"use strict";define("Dashboards/DashboardPanel",["require","exports","react","VSS/Core/Util/Accessibility","VSS/Core/Util/String","VSS/Features/Identities/IdentityPickerProvider","VSS/Platform/Feature","VSSUI/Checkbox","VSSUI/Dropdown","VSSUI/FormItem","VSS/Platform/Layout","VSSUI/IdentityPicker","VSSUI/MessageCard","VSSUI/Panel","VSSUI/RadioButton","VSSUI/Spinner","VSSUI/TextField","VSSUI/Util","VSSUI/Utilities/DropdownSelection","VSS/Legacy/Legacy","VSSUI/Link"],function(e,t,s,a,r,o,i,d,n,l,h,c,p,m,b,u,g,D,j,y,I){var S,T,P,f;S=t.Resources={},t.Resources.AutoRefreshFieldLabel="Automatically refresh the dashboard every 5 minutes",t.Resources.CancelButtonLabel="Cancel",t.Resources.CreateDashboardPanelTitle="Create a dashboard",t.Resources.CopyDashboardPanelTitle="New dashboard",t.Resources.CreateDashboardSubmitButtonLabel="Create",t.Resources.DashboardTypeFieldLabel="Dashboard Type",t.Resources.DashboardTypeProjectDescription="The dashboard is not associated with a team. You decide which users and groups can edit and manage this dashboard. Everyone can view the dashboard. ",t.Resources.DashboardTypeProjectOption="Project Dashboard",t.Resources.DashboardTypeTeamDescription="The dashboard is associated with a single team. Team admins can edit and manage this dashboard. Everyone can view the dashboard.",t.Resources.DashboardTypeTeamOption="Team Dashboard",t.Resources.DescriptionFieldLabel="Description",t.Resources.DescriptionFieldMaxLengthError="Description must be less than {0} characters",t.Resources.DescriptionFieldPlaceholder="Enter a description",t.Resources.InfoIconDescription="Info icon to show detailed description",t.Resources.ManageDashboardPanelDescription="Change the name or the description to help others quickly find this dashboard, as well as manage permissions.",t.Resources.ManageDashboardPanelTitle="Settings for {0}",t.Resources.ManageDashboardSubmitButtonLabel="Save",t.Resources.ManagePermissionsLink="Manage permissions for this dashboard",t.Resources.NameFieldLabel="Name*",t.Resources.NameFieldMaxLengthError="Dashboard name must be less than {0} characters",t.Resources.OwnerNotFoundError="Owner not found for this dashboard",t.Resources.NameFieldPlaceholder="Enter a name",t.Resources.PanelTitle="Create a dashboard",t.Resources.SecuritySectionHeading="Security",t.Resources.SecuritySectionProjectDashboardDescription="Only dashboard administrators can set permissions for this dashboard. The Owner is an administrator by default.",t.Resources.SecuritySectionTeamDashboardDescription="Only team admins can set a team's permissions for a dashboard.",t.Resources.OwnerFieldLabel="Owner",t.Resources.DashboardOwnerPicker_SearchUsers="Search users",t.Resources.SelectOwnerAriaLabel="Select a user to be the owner for this dashboard",t.Resources.TeamDashboardOwnerFieldLabel="Owned by team",t.Resources.TeamFieldDropdownLoadingPrompt="Loading Teams",t.Resources.TeamFieldDropdownPrompt="Select a Team",t.Resources.ProjectFieldDropdownLoadingPrompt="Loading Projects",t.Resources.ProjectFieldDropdownPrompt="Select a Project",t.Resources.TeamFieldLabel="Team",t.Resources.ProjectFieldLabel="Project",t.Resources.ValueRequired="Value is required",t.Resources.CopyDashboardQueriesCheckBoxLabel="Select folder to copy dashboard queries",t.Resources.QueryFolderDropdownFieldLabel="Select folder location for queries",t.Resources.QueryFolderDropdownPlaceholder="Select folder",t.Resources.QueryFolderDropdownFieldLabelError="Folder not found.",t.Resources.SharedQueries="Shared Queries",T=t.Common={},t.Common.Constants=Object.freeze({maxNameLength:32,maxDescriptionLength:128,autoRefreshIntervalInMins:5}),(f=t.Common.DashboardType||(t.Common.DashboardType={})).Project="project",f.Team="team",t.Common.WebAccessDashboardsSecurityDialog="WebAccess.Dashboards.SecurityDialog",t.Common.WebAccessUseCopyDashboardDedicatedApi="WebAccess.Dashboards.UseCopyDashboardDedicatedApi",t.Common.SecurityNameSpaceIdForDashboards="8ADF73B7-389A-4276-B638-FE1653F7EFC7",function(e){function y(e,t){const s={name:null,description:null,owner:null};return e.name&&e.name.trim()?e.name.trim().length>=T.Constants.maxNameLength&&(s.name=(0,r.format)(S.NameFieldMaxLengthError,T.Constants.maxNameLength)):s.name=S.ValueRequired,e.description&&e.description.trim().length>=T.Constants.maxDescriptionLength&&(s.description=(0,r.format)(S.DescriptionFieldMaxLengthError,T.Constants.maxDescriptionLength)),t&&!e.owner&&(s.owner=S.OwnerNotFoundError),e.copyQueriesFlag&&e.queryFolderPath&&e.queryFolderPath.trim().length>=T.Constants.maxDescriptionLength&&(s.owner=S.QueryFolderDropdownFieldLabelError),s}P=t.DashboardPanel={};class I extends h.VssComponent{constructor(e,t){super(e,t),this.teamSelection=new j.DropdownSelection,this.projectSelection=new j.DropdownSelection,this.handleDismiss=(()=>{this.props.onDismiss()}),this.handleSubmit=(()=>{this.setState({submitting:!0,submissionError:null},async()=>{try{await this.props.onSubmit(this.state.fields,this.state.selectedDashboardType)}catch(e){this.setState({submitting:!1,submissionError:e.message})}})}),this.onNameChange=((e,t)=>{const s=Object.assign(Object.assign({},this.state.fields),{name:t});this.setState({fields:s,errors:Object.assign(Object.assign({},this.state.errors),y(s,this.props.showOwnerField))})}),this.onDescriptionChange=((e,t)=>{const s=Object.assign(Object.assign({},this.state.fields),{description:t});this.setState({fields:s,errors:Object.assign(Object.assign({},this.state.errors),y(s,this.props.showOwnerField))})}),this.onOwnerChange=(e=>{if(e){const t=Object.assign(Object.assign({},this.state.fields),{owner:e});this.setState({fields:t,errors:Object.assign(Object.assign({},this.state.errors),y(t,this.props.showOwnerField))})}}),this.onOwnerClear=(()=>{const e=Object.assign(Object.assign({},this.state.fields),{owner:void 0});this.setState({fields:e,errors:Object.assign(Object.assign({},this.state.errors),y(e,this.props.showOwnerField))})}),this.onAutoRefreshChange=((e,t)=>{const s=Object.assign(Object.assign({},this.state.fields),{autoRefresh:t});this.setState({fields:s})}),this.onCopyQueriesFlagChange=((e,t)=>{const s=Object.assign(Object.assign({},this.state.fields),{copyQueriesFlag:this.state.disableQueryCheckboxfield?this.state.fields.copyQueriesFlag:t});this.setState({fields:s})}),this.onDashboardTypeSelect=(e=>{let t=null;e!==T.DashboardType.Team||this.state.fields.teamId||(t=S.ValueRequired),this.setState({selectedDashboardType:e,errors:Object.assign(Object.assign({},this.state.errors),{teamId:t})})}),this.onDashboardProjectTeamSelect=(e=>{var t,s,a;let r=null;r=this.state.fields.projectId?null:S.ValueRequired;let o=this.state.fields.projectId===(null===(t=this.props.dashboardProject)||void 0===t?void 0:t.id);if(e===T.DashboardType.Project)this.setState({selectedDashboardType:e,fields:Object.assign(Object.assign({},this.state.fields),{copyQueriesFlag:!o||this.state.fields.copyQueriesFlag}),errors:Object.assign(Object.assign({},this.state.errors),{projectId:r,teamId:null}),disableQueryCheckboxfield:!o});else{let t=0,i=this.getTeamDropdownItems(!0,this.state.fields.projectId);if(this.props.projects&&0!=this.props.projects.length)if(i&&0!=i.length)this.setState({selectedDashboardType:e,teamItems:i,fields:Object.assign(Object.assign({},this.state.fields),{teamId:i[t].id,copyQueriesFlag:!o||this.state.fields.copyQueriesFlag}),errors:Object.assign(Object.assign({},this.state.errors),{projectId:r,teamId:null}),disableQueryCheckboxfield:!o},()=>{this.teamSelection.select(t)});else{const t=this.props.projects.find(e=>e.id==this.state.fields.projectId);this.setState(Object.assign(Object.assign({},this.state),{selectedDashboardType:e,teamItems:[],teamsLoading:!0,submitting:!1,fields:Object.assign(Object.assign({},this.state.fields),{teamId:void 0,copyQueriesFlag:!o||this.state.fields.copyQueriesFlag}),errors:Object.assign(Object.assign({},this.state.errors),{projectId:null,teamId:null}),disableQueryCheckboxfield:!o})),null===(a=(s=this.props).onProjectSelectLoadTeam)||void 0===a||a.call(s,t)}else this.setState(Object.assign(Object.assign({},this.state),{selectedDashboardType:e,teamItems:[],teamsLoading:!0,submitting:!1,fields:Object.assign(Object.assign({},this.state.fields),{teamId:void 0,copyQueriesFlag:!o||this.state.fields.copyQueriesFlag}),errors:Object.assign(Object.assign({},this.state.errors),{projectId:null,teamId:null}),disableQueryCheckboxfield:!o}))}}),this.onTeamSelect=((e,t)=>{this.setState({fields:Object.assign(Object.assign({},this.state.fields),{teamId:t.id}),errors:Object.assign(Object.assign({},this.state.errors),{teamId:null})})}),this.onProjectSelect=((e,t)=>{var s,a,r,o;if(!0===this.props.showDashboardProjectTeamSelector&&t.id!==this.state.fields.projectId){let e=0,i=this.state.selectedDashboardType===T.DashboardType.Team?this.getTeamDropdownItems(!0,t.id):this.state.teamItems,d=t.id===this.props.dashboardProject.id;if(i&&0!==i.length){let s=t.id===this.props.dashboardProject.id;this.setState({teamItems:this.state.selectedDashboardType===T.DashboardType.Team?i:this.state.teamItems,fields:Object.assign(Object.assign({},this.state.fields),{projectId:t.id,teamId:i[e].id,copyQueriesFlag:!s||this.state.fields.copyQueriesFlag}),errors:Object.assign(Object.assign({},this.state.errors),{projectId:null,teamId:null}),disableQueryCheckboxfield:!s},()=>{this.teamSelection.select(e)})}else this.setState({teamItems:[],teamsLoading:!0,submitting:!1,fields:Object.assign(Object.assign({},this.state.fields),{projectId:t.id,teamId:void 0,copyQueriesFlag:!d||this.state.fields.copyQueriesFlag}),errors:Object.assign(Object.assign({},this.state.errors),{projectId:null,teamId:null}),disableQueryCheckboxfield:!d}),null===(a=(s=this.props).onProjectSelectLoadTeam)||void 0===a||a.call(s,null!==(o=null===(r=this.props.projects)||void 0===r?void 0:r.find(e=>e.id===t.id))&&void 0!==o?o:{id:t.id,name:t.text})}}),this.onQueriesChanged=(e=>{const t=Object.assign(Object.assign({},this.state.fields),{queryFolderPath:e});this.setState({fields:t})}),e.showOwnerField&&null!=e.dashboard&&this.initializeOwnerIdentityPickerProvider(),this.state={fields:this.getInitialFields(),errors:{name:null,description:null,projectId:e.dashboardProject&&null!=e.dashboardProject.id?null:S.ValueRequired,teamId:null!=e.dashboard?null:S.ValueRequired,owner:e.showOwnerField&&!e.dashboardOwner?S.OwnerNotFoundError:null},projectItems:[],teamItems:[],projectsLoading:!0,teamsLoading:!0,selectedDashboardType:T.DashboardType.Team,submitting:!1,submissionError:null,disableQueryCheckboxfield:!1}}componentDidMount(){this.props.showDashboardTypeSelector&&this.loadTeams(),this.props.showDashboardProjectTeamSelector&&this.loadProjectAndTeams(),this.props.showQueryFolderSelector&&this.loadQueryFolder()}componentDidUpdate(e){this.props.showDashboardProjectTeamSelector&&e.projects!=this.props.projects?this.loadProjectAndTeams():this.props.showDashboardProjectTeamSelector&&e.projectTeamMap!=this.props.projectTeamMap&&this.loadTeamsForSpecificProject()}render(){return this.props.hidePanel?null:s.createElement(m.Panel,{description:this.props.description,footerButtonProps:this.getFooterButtonProps(),onDismiss:this.handleDismiss,titleProps:{text:this.getTitleText()}},s.createElement("div",{className:"dashboard-panel-content"},this.renderSubmissionErrorMessage(),s.createElement(l.FormItem,{className:"dashboard-panel-form-item",label:S.NameFieldLabel,error:null!=this.state.errors.name,message:this.state.errors.name},s.createElement(g.TextField,{value:this.state.fields.name,placeholder:S.NameFieldPlaceholder,width:"auto",onChange:this.onNameChange,required:!0,disabled:this.state.submitting})),s.createElement(l.FormItem,{label:S.DescriptionFieldLabel,error:null!=this.state.errors.description,message:this.state.errors.description},s.createElement(g.TextField,{placeholder:S.DescriptionFieldPlaceholder,multiline:!0,rows:10,value:this.state.fields.description,onChange:this.onDescriptionChange,width:"auto",disabled:this.state.submitting})),s.createElement(d.Checkbox,{label:S.AutoRefreshFieldLabel,checked:this.state.fields.autoRefresh,onChange:this.onAutoRefreshChange,disabled:this.state.submitting}),this.props.showDashboardTypeSelector&&this.renderDashboardTypeSelector(),this.props.showDashboardProjectTeamSelector&&this.renderDashboardProjectTeamSelector(),this.props.showOwnerField&&this.renderOwnerField(),this.props.showQueryFolderSelector&&s.createElement(d.Checkbox,{label:S.CopyDashboardQueriesCheckBoxLabel,checked:this.state.fields.copyQueriesFlag,onChange:this.onCopyQueriesFlagChange,disabled:this.state.disableQueryCheckboxfield||this.state.submitting}),this.props.showQueryFolderSelector&&this.state.fields.copyQueriesFlag&&this.renderQueryFolderDropdownField(),this.props.children))}initializeOwnerIdentityPickerProvider(){const e=this.context.pageContext.getService("IVssPageService").getData();this.pickerProvider=new o.PeoplePickerProvider(this.context.pageContext,{identityTypes:this.isTeamDashboard()?["group"]:["user"],options:{MinResults:I.peoplePickerMinResultsToDisplay,MaxResults:I.peoplePickerMaxResultsToDisplay},operationScopes:e.isHosted?["ims","source"]:["ims","source","ad"]})}getFooterButtonProps(){return[{text:this.state.submitting?"":this.props.submitButtonLabel,primary:!0,onClick:this.handleSubmit,disabled:this.isFormInvalid()||this.state.submitting,iconProps:this.state.submitting?{render:()=>s.createElement(u.Spinner,{size:"small"})}:void 0},{text:S.CancelButtonLabel,onClick:this.handleDismiss,disabled:this.state.submitting}]}getInitialFields(){return null!=this.props.dashboard?{name:this.props.dashboard.name||"",description:this.props.dashboard.description||"",teamId:this.props.dashboardTeam?this.props.dashboardTeam.id:void 0,projectId:this.props.dashboardProject?this.props.dashboardProject.id:void 0,owner:this.props.dashboardOwner||void 0,autoRefresh:this.props.dashboard.refreshInterval===T.Constants.autoRefreshIntervalInMins,copyQueriesFlag:!1,queryFolderPath:S.SharedQueries}:{name:"",description:"",teamId:void 0,projectId:this.props.dashboardProject?this.props.dashboardProject.id:void 0,owner:void 0,autoRefresh:!1,copyQueriesFlag:!1,queryFolderPath:""}}getInitialProjectId(){return this.props.dashboardProject&&this.props.dashboardProject.id?this.props.dashboardProject.id:this.props.projects&&this.props.projects[0]&&this.props.projects[0].id?this.props.projects[0].id:""}getInitialTeamId(){const e=this.context.pageContext.getService("IVssContributionService").getData("ms.vss-dashboards-web.dashboards-team-data-provider");return e&&e.value&&e.value.id}getInitialQueryId(){return S.SharedQueries}getTeamDropdownItems(e=!1,t=""){let s;if(e)s=this.props.projectTeamMap&&this.props.projectTeamMap[t]?this.getTeamItems(this.props.projectTeamMap[t].teamList):[];else{const e=this.props.allTeams.filter(e=>!this.props.userTeams.some(t=>t.id===e.id)),t=this.getTeamItems(this.props.userTeams),a=this.getTeamItems(e),r={id:"divider",type:3};s=t,a.length&&(s.length&&(s=s.concat(r)),s=s.concat(a))}return s}getProjectDropdownItems(){return this.getTeamItems(this.props.projects?this.props.projects:[])}getTeamItems(e){return e.map(e=>({id:e.id,text:e.name})).sort((e,t)=>(0,r.localeComparer)(e.text,t.text))}getTitleText(){return"function"==typeof this.props.title?this.props.title(this.state.fields.name):this.props.title}loadTeams(){const e=this.getInitialTeamId();this.setState({teamItems:this.getTeamDropdownItems(),teamsLoading:!1,fields:Object.assign(Object.assign({},this.state.fields),{teamId:e||this.state.fields.teamId}),errors:Object.assign(Object.assign({},this.state.errors),{teamId:e?null:this.state.errors.teamId})},()=>{const t=this.state.teamItems.findIndex(t=>t.id===e);-1!==t&&this.teamSelection.select(t)})}loadQueryFolder(){const e=this.getInitialQueryId();this.setState({fields:Object.assign(Object.assign({},this.state.fields),{queryFolderPath:e||this.state.fields.queryFolderPath})})}loadProjectAndTeams(){const e=this.getInitialProjectId(),t=this.getInitialTeamId(),s=this.getTeamDropdownItems(!0,e),a=this.getProjectDropdownItems();let r=(e||this.state.fields.projectId)===this.props.dashboardProject.id;this.setState({teamItems:null!=s?s:[],projectItems:null!=a?a:[],teamsLoading:!(s&&0!==s.length),projectsLoading:!(a&&0!==a.length),fields:Object.assign(Object.assign({},this.state.fields),{teamId:t||this.state.fields.teamId,projectId:e||this.state.fields.projectId,copyQueriesFlag:!r||this.state.fields.copyQueriesFlag}),errors:Object.assign(Object.assign({},this.state.errors),{teamId:t?null:this.state.errors.teamId,projectId:e?null:this.state.errors.projectId}),disableQueryCheckboxfield:!r},()=>{const s=this.state.teamItems.findIndex(e=>e.id===t);-1!==s&&this.teamSelection.select(s);const a=this.state.projectItems.findIndex(t=>t.id===e);-1!==a&&this.projectSelection.select(a)})}loadTeamsForSpecificProject(){if(this.state.fields.projectId){let e=0,t=this.state.selectedDashboardType===T.DashboardType.Team?this.getTeamDropdownItems(!0,this.state.fields.projectId):this.state.teamItems;this.setState({teamItems:this.state.selectedDashboardType===T.DashboardType.Team?t:this.state.teamItems,teamsLoading:!1,fields:Object.assign(Object.assign({},this.state.fields),{teamId:t[e].id}),errors:Object.assign(Object.assign({},this.state.errors),{projectId:null,teamId:null})},()=>{this.teamSelection.select(e)})}}isFormInvalid(){const e=Object.keys(this.state.errors);return!this.areProjectTeamPopulatedForDashboardType()||""===this.state.fields.name||e.some(e=>null!==this.state.errors[e])}areProjectTeamPopulatedForDashboardType(){return!this.props.showDashboardProjectTeamSelector||(this.state.selectedDashboardType==T.DashboardType.Project?!!this.state.fields.projectId:this.state.selectedDashboardType==T.DashboardType.Team&&(!!this.state.fields.projectId&&!!this.state.fields.teamId))}isTeamDashboard(){return 1===this.props.dashboard.dashboardScope}renderDashboardTypeRadioButton(e){const t="rb-label-"+e,a="rb-label-info-"+e,r=e===T.DashboardType.Team?S.DashboardTypeTeamOption:S.DashboardTypeProjectOption,o=e===T.DashboardType.Team?S.DashboardTypeTeamDescription:S.DashboardTypeProjectDescription;return s.createElement(s.Fragment,null,s.createElement(b.RadioButton,{id:e,ariaLabelledBy:t,ariaDescribedBy:a},s.createElement("div",{className:"dashboard-panel-dashboard-type-radio-button"},s.createElement("div",{className:"bolt-radio-button-label",id:(0,D.getSafeId)(t)},r))),s.createElement("div",{className:"dashboard-panel-dashboard-type-radio-button-sub-text font-size-ms secondary-text",id:(0,D.getSafeId)(a)},o))}renderDashboardTypeSelector(){return(0,i.isFeatureEnabled)(this.context.pageContext,"ms.vss-dashboards.team-agnostic-dashboards-feature",!1)?s.createElement(s.Fragment,null,s.createElement(b.RadioButtonGroup,{className:"dashboard-panel-dashboard-type-section",onSelect:this.onDashboardTypeSelect,selectedButtonId:this.state.selectedDashboardType,text:S.DashboardTypeFieldLabel},this.renderDashboardTypeRadioButton(T.DashboardType.Team),this.renderDashboardTypeRadioButton(T.DashboardType.Project)),this.state.selectedDashboardType===T.DashboardType.Team?this.renderTeamDropdownField():null):this.renderTeamDropdownField()}renderDashboardProjectTeamSelector(){return s.createElement(s.Fragment,null,s.createElement(b.RadioButtonGroup,{className:"dashboard-panel-dashboard-project-team-section",onSelect:this.onDashboardProjectTeamSelect,selectedButtonId:this.state.selectedDashboardType,text:S.DashboardTypeFieldLabel},this.renderDashboardTypeRadioButton(T.DashboardType.Team),this.renderDashboardTypeRadioButton(T.DashboardType.Project)),this.renderProjectDropdownField(),this.state.selectedDashboardType===T.DashboardType.Team?this.renderTeamDropdownField():null)}renderOwnerField(){return s.createElement(l.FormItem,{className:"dashboard-panel-owner-form-item",label:this.props.dashboard&&this.isTeamDashboard()?S.TeamDashboardOwnerFieldLabel:S.OwnerFieldLabel},s.createElement(c.IdentityPickerDropdown,{disabled:this.props.disableOwnerField,pickerProvider:this.pickerProvider,onChange:this.onOwnerChange,onClear:this.onOwnerClear,suggestionsContainerAriaLabel:S.SelectOwnerAriaLabel,value:this.state.fields.owner,editPlaceholder:S.DashboardOwnerPicker_SearchUsers}))}renderSubmissionErrorMessage(){return this.state.submissionError?((0,a.announce)(this.state.submissionError),s.createElement(p.MessageCard,{onDismiss:()=>this.setState({submissionError:null}),severity:"Error"},this.state.submissionError)):null}renderTeamDropdownField(){return s.createElement(l.FormItem,{className:"dashboard-panel-team-form-item",label:S.TeamFieldLabel},s.createElement(n.Dropdown,{items:this.state.teamItems,loading:this.state.teamsLoading,onSelect:this.onTeamSelect,selection:this.teamSelection,placeholder:this.state.teamsLoading?S.TeamFieldDropdownLoadingPrompt:S.TeamFieldDropdownPrompt,disabled:this.state.teamsLoading||this.state.submitting}))}renderQueryFolderDropdownField(){return s.createElement(l.FormItem,{className:"padding-top-16",label:S.QueryFolderDropdownFieldLabel},s.createElement(h.WrappedComponent,Object.assign({dependencies:[" ms.vss-work-web.common-query-save-dialog"],wrappedType:"FolderDropdownGeneral"},{mode:1,onQueriesChanged:this.onQueriesChanged,navigateToQueryOnSave:!1,projectId:this.state.fields.projectId},{disabled:this.state.submitting})))}renderProjectDropdownField(){return s.createElement(l.FormItem,{className:"dashboard-panel-project-form-item",label:S.ProjectFieldLabel},s.createElement(n.Dropdown,{items:this.state.projectItems,loading:this.state.projectsLoading,onSelect:this.onProjectSelect,selection:this.projectSelection,placeholder:this.state.projectsLoading?S.ProjectFieldDropdownLoadingPrompt:S.ProjectFieldDropdownPrompt,disabled:this.state.projectsLoading||this.state.submitting}))}}t.DashboardPanel.DashboardPanel=I,I.peoplePickerMinResultsToDisplay=5,I.peoplePickerMaxResultsToDisplay=20,I.defaultProps={disableOwnerField:!1,hidePanel:!1,showDashboardTypeSelector:!1,showOwnerField:!1,showQueryFolderSelector:!1}}(),function(e){t.CopyDashboardPanel={};t.CopyDashboardPanel.CopyDashboardPanel=class extends h.VssComponent{constructor(){super(...arguments),this.handleSubmit=((e,t)=>new Promise((s,a)=>{const r=this.context.pageContext.getRestClient("IDashboardRestClient"),o={teamId:t===T.DashboardType.Team?e.teamId:null,projectId:e.projectId,project:"",team:""};if(!0===this.props.useDedicatedApi){const s={teamId:this.props.team&&this.props.team.id?this.props.team.id:"",projectId:this.props.project&&this.props.project.id?this.props.project.id:"",project:"",team:""},i=t==T.DashboardType.Project?{copyDashboardScope:2,projectId:e.projectId?e.projectId:"",teamId:"",name:e.name,description:e.description,refreshInterval:e.autoRefresh?T.Constants.autoRefreshIntervalInMins:0,copyQueriesFlag:!!e.copyQueriesFlag&&e.copyQueriesFlag,queryFolderPath:e.queryFolderPath?e.queryFolderPath:S.SharedQueries}:{copyDashboardScope:1,projectId:e.projectId?e.projectId:"",teamId:e.teamId?e.teamId:"",name:e.name,description:e.description,refreshInterval:e.autoRefresh?T.Constants.autoRefreshIntervalInMins:0,copyQueriesFlag:!!e.copyQueriesFlag&&e.copyQueriesFlag,queryFolderPath:e.queryFolderPath?e.queryFolderPath:S.SharedQueries};r.copyDashboard(i,s,this.props.dashboard.id).then(e=>{this.props.onDashboardCopied(Object.assign(Object.assign({},o),e.copiedDashboard))}).catch(e=>{a(e)})}else{const t=Object.assign(Object.assign({},this.props.dashboard),{name:e.name,id:"",description:e.description,refreshInterval:e.autoRefresh?T.Constants.autoRefreshIntervalInMins:0});r.createDashboard(t,o).then(e=>{this.props.onDashboardCopied(Object.assign(Object.assign({},o),e))}).catch(e=>{a(e)})}}))}render(){const{onDismiss:e,project:t,projects:a,projectTeamMap:r,team:o}=this.props;return s.createElement(P.DashboardPanel,{dashboardTeam:o,dashboardProject:t,allTeams:[],onDismiss:e,onSubmit:this.handleSubmit,submitButtonLabel:S.CreateDashboardSubmitButtonLabel,title:S.CopyDashboardPanelTitle,userTeams:[],showDashboardProjectTeamSelector:!0,showQueryFolderSelector:!0,projects:a,projectTeamMap:r,onProjectSelectLoadTeam:this.props.onLoadNewTeamsForProject})}}}(),function(e){t.CreateDashboardPanel={};t.CreateDashboardPanel.CreateDashboardPanel=class extends h.VssComponent{constructor(){super(...arguments),this.handleSubmit=((e,t)=>new Promise((s,a)=>{const r={name:e.name,description:e.description,refreshInterval:e.autoRefresh?T.Constants.autoRefreshIntervalInMins:0},o={teamId:t===T.DashboardType.Team?e.teamId:null,projectId:this.props.project.id,project:this.props.project.name,team:""};this.context.pageContext.getRestClient("IDashboardRestClient").createDashboard(r,o).then(e=>{this.props.onDashboardCreated(Object.assign(Object.assign({},o),e)),s()}).catch(e=>{a(e)})}))}render(){return s.createElement(P.DashboardPanel,{allTeams:this.props.allTeams,onDismiss:this.props.onDismiss,onSubmit:this.handleSubmit,submitButtonLabel:S.CreateDashboardSubmitButtonLabel,title:S.CreateDashboardPanelTitle,showDashboardTypeSelector:!0,userTeams:this.props.userTeams,dashboardProject:this.props.project})}}}(),function(e){t.ManageDashboardPanel={};class a extends h.VssComponent{constructor(e,t){super(e,t),this.handleSubmit=(e=>new Promise((t,s)=>{const a=Object.assign(Object.assign({},this.props.dashboard),{name:e.name,description:e.description,refreshInterval:e.autoRefresh?T.Constants.autoRefreshIntervalInMins:0,ownerId:e.owner?e.owner.localId:void 0});let r={projectId:this.props.project.id,project:this.props.project.name,teamId:"",team:""};this.props.team&&(r=Object.assign(Object.assign({},r),{teamId:this.props.team.id,team:this.props.team.name})),this.context.pageContext.getRestClient("IDashboardRestClient").replaceDashboard(a,r,a.id).then(e=>{this.props.onDashboardUpdated(e),t()}).catch(e=>{s(e)})})),this.onManagePermissionsClick=(()=>{this.setState({hidePanel:!0},()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout(e=>{const t=this.props.team?this.props.team.id:a.teamScopedGroupId;if((0,i.isFeatureFlagEnabled)(this.context.pageContext,T.WebAccessDashboardsSecurityDialog,!1)){const a={onCancel:()=>{e(),this.setState({hidePanel:!1})},securityViewTitle:this.props.dashboard.name,permissionSetId:T.SecurityNameSpaceIdForDashboards,permissionSetToken:JSON.stringify({teamId:t,dashboardId:this.props.dashboard.id})};return s.createElement(h.WrappedComponent,{dependencies:["ms.vss-admin-web.security-view-common-content"],wrappedType:"ms.vss-admin-web.security-panel-component",wrappedProps:a})}{const a={dashboardId:this.props.dashboard.id,dashboardName:this.props.dashboard.name,teamId:t,onClose:()=>{e(),this.setState({hidePanel:!1})}};return s.createElement(y.LegacyComponent,{modules:["Dashboards/Components/Directory/DashboardsSecurityDialog"],wrappedType:"DashboardSecurityDialog",wrappedProps:a})}})})}),this.state={hidePanel:!1}}render(){const{dashboard:e,team:t,owner:a,canManagePermissionsForDashboard:o,onDismiss:i}=this.props,d=!this.isProjectDashboard();return s.createElement(P.DashboardPanel,{allTeams:[],dashboard:e,dashboardTeam:t,dashboardOwner:a,description:S.ManageDashboardPanelDescription,disableOwnerField:d||!o,hidePanel:this.state.hidePanel,onDismiss:i,onSubmit:this.handleSubmit,submitButtonLabel:S.ManageDashboardSubmitButtonLabel,showOwnerField:!0,title:e=>(0,r.format)(S.ManageDashboardPanelTitle,e),userTeams:[],dashboardProject:this.props.project},this.renderSecuritySection())}renderSecuritySection(){return s.createElement("div",{className:"manage-dashboard-panel-security-section"},s.createElement("div",{className:"manage-dashboard-panel-security-section-heading"},S.SecuritySectionHeading),s.createElement("div",{className:"manage-dashboard-panel-security-section-description"},this.getSecuritySectionDescription()),s.createElement(I.Link,{onClick:this.onManagePermissionsClick},S.ManagePermissionsLink))}isProjectDashboard(){return 2===this.props.dashboard.dashboardScope}getSecuritySectionDescription(){return this.isProjectDashboard()?S.SecuritySectionProjectDashboardDescription:S.SecuritySectionTeamDashboardDescription}}t.ManageDashboardPanel.ManageDashboardPanel=a,a.teamScopedGroupId="00000000-0000-0000-0000-000000000000"}()},["Resources","Common","DashboardPanel","CopyDashboardPanel","CreateDashboardPanel","ManageDashboardPanel"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-dashboards.dashboards-dashboard-panel"}}));