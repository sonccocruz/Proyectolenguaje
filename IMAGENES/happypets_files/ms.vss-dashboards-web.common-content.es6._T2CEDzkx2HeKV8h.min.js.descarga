"use strict";define("Dashboards/Common",["require","exports","VSS/Platform/Context","VSS/Platform/Feature","VSS/Core/Observable","VSS/Core/Util/String"],function(e,s,i,t,r,a){var n,o,d;n=s.Resources={},s.Resources.Dashboard_Timer_Initialized="Updated less than a minute ago",s.Resources.Dashboard_Timer_Updated_hours="Updated 1 hour ago",s.Resources.Dashboard_Timer_Updated_minutes="Updated {0} minutes ago",s.Resources.Dashboard_Timer_Updated_one_minute="Updated 1 minute ago",o=s.Constants={},s.Constants.DisableUserNamePrefixForProjectDashboardFeature="ms.vss-dashboards-web.project-level-dashboard-disable-user-prefix-feature",function(e){s.FavoriteProviderDataService={};i.Services.add("dashboard-favorite-provider-data-service",{serviceFactory:class extends i.VssService{getArtifactType(){return"Microsoft.TeamFoundation.Dashboards.Dashboard"}getDisplayName({artifactName:e,artifactProperties:s}){return this.areDashboardFavoriteProperties(s)?!s.groupId&&(0,t.isFeatureEnabled)(this.pageContext,o.DisableUserNamePrefixForProjectDashboardFeature,!1)?e:`${s.ownerName} - ${e}`:e}areDashboardFavoriteProperties(e){return null!=e&&null!=e.ownerId&&null!=e.ownerName}}})}(),d=s.PageVisibility={},function(e){let s,i={hidden:"hidden",visibilityChangeEventName:"visibilitychange"};function t(e,s){i={hidden:e,visibilityChangeEventName:s}}function r(){return void 0!==document.addEventListener&&void 0!==document[i.hidden]}void 0!==document.hidden?t("hidden","visibilitychange"):void 0!==document.mozHidden?t("mozHidden","mozvisibilitychange"):void 0!==document.msHidden?t("msHidden","msvisibilitychange"):void 0!==document.webkitHidden&&t("webkitHidden","webkitvisibilitychange"),r()&&(s=!document[i.hidden],document.addEventListener(i.visibilityChangeEventName,()=>{s=!document[i.hidden]},!1)),e.isPageVisible=function(){return!r()||s}}(s.PageVisibility.PageVisibility||(s.PageVisibility.PageVisibility={})),function(e){s.RefreshManager={};class i extends r.Observable{constructor(){super(...arguments),this.refreshCountdownEnable=!0,this.refreshTimeout=0}static getInstance(){return i.instance||(i.instance=new i),i.instance}getTimeLabelText(){const e=this.getTimeDifferenceInSecond(this.startDateTime,new Date);if(null!=e){const s=Math.floor(e/60);if(0==s)return n.Dashboard_Timer_Initialized;if(1==s)return n.Dashboard_Timer_Updated_one_minute;if(s>=60)return n.Dashboard_Timer_Updated_hours;if(s>1)return a.format(n.Dashboard_Timer_Updated_minutes,s)}return""}setAndStartRefreshTimer(e){this.refreshTimeout=e,this.refreshTimeout?this.resetRefreshCountdown():this.stop()}resetRefreshCountdown(){this.refreshTimeout&&(this.stop(),this.startDateTime=new Date,this.refreshDateTime=new Date(this.startDateTime.getTime()+60*this.refreshTimeout*1e3),this.refreshCountdownEnable=!0,this.tick())}stopRefreshCountdown(){this.refreshCountdownEnable=!1}tick(){const e=new Date,s=this.getTimeDifferenceInSecond(e,this.refreshDateTime);s&&s<=0&&this.refreshCountdownEnable&&d.PageVisibility.isPageVisible()?(this.stop(),this.notify(null,"refresh_dashboards")):this.updateTimerHandle=setTimeout(()=>{this.tick()},1e3)}getTimeDifferenceInSecond(e,s){return e&&s?Math.floor((s.getTime()-e.getTime())/1e3):null}stop(){null!=this.updateTimerHandle&&(clearTimeout(this.updateTimerHandle),this.updateTimerHandle=null)}}s.RefreshManager.DashboardRefreshManager=i}(),function(e){s.UserPermissions={};class t extends i.VssService{CanReadDashboards(){return this.hasModernRead()||this.hasModernManagePermissions()}CanCreateDashboards(){return this.hasModernCreate()||this.hasModernManagePermissions()}CanEditDashboards(){return this.hasModernEdit()||this.hasModernManagePermissions()}CanDeleteDashboards(){return this.hasModernDelete()||this.hasModernManagePermissions()}CanManagePermissionForDashboards(){return this.hasModernManagePermissions()}getPermissionsForUser(){const e=this.pageContext.getService("IVssContributionService").getData("ms.vss-dashboards-web.dashboards-team-context-data-provider");return null!=e?e.value:0}hasLegacyRead(){return 0!=(this.getPermissionsForUser()&a.Read)}hasLegacyEdit(){return 0!=(this.getPermissionsForUser()&a.Edit)}hasLegacyManage(){return 0!=(this.getPermissionsForUser()&a.Manage)}hasLegacyManagePermissions(){return 0!=(this.getPermissionsForUser()&a.ManagePermissions)}hasModernRead(){return 0!=(this.getPermissionsForUser()&r.Read)}hasModernCreate(){return 0!=(this.getPermissionsForUser()&r.Create)}hasModernEdit(){return 0!=(this.getPermissionsForUser()&r.Edit)}hasModernDelete(){return 0!=(this.getPermissionsForUser()&r.Delete)}hasModernManagePermissions(){return 0!=(this.getPermissionsForUser()&r.ManagePermissions)}}var r,a;s.UserPermissions.DashboardsUserPermissionService=t,function(e){e[e.Read=1]="Read",e[e.Create=2]="Create",e[e.Edit=4]="Edit",e[e.Delete=8]="Delete",e[e.ManagePermissions=16]="ManagePermissions"}(r||(r={})),function(e){e[e.Read=1]="Read",e[e.Edit=2]="Edit",e[e.Manage=4]="Manage",e[e.ManagePermissions=8]="ManagePermissions"}(a||(a={})),i.Services.add("IDashboardsUserPermissionService",{serviceFactory:t})}()},["Resources","Constants","FavoriteProviderDataService","PageVisibility","RefreshManager","UserPermissions"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-dashboards-web.common-content"}}));