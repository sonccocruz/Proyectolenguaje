"use strict";define("Dashboards/WidgetCatalog",["require","exports","VSS/Platform/Util/Url","VSS/Ext/ExternalContentUtil","VSS/Platform/Feature"],function(t,o,e,n,i){var r;r=o.Resources={},o.Resources.WidgetContributionIdMissing="Widget Contribution Id was not provided",o.Resources.WidgetContributionCouldNotLoad="Widget Contribution could not be loaded, for Widget Type Id: {0}",o.Resources.WidgetComponentContributionIdMissing="Component Contribution Id was not provided",o.Resources.WidgetComponentContributionCouldNotLoad="Component Contribution could not be loaded",o.Resources.MicrosoftContributionPublisherName="Microsoft",function(t){o.WidgetCatalogQuery={};o.WidgetCatalogQuery.WidgetCatalogQuery=class{constructor(t){this.projectId=t}getKey(){return"WidgetCatalogQuery."+(null!=this.projectId?this.projectId.toLowerCase():"Unscoped")}runQuery(t){return function(t,o){return t.getRestClient("IDashboardRestClient").getWidgetTypes(1,o).then(t=>({catalogEntries:t.widgetTypes.map(t=>{const o=t.allowedSizes&&0!==t.allowedSizes.length?t.allowedSizes.slice().sort((t,o)=>t.columnSpan-o.columnSpan||t.rowSpan-o.rowSpan):[{columnSpan:1,rowSpan:1}],e={canStoreCrossProjectSettings:!0,catalogIconUrl:t.catalogIconUrl,catalogInfoURI:i(t.catalogInfoUrl)?t.catalogInfoUrl:"",configContributionId:t.configurationContributionId,contributionId:t.contributionId,defaultSize:t.allowedSizes&&t.allowedSizes.length>0?t.allowedSizes[0]:o[0],description:t.description,isNameConfigurable:t.isNameConfigurable,isVisibleFromCatalog:t.isVisibleFromCatalog,keywords:t.keywords,lightbox:t.lightboxOptions,name:t.name,publisherName:"ms"===t.publisherName?r.MicrosoftContributionPublisherName:t.publisherName,supportedSizes:o,tags:t.tags};return e}),galleryUrl:t._links&&t._links.web&&t._links.web.href}))}(t,this.projectId)}};const n=["http","https"];function i(t){try{const o=new e.Uri(t).scheme;return n.indexOf(o)>=0}catch(t){return!1}}}(),function(t){function e(t,o){if(!o)throw new Error(r.WidgetContributionIdMissing);let e=t.getService("IVssContributionService").getContribution(o);if(e)return e=s(t,o,e);throw new Error(r.WidgetContributionCouldNotLoad)}function s(t,o,e){return"ms.vss-dashboards-web.Microsoft.VisualStudioOnline.Dashboards.SprintBurndownWidget"===o&&((0,i.isFeatureEnabled)(t,"ms.vss-dashboards-web.sprint-burndown-availability")?e.lightbox={width:900,height:700,resizable:!0}:(e.supportedSizes=[{rowSpan:1,columnSpan:2}],e.configComponentContributionId=void 0)),e}o[t]={},o[t].resolveWidgetContributionAsync=async function(t,o){if(!o)throw new Error(r.WidgetContributionIdMissing);const e=t.getService("IVssContributionService");let n=await e.getContributionAsync(o);if(n)return n=s(t,o,n);throw new Error(r.WidgetContributionCouldNotLoad)},o[t].resolveComponentContributionAsync=async function(t,o){if(!o)throw new Error(r.WidgetComponentContributionIdMissing);const e=t.getService("IVssContributionService"),n=await e.getContributionAsync(o);return n&&n.componentType&&n.includes?await({componentType:n.componentType,includes:n.includes}):null},o[t].getProviderInfo=function(t,o){const e=t.getService("IVssContributionService").getContributionProvider(o)||{id:"Unknown",displayName:"UnknownContributionProvider"};return(0,n.getExtensionMarketplaceUrl)(t,e.id).then(t=>({providerDisplayName:null!=e?e.displayName:"UnknownContributionProvider",marketplaceUrl:t}))},o[t].isInternalContribution=function(t){return t.startsWith("ms.vss")},o[t].contributionHasModernImplementation=function(t,o){let n;try{n=e(t,o)}catch(t){n=null}return null!=n&&null!=n.widgetComponentContributionId&&!n.ignoreComponentContributionForDashboardLoad},o[t].resolveWidgetContribution=e,o[t].widgetImplementationIsSlow=function(t,o){return((0,i.isFeatureFlagEnabled)(o,"WebAccess.Dashboards.DelayLoadSlowWidgets.Enable",!1)?["ms.vss-dashboards-web.Microsoft.VisualStudioOnline.Dashboards.VelocityWidget"]:[]).some(o=>t===o)}}("WidgetContributionsHelper")},["Resources","WidgetCatalogQuery","WidgetContributionsHelper"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-dashboards.dashboards-widget-catalog"}}));