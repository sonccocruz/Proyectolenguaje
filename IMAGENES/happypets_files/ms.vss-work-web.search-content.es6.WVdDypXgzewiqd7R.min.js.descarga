"use strict";define("Wit/Search",["require","exports","react","VSS/Core/Observable","VSS/Platform/Context","VSS/Core/Util/Accessibility","VSS/Core/Util/String","VSS/Platform/Location","VSS/Platform/FPS","InstantSearch/Shared/InstantSearchProviders/BaseInstantSearchProvider","InstantSearch/Shared/ResultRow","VSS/Platform/Feature","VSS/Legacy/Legacy","VSSUI/Util","VSSUI/Utilities/FriendlyNumber","VSS/Core/TimerManagement","InstantSearch/Shared/Utils","VSS/Features/Search/SearchHelp","VSSUI/VssIcon","VSS/Platform/Layout","VSS/Features/Identities/IdentityPickerProvider","VSSUI/SuggestionsList","VSSUI/Observer","VSSUI/Components/IdentityPickerSuggestionsList/IdentityPickerSuggestionItem","VSS/Platform/Components/Format","InstantSearch/Shared/SearchSuggestions","InstantSearch/Shared/TelemetryWriter"],function(e,t,s,r,i,o,n,a,c,u,l,h,d,p,g,m,S,I,y,v,k,x,_,f,T,F,b){var C,P,R,w,W,N,E,B,M,A,V,K;C=t.Resources={},t.Resources.FilterByField="Filter by field",t.Resources.FilterByFieldExample='e.g., Tags:"Release Blocker"',t.Resources.FilterByFieldFooter="Start typing to find out more...",t.Resources.AssignedToHint="Assigned To",t.Resources.CreatedByHint="Created By",t.Resources.StateHint="State",t.Resources.WITHint="Work Item Type",t.Resources.Operators="Operators",t.Resources.OperatorsExample="(e.g., ToDo OR revisit)",t.Resources.NoSearchSuggestionsInProjectMessage="No {0} results found in {1}.",t.Resources.NoSearchSuggestionsMessage="No {0} results found.",t.Resources.WorkItemText="work item",t.Resources.BoardText="board",t.Resources.SprintText="sprint",t.Resources.BacklogText="backlog",t.Resources.WorkItemsHeader="Work items",t.Resources.BoardsHeader="Other items in Boards",t.Resources.RecentWorkItemsHeader="Recent work items",t.Resources.RecentBoardsHeader="Recent boards",t.Resources.ViewAllResults="View all {0} work items",t.Resources.QueryHelpFilterGroupCaption="ADD A SEARCH FILTER",t.Resources.DayZeroMessage="Enjoy smart suggestions as you type.",t.Resources.GenericErrorMessage="Oops, something went wrong. Please try again.",t.Resources.WorkItemIdAriaLabel="ID {0}",t.Resources.SingleResultLoadedMessage="Result loaded.",t.Resources.ResultsLoadedMessage="Results loaded.",t.Resources.RecentWorkItemsLoadedMessage="Recent workitems loaded.",t.Resources.IdentityPickerLoadingText="Loading Suggestions",t.Resources.IdentityPickerNoResultsText="No results found",function(e){P=t.SearchResult={};t.SearchResult.WorkitemSearchResultComponent=class extends s.Component{constructor(){super(...arguments),this.onSearchResultSet=(e=>{this.forceUpdate()})}render(){const e=this.props.searchStatus&&this.props.searchStatus.searchResult&&this.props.searchStatus.searchResult.value;return s.createElement("div",{className:"search-provider flex flex-column flex-grow"},s.createElement("div",{className:"search-filter-bar"},"Place WIT filter bar components here ..."),s.createElement("div",{className:"search-results flex flex-column flex-grow"},this.props.searchStatus?e?e.matches&&e.matches.length?s.createElement("ul",null,e.matches.map((e,t)=>s.createElement("li",{key:t},e.render()))):s.createElement("span",null,"No matches found"):s.createElement("span",null,"Waiting on results ..."):s.createElement("div",{className:"search-view-information-area"},s.createElement("div",{className:"search-view-information-title"},"Welcome to Workitem Search!"),s.createElement("div",{className:"search-view-information-summary"},"Find workitems in your Azure DevOps Services account",s.createElement("br",null),s.createElement("br",null),"Here are some ways to find the workitems you want:",s.createElement("ul",{className:"search-view-information-examples"},s.createElement("li",null,"Example 1 ..."),s.createElement("li",null,"Example 2 ..."),s.createElement("li",null,"Example 3 ...")),s.createElement("p",null,s.createElement("span",null,"For more ways to search, see the "),s.createElement("a",{href:"https://go.microsoft.com/fwlink/?LinkId=698587&clcid=0x409",id:"search-hub-helplink",target:"_blank"},"help page"),s.createElement("span",null,". "),s.createElement("span",null,"Send your feedback to "),s.createElement("a",{href:"mailto:vsosrch@microsoft.com",id:"search-hub-feedbacklink",target:"_top"},"vsosrch@microsoft.com"))))))}componentDidMount(){this.props.searchStatus&&this.props.searchStatus.searchResult.subscribe(this.onSearchResultSet)}componentWillReceiveProps(e){this.props.searchStatus&&this.props.searchStatus.searchResult.unsubscribe(this.onSearchResultSet),e.searchStatus&&e.searchStatus.searchResult.subscribe(this.onSearchResultSet)}componentWillUnmount(){this.props.searchStatus&&this.props.searchStatus.searchResult.unsubscribe(this.onSearchResultSet)}}}(),function(e){R=t.BaseProvider={};t.BaseProvider.WorkitemSearchBaseProvider=class extends i.VssService{execute(e){return{searchQuery:e,searchResult:new r.ObservableValue(void 0)}}render(e){return s.createElement(P.WorkitemSearchResultComponent,{searchStatus:e})}performAction(e){const t=e.queryText.match(/^\s*#?(\d{1,9})\s*$/),s=t?parseInt(t[1],10):0;if(s>0){const e=this.pageContext.getRestClient("IWorkItemTrackingRestClient"),t=this.pageContext.getService("IVssContributionService");return Promise.all([e.getWorkItem(s,void 0,["System.Id"]),t.getService("ms.vss-work-web.work-item-service")]).then(([e,t])=>(t&&t.openWorkItem(s),!0),e=>Promise.resolve(!1))}return Promise.resolve(!1)}}}(),w=t.Constants={},t.Constants.WorkItemRoute="ms.vss-work-web.work-items-form-route-with-id",t.Constants.InfiniteScrollTakeValue=25,t.Constants.HubName="Boards",(K=t.Constants.CustomerIntelligenceConstants||(t.Constants.CustomerIntelligenceConstants={})).Feature="WorkItemSearchSuggestions",K.TTISearchScenarioName="WorkItemSearchTTIScenario",K.SubsequentSearchScenarioName="WorkItemSearchTTIScenario",(V=t.Constants.WitRef||(t.Constants.WitRef={})).title="system.title",V.id="system.id",V.type="system.workitemtype",(A=t.Constants.FeatureFlags||(t.Constants.FeatureFlags={})).DisableAggregations="WebAccess.Search.WorkItem.DisableAggregations",A.InfiniteScroll="WebAccess.Search.WorkItem.InfiniteScroll",function(e){var s;W=t[e]={},function(e){e.AssignedTo="system.assignedto",e.CreatedBy="system.createdby",e.State="system.state",e.WorkItemType="system.workitemtype"}(s=t[e].ShortcutFieldNames||(t[e].ShortcutFieldNames={})),t[e].ShortcutTexts={[s.AssignedTo]:"a",[s.CreatedBy]:"c",[s.State]:"s",[s.WorkItemType]:"t"},function(e){e.Today="@Today",e.Today1="@Today-1",e.Today7="@Today-7",e.Today30="@Today-30"}(t[e].ValueSuggestions||(t[e].ValueSuggestions={}));class r extends i.VssService{_serviceStart(s){super._serviceStart(s);const r=s.getRestClient("IWorkItemTrackingRestClient"),i=s.getService("ITfsPageService").getData(),o=i&&i.project?i.project.name:"";this.fieldsPromise=r.getFields(o).then(s=>s.map(s=>({field:s,shortcut:t[e].ShortcutTexts[s.referenceName.toLowerCase()]})))}getFields(){return this.fieldsPromise}}t[e].WorkItemTrackingFieldService=r,i.Services.add("WorkItemTrackingFieldService",{serviceFactory:r})}("SearchFields"),function(e){N=t[e]={};const s="\\.,;'`:~\\\\/\\*\\|\\?\"&%$!\\+=\\(\\)\\[\\]{}<>-",r=new RegExp("([^{0}\\s]+)\\s*(:|<=|>=|<|>|=|!=)\\s*([^{1}\\s]*)$".replace("{0}",s).replace("{1}",":|<|>|<=|>=|!=")),i=new RegExp("([^{0}\\s]+)(\\s*)$".replace("{0}",s)),o=new RegExp('"([^{0}]+)"\\s*(:|<=|>=|<|>|=|!=)\\s*([^{1}"]*)$'.replace("{0}",s).replace("{1}",":|<|>|<=|>=|!=")),n=new RegExp('"([^{0}]+)"\\s*$'.replace("{0}",s)),a=/(.*)\s*(:|<=|>=|<|>|=|!=)\s*\"([^\"]*)$/,c=new RegExp('"[^{0}]*$'.replace("{0}",s)),u=/(:|<=|>=|<|>|=|!=)/,l=[" ","<",">",":","=",'"',"!"];var h;!function(e){e[e.None=0]="None",e[e.Static=1]="Static",e[e.Fields=2]="Fields",e[e.Operators=3]="Operators",e[e.Values=4]="Values",e[e.Identity=5]="Identity"}(h=t[e].DropdownType||(t[e].DropdownType={})),t[e].defaultFieldsFilterGroup={caption:C.FilterByField,example:C.FilterByFieldExample,footer:C.FilterByFieldFooter,filters:[{text:`${W.ShortcutTexts[W.ShortcutFieldNames.AssignedTo]}:`,hint:C.AssignedToHint,getSuggestedText:I},{text:`${W.ShortcutTexts[W.ShortcutFieldNames.CreatedBy]}:`,hint:C.CreatedByHint,getSuggestedText:I},{text:`${W.ShortcutTexts[W.ShortcutFieldNames.State]}:`,hint:C.StateHint,getSuggestedText:I},{text:`${W.ShortcutTexts[W.ShortcutFieldNames.WorkItemType]}:`,hint:C.WITHint,getSuggestedText:I}]},t[e].defaultOperatorsFilterGroup={caption:C.Operators,example:C.OperatorsExample,singleLine:!0,filters:[{text:"AND",getSuggestedText:I},{text:"NOT",getSuggestedText:I},{text:"OR",getSuggestedText:I}]};const d={caption:"",filters:[{text:"=",getSuggestedText:I},{text:"!=",getSuggestedText:I},{text:">",getSuggestedText:I},{text:"<",getSuggestedText:I},{text:">=",getSuggestedText:I},{text:"<=",getSuggestedText:I}]};function p(e){return e&&e.replace(/\s+/g,"").toLowerCase()}function g(e,t){const s=y(e,t);return s[0]&&s[0].field?s[0].field.type:void 0}function m(e){const t=e.match(/\"/g);return!!((t?t.length:0)%2)}function S(e,t,s=!1,r=!0){t=r?t.replace(/[\s]+/g,""):t;const i=m(e)?['"']:l;let{endIndex:o,startIndex:n}=function(e,t){let s=e.length-1,r=e.length-1;for(;s>0&&t.indexOf(e.charAt(s))<0;)s--;for(;r<e.length-1&&-1===t.indexOf(e.charAt(r));)r++;const i=s>0?s+1:0,o=r<e.length-1?r-1:r;return{startIndex:i,endIndex:o,content:e.substr(i,o-i+1)}}(e,i);n>0&&'"'===e.charAt(n-1)&&m(e)&&(e=e.slice(0,n-1)+e.slice(n),n--,o--),s&&(t=`${t}:`),t=`${t} `;const a=e.substr(0,n).trim();return`${`${a}${""!==a?" ":""}${t}`}${e.substr(o+1).trim()}`}function I(e,t){return`${t} `}function y(e,t){return e.filter(e=>p(e.field.name)===p(t)||e.shortcut&&p(e.shortcut)===p(t))}t[e].FieldSuggestionStore=class{constructor(){this.dropdownType=h.Static,this.getFilterGroups=((s,r)=>{if(this.textToFilter=this.getTextToFilter(s,r),this.dropdownType===h.Static)return[t[e].defaultFieldsFilterGroup,t[e].defaultOperatorsFilterGroup];if(this.dropdownType===h.Fields){const s=r.filter(e=>0===p(e.field.name).indexOf(p(this.textToFilter)));return[{caption:C.FilterByField,example:C.FilterByFieldExample,filters:s.map(e=>({text:e.field.name,getSuggestedText:(t,s)=>S(t,s,function(e){return 8===e||6===e||4===e||3===e||0===e||5===e||10===e||11===e}(e.field.type)),shortcutText:e.shortcut,replaceTextOnActivation:!0}))},t[e].defaultOperatorsFilterGroup]}return this.dropdownType===h.Operators?[d]:this.dropdownType===h.Values?[{caption:"",filters:[{text:W.ValueSuggestions.Today,getSuggestedText:S,replaceTextOnActivation:!0},{text:W.ValueSuggestions.Today1,getSuggestedText:S,replaceTextOnActivation:!0},{text:W.ValueSuggestions.Today7,getSuggestedText:S,replaceTextOnActivation:!0},{text:W.ValueSuggestions.Today30,getSuggestedText:S,replaceTextOnActivation:!0}].filter(e=>0===p(e.text).indexOf(p(this.textToFilter)))}]:[]}),this.getTextToFilter=((e,t)=>(this.dropdownType=h.Static,!e||e.length<=1&&m(e)?"":m(e)?this.handleForUnPairedQuote(e,t):this.handleForPairedQuote(e,t))),this.handleForPairedQuote=((e,t)=>{const s=e.lastIndexOf('"'),a=e=>{const s=e[1],r=e[3];return this.setSuggestionModeForOperators(s,r,t)},c=e=>{const s=e[2]&&" "===e[2].replace(/\s+/," "),r=e[1];return s?this.setSuggestionModeForFieldName(r,t):(this.dropdownType=h.Fields,r)};if(s<0){const t=e.match(r);if(t)return a(t);const s=e.match(i);return s?c(s):(this.dropdownType=h.Fields,e)}{const u=e.substr(s+1),l=u.match(r);if(l)return a(l);const d=e.match(o);if(d){const e=d[1],s=d[3];return this.setSuggestionModeForOperators(e,s,t)}const p=u.match(i);if(p)return c(p);const g=e.match(n);if(g){const e=g[1].replace(/\s+/g,"");return this.setSuggestionModeForFieldName(e,t)}return this.dropdownType=h.Static,""}}),this.handleForUnPairedQuote=((e,t)=>{const s=e.match(a),r=e.match(c);if(s){if(":"===s[2]){const e=s[1].trim(),r=e.length;let i,o;if('"'===e[r-1]){for(o=r-2;'"'!==e.charAt(o)&&o>0;)o--;i=e.substring(o+1,r-1)}else{for(o=r-1;" "!==e.charAt(o)&&o>0;)o--;" "===e.charAt(o)&&o++,i=e.substr(o)}return this.setSuggestionModeForOperators(i,s[3],t)}return this.dropdownType=h.None,""}if(r){const t=e.lastIndexOf('"'),s=e.substr(t+1);return s?s.match(u)?this.dropdownType=h.None:this.dropdownType=h.Fields:this.dropdownType=h.Static,s}return this.dropdownType=h.None,""}),this.setSuggestionModeForOperators=((e,t,s)=>{const r=g(s,e);return void 0===r?(this.dropdownType=h.None,""):(2===r?this.dropdownType=h.Values:10===r||function(e,t){const s=y(e,t);return s[0].field&&s[0].field.isIdentity}(s,e)?this.dropdownType=h.Identity:this.dropdownType=h.None,t)}),this.setSuggestionModeForFieldName=((e,t)=>{const s=g(t,e);return s?2!==s&&7!==s&&1!==s||(this.dropdownType=h.Operators):this.dropdownType=h.Static,""})}},t[e].getSuggestedText=S}("FieldSuggestionStore"),function(e){t.InstantSearchProvidersBoardSuggestionsProvider={};const r=5,h=3;class d extends u.BaseInstantSearchProvider{constructor(){super(...arguments),this._contributionId="ms.vss-work-web.board-project-menu-provider",this._recordBoardResultsClickTelemetry=((e,t)=>{t.publish("ResultClicked",{index:e,resultType:"BoardSearchResults"})})}_serviceStart(e){super._serviceStart(e),this._initContribution(this._contributionId),this._searchClient=this.pageContext.getRestClient("TFS_WIT_SEARCH.ISearchRestClient")}_initContribution(e){super._initContribution(e),this._contribution&&(this._boardsMenuProps=this._contribution.boardsMenuProps||{})}_getMenuItems(e,t,s,r){return s&&r?this.getSuggestions(r,t,"RecentBoardSearchResultsFetched"):this._menuItems.splice(0,this._menuItems.length),this._menuItems}_fetchResults(e,t){const s=this.projectProperties?this.projectProperties.id:"",{invokedProvidersProps:i}=t,o=i&&i.props?i.props.key:void 0,n=o?o.substr(1):"",a={searchText:e,$skip:0,$top:o?r:h,includeFacets:!1,$orderBy:[],filters:n?{boardType:[n]}:{}};return this._searchClient.fetchBoardSearchResults(a,s)}_onFetchSuccess(e,t,i){const{telemetryWriter:u,onFocus:d,searchInput:p,invokedProvidersProps:g}=t;if(this._menuItems.splice(0,this._menuItems.length),this.shouldInvokeProvider(t)&&!p.queryText().trim())return;const m=g&&g.props?g.props.header:C.BoardsHeader,S=g&&g.props?g.props.key:void 0;if(i&&i.results.length>0){this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:m,className:"search-suggestion-header"});const e=i.results,t=S?r:h,o=Math.min(t,e.length);for(let t=0;t<o;t++){const r=e[t],i=r.project,o=r.boardtype,h=r.team,{iconName:p,routeContribution:g}=this._boardsMenuProps[o];this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,renderMenuCell:(e,t,r)=>{switch(r.onFocusItem=d,e){case 2:const t=(0,n.format)("{0} {1}",h.name,o.toLowerCase());return s.createElement(l.ResultRow,{iconProps:{iconName:p},title:t});default:return}},onActivate:(e,s)=>{const r={project:i.name,teamName:h.name,pivot:o.toLowerCase()},n=(0,a.routeUrl)(this.pageContext,g,r);if(s.ctrlKey||s.metaKey){const e=window.open(n,"_blank");e&&e.opener&&(e.opener=null)}else(0,c.onClickFPS)(this.pageContext,n,!0,s);this._recordBoardResultsClickTelemetry(t,u)}})}}else if(i&&0===i.results.length||!i){if(S){const e=this.projectProperties?(0,n.format)(C.NoSearchSuggestionsInProjectMessage,this._getBoardTypeResourceText(S),this.projectProperties.name):(0,n.format)(C.NoSearchSuggestionsMessage,this._getBoardTypeResourceText(S));this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:m,className:"search-suggestion-header"},{id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:e,className:"suggestion-message"}),(0,o.announce)(e)}u.publish("NoSuggestionsFound",{type:"BoardSearchSuggestions"})}}_onFetchFail(e,t){const{invokedProvidersProps:s}=e,r=s&&s.props?s.props.header:C.BoardsHeader;this._menuItems.splice(0,this._menuItems.length),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:r,className:"search-suggestion-header"},{id:"",itemType:2,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:C.GenericErrorMessage}),(0,o.announce)(C.GenericErrorMessage)}get projectProperties(){if(!this._projectProperties){const e=this.pageContext.getService("ITfsPageService").getData();this._projectProperties=e?e.project:void 0}return this._projectProperties}_getBoardTypeResourceText(e){switch(e){case"/board":return C.BoardText;case"/sprint":return C.SprintText;case"/backlog":return C.BacklogText;default:return C.BoardText}}}t.InstantSearchProvidersBoardSuggestionsProvider.BoardSuggestionsProvider=d,i.Services.add("project-board-provider-service",{serviceFactory:d})}(),function(e){t.InstantSearchProvidersDayZeroMessageProvider={};class s extends u.BaseInstantSearchProvider{constructor(){super(...arguments),this._contributionId="ms.vss-work-web.dayzero-message-menu-provider",this._isWorkitemAvailable=!0}_serviceStart(e){super._serviceStart(e),this._initContribution(this._contributionId),this._isBoardsAvailable=(0,h.isFeatureFlagEnabled)(e,"TeamFoundationRecentActivityService.DisplayUserProjectActivities",!1)}_getMenuItems(e,t,s,r){return s&&!r||(this._menuItems.length>0&&this._menuItems.splice(0,this._menuItems.length),this._isWorkitemAvailable=!0,this._isBoardsAvailable=!0),this._menuItems}updateWorkItemState(e){this._isWorkitemAvailable=e,this._updateDayZeroMessage()}updateBoardState(e){this._isBoardsAvailable=e,this._updateDayZeroMessage()}_updateDayZeroMessage(){this._menuItems.length>0&&this._menuItems.splice(0,this._menuItems.length),this._isBoardsAvailable||this._isWorkitemAvailable||(this._menuItems.push({id:"",itemType:0,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:C.DayZeroMessage}),(0,o.announce)(C.DayZeroMessage))}}t.InstantSearchProvidersDayZeroMessageProvider.DayZeroMessageProvider=s,i.Services.add("dayzero-message-provider-service",{serviceFactory:s})}(),function(e){t.InstantSearchProvidersRecentBoardsProvider={};const r=5;class a extends u.BaseInstantSearchProvider{constructor(){super(...arguments),this._contributionId="ms.vss-work-web.recent-boards-menu-provider",this._recordWorkItemClickTelemetry=((e,t)=>{t.publish("ResultClicked",{index:e,resultType:"RecentBoards"})})}_serviceStart(e){super._serviceStart(e),this._initContribution(this._contributionId),this._contribution&&(this._recentBoardsProps=this._contribution.recentBoardsMenuProps||{}),this._dayZeroMessageService=this.pageContext.getService("dayzero-message-provider-service")}_getMenuItems(e,t,s,r){return s&&!r?this.getSuggestions("",t,"RecentBoardsFetched"):this._menuItems.splice(0,this._menuItems.length),this._menuItems}_fetchResults(e,t){const s=this.pageContext.getService("IVssContributionService"),{invokedProvidersProps:r}=t,i=r&&r.props?r.props.key:void 0,o=i?i.substr(1):"",n=o?{boardType:o}:void 0;return s.getDataAsync("ms.vss-work-web.boards-recent-activity-data-provider",n,!0)}_onFetchSuccess(e,t,i){const{telemetryWriter:o,onFocus:a,searchInput:u,invokedProvidersProps:h}=t;if(this._menuItems.splice(0,this._menuItems.length),!this.shouldInvokeProvider(t)||!u.queryText().trim())if(i&&i.length>0){const e=h&&h.props?h.props.emptyTextHeader:C.RecentBoardsHeader;this._dayZeroMessageService.updateBoardState(!0),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:e,className:"search-suggestion-header"});const t=Math.min(r,i.length);for(let e=0;e<t;e++){const t=i[e];this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,renderMenuCell:(e,r,i)=>{switch(i.onFocusItem=a,e){case 2:var o=this._recentBoardsProps[t.artifactKind.toUpperCase()];const r=(0,n.format)("{0} {1}",t.name,o.boardType);return s.createElement(l.ResultRow,{iconProps:{iconName:o.iconName},title:r});default:return}},onActivate:(s,r)=>{if(r.ctrlKey||r.metaKey){const e=window.open(t.artifactUri,"_blank");e&&e.opener&&(e.opener=null)}else(0,c.onClickFPS)(this.pageContext,t.artifactUri,!0,r);this._recordWorkItemClickTelemetry(e,o)}})}}else(i&&0===i.length||!i)&&(this._dayZeroMessageService.updateBoardState(!1),o.publish("NoSuggestionsFound",{type:"RecentBoards"}))}_onFetchFail(e,t){const{invokedProvidersProps:s}=e,r=s&&s.props?s.props.emptyTextHeader:C.RecentBoardsHeader;this._menuItems.splice(0,this._menuItems.length),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:r,className:"search-suggestion-header"},{id:"",itemType:2,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:C.GenericErrorMessage}),(0,o.announce)(C.GenericErrorMessage)}}t.InstantSearchProvidersRecentBoardsProvider.RecentBoardsProvider=a,i.Services.add("recent-boards-provider-service",{serviceFactory:a})}(),function(e){t.InstantSearchProvidersServicesDisplayWorkItemService={};i.Services.add("IDisplayWorkItemService",{serviceFactory:class extends i.VssService{displayWorkItem(e,t,r,i,o){if(r){const s=(0,a.routeUrl)(this.pageContext,w.WorkItemRoute,{project:t,id:e}),r=window.open(s,"_blank");r&&r.opener&&(r.opener=null)}else{const t=this.pageContext.getService("IVssLayoutManager");i&&i(!0),t.renderCallout(t=>s.createElement(d.LegacyComponent,{modules:["WorkItemTracking/SharedScripts/WorkItemDialogShim"],wrappedType:"WorkItemDialog",workItemId:Number(e),onDismiss:()=>{t(),i&&i(!1)}}))}o&&o()}}})}(),function(e){t.InstantSearchProvidersRecentWorkItemsProvider={};const r=5;class a extends u.BaseInstantSearchProvider{constructor(){super(...arguments),this._contributionId="",this._recordWorkItemClickTelemetry=((e,t)=>{t.publish("ResultClicked",{index:e,resultType:"RecentWorkItem"})}),this._displayWorkItem=((e,t,s,r,i)=>{this.pageContext.getService("IDisplayWorkItemService").displayWorkItem(e,t,s,r,i)})}_serviceStart(e){super._serviceStart(e),this._initContribution(this._contributionId),this._dayZeroMessageService=this.pageContext.getService("dayzero-message-provider-service")}_getMenuItems(e,t,s,r){return s&&!r?this.getSuggestions("",t,"CachedRecentWorkItemsFetched",w.CustomerIntelligenceConstants.TTISearchScenarioName,w.CustomerIntelligenceConstants.SubsequentSearchScenarioName):this._menuItems.splice(0,this._menuItems.length),this._menuItems}_fetchResults(e,t){return this.pageContext.getService("IPrefetchInstantSearchContentService").recentWorkItemsCache}_onFetchSuccess(e,t,i){const{searchInput:a,telemetryWriter:c,onFocus:u,invokedProvidersProps:h}=t;if(this._menuItems.splice(0,this._menuItems.length),!this.shouldInvokeProvider(t)||!a.queryText().trim())if(i&&i.length>0){const e=h&&h.props?h.props.emptyTextHeader:C.RecentWorkItemsHeader;this._dayZeroMessageService.updateWorkItemState(!0),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:e,className:"search-suggestion-header"});const t=Math.min(r,i.length);for(let e=0;e<t;e++){const t=i[e].data,r=t[0],o=t[1],h=t[2],d=t[3];this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,renderMenuCell:(e,t,i)=>{switch(i.onFocusItem=u,e){case 2:return s.createElement(l.ResultRow,{workItemIconProps:{project:r,workItemType:d},title:h,mutedText:"#"+o,mutedTextAriaLabel:(0,n.format)(C.WorkItemIdAriaLabel,o)});default:return}},onActivate:(e,t)=>this._displayWorkItem(o,r,t&&t.ctrlKey,a.setHelpVisibility,()=>this._recordWorkItemClickTelemetry(e.data,c))})}(0,o.announce)(C.RecentWorkItemsLoadedMessage)}else(i&&0===i.length||!i)&&(this._dayZeroMessageService.updateWorkItemState(!1),c.publish("NoSuggestionsFound",{type:"RecentWorkItems"}))}_onFetchFail(e,t){const{invokedProvidersProps:s}=e,r=s&&s.props?s.props.emptyTextHeader:C.RecentWorkItemsHeader;this._menuItems.splice(0,this._menuItems.length),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:r,className:"search-suggestion-header"},{id:"",itemType:2,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:C.GenericErrorMessage}),(0,o.announce)(C.GenericErrorMessage)}}function c(e){return class extends a{constructor(){super(...arguments),this._contributionId=e}}}t.InstantSearchProvidersRecentWorkItemsProvider.RecentWorkItemsProvider=a,i.Services.add("project-recent-workitems-provider-service",{serviceFactory:c("ms.vss-work-web.recent-workitems-project-menu-provider")}),i.Services.add("collection-recent-workitems-provider-service",{serviceFactory:c("ms.vss-work-web.recent-workitems-collection-menu-provider")})}(),function(e){t.InstantSearchProvidersWorkItemSuggestionsProvider={};const r=5;class a extends u.BaseInstantSearchProvider{constructor(){super(...arguments),this._contributionId="",this._providerId="",this._projectFilter="",this._displayWorkItem=((e,t,s,r,i)=>{this.pageContext.getService("IDisplayWorkItemService").displayWorkItem(e,t,s,r,i)}),this._executeSearch=((e,t,s,r,i)=>{this.pageContext.getService("IExecuteSearchService").executeSearch(e,t,s,r,i)}),this._recordWorkItemClickTelemetry=((e,t)=>{t.publish("ResultClicked",{index:e,resultType:"InstantSearchWorkItem"})}),this._onViewAllResultsClick=((e,t,s)=>{t(!0),s.publish("ResultClicked",{index:e,resultType:"ViewAllWorkItemsLink"})})}_serviceStart(e){super._serviceStart(e),this._initContribution(this._contributionId),this._legacySearchClient=this.pageContext.getRestClient("Legacy.ISearchRestClient")}_getMenuItems(e,t,s,r){return s&&r?this.getSuggestions(r,t,"WorkItemSuggestionsFetched",w.CustomerIntelligenceConstants.TTISearchScenarioName,w.CustomerIntelligenceConstants.SubsequentSearchScenarioName):this._menuItems.splice(0,this._menuItems.length),this._menuItems}_initContribution(e){if(super._initContribution(e),this._contribution){const{searchProjectFilter:e,searchProviderId:t}=this._contribution;this._providerId=t||"",this._projectFilter=e||""}}_fetchResults(e,t){const s=this.projectProperties?this.projectProperties.id:"",i=this.projectProperties?this.projectProperties.name:"",o=i&&this._projectFilter?{[this._projectFilter]:[i]}:{},n={searchText:e,skipResults:0,takeResults:r,summarizedHitCountsNeeded:!1,includeSuggestions:!1,searchFilters:o,filters:[],sortOptions:[],isInstantSearch:!0};return this._legacySearchClient.postWorkItemQuery(n,s)}_onFetchSuccess(e,t,i,a){i.activityId&&i.activityId.length>0&&a.addProperties({responseActivityId:i.activityId[0]});const{searchInput:c,telemetryWriter:u,onFocus:h,invokedProvidersProps:d}=t;if(this._menuItems.splice(0,this._menuItems.length),this.shouldInvokeProvider(t)&&!c.queryText().trim())return;const m=d&&d.props?d.props.header:C.WorkItemsHeader,S=i.response,{values:I,count:y}=S.results,v=I,k=y;if(v&&v.length>0){this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:m,className:"search-suggestion-header"});const t=1===v.length;if(v.forEach((e,r)=>{let i={};e.fields.map(e=>{i[e.referenceName]=e.value});const o=i[w.WitRef.id],a=i[w.WitRef.type],d=i[w.WitRef.title],g=e.project;this._menuItems.push({id:"",className:(0,p.css)(t&&0===r&&"focused"),groupKey:this._groupKey,rank:this._rank,renderMenuCell:(e,t,r)=>{switch(r.onFocusItem=h,e){case 2:return s.createElement(l.ResultRow,{workItemIconProps:{project:g,workItemType:a},title:d,mutedText:"#"+o,mutedTextAriaLabel:(0,n.format)(C.WorkItemIdAriaLabel,o)});default:return}},onActivate:(e,t)=>this._displayWorkItem(o,g,t&&t.ctrlKey,c.setHelpVisibility,()=>this._recordWorkItemClickTelemetry(r,u))})}),k>v.length){const t=(0,n.format)(C.ViewAllResults,(0,g.getFriendlyDisplayValue)(k));this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,renderMenuCell:(e,r,i)=>{switch(i.onFocusItem=h,e){case 2:return s.createElement(l.ResultRow,{iconProps:{iconName:"Search"},title:t});default:return}},onActivate:(t,s)=>this._executeSearch(e,this._providerId,void 0,s.ctrlKey,()=>this._onViewAllResultsClick(r,c.setHelpVisibility,u))})}(0,o.announce)(1===v.length?C.SingleResultLoadedMessage:C.ResultsLoadedMessage)}else if(v&&0===v.length){const e=this.projectProperties?(0,n.format)(C.NoSearchSuggestionsInProjectMessage,C.WorkItemText,this.projectProperties.name):(0,n.format)(C.NoSearchSuggestionsMessage,C.WorkItemText);d&&this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:m,className:"search-suggestion-header"}),this._menuItems.push({id:"",itemType:2,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:e}),(0,o.announce)(e),u.publish("NoSuggestionsFound",{type:"InstantSearch"})}}_onFetchFail(e,t,s){t.activityId&&s.addProperties({responseActivityId:t.activityId});const{invokedProvidersProps:r}=e,i=r&&r.props?r.props.header:C.WorkItemsHeader;this._menuItems.splice(0,this._menuItems.length),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:i,className:"search-suggestion-header"},{id:"",itemType:2,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:C.GenericErrorMessage}),(0,o.announce)(C.GenericErrorMessage)}get projectProperties(){if(!this._projectProperties){const e=this.pageContext.getService("ITfsPageService").getData();this._projectProperties=e?e.project:void 0}return this._projectProperties}}function c(e){return class extends a{constructor(){super(...arguments),this._contributionId=e}}}t.InstantSearchProvidersWorkItemSuggestionsProvider.WorkItemSuggestionsProvider=a,i.Services.add("project-workitem-suggestions-provider-service",{serviceFactory:c("ms.vss-work-web.workitem-suggestions-project-menu-provider")}),i.Services.add("collection-workitem-suggestions-provider-service",{serviceFactory:c("ms.vss-work-web.workitem-suggestions-collection-menu-provider")})}(),function(e){E=t.SearchWarmer={};t.SearchWarmer.SearchWarmer=class{constructor(e){if(this.pageContext=e,this._isSearchWarmerEnabled=!1,this._warmerRunIntervalInSec=300,this._warmerIntervalSettingKey="Search/Wit/Warmer/Interval",this._timer=new m.TimerManagement,this._warmerRequest={searchText:"dummy-114B37FF-4996-4976-AE76-4B8DF19BF35D",skipResults:0,takeResults:0,summarizedHitCountsNeeded:!1,includeSuggestions:!1,searchFilters:{},filters:[],sortOptions:[],isInstantSearch:!1},this._isSearchWarmerEnabled=(0,h.isFeatureFlagEnabled)(this.pageContext,"WebAccess.Search.WorkItem.SearchWarmers",!1),this._isSearchWarmerEnabled){this._legacySearchClient=this.pageContext.getRestClient("Legacy.ISearchRestClient"),this._warmerRunIntervalInSec=(0,S.getSetting)(this.pageContext,this._warmerIntervalSettingKey,this._warmerRunIntervalInSec);const e=this.pageContext.getService("ITfsPageService").getData();e&&e.project&&(this._projectId=e.project.id)}}initSearchWarmers(){this._isSearchWarmerEnabled&&this.executeSearchWarmer()}executeSearchWarmer(){try{this._legacySearchClient.postWorkItemQuery(this._warmerRequest,this._projectId).then(e=>{e.response.errors.length>0&&"StopWarmerRequests"===e.response.errors[0].errorCode&&(this._isSearchWarmerEnabled=!1)},e=>{})}catch(e){}finally{this._isSearchWarmerEnabled&&this._timer.setTimeout(()=>this.executeSearchWarmer(),1e3*this._warmerRunIntervalInSec)}}}}(),function(e){t.QueryProvider={};const r={caption:C.QueryHelpFilterGroupCaption,filters:[{text:C.AssignedToHint,getSuggestedText:(e,t)=>'a:"@Me"'},{text:C.CreatedByHint,getSuggestedText:(e,t)=>'c:"@Me"'},{text:C.StateHint,getSuggestedText:(e,t)=>'s:""'},{text:C.WITHint,getSuggestedText:(e,t)=>'t:""'}]};const o=(e,t)=>s.createElement("div",null,s.createElement(y.VssIcon,{iconName:"FilterSolid",iconType:0,className:"workitem-query-filter-icon"}),s.createElement("span",{className:"workitem-query-filter-text"},e.text));i.Services.add("workitem-query-provider",{serviceFactory:class extends R.WorkitemSearchBaseProvider{help(e){return s.createElement(I.SearchHelpComponent,{filterGroups:[r],searchInput:e,onRenderFilterText:o})}}})}(),function(e){B=t.WitPeoplePicker={};const r=5;t.WitPeoplePicker.WITIdentityPicker=class extends v.VssComponent{constructor(e,t){super(e),this.renderNoIdentitiesFound=(()=>s.createElement("div",{className:"search-people-picker-no-results flex-row flex-grow flex-center"},C.IdentityPickerNoResultsText)),this.renderSuggestionItem=(e=>s.createElement("div",{tabIndex:-1,className:"suggestion-item-container"},s.createElement(f.IdentityPickerSuggestionItem,Object.assign({},e)))),this.onKeyDown=(e=>{const t=r<this.state.suggestions.length?r:this.state.suggestions.length,{selectedIndex:s}=this.state;if(40===e.keyCode)this.setState({selectedIndex:(s+1)%t});else if(38===e.keyCode){const e=0===s?t-1:s-1;this.setState({selectedIndex:e})}else if(13===e.keyCode){const e=`"${this.getIdentityName(this.state.suggestions[s])}"`,t=(0,N.getSuggestedText)(this.props.searchInput.queryText(),e,!1,!1);this.props.searchInput.replaceText(t),this.setState({areSuggestionsVisible:!1})}e.stopPropagation()}),this.componentDidMount=(()=>{this.getSuggestions(this.props.searchText)}),this.componentWillReceiveProps=(e=>{this.getSuggestions(e.searchText)}),this.componentWillUnmount=(()=>{this.timerManagement.dispose()}),this.getSuggestions=(e=>{e&&""!==e.trim()?this.updateSuggestionsOnType(this.pickerProvider.onFilterIdentities(e,[])):this.updateSuggestions(this.pickerProvider.onEmptyInputFocus())}),this.updateSuggestions=(e=>{const t=e,s=e;Array.isArray(t)?this.setState({suggestions:t,suggestionsLoading:!1}):s&&s.then&&s.then(e=>{this.setState({suggestions:e,suggestionsLoading:!1})})}),this.onSuggestionClicked=(e=>{const t=`"${this.getIdentityName(e.item)}"`,s=(0,N.getSuggestedText)(this.props.searchInput.queryText(),t,!1,!1);this.props.searchInput.replaceText(s),this.setState({areSuggestionsVisible:!1,selectedIndex:e.index})}),this.getIdentityName=(e=>{if(!e)return"";const t=e.signInAddress||e.mail;return t?-1===t.indexOf("@")&&e.scopeName?`${e.displayName} <${e.scopeName}\\${t}>`:`${e.displayName} <${t}>`:e.displayName||""}),this.state={suggestions:[],areSuggestionsVisible:!0,openedIdentityCard:void 0,selectedIndex:0,suggestionsLoading:!0},this.pickerProvider=new k.PeoplePickerProvider(t.pageContext,{query:this.props.searchInput.queryText(),identityTypes:["user"],operationScopes:["ims","source"]}),this.timerManagement=new m.TimerManagement,this.updateSuggestionsOnType=this.timerManagement.debounce(this.updateSuggestions,150)}render(){return s.createElement(_.Observer,{suggestionsVisible:this.state.areSuggestionsVisible,suggestionsLoading:this.state.suggestionsLoading,selectedIndex:this.state.selectedIndex,suggestions:this.state.suggestions},e=>e.suggestionsVisible?s.createElement("div",{className:"people-picker-container",onKeyDown:this.onKeyDown},s.createElement(x.SuggestionsList,Object.assign({},this.props,{className:"WIT-suggestions-list",isLoading:e.suggestionsLoading,loadingText:C.IdentityPickerLoadingText,renderNoResultFound:this.renderNoIdentitiesFound,renderSuggestion:this.renderSuggestionItem,resultsMaximumNumber:r,suggestionsItemClassName:"WIT-suggestions-item",suggestions:e.suggestions,selectedIndex:e.selectedIndex,onSuggestionClicked:this.onSuggestionClicked}))):s.createElement("div",null))}}}(),function(e){M=t.SearchHelp={};class r extends v.VssComponent{constructor(e){super(e),this.onChange=(e=>{this.context.pageContext.getService("WorkItemTrackingFieldService").getFields().then(t=>{const s=this.fieldSuggestionStore.getFilterGroups(e,t),r=this.fieldSuggestionStore.textToFilter,i=this.fieldSuggestionStore.dropdownType,o=this.fieldSuggestionStore.dropdownType===N.DropdownType.None;o?this.props.searchInput.setHelpVisibility(o):this.setState({filterGroups:s,filterText:r,dropdownType:i})})}),this._notifyFilterActivated=(e=>{this.context.pageContext.getService("IVssTelemetryService").publishEvent("L1SearchBox","WorkItem.SearchHelpFilterActivated",{filterText:e&&e.text,entity:"WorkItem"})}),this.state={filterGroups:[],filterText:"",dropdownType:N.DropdownType.None},this.fieldSuggestionStore=new N.FieldSuggestionStore}render(){const{filterGroups:e,filterText:t,dropdownType:r}=this.state;return r!==N.DropdownType.Identity?s.createElement(I.SearchHelpComponent,{filterGroups:e,helpLink:"https://docs.microsoft.com/en-us/azure/devops/project/search/functional-work-item-search?view=azure-devops",searchInput:this.props.searchInput,filterText:t,onRenderFilterText:i,onItemActivated:this._notifyFilterActivated}):r===N.DropdownType.Identity?s.createElement(B.WITIdentityPicker,{searchInput:this.props.searchInput,searchText:t}):null}componentDidMount(){const e=this.props.searchInput.queryText();e?this.onChange(e):this.setState({filterGroups:[N.defaultFieldsFilterGroup,N.defaultOperatorsFilterGroup]}),this.props.searchInput.subscribe(this.onChange)}componentWillUnmount(){this.props.searchInput.unsubscribe(this.onChange)}}t.SearchHelp.WorkitemSearchHelpComponent=r;const i=(e,t)=>{const r=(t=t.replace(/[\s]+/g," ").toLowerCase()).search(/\s/)>0;if(!t)return e.text;let i,o;if(r)i=e.text.substring(t.length),o=e.text.substring(0,t.length);else{let s=e.text.indexOf(" "),r=t.length;for(;s>0&&r>s;)r+=1,s=e.text.indexOf(" ",s+1);i=e.text.substring(r),o=e.text.substring(0,r)}return s.createElement(T.FormatComponent,{format:`${o}{0}`},s.createElement("span",{style:{fontWeight:700}},i))};v.VssComponent.register("search.workItem.help",r)}(),function(e){t.SearchProvider={};i.Services.add("workitem-search-provider",{serviceFactory:class extends R.WorkitemSearchBaseProvider{constructor(){super(...arguments),this._workItemSearchSuggestionsComponentRef=s.createRef(),this._searchWarmerInitialized=!1}getQuery(e){const t=Object.assign({type:"workitem",filters:{}},e),s=this.pageContext.getService("ITfsPageService").getData();return s&&s.project&&(t.filters.Projects=[s.project.name]),(0,h.isFeatureFlagEnabled)(this.pageContext,w.FeatureFlags.InfiniteScroll,!1)&&(t.pageSize=w.InfiniteScrollTakeValue),(0,h.isFeatureFlagEnabled)(this.pageContext,w.FeatureFlags.DisableAggregations,!1)&&(t.includeFacets=!1),t}help(e){return this._searchWarmerInitialized||(this.searchWarmer.initSearchWarmers(),this._searchWarmerInitialized=!0),(0,h.isFeatureEnabled)(this.pageContext,"ms.vss-tfs-web.enable-search-suggestions",!1)?s.createElement(F.InstantSearchSuggestionsComponent,{ref:this._workItemSearchSuggestionsComponentRef,hubName:w.HubName,featureName:w.CustomerIntelligenceConstants.Feature,searchInput:e}):s.createElement(M.WorkitemSearchHelpComponent,{searchInput:e})}performAction(e){return super.performAction(e).then(t=>{const s=(0,h.isFeatureEnabled)(this.pageContext,"ms.vss-tfs-web.enable-search-suggestions",!1);if(!t&&s){if(!this.pageContext.getService("IInvokedProvidersManager").shouldAllowImmersiveSearch())return!0;const t=this._workItemSearchSuggestionsComponentRef.current;if(t&&!e.openInNewWindow)return t.invokeActionOfSelectedItem(),!0;e.queryText=(0,S.getQueryTextWithWildCardChar)(e.queryText),this.telemetryWriter.publish("ImmersiveSearchPerformed")}return t})}get telemetryWriter(){return this._telemetryWriter||(this._telemetryWriter=new b.TelemetryWriter(this.pageContext,w.CustomerIntelligenceConstants.Feature)),this._telemetryWriter}get searchWarmer(){return this._searchWarmer||(this._searchWarmer=new E.SearchWarmer(this.pageContext)),this._searchWarmer}}})}()},["Resources","SearchResult","BaseProvider","Constants","SearchFields","FieldSuggestionStore","InstantSearchProviders/BoardSuggestionsProvider","InstantSearchProviders/DayZeroMessageProvider","InstantSearchProviders/RecentBoardsProvider","InstantSearchProviders/Services/DisplayWorkItemService","InstantSearchProviders/RecentWorkItemsProvider","InstantSearchProviders/WorkItemSuggestionsProvider","SearchWarmer","QueryProvider","WitPeoplePicker","SearchHelp","SearchProvider"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.search-content"}}));