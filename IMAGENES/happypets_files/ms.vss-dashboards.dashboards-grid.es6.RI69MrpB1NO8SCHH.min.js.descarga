"use strict";define("Dashboards/Grid",["require","exports","react","react-grid-layout"],function(e,t,r,i){var n,o;!function(e){t.DashboardGridItem={},t.DashboardGridItem.GridItem=r.forwardRef((e,t)=>r.createElement(i,Object.assign({forwardRef:t},e)));class i extends r.Component{render(){const e=this.props,{row:t,rowSpan:i,column:n,columnSpan:o,forwardRef:s,children:a,id:d,isFocalPreviewElement:l,dragEvent:c}=e,u=__rest(e,["row","rowSpan","column","columnSpan","forwardRef","children","id","isFocalPreviewElement","dragEvent"]),h=l?"focal-grid-item":"";return r.createElement("div",Object.assign({},u,{ref:s,className:`grid-item ${u.className} ${h}`,style:Object.assign(Object.assign({},this.generateGridItemStyles()),u.style)}),a)}generateGridItemStyles(){const{row:e,column:t,rowSpan:r,columnSpan:i}=this.props,n={msGridColumn:`${2*t-1}`,msGridColumnSpan:`${2*i-1}`,msGridRow:`${2*e-1}`,msGridRowSpan:`${2*r-1}`};return Object.assign(Object.assign({},n),{gridColumnStart:t,gridColumnEnd:`span ${i}`,gridRowStart:e,gridRowEnd:`span ${r}`})}}}(),function(e){function i(e,t,r){let i;const n=r-e.columnSpan;if(n>0){const r=t.length,o=s(e.columnSpan,0);for(let s=0;s<r;++s){let a=o;for(let o=0;o<=n;++o){let n=!0;const d=s+e.rowSpan;for(let e=s;e<d&&e<r&&(n=0==(t[e]&a));++e);if(n){i={row:s+1,column:o+1};break}a*=2}if(null!=i)break}}return null==i&&(i={row:t.length+1,column:1}),Object.assign(Object.assign({},e),{row:i.row,column:i.column})}function o(e){return e.column>0&&e.row>0}function s(e,t){return~(-1*Math.pow(2,e))*Math.pow(2,t)}function a(e,t){const r=t.slice(),i=e.column-1,n=s(e.columnSpan,i),o=e.row-1,a=o+e.rowSpan;for(let e=o;e<a;++e)r[e]||(r[e]=0),r[e]=r[e]|n;return r}n=t.GridPlacement={},t.GridPlacement.assignPositionsToGridItems=function(e,t){if(t>32||t<1)throw Error("Cannot search grid exceeding 32 columns or less than 1 column");const n=e.slice(),s=n.map(e=>e.props);let d=!1,l=function(e){let t=[];for(let r of e)o(r)&&(t=a(r,t));for(let e=0;e<t.length;++e)t[e]||(t[e]=0);return t}(s);for(let c=0;c<s.length;++c){const u=s[c];if(!o(u)){const o=i(u,l,t);n[c]=r.cloneElement(e[c],o),l=a(o,l),d=!0}}return d?n:e}}(),function(e){o=t.WidgetSizeConverter={};class r{static CalculatePixelSize(e,t,r){return t*e+r*(e-1)}static CalculateGridSize(e,t,r){return Math.ceil((e+r)/(r+t))}static ColumnsToPixelWidth(e){return this.CalculatePixelSize(e,r.CellWidth,r.CellMarginWidth)}static RowsToPixelHeight(e){return this.CalculatePixelSize(e,r.CellHeight,r.CellMarginHeight)}static ConvertToPixelSize(e){return{width:r.ColumnsToPixelWidth(e.columnSpan),height:r.RowsToPixelHeight(e.rowSpan)}}static ConvertToGridSize(e){return{columnSpan:r.CalculateGridSize(e.width,r.CellWidth,r.CellMarginWidth),rowSpan:r.CalculateGridSize(e.height,r.CellHeight,r.CellMarginHeight)}}}t.WidgetSizeConverter.WidgetSizeConverter=r,r.CellWidth=160,r.CellHeight=160,r.CellMarginWidth=10,r.CellMarginHeight=10}(),function(e){t.DashboardGrid={},t.DashboardGrid.DashboardGrid=r.forwardRef((e,t)=>r.createElement(s,Object.assign({forwardRef:t},e)));class s extends r.Component{constructor(e){super(e),this.onLayoutChange=(e=>{const t=e.map(this.layoutToGridItemPosition);this.props.onGridItemsMoved(t);const r=Math.max(0,...e.map(e=>e.x+e.w));this.setState({gridColumnCount:r})}),this.onDrag=((e,t,r)=>{const{x:i,w:n}=r,o=i+n,s=Math.max(this.state.gridColumnCount,o+1);this.setState({gridColumnCount:s})}),this.throwIfChildrenAreNotGridItems(),this.state={gridColumnCount:0,precedingUpdateRenderedGrid:!1}}static getRightmostOccupiedColumnOfGridItems(e){return Math.max(0,...e.map(e=>e.props.column+e.props.columnSpan-1))}static getDerivedStateFromProps(e,t){const i=r.Children.toArray(e.children);let n=0;return i.length>0&&(n=Math.max(t.gridColumnCount,s.getRightmostOccupiedColumnOfGridItems(i))),n===t.gridColumnCount?null:Object.assign(Object.assign({},t),{gridColumnCount:n})}componentDidMount(){const e=this.showEmptyExperience();!e!==this.state.precedingUpdateRenderedGrid&&this.setState({precedingUpdateRenderedGrid:!e})}componentDidUpdate(){const e=this.showEmptyExperience();e&&this.state.precedingUpdateRenderedGrid&&this.onLayoutChange([]),e===this.state.precedingUpdateRenderedGrid&&this.setState({precedingUpdateRenderedGrid:!e})}render(){this.throwIfChildrenAreNotGridItems();const e=r.Children.toArray(this.props.children),t=(0,n.assignPositionsToGridItems)(e,this.props.wrappingColumn),i=this.computeGridColumnCount(e,t),{gridItemsWithLayouts:o,gridItemLayouts:s}=this.applyLayoutsToGridItems(t),a=this.sortGridItems(o);return this.renderGrid(a,s,i)}computeGridColumnCount(e,t){let r=e===t?this.state.gridColumnCount:Math.max(this.state.gridColumnCount,s.getRightmostOccupiedColumnOfGridItems(t));return r=Math.min(s.maxColumn,r)}sortGridItems(e){return e.slice().sort(a)}applyLayoutsToGridItems(e){const t=[],i=[];for(const n of e){const e=this.gridItemPropsToLayout(n.props);t.push(e),i.push(r.cloneElement(n,{"data-grid":e}))}return{gridItemLayouts:t,gridItemsWithLayouts:i}}computeGridWidth(e){return o.WidgetSizeConverter.CellWidth*e+o.WidgetSizeConverter.CellMarginWidth*(e+1)}getGridStyles(e){return this.state.precedingUpdateRenderedGrid||this.showEmptyExperience()?{minWidth:e}:{width:e}}showEmptyExperience(){return!(1===this.props.mode)&&0===r.Children.count(this.props.children)}renderGrid(e,t,i){const n=1===this.props.mode;let o="devops-dashboard-grid flex-grow";n&&(o+=" editable");const s=this.computeGridWidth(i);return r.createElement("div",{className:o,ref:this.props.forwardRef,style:this.getGridStyles(s)},this.showEmptyExperience()?null:this.renderOSSGrid(e,t,i,s,n),this.showEmptyExperience()?this.props.renderOnEmpty():null)}renderOSSGrid(e,t,n,a,d){return r.createElement(r.Fragment,null,r.createElement(i,Object.assign({cols:n,width:a,rowHeight:o.WidgetSizeConverter.CellHeight,margin:s.gridMargin,isResizable:!1,isDraggable:!0},{isEditable:d},{layout:t,onLayoutChange:this.onLayoutChange,onDrag:this.onDrag}),e))}gridItemPropsToLayout(e){return{i:e.id,y:e.row-1,h:e.rowSpan,x:e.column-1,w:e.columnSpan,continueDrag:e.dragEvent}}layoutToGridItemPosition(e){return{id:e.i,row:e.y+1,rowSpan:e.h,column:e.x+1,columnSpan:e.w}}throwIfChildrenAreNotGridItems(){0}}function a(e,t){let r=e.props.row-t.props.row;return 0===r&&(r=e.props.column-t.props.column),r}s.gridMargin=[o.WidgetSizeConverter.CellMarginWidth,o.WidgetSizeConverter.CellMarginHeight],s.maxColumn=24}()},["DashboardGridItem","GridPlacement","WidgetSizeConverter","DashboardGrid"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-dashboards.dashboards-grid"}}));