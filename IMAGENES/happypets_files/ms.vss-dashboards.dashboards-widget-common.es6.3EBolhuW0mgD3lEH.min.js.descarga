"use strict";define("Dashboards/WidgetCommon",["require","exports","Reporting/Common/CacheableQueryService","Dashboards/Common/DashboardsNotificationService","VSS/Platform/Context"],function(e,t,i,r,s){!function(e){t.DashboardsCacheableQueryService={},t.DashboardsCacheableQueryService.IDashboardsCacheableQueryServiceName="IDashboardsCacheableQueryService";s.Services.add(t.DashboardsCacheableQueryService.IDashboardsCacheableQueryServiceName,{serviceFactory:class extends i.CacheableQueryService{constructor(){super(...arguments),this.notificationListener=((e,t)=>{"dashboardRefreshing"===t&&this.resetCache()})}_serviceStart(e){super._serviceStart(e),this.notificationService=this.pageContext.getService(r.IDashboardsNotificationServiceName),this.notificationService.subscribe(this.notificationListener)}}})}(),function(e){t.WidgetTelemetry={};class i{}t.WidgetTelemetry.DashboardsTelemetryConstants=i,i.Area="Dashboards";class r extends s.VssService{_serviceStart(e){super._serviceStart(e),this.telemetryService=e.getService("IVssTelemetryService")}onWidgetClick(e,t={}){const r=t.linkDescription?t.linkDescription:"GenericClick",s=this.pageContext.getService("IVssPageService").getData().sessionId,a=e.contributionId,n=a.startsWith("ms.vss-dashboards-web.")?a.replace("ms.vss-dashboards-web.",""):a,o={WidgetId:e.id,WidgetTypeId:n,ContributionId:e.contributionId,WidgetPresentationMode:e.presentationMode,Description:r,StartTime:Date.now(),SessionId:s};this.telemetryService.publishEvent(i.Area,"WidgetClicked",o)}onWidgetFailure(e,t,r,s={}){const a=Object.assign({WidgetId:e.id,WidgetTypeId:e.contributionId,ContributionId:e.contributionId,WidgetPresentationMode:e.presentationMode,ErrorMessage:t,OperationName:r},s);this.telemetryService.publishEvent(i.Area,"WidgetFailed",a)}onWidgetLoaded(e,t){this.generateAndPublishTelemetry(e,t,"WidgetLoaded")}onWidgetLoading(e,t){this.generateAndPublishTelemetry(e,t,"WidgetLoading")}generateAndPublishTelemetry(e,t,r){const s={WidgetId:e.id,WidgetTypeId:e.contributionId,ContributionId:e.contributionId,WidgetPresentationMode:e.presentationMode,ParentPageName:e.parentPageName,WidgetProperties:Object.assign({Width:e.size.width,Height:e.size.height,Size:`${e.size.width} * ${e.size.height}`},t)};this.telemetryService.publishEvent(i.Area,r,s)}}t.WidgetTelemetry.WidgetTelemetryService=r,s.Services.add("IWidgetTelemetryService",{serviceFactory:r}),t.WidgetTelemetry.onWidgetClick=function(e,t,i){e.getService("IWidgetTelemetryService").onWidgetClick(t,i)},t.WidgetTelemetry.onWidgetFailure=function(e,t,i,r,s){e.getService("IWidgetTelemetryService").onWidgetFailure(t,i,r,s)},t.WidgetTelemetry.onWidgetLoaded=function(e,t,i){e.getService("IWidgetTelemetryService").onWidgetLoaded(t,Object.assign({},i))},t.WidgetTelemetry.onWidgetLoading=function(e,t,i){e.getService("IWidgetTelemetryService").onWidgetLoading(t,Object.assign({},i))},t.WidgetTelemetry.executeAndTimeAsync=function(e,t,r,s,a,n){let o=null,d={Function:r,StartDate:new Date,StartTime:Date.now()};const c=e.getService("IVssTelemetryService"),g=e=>{d.ElapsedTimeMs=Date.now()-d.StartTime;const r=a?a(e):e;d.Error=r,d=Object.assign(Object.assign({},d),n),c.publishEvent(i.Area,t,d)};try{o=s().then(e=>(d.ElapsedTimeMs=Date.now()-d.StartTime,d=Object.assign(Object.assign({},d),n),c.publishEvent(i.Area,t,d),e),e=>{throw g(e),e})}catch(e){throw g(e),e}return o}}()},["DashboardsCacheableQueryService","WidgetTelemetry"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-dashboards.dashboards-widget-common"}}));