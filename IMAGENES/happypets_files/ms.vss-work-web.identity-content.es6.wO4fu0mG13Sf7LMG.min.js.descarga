"use strict";define("Wit/Identity",["require","exports","VSS/Core/Util/String","VSS/Platform/Identity","VSS/Platform/Location"],function(e,t,i,n,I){t.InterfacesWorkItemInterfaces={},function(e){t[e]={};let r={},E={},s={};function a(n){var I;if(!n)return"";var r="",E=n.lastIndexOf(t[e].IDENTITY_UNIQUENAME_SEPARATOR);if(I=-1===E?n:n.substr(0,E),i.startsWith(I,t[e].TFS_GROUP_PREFIX)){var s=I.substr(3).trim();r=i.isGuid(s)?s:""}return r}function d(n){if(!n)return null;var I=n.lastIndexOf(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START),r=n.lastIndexOf(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END),E=!1,s=!1,d=!1,N=n;I>=0&&r>I&&(d=!0,N=N.replace(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START).replace(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END)),I=N.lastIndexOf(t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START),r=N.lastIndexOf(t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END);var T=N,o="",R="";let _="";var m,A="";if(I>=0&&r>I)if(T=N.substr(0,I).trim(),d){0===(A=N.substr(I+1,r-I-1).trim()).indexOf(t[e].AAD_IDENTITY_USER_PREFIX)?A=A.substr(t[e].AAD_IDENTITY_USER_PREFIX.length):0===A.indexOf(t[e].AAD_IDENTITY_GROUP_PREFIX)&&(E=!0,A=A.substr(t[e].AAD_IDENTITY_GROUP_PREFIX.length));var D=A.lastIndexOf("\\");D>0&&(-1!==(R=A.substr(D+1).trim()).indexOf("@")?(o=R,A=A.substr(0,D).trim()):(T=n,A="",d=!1,E=!1))}else{var l=a(R=N.substr(I+1,r-I-1).trim());_=(m=R)?0!=m.indexOf(t[e].DESCRIPTOR_PREFIX)?"":m.replace(/desc:/i,""):"",-1!==R.indexOf("@")||-1!==R.indexOf("\\")||-1!==R.indexOf(t[e].DESCRIPTOR_PREFIX)||l||i.isGuid(R)?(o=R,""!=l&&(A=l,E=!0,s=!0,o="")):T=n}return{id:A,displayName:T,uniqueName:_||o,isAadIdentity:d,isContainer:E,isTfsGroup:s}}function N(e,t,i){const n=T(t),I=o(t);if(i&&!n&&!I)return R(e,t);if(n){const e=t;return i?e.identityRef:e.distinctDisplayName||e.identityRef.displayName}if(I){const e=t;return i?e:e.displayName}return t}function T(e){if(e&&void 0!==e.identityRef){const t=e;return t.distinctDisplayName&&!r[t.distinctDisplayName]&&(r[t.distinctDisplayName]=t),t.identityRef&&t.identityRef.descriptor&&!E[t.identityRef.descriptor]&&(E[t.identityRef.descriptor]=t),!0}return!1}function o(e){return!(!e||void 0===e.displayName)}function R(e,t,i){if(r[t])return r[t].identityRef;const n=d(t),I=e.getService("IVssIdentityService");return i=i||I.getIdentityImageUrl(n?n.id:""),n&&n.isAadIdentity?{displayName:t}:n&&{displayName:n.displayName,uniqueName:n.uniqueName,imageUrl:i,_links:{avatar:{href:i}}}}function _(e){let t=Object.assign({},e);return e.identityRef.displayName&&(t.identityRef.displayName=d(t.identityRef.displayName).displayName),t}function m(n,I){return n&&I?i.format("{0} {1}{2}{3}",n,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,I,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):""}function A(n){if(!n)return"";const I=n.signInAddress||n.mail||n.samAccountName;if(r=n,i.equals(r.originDirectory,"aad",!0)&&r.originId&&!r.localId){const I=i.equals(n.entityType,"Group",!0),r=I?t[e].AAD_IDENTITY_GROUP_PREFIX:t[e].AAD_IDENTITY_USER_PREFIX;return!n.signInAddress&&!n.mail||I?i.format("{0} {1}{2}{3}{4}",n.displayName,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,r,n.originId,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):i.format("{0} {1}{2}{3}\\{4}{5}",n.displayName,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,r,n.originId,n.signInAddress||n.mail,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END)}return function(e){const t=e.displayName.indexOf("\\");return i.equals(e.entityType,"Group",!0)&&i.startsWith(e.displayName,"[")&&-1!==t&&i.endsWith(e.displayName.substring(0,t),"]")}(n)?n.localId?i.format("{0} {1}{2}{3}{4}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].TFS_GROUP_PREFIX,n.localId.toUpperCase(),t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):n.displayName:I?-1===I.indexOf("@")&&n.scopeName?i.format("{0} {1}{2}\\{3}{4}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,n.scopeName,I,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):i.format("{0} {1}{2}{3}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,I,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):n.subjectDescriptor?i.format("{0} {1}{2}{3}{4}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].DESCRIPTOR_PREFIX,n.subjectDescriptor,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):n.displayName||"";var r}function D(e,t){const i=e.getService("IVssIdentityService").getIdentityImageUrl(t);return{displayName:t.displayName,entityId:t.id,entityType:"User",image:i}}t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START="<",t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END=">",t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START="<<",t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END=">>",t[e].TFS_GROUP_PREFIX="id:",t[e].AAD_IDENTITY_USER_PREFIX="user:",t[e].AAD_IDENTITY_GROUP_PREFIX="group:",t[e].IDENTITY_UNIQUENAME_SEPARATOR="\\",t[e].DESCRIPTOR_PREFIX="desc:",t[e].getVsIdFromGroupUniqueName=a,t[e].parseUniquefiedIdentityName=d,t[e].setResolvedByDescriptorIfWorkItemIdentityRef=function(e){T(e)&&e.identityRef&&e.identityRef.descriptor&&(s[e.identityRef.descriptor]=!0)},t[e].convertPotentialIdentityRefFromFieldValue=N,t[e].convertPotentialIdentityRefFromFieldValueNotAsIdentityRef=function(e){return T(e)?e.distinctDisplayName||e.identityRef.displayName:o(e)?e.displayName:e},t[e].isWorkItemIdentityRef=T,t[e].isIdentityRef=o,t[e].createIdentityRefFromDistinctDisplayName=R,t[e].convertWorkItemIdentityRefFromFieldValue=function(e,t){if(T(t))return _(t);let i=N(e,t,!0);return i||(i={displayName:t}),_({distinctDisplayName:t,identityRef:i})},t[e].uniqueSortWorkItemIdentityRefObjects=function(e){if(!e||0===e.length)return e;const t={};return e.forEach(e=>t[e.distinctDisplayName]=e),Object.keys(t).sort(i.localeIgnoreCaseComparer).map(e=>t[e])},t[e].getFriendlyDistinctDisplayName=function(e){return e.displayName&&e.uniqueName&&!e.isTfsGroup?m(e.displayName,e.uniqueName):e.displayName||""},t[e].getDistinctDisplayName=m,t[e].getUniquefiedIdentityName=A,t[e].convertIIdentityToWorkItemIdentityRef=function(e,t,i){const n=A(t);return{distinctDisplayName:n,identityRef:R(e,n,i)}},t[e].convertWorkItemIdentityRefToIIdentity=function(e,t){const i=null==t?void 0:t.identityRef;if(i)return D(e,i)},t[e].convertIdentityRefToIIdentity=D,t[e].getIIdentityObject=function(e,t){if(!t)return;if(0===(0,i.localeIgnoreCaseComparer)(t,"@me"))return{displayName:"@me",entityId:"@me",entityType:"User",originDirectory:"",originId:"",image:(0,I.getAssetLocation)(e,"ms.vss-work-web/common-content/Content/memacro-user.svg")};const r=t.substring(0,t.indexOf("<")).trim(),E=-1!==t.indexOf("<id:");let s;return s=E?t.substring(t.indexOf(":")+1,t.length-1).trim():t.substring(t.indexOf("<")+1,t.length-1).trim(),{displayName:r,entityId:"",entityType:E?"Group":"User",localId:E?s:"",mail:E?"":s,originId:E?s:"",samAccountName:E?"":s,signInAddress:E?"":s,image:(0,n.getIdentityImageUrl)(e,R(e,t))}};const l=/.*\<[0-9\-\@a-f]+\>$/i;t[e].stripIdPartFromDisplayName=function(e){return l.test(e)?e.substr(0,e.lastIndexOf("<")).trim():e}}("UtilitiesWorkItemIdentityHelper")},["Interfaces/WorkItemInterfaces","Utilities/WorkItemIdentityHelper"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.identity-content"}}));