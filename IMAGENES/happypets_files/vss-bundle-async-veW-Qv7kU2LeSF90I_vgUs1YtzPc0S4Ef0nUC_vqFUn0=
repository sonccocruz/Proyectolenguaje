if (window.performance && window.performance.mark) { window.performance.mark('startLoadBundleInner-async'); }
// Copyright (C) Microsoft Corporation. All rights reserved.
define("VSS/Identities/Picker/Common",["require","exports"],function(n,t){var r,i;Object.defineProperty(t,"__esModule",{value:!0});t.CommonHelpers=t.FilterByScope=void 0;r=function(){function n(n,t){this.filterByAncestorEntityIds=n||[];this.filterByEntityIds=t||[]}return n.GetHashCode=function(t){var r=i._hashSeed,e,u,f,o;if(t==null)return r;for(e=t.filterByAncestorEntityIds.sort().concat([n._hashSeparator],t.filterByEntityIds.sort()),u=0,f=e;u<f.length;u++)o=f[u],r=r*i._stringListHashPrime+i.GetStringHashCode(o),r=r&r;return r},n.isFilterByScopeEmpty=function(n){return n&&n.filterByAncestorEntityIds.length==0&&n.filterByEntityIds.length==0},n._hashSeparator="@",n}();t.FilterByScope=r;i=function(){function n(){}return n.GetStringHashCode=function(t){var i=n._hashSeed,r;if(t)for(t=t.trim().toLowerCase(),r=0;r<t.length;r++)i=i*n._stringHashPrime+t.charCodeAt(r),i=i&i;return i},n.GetStringListHashCode=function(t){var i=n._hashSeed,r;if(t)for(r in t)i=i*n._stringListHashPrime+n.GetStringHashCode(r),i=i&i;return i},n._hashSeed=0,n._stringListHashPrime=31,n._stringHashPrime=37,n}();t.CommonHelpers=i});

define("VSS/Identities/Picker/Constants",["require","exports"],function(n,t){var i,r,u,f,e;Object.defineProperty(t,"__esModule",{value:!0});t.diacriticsRemovalMap=t.PromiseResultStatus=t.ConsumerId=t.PrefixType=t.TelemetryProperties=t.Telemetry=void 0;i=function(){function n(){}return n.Area="IdentityPicker",n.Scenario_GetMru_Rtt="IdentityPicker_MruService_GetMru_Rtt",n.Scenario_AddMru_Rtt="IdentityPicker_MruService_AddMru_Rtt",n.Scenario_RemoveMru_Rtt="IdentityPicker_MruService_RemoveMru_Rtt",n.Scenario_GetDirectory_Rtt="IdentityPicker_IdentityService_GetDirectory_Rtt",n.Scenario_GetConnections_Rtt="IdentityPicker_IdentityService_GetConnections_Rtt",n.Scenario_GetUserConnections_Rtt="IdentityPicker_IdentityService_GetUserConnections_Rtt",n.Scenario_PagingQuerySplit="IdentityPicker_PagingQuerySplit",n.Feature_DropdownControl="DropdownControl",n.Feature_SearchControl="SearchControl",n.Feature_IdCardDialogControl="IdCardDialogControl",n.Feature_DisplayControl="DisplayControl",n.Feature_TwoLayerCache="TwoLayerCache",n.Feature_RequestCache="RequestCache",n.Feature_Select_Mru_NoPrefix="Select_Mru_NoPrefix",n.Feature_Select_Mru_Prefix="Select_Mru_Prefix",n.Feature_Select_Mru_Dir="Select_Mru_Dir",n.Feature_Select_Dir="Select_Dir",n.Feature_Click_IdCard="Click_IdCard",n.Feature_Click_Remove_Mru="Click_Remove_Mru",n.Feature_ApiExceptions="Api_Exceptions",n}();t.Telemetry=i;r=function(){function n(){}return n.prefixType="p_prefixType",n.prefixLength="p_prefixLength",n.userId="p_userId",n.accountProjectCollectionTeam="p_accountProjectCollectionTeam",n.identityTypes="p_identityTypes",n.operationScopes="p_operationScopes",n.maxResults="p_maxResults",n.minResults="p_minResults",n.consumerId="p_consumerId",n.extensionId="p_extensionId",n.entityId="p_entityId",n.exceptionData="p_exceptionData",n.isMru="p_isMru",n.isNonMaterialized="p_isNonMaterialized",n.isTwoLayerCacheHit="p_isTwoLayerCacheHit",n.isDirSearchUid="p_isDirSearchUid",n}();t.TelemetryProperties=r;u=function(){function n(){}return n.SignInAddress="signInAddress",n.DomainSamAccountName="domainSamAccountName",n.EntityId="entityId",n.Vsid="vsid",n.ScopedPrefix="scopedPrefix",n.StringPrefix="stringPrefix",n}();t.PrefixType=u;f=function(){function n(){}return n.UnknownConsumer="UNKNOWN",n}();t.ConsumerId=f;e=function(){function n(){}return n.Fulfilled="fulfilled",n.Rejected="rejected",n}();t.PromiseResultStatus=e;t.diacriticsRemovalMap={A:"A","\u24b6":"A","\uff21":"A","\u00c0":"A","\u00c1":"A","\u00c2":"A","\u1ea6":"A","\u1ea4":"A","\u1eaa":"A","\u1ea8":"A","\u00c3":"A","\u0100":"A","\u0102":"A","\u1eb0":"A","\u1eae":"A","\u1eb4":"A","\u1eb2":"A","\u0226":"A","\u01e0":"A","\u00c4":"A","\u01de":"A","\u1ea2":"A","\u00c5":"A","\u01fa":"A","\u01cd":"A","\u0200":"A","\u0202":"A","\u1ea0":"A","\u1eac":"A","\u1eb6":"A","\u1e00":"A","\u0104":"A","\u023a":"A","\u2c6f":"A","\ua732":"AA","\u00c6":"AE","\u01fc":"AE","\u01e2":"AE","\ua734":"AO","\ua736":"A","\ua738":"AV","\ua73a":"AV","\ua73c":"AY",B:"B","\u24b7":"B","\uff22":"B","\u1e02":"B","\u1e04":"B","\u1e06":"B","\u0243":"B","\u0182":"B","\u0181":"B",C:"C","\u24b8":"C","\uff23":"C","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u00c7":"C","\u1e08":"C","\u0187":"C","\u023b":"C","\ua73e":"C",D:"D","\u24b9":"D","\uff24":"D","\u1e0a":"D","\u010e":"D","\u1e0c":"D","\u1e10":"D","\u1e12":"D","\u1e0e":"D","\u0110":"D","\u018b":"D","\u018a":"D","\u0189":"D","\ua779":"D","\u01f1":"DZ","\u01c4":"DZ","\u01f2":"Dz","\u01c5":"Dz",E:"E","\u24ba":"E","\uff25":"E","\u00c8":"E","\u00c9":"E","\u00ca":"E","\u1ec0":"E","\u1ebe":"E","\u1ec4":"E","\u1ec2":"E","\u1ebc":"E","\u0112":"E","\u1e14":"E","\u1e16":"E","\u0114":"E","\u0116":"E","\u00cb":"E","\u1eba":"E","\u011a":"E","\u0204":"E","\u0206":"E","\u1eb8":"E","\u1ec6":"E","\u0228":"E","\u1e1c":"E","\u0118":"E","\u1e18":"E","\u1e1a":"E","\u0190":"E","\u018e":"E",F:"F","\u24bb":"F","\uff26":"F","\u1e1e":"F","\u0191":"F","\ua77b":"F",G:"G","\u24bc":"G","\uff27":"G","\u01f4":"G","\u011c":"G","\u1e20":"G","\u011e":"G","\u0120":"G","\u01e6":"G","\u0122":"G","\u01e4":"G","\u0193":"G","\ua7a0":"G","\ua77d":"G","\ua77e":"G",H:"H","\u24bd":"H","\uff28":"H","\u0124":"H","\u1e22":"H","\u1e26":"H","\u021e":"H","\u1e24":"H","\u1e28":"H","\u1e2a":"H","\u0126":"H","\u2c67":"H","\u2c75":"H","\ua78d":"H",I:"I","\u24be":"I","\uff29":"I","\u00cc":"I","\u00cd":"I","\u00ce":"I","\u0128":"I","\u012a":"I","\u012c":"I","\u0130":"I","\u00cf":"I","\u1e2e":"I","\u1ec8":"I","\u01cf":"I","\u0208":"I","\u020a":"I","\u1eca":"I","\u012e":"I","\u1e2c":"I","\u0197":"I",J:"J","\u24bf":"J","\uff2a":"J","\u0134":"J","\u0248":"J",K:"K","\u24c0":"K","\uff2b":"K","\u1e30":"K","\u01e8":"K","\u1e32":"K","\u0136":"K","\u1e34":"K","\u0198":"K","\u2c69":"K","\ua740":"K","\ua742":"K","\ua744":"K","\ua7a2":"K",L:"L","\u24c1":"L","\uff2c":"L","\u013f":"L","\u0139":"L","\u013d":"L","\u1e36":"L","\u1e38":"L","\u013b":"L","\u1e3c":"L","\u1e3a":"L","\u0141":"L","\u023d":"L","\u2c62":"L","\u2c60":"L","\ua748":"L","\ua746":"L","\ua780":"L","\u01c7":"LJ","\u01c8":"Lj",M:"M","\u24c2":"M","\uff2d":"M","\u1e3e":"M","\u1e40":"M","\u1e42":"M","\u2c6e":"M","\u019c":"M",N:"N","\u24c3":"N","\uff2e":"N","\u01f8":"N","\u0143":"N","\u00d1":"N","\u1e44":"N","\u0147":"N","\u1e46":"N","\u0145":"N","\u1e4a":"N","\u1e48":"N","\u0220":"N","\u019d":"N","\ua790":"N","\ua7a4":"N","\u01ca":"NJ","\u01cb":"Nj",O:"O","\u24c4":"O","\uff2f":"O","\u00d2":"O","\u00d3":"O","\u00d4":"O","\u1ed2":"O","\u1ed0":"O","\u1ed6":"O","\u1ed4":"O","\u00d5":"O","\u1e4c":"O","\u022c":"O","\u1e4e":"O","\u014c":"O","\u1e50":"O","\u1e52":"O","\u014e":"O","\u022e":"O","\u0230":"O","\u00d6":"O","\u022a":"O","\u1ece":"O","\u0150":"O","\u01d1":"O","\u020c":"O","\u020e":"O","\u01a0":"O","\u1edc":"O","\u1eda":"O","\u1ee0":"O","\u1ede":"O","\u1ee2":"O","\u1ecc":"O","\u1ed8":"O","\u01ea":"O","\u01ec":"O","\u00d8":"O","\u01fe":"O","\u0186":"O","\u019f":"O","\ua74a":"O","\ua74c":"O","\u01a2":"OI","\ua74e":"OO","\u0222":"OU",P:"P","\u24c5":"P","\uff30":"P","\u1e54":"P","\u1e56":"P","\u01a4":"P","\u2c63":"P","\ua750":"P","\ua752":"P","\ua754":"P",Q:"Q","\u24c6":"Q","\uff31":"Q","\ua756":"Q","\ua758":"Q","\u024a":"Q",R:"R","\u24c7":"R","\uff32":"R","\u0154":"R","\u1e58":"R","\u0158":"R","\u0210":"R","\u0212":"R","\u1e5a":"R","\u1e5c":"R","\u0156":"R","\u1e5e":"R","\u024c":"R","\u2c64":"R","\ua75a":"R","\ua7a6":"R","\ua782":"R",S:"S","\u24c8":"S","\uff33":"S","\u1e9e":"S","\u015a":"S","\u1e64":"S","\u015c":"S","\u1e60":"S","\u0160":"S","\u1e66":"S","\u1e62":"S","\u1e68":"S","\u0218":"S","\u015e":"S","\u2c7e":"S","\ua7a8":"S","\ua784":"S",T:"T","\u24c9":"T","\uff34":"T","\u1e6a":"T","\u0164":"T","\u1e6c":"T","\u021a":"T","\u0162":"T","\u1e70":"T","\u1e6e":"T","\u0166":"T","\u01ac":"T","\u01ae":"T","\u023e":"T","\ua786":"T","\ua728":"TZ",U:"U","\u24ca":"U","\uff35":"U","\u00d9":"U","\u00da":"U","\u00db":"U","\u0168":"U","\u1e78":"U","\u016a":"U","\u1e7a":"U","\u016c":"U","\u00dc":"U","\u01db":"U","\u01d7":"U","\u01d5":"U","\u01d9":"U","\u1ee6":"U","\u016e":"U","\u0170":"U","\u01d3":"U","\u0214":"U","\u0216":"U","\u01af":"U","\u1eea":"U","\u1ee8":"U","\u1eee":"U","\u1eec":"U","\u1ef0":"U","\u1ee4":"U","\u1e72":"U","\u0172":"U","\u1e76":"U","\u1e74":"U","\u0244":"U",V:"V","\u24cb":"V","\uff36":"V","\u1e7c":"V","\u1e7e":"V","\u01b2":"V","\ua75e":"V","\u0245":"V","\ua760":"VY",W:"W","\u24cc":"W","\uff37":"W","\u1e80":"W","\u1e82":"W","\u0174":"W","\u1e86":"W","\u1e84":"W","\u1e88":"W","\u2c72":"W",X:"X","\u24cd":"X","\uff38":"X","\u1e8a":"X","\u1e8c":"X",Y:"Y","\u24ce":"Y","\uff39":"Y","\u1ef2":"Y","\u00dd":"Y","\u0176":"Y","\u1ef8":"Y","\u0232":"Y","\u1e8e":"Y","\u0178":"Y","\u1ef6":"Y","\u1ef4":"Y","\u01b3":"Y","\u024e":"Y","\u1efe":"Y",Z:"Z","\u24cf":"Z","\uff3a":"Z","\u0179":"Z","\u1e90":"Z","\u017b":"Z","\u017d":"Z","\u1e92":"Z","\u1e94":"Z","\u01b5":"Z","\u0224":"Z","\u2c7f":"Z","\u2c6b":"Z","\ua762":"Z",a:"a","\u24d0":"a","\uff41":"a","\u1e9a":"a","\u00e0":"a","\u00e1":"a","\u00e2":"a","\u1ea7":"a","\u1ea5":"a","\u1eab":"a","\u1ea9":"a","\u00e3":"a","\u0101":"a","\u0103":"a","\u1eb1":"a","\u1eaf":"a","\u1eb5":"a","\u1eb3":"a","\u0227":"a","\u01e1":"a","\u00e4":"a","\u01df":"a","\u1ea3":"a","\u00e5":"a","\u01fb":"a","\u01ce":"a","\u0201":"a","\u0203":"a","\u1ea1":"a","\u1ead":"a","\u1eb7":"a","\u1e01":"a","\u0105":"a","\u2c65":"a","\u0250":"a","\ua733":"aa","\u00e6":"ae","\u01fd":"ae","\u01e3":"ae","\ua735":"ao","\ua737":"au","\ua739":"av","\ua73b":"av","\ua73d":"ay",b:"b","\u24d1":"b","\uff42":"b","\u1e03":"b","\u1e05":"b","\u1e07":"b","\u0180":"b","\u0183":"b","\u0253":"b",c:"c","\u24d2":"c","\uff43":"c","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u00e7":"c","\u1e09":"c","\u0188":"c","\u023c":"c","\ua73f":"c","\u2184":"c",d:"d","\u24d3":"d","\uff44":"d","\u1e0b":"d","\u010f":"d","\u1e0d":"d","\u1e11":"d","\u1e13":"d","\u1e0f":"d","\u0111":"d","\u018c":"d","\u0256":"d","\u0257":"d","\ua77a":"d","\u01f3":"dz","\u01c6":"dz",e:"e","\u24d4":"e","\uff45":"e","\u00e8":"e","\u00e9":"e","\u00ea":"e","\u1ec1":"e","\u1ebf":"e","\u1ec5":"e","\u1ec3":"e","\u1ebd":"e","\u0113":"e","\u1e15":"e","\u1e17":"e","\u0115":"e","\u0117":"e","\u00eb":"e","\u1ebb":"e","\u011b":"e","\u0205":"e","\u0207":"e","\u1eb9":"e","\u1ec7":"e","\u0229":"e","\u1e1d":"e","\u0119":"e","\u1e19":"e","\u1e1b":"e","\u0247":"e","\u025b":"e","\u01dd":"e",f:"f","\u24d5":"f","\uff46":"f","\u1e1f":"f","\u0192":"f","\ua77c":"f",g:"g","\u24d6":"g","\uff47":"g","\u01f5":"g","\u011d":"g","\u1e21":"g","\u011f":"g","\u0121":"g","\u01e7":"g","\u0123":"g","\u01e5":"g","\u0260":"g","\ua7a1":"g","\u1d79":"g","\ua77f":"g",h:"h","\u24d7":"h","\uff48":"h","\u0125":"h","\u1e23":"h","\u1e27":"h","\u021f":"h","\u1e25":"h","\u1e29":"h","\u1e2b":"h","\u1e96":"h","\u0127":"h","\u2c68":"h","\u2c76":"h","\u0265":"h","\u0195":"hv",i:"i","\u24d8":"i","\uff49":"i","\u00ec":"i","\u00ed":"i","\u00ee":"i","\u0129":"i","\u012b":"i","\u012d":"i","\u00ef":"i","\u1e2f":"i","\u1ec9":"i","\u01d0":"i","\u0209":"i","\u020b":"i","\u1ecb":"i","\u012f":"i","\u1e2d":"i","\u0268":"i","\u0131":"i",j:"j","\u24d9":"j","\uff4a":"j","\u0135":"j","\u01f0":"j","\u0249":"j",k:"k","\u24da":"k","\uff4b":"k","\u1e31":"k","\u01e9":"k","\u1e33":"k","\u0137":"k","\u1e35":"k","\u0199":"k","\u2c6a":"k","\ua741":"k","\ua743":"k","\ua745":"k","\ua7a3":"k",l:"l","\u24db":"l","\uff4c":"l","\u0140":"l","\u013a":"l","\u013e":"l","\u1e37":"l","\u1e39":"l","\u013c":"l","\u1e3d":"l","\u1e3b":"l","\u017f":"l","\u0142":"l","\u019a":"l","\u026b":"l","\u2c61":"l","\ua749":"l","\ua781":"l","\ua747":"l","\u01c9":"lj",m:"m","\u24dc":"m","\uff4d":"m","\u1e3f":"m","\u1e41":"m","\u1e43":"m","\u0271":"m","\u026f":"m",n:"n","\u24dd":"n","\uff4e":"n","\u01f9":"n","\u0144":"n","\u00f1":"n","\u1e45":"n","\u0148":"n","\u1e47":"n","\u0146":"n","\u1e4b":"n","\u1e49":"n","\u019e":"n","\u0272":"n","\u0149":"n","\ua791":"n","\ua7a5":"n","\u01cc":"nj",o:"o","\u24de":"o","\uff4f":"o","\u00f2":"o","\u00f3":"o","\u00f4":"o","\u1ed3":"o","\u1ed1":"o","\u1ed7":"o","\u1ed5":"o","\u00f5":"o","\u1e4d":"o","\u022d":"o","\u1e4f":"o","\u014d":"o","\u1e51":"o","\u1e53":"o","\u014f":"o","\u022f":"o","\u0231":"o","\u00f6":"o","\u022b":"o","\u1ecf":"o","\u0151":"o","\u01d2":"o","\u020d":"o","\u020f":"o","\u01a1":"o","\u1edd":"o","\u1edb":"o","\u1ee1":"o","\u1edf":"o","\u1ee3":"o","\u1ecd":"o","\u1ed9":"o","\u01eb":"o","\u01ed":"o","\u00f8":"o","\u01ff":"o","\u0254":"o","\ua74b":"o","\ua74d":"o","\u0275":"o","\u01a3":"oi","\u0223":"ou","\ua74f":"oo",p:"p","\u24df":"p","\uff50":"p","\u1e55":"p","\u1e57":"p","\u01a5":"p","\u1d7d":"p","\ua751":"p","\ua753":"p","\ua755":"p",q:"q","\u24e0":"q","\uff51":"q","\u024b":"q","\ua757":"q","\ua759":"q",r:"r","\u24e1":"r","\uff52":"r","\u0155":"r","\u1e59":"r","\u0159":"r","\u0211":"r","\u0213":"r","\u1e5b":"r","\u1e5d":"r","\u0157":"r","\u1e5f":"r","\u024d":"r","\u027d":"r","\ua75b":"r","\ua7a7":"r","\ua783":"r",s:"s","\u24e2":"s","\uff53":"s","\u00df":"s","\u015b":"s","\u1e65":"s","\u015d":"s","\u1e61":"s","\u0161":"s","\u1e67":"s","\u1e63":"s","\u1e69":"s","\u0219":"s","\u015f":"s","\u023f":"s","\ua7a9":"s","\ua785":"s","\u1e9b":"s",t:"t","\u24e3":"t","\uff54":"t","\u1e6b":"t","\u1e97":"t","\u0165":"t","\u1e6d":"t","\u021b":"t","\u0163":"t","\u1e71":"t","\u1e6f":"t","\u0167":"t","\u01ad":"t","\u0288":"t","\u2c66":"t","\ua787":"t","\ua729":"tz",u:"u","\u24e4":"u","\uff55":"u","\u00f9":"u","\u00fa":"u","\u00fb":"u","\u0169":"u","\u1e79":"u","\u016b":"u","\u1e7b":"u","\u016d":"u","\u00fc":"u","\u01dc":"u","\u01d8":"u","\u01d6":"u","\u01da":"u","\u1ee7":"u","\u016f":"u","\u0171":"u","\u01d4":"u","\u0215":"u","\u0217":"u","\u01b0":"u","\u1eeb":"u","\u1ee9":"u","\u1eef":"u","\u1eed":"u","\u1ef1":"u","\u1ee5":"u","\u1e73":"u","\u0173":"u","\u1e77":"u","\u1e75":"u","\u0289":"u",v:"v","\u24e5":"v","\uff56":"v","\u1e7d":"v","\u1e7f":"v","\u028b":"v","\ua75f":"v","\u028c":"v","\ua761":"vy",w:"w","\u24e6":"w","\uff57":"w","\u1e81":"w","\u1e83":"w","\u0175":"w","\u1e87":"w","\u1e85":"w","\u1e98":"w","\u1e89":"w","\u2c73":"w",x:"x","\u24e7":"x","\uff58":"x","\u1e8b":"x","\u1e8d":"x",y:"y","\u24e8":"y","\uff59":"y","\u1ef3":"y","\u00fd":"y","\u0177":"y","\u1ef9":"y","\u0233":"y","\u1e8f":"y","\u00ff":"y","\u1ef7":"y","\u1e99":"y","\u1ef5":"y","\u01b4":"y","\u024f":"y","\u1eff":"y",z:"z","\u24e9":"z","\uff5a":"z","\u017a":"z","\u1e91":"z","\u017c":"z","\u017e":"z","\u1e93":"z","\u1e95":"z","\u01b6":"z","\u0225":"z","\u0240":"z","\u2c6c":"z","\ua763":"z"}});

var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();define("VSS/Identities/Picker/RestClient",["require","exports","VSS/WebApi/Constants","VSS/WebApi/RestClient"],function(n,t,i,r){var u,f;Object.defineProperty(t,"__esModule",{value:!0});t.CommonIdentityPickerHttpClient=t.AbstractIdentityPickerHttpClient=void 0;u=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t.prototype.beginGetIdentities=function(){throw{source:"AbstractIdentityPickerHttpClient",message:"A concrete httpclient should extend AbstractIdentityPickerHttpClient and implement beginGetIdentities"};},t.prototype.beginGetIdentityImageLocation=function(){throw{source:"AbstractIdentityPickerHttpClient",message:"A concrete httpclient should extend AbstractIdentityPickerHttpClient and implement beginGetImageLocation"};},t.prototype.beginGetConnections=function(){throw{source:"AbstractIdentityPickerHttpClient",message:"A concrete httpclient should extend AbstractIdentityPickerHttpClient and implement beginGetConnections"};},t.prototype.beginGetIdentityFeatureMru=function(){throw{source:"AbstractIdentityPickerHttpClient",message:"A concrete httpclient should extend AbstractIdentityPickerHttpClient and implement beginGetMru"};},t.prototype.beginPatchIdentityFeatureMru=function(){throw{source:"AbstractIdentityPickerHttpClient",message:"A concrete httpclient should extend AbstractIdentityPickerHttpClient and implement beginPatchMru"};},t}(r.VssHttpClient);t.AbstractIdentityPickerHttpClient=u;f=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t.prototype.beginGetIdentities=function(n){return this._beginRequest({area:i.CommonIdentityPickerResourceIds.ServiceArea,locationId:i.CommonIdentityPickerResourceIds.IdentitiesLocationId,httpMethod:"POST",data:n})},t.prototype.beginGetIdentityImageLocation=function(n){var r=this,u={objectId:n};return t._identityImageLocation||(t._identityImageLocation=this._beginGetLocation(i.CommonIdentityPickerResourceIds.ServiceArea,i.CommonIdentityPickerResourceIds.IdentityAvatarLocationId)),t._identityImageLocation.then(function(n){return r.getRequestUrl(n.routeTemplate,n.area,n.resourceName,u,{})})},t.prototype.beginGetConnections=function(n,t){return this._beginRequest({area:i.CommonIdentityPickerResourceIds.ServiceArea,locationId:i.CommonIdentityPickerResourceIds.IdentityConnectionsLocationId,httpMethod:"GET",routeValues:{objectId:n},data:t})},t.prototype.beginGetIdentityFeatureMru=function(n,t,r){return this._beginRequest({area:i.CommonIdentityPickerResourceIds.ServiceArea,locationId:i.CommonIdentityPickerResourceIds.IdentityFeatureMruLocationId,httpMethod:"GET",routeValues:{objectId:n,featureId:t},data:r})},t.prototype.beginPatchIdentityFeatureMru=function(n,t,r){return this._beginRequest({area:i.CommonIdentityPickerResourceIds.ServiceArea,locationId:i.CommonIdentityPickerResourceIds.IdentityFeatureMruLocationId,httpMethod:"PATCH",routeValues:{objectId:n,featureId:t},data:r})},t._identityImageLocation=null,t}(u);t.CommonIdentityPickerHttpClient=f});

define("VSS/Identities/Picker/Cache",["require","exports","VSS/Utils/Core","VSS/Utils/String","VSS/Identities/Picker/Constants","VSS/Telemetry/Services"],function(n,t,i,r,u,f){var s,e,o,h,c,l;Object.defineProperty(t,"__esModule",{value:!0});t.TwoLayerCache=t.RequestCache=t.HashCache=t.CacheableTypes=void 0;s=function(){function n(){}return n.guessQueryTokenType=function(t){return r.isGuid(t)&&!r.isEmptyGuid(t)?e.Guid:n._isValidEmail(t)?e.Email:n._isPotentialEntityId(t)?e.UniqueIdentifier:e.Unknown},n._isPotentialEntityId=function(n){var t=n.split(".");return t.length==6&&r.isGuid(t[5])&&!r.isEmptyGuid(t[5])?!0:!1},n._isValidEmail=function(n){var t=n.split("@");return t.length===2&&t[0].length>=1&&t[1].length>=1?!0:!1},n}(),function(n){n[n.Unknown=0]="Unknown";n[n.UniqueIdentifier=1]="UniqueIdentifier";n[n.Guid=2]="Guid";n[n.Email=3]="Email"}(e=t.CacheableTypes||(t.CacheableTypes={}));o=function(){function n(){this._cache={};this._config={expirationIntervalS:86400}}return n.prototype.get=function(n){if(!n)throw{message:"invalid (null/undefined) key",parameter:"key",source:"HashCache add"};if(!this._cache.hasOwnProperty(n)||!this._cache[n])return null;var t=this._cache[n];return(new Date).getTime()/1e3>t.expiryTimeS?(delete this._cache[n],null):this._cache[n].item},n.prototype.set=function(n,t){if(!n)throw{message:"invalid (null/undefined) key",parameter:"key",source:"HashCache add"};var i={item:t,expiryTimeS:(new Date).getTime()/1e3+this._config.expirationIntervalS};this._cache[n]=i},n.prototype.clear=function(){var n=this._getKeys(),t;if(n&&n.length!=0)for(t in n)delete this._cache[t]},n.prototype.configure=function(n){this._config=n},n.prototype._getKeys=function(){return Object.keys(this._cache)},n}();t.HashCache=o;h=function(){function n(){this._config={delayIntervalMS:n._defaultDelayIntervalMS};this._cache=new o;this._cache.configure({expirationIntervalS:this._config.delayIntervalMS/1e3})}return n.prototype.getPromise=function(n){this._setOrResetTimer();var t=this._cache.get(n);return t?t:null},n.prototype.setPromise=function(n,t){this._setOrResetTimer();this._cache.set(n,t)},n.prototype.configure=function(n){this._config=n;this._cache.configure({expirationIntervalS:this._config.delayIntervalMS/1e3})},n.prototype._setOrResetTimer=function(){var n=this;this._timeoutHandle&&(clearTimeout(this._timeoutHandle),this._timeoutHandle=null);this._timeoutHandle=window.setTimeout(i.delegate(this,function(){n._cache.clear()}),this._config.delayIntervalMS)},n._defaultDelayIntervalMS=6e4,n}();t.RequestCache=h;c=function(){function n(n){this._redirectors={};this.configure(n);this._objectCache=new o}return n.prototype.configure=function(n){if(!n||!n.getUniqueIdentifier)throw{source:"TwoLayerCache configure",message:"missing config or missing the required getUniqueIdentifier property",parameter:"config"};this._config=n},n.prototype.addRedirector=function(n){if(n===null||n===undefined)throw{source:"TwoLayerCache addRedirector",message:"invalid null/undefined cacheType",parameter:"cacheType"};if(this._redirectors.hasOwnProperty(n.toString()))throw{source:"TwoLayerCache addRedirector",message:"redirector with supplied cacheType already exists: currently at most one redirector supported for a CacheType",parameter:"cacheType"};this._redirectors[n.toString()]=new o},n.prototype.get=function(n,t){return this._queryCache(n,t)},n.prototype.set=function(n,t,i){var u,r,f;if(u=i?i:s.guessQueryTokenType(n).toString(),r=this._config.getUniqueIdentifier(t),!r)throw{source:"TwoLayerCache set",message:"could not retrieve a valid unique identifier from the value"};if(u==e.UniqueIdentifier.toString()||r==n||this._redirectors.hasOwnProperty(u.toString())){if(u==e.UniqueIdentifier.toString()||r==n){this._objectCache.set(n,t);return}f=this._redirectors[u];f.set(n,r);this._objectCache.set(r,t);return}},n.prototype._queryCache=function(n,t){var i,r;return i=t?t:s.guessQueryTokenType(n).toString(),i==e.UniqueIdentifier.toString()?this._objectCache.get(n):this._redirectors.hasOwnProperty(i.toString())?(r=this._redirectors[i].get(n),!r)?null:this._objectCache.get(r):this._objectCache.get(n)},n}();t.TwoLayerCache=c;l=function(){function n(){}return n.traceCacheHit=function(n,t){var r=n!=null,i={};i[u.TelemetryProperties.isTwoLayerCacheHit]=r;f.publishEvent(new f.TelemetryEventData(u.Telemetry.Area,t,i))},n}()});

var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e};define("VSS/Identities/Picker/Services",["require","exports","VSS/Context","VSS/Locations","VSS/Performance","VSS/Service","VSS/Telemetry/Services","VSS/User/Services","VSS/Utils/Core","VSS/Utils/String","VSS/Identities/Picker/RestClient","VSS/Identities/Picker/Cache","VSS/Identities/Picker/Common","VSS/Identities/Picker/Constants","q","VSS/LWP"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var b,w,k,d;Object.defineProperty(t,"__esModule",{value:!0});t.MruService=t.IdentityService=t.ServiceHelpers=void 0;b=s.delegate;w=function(){function n(){}return n.getOperationScopeList=function(n){var t=[];return n.IMS&&t.push("ims"),n.Source&&t.push("source"),n.AAD&&t.push("aad"),n.AD&&t.push("ad"),n.WMD&&t.push("wmd"),n.GHB&&t.push("ghb"),t},n.getQueryTypeHint=function(n){var t=void 0;return n?(n.UID&&(t="uid"),t):t},n.getIdentityTypeList=function(t){var i=[];return t.User&&i.push(n.UserEntity),t.Group&&i.push(n.GroupEntity),i},n.getConnectionTypeList=function(n){var t=[];return n.successors?t.push("successors"):n.successors&&t.push("predecessors"),n.managers&&t.push("managers"),n.directReports&&t.push("directReports"),t},n.getDefaultIdentityImage=function(t){return t.entityType.toLowerCase().trim()==n.GroupEntity?t.originDirectory.toLowerCase().trim()==n.VisualStudioDirectory?n.DefaultVsoGroupImage:n.DefaultRemoteGroupImage:n.DefaultUserImage},n.getDistinct=function(n){return n.filter(function(n,t,i){return i.indexOf(n)==t})},n.isAuthenticatedMember=function(){return o.getService().hasClaim(o.UserClaims.Member)},n.getPrefixTypeForTelemetry=function(n){var t,r;return h.isGuid(n)?v.PrefixType.Vsid:(t=n.indexOf("@"),t&&n.indexOf(".",t))?v.PrefixType.SignInAddress:(r=n.indexOf("\\"),r&&r==n.lastIndexOf("\\"))?i.getPageContext().webAccessConfiguration.isHosted?v.PrefixType.ScopedPrefix:v.PrefixType.DomainSamAccountName:n.startsWith("vss.ds.v1")?v.PrefixType.EntityId:v.PrefixType.StringPrefix},n.addScenarioProperties=function(t,i,r,u,f,e){return u&&(i[v.TelemetryProperties.identityTypes]=n.getIdentityTypeList(u)),r&&(i[v.TelemetryProperties.operationScopes]=n.getOperationScopeList(r)),f&&(i[v.TelemetryProperties.maxResults]=f.maxResults,i[v.TelemetryProperties.minResults]=f.minResults),i[v.TelemetryProperties.consumerId]=e?e.consumerId:v.ConsumerId.UnknownConsumer,i[v.TelemetryProperties.userId]=t&&t.getWebContext()&&t.getWebContext().user?t.getWebContext().user.id:"",i[v.TelemetryProperties.accountProjectCollectionTeam]=n._getHostMetadata(t),i},n._getHostMetadata=function(n){var t="",i="",r="",u="";return n&&n.getWebContext()&&(t=n.getWebContext().account?n.getWebContext().account.name:"",i=n.getWebContext().collection?n.getWebContext().collection.name:"",r=n.getWebContext().project?n.getWebContext().project.name:"",u=n.getWebContext().team?n.getWebContext().team.name:""),"account["+t+"]/collection["+i+"]/project["+r+"]/team["+u+"]"},n._defaultProperties=["DisplayName","IsMru","ScopeName","SamAccountName","Active","SubjectDescriptor"],n._defaultUserProperties=["Department","JobTitle","Mail","MailNickname","PhysicalDeliveryOfficeName","SignInAddress","Surname","Guest","TelephoneNumber"],n._defaultGroupProperties=["Description"],n.DefaultUserImage=r.urlHelper.getVersionedContentUrl("ip-content-user-default.png"),n.DefaultVsoGroupImage=r.urlHelper.getVersionedContentUrl("ip-content-vso-group-default.png"),n.DefaultRemoteGroupImage=r.urlHelper.getVersionedContentUrl("ip-content-aad-group-default.png"),n.VisualStudioDirectory="vsd",n.AzureActiveDirectory="aad",n.ActiveDirectory="ad",n.WindowsMachineDirectory="wmd",n.SourceDirectory="src",n.GitHubDirectory="ghb",n.UserEntity="user",n.GroupEntity="group",n.OptionsMinResultsKey="MinResults",n.OptionsMaxResultsKey="MaxResults",n.ExtensionData_ExtensionIdKey="ExtensionId",n.ExtensionData_ProjectScopeNameKey="ProjectScopeName",n.ExtensionData_CollectionScopeNameKey="CollectionScopeName",n.ExtensionData_ConstraintListKey="Constraints",n.ExtensionData_NoServiceIdentities="NoServiceIdentities",n.GetIdentities_Prefix_Separator=";",n}();t.ServiceHelpers=w;k=function(n){function t(){var i=__construct(this,n,[]),r,u,f;for(r in i)i.hasOwnProperty(r)&&(this[r]=i[r]);return u={getUniqueIdentifier:function(n){return n&&n.identities&&n.identities.length==1?n.identities[0].entityId:null}},i._qtrCache=new l.TwoLayerCache(u),i._qtrCache.addRedirector(l.CacheableTypes.Email),i._qtrCache.addRedirector(l.CacheableTypes.Guid),i._qtrRequestAggregator=new l.RequestCache,i._entityImageRequestAggregator=new l.RequestCache,f=p.getLWPService("IVssContributionService"),i.identitySearchService=t.resolveIdentitySearchService(),i}return __extends(t,n),t.resolveIdentitySearchService=function(){return __awaiter(this,void 0,void 0,function(){var i,r,n,f,t,e,o,u,s,h;return __generator(this,function(c){switch(c.label){case 0:c.trys.push([0,7,,8]);i=p.getLWPService("IVssContributionService");r=i.getContributionsByType("ms.vss-features.preferred-identity-search-service-name");n=[];for(f in r)n.push(f);t=0;c.label=1;case 1:if(!(t<n.length))return[3,6];e=n[t];o=r[e];c.label=2;case 2:return c.trys.push([2,4,,5]),[4,i.getService(o.serviceId)];case 3:return(u=c.sent(),u)?[2,u]:[3,5];case 4:return s=c.sent(),[3,5];case 5:return t++,[3,1];case 6:return[3,8];case 7:return h=c.sent(),[3,8];case 8:return[2,undefined]}})})},t.prototype.getIdentities=function(n,i,r,f,o,s){var tt=this,k,p,h,rt,ct,ft,lt,g,at,et,vt,yt,l,ut,it,st,bt,nt;if(!i){it={source:"IdentityService",parameter:"operationScope",message:"operationScope null or undefined"};throw it;}if(!r){it={source:"IdentityService",parameter:"identityType",message:"identityType null or undefined"};throw it;}if(k=u.getScenarioManager().startScenario(v.Telemetry.Area,v.Telemetry.Scenario_GetDirectory_Rtt),p={},p=w.addScenarioProperties(this,p,i,r,f,s),p[v.TelemetryProperties.prefixType]=w.getPrefixTypeForTelemetry(n),p[v.TelemetryProperties.prefixLength]=n.length,p[v.TelemetryProperties.isDirSearchUid]=Boolean(o&&o.UID),h={},rt={},!n)return rt;for(l=[],ct=n.split(w.GetIdentities_Prefix_Separator),ft=0;ft<ct.length;ft++)lt=ct[ft].trim(),lt&&l.push(lt);l=w.getDistinct(l);l.forEach(function(n){h[n.toLowerCase()]=y.defer();rt[n.toLowerCase()]=h[n.toLowerCase()].promise});for(g in h){if(at=t.getUniqueRequestString(g,i,r,f?f.extensionData:null,f?f.getFilterByScope():null),et=this._qtrCache.get(at),et){et.queryToken=g;h[g].resolve(et);l=t._removeQueryToken(g,l);continue}if(vt=this._qtrRequestAggregator.getPromise(at),vt){yt=b(this,function(n){vt.then(b(tt,function(t){h&&h[n]&&h[n].resolve(t)}),b(tt,function(t){h&&h[n]&&h[n].reject(t)}))});yt(g);l=t._removeQueryToken(g,l);continue}}if(l.length==0)return rt;for(ut=0;ut<l.length;ut++)this._qtrRequestAggregator.setPromise(t.getUniqueRequestString(l[ut],i,r,f?f.extensionData:null,f?f.getFilterByScope():null),h[l[ut].toLowerCase()].promise);n=l.join(w.GetIdentities_Prefix_Separator);var pt=w.getIdentityTypeList(r),wt=w.getOperationScopeList(i),ot=w.getQueryTypeHint(o);if(pt.length==0||wt.length==0){it={source:"IdentityService",parameter:"identityType or operationScope",message:"queried identityType or operationScope is/are unsupported"};throw it;}f&&f.httpClient?st=f.httpClient:(bt=this.getConnection().getHttpClient(c.CommonIdentityPickerHttpClient),st=bt);var kt=pt,dt=wt,d={};f&&f.minResults&&(d[w.OptionsMinResultsKey]=f.minResults);f&&f.maxResults&&(d[w.OptionsMaxResultsKey]=f.maxResults);f&&f.extensionData&&(d[w.ExtensionData_ExtensionIdKey]=f.extensionData.extensionId,d[w.ExtensionData_ProjectScopeNameKey]=f.extensionData.projectScopeName,d[w.ExtensionData_CollectionScopeNameKey]=f.extensionData.collectionScopeName,d[w.ExtensionData_ConstraintListKey]=f.extensionData.constraints);nt=w._defaultProperties;r.User&&(nt=nt.concat(w._defaultUserProperties));r.Group&&(nt=nt.concat(w._defaultGroupProperties));var ni=function(n){if(n.results.length<1)return u;var s=function(n){if(k&&k.addSplitTiming(v.Telemetry.Scenario_PagingQuerySplit+"_End_"+n&&n.results[0]?a.CommonHelpers.GetStringHashCode(n.results[0].queryToken).toString():""),n&&n.results.length!=0){n.results[0].identities.forEach(function(n){n.image||(n.image=w.getDefaultIdentityImage(n))});tt._cacheQueryTokenResult(n.results[0],t.getUniqueRequestString(n.results[0].queryToken.trim(),i,r,f?f.extensionData:null,f?f.getFilterByScope():null));var u=n.results[0].queryToken;u&&h[u.toLowerCase().trim()]&&h[u.toLowerCase().trim()].resolve(n.results[0])}},o=function(n){for(var i in h)h[i].reject(n);p[v.TelemetryProperties.exceptionData]=t._getExceptionData(n);e.publishEvent(new e.TelemetryEventData(v.Telemetry.Area,v.Telemetry.Feature_ApiExceptions,p))},u,c=function(n){var e,c,l;n.identities&&n.identities.length==0&&n.pagingToken?(e=f&&f.getFilterByScope(),c={query:n.queryToken,identityTypes:kt,operationScopes:dt,properties:nt,filterByAncestorEntityIds:e?e.filterByAncestorEntityIds:[],filterByEntityIds:e?e.filterByEntityIds:[],pagingToken:n.pagingToken,options:d},ot&&(c.queryTypeHint=ot),k.addSplitTiming(v.Telemetry.Scenario_PagingQuerySplit+"_Start_"+a.CommonHelpers.GetStringHashCode(n.queryToken).toString()),l=tt.fetchIdentitiesWithInjectionsAsync(st,c).then(s,o),u&&u.push(l)):n.identities&&n.identities.length>=0?(n.identities.forEach(function(n){n.image||(n.image=w.getDefaultIdentityImage(n))}),tt._cacheQueryTokenResult(n,t.getUniqueRequestString(n.queryToken.trim(),i,r,f?f.extensionData:null,f?f.getFilterByScope():null)),n.queryToken&&h[n.queryToken.toLowerCase().trim()]&&h[n.queryToken.toLowerCase().trim()].resolve(n)):o()};n.results.forEach(c,tt);u&&u.length>0?y.allSettled(u).then(function(){k.addData(p);k.end()},function(){k.addData(p);k.end()}):(k.addData(p),k.end())},ti=function(n){for(var i in h)h[i].reject(n);p[v.TelemetryProperties.exceptionData]=t._getExceptionData(n);e.publishEvent(new e.TelemetryEventData(v.Telemetry.Area,v.Telemetry.Feature_ApiExceptions,p));k.end()},ht=f&&f.getFilterByScope(),gt={query:n,identityTypes:kt,operationScopes:dt,properties:nt,filterByAncestorEntityIds:ht?ht.filterByAncestorEntityIds:[],filterByEntityIds:ht?ht.filterByEntityIds:[],options:d};return ot&&(gt.queryTypeHint=ot),this.fetchIdentitiesWithInjectionsAsync(st,gt).then(ni,ti),rt},t.prototype.fetchIdentitiesWithInjectionsAsync=function(n,t){return __awaiter(this,void 0,void 0,function(){var i,r,u;return __generator(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),[4,this.identitySearchService];case 1:return i=f.sent(),i&&(r=i.getScopeId(),r&&(t.operationScopes=["ims"],t.options=__assign({ScopeId:r},t.options))),[3,3];case 2:return u=f.sent(),[3,3];case 3:return[2,n.beginGetIdentities(t)]}})})},t.prototype.getIdentityImages=function(n,i){var h=this,l,r,e,o,a,f,s,v,u;if(!n||n.length<=0){l={source:"IdentityService",parameter:"identities",message:"identities null or undefined or empty list"};throw l;}r={};e={};i&&i.httpClient?o=i.httpClient:(a=this.getConnection().getHttpClient(c.CommonIdentityPickerHttpClient),o=a);u=t._getEntityIdsAsQueryTokens(n);u.forEach(function(n){r[n]=y.defer();e[n]=r[n].promise});for(f in r)if(s=this._entityImageRequestAggregator.getPromise(f),s){v=b(this,function(n){s.then(b(h,function(t){r&&r[n]&&r[n].resolve(t)}),b(h,function(t){r&&r[n]&&r[n].reject(t)}))});v(f);u=t._removeQueryToken(f,u);continue}else this._entityImageRequestAggregator.setPromise(f,r[f].promise);return u.length==0?e:(u.forEach(function(n){var t=function(t){var i;t&&t.trim()&&(i={},i[n]=t.trim(),r[n].resolve(i))};o.beginGetIdentityImageLocation(n).then(t)}),e)},t.prototype.getIdentityConnections=function(n,i,r,f,o,s,h){var l,p,a,b,tt,k,it;if(!w.isAuthenticatedMember())return null;if(!n){l={source:"IdentityService",parameter:"identity",message:"identity null or undefined or empty list"};throw l;}if(!i){l={source:"IdentityService",parameter:"operationScope",message:"operationScope null or undefined"};throw l;}if(!r){l={source:"IdentityService",parameter:"identityType",message:"identityType null or undefined"};throw l;}if(!f){l={source:"IdentityService",parameter:"connectionType",message:"connectionType null or undefined"};throw l;}var rt=h?h:1,d=w.getIdentityTypeList(r),g=w.getOperationScopeList(i),nt=w.getConnectionTypeList(f);if(d.length==0||g.length==0||nt.length==0){l={source:"IdentityService",parameter:"identityType or operationScope or connectionType",message:"queried identityType or operationScope or connectionType is/are unsupported"};throw l;}p=u.getScenarioManager().startScenario(v.Telemetry.Area,v.Telemetry.Scenario_GetConnections_Rtt);a={};a=w.addScenarioProperties(this,a,i,r,o,s);a[v.TelemetryProperties.entityId]=n.entityId;b=y.defer();tt=b.promise;o&&o.httpClient?k=o.httpClient:(it=this.getConnection().getHttpClient(c.CommonIdentityPickerHttpClient),k=it);var ut=w._defaultProperties.concat(w._defaultUserProperties).concat(w._defaultGroupProperties).concat("Manager"),ft={identityTypes:d,operationScopes:g,connectionTypes:nt,depth:rt,properties:ut},et=function(n){n&&n.successors&&n.successors.forEach(function(n){n.image||(n.image=w.getDefaultIdentityImage(n))});p.addData(a);p.end();b.resolve(n)},ot=function(n){a[v.TelemetryProperties.exceptionData]=t._getExceptionData(n);p.addData(a);e.publishEvent(new e.TelemetryEventData(v.Telemetry.Area,v.Telemetry.Feature_ApiExceptions,a));p.end();b.reject(n)};return k.beginGetConnections(n.entityId,ft).then(et,ot),tt},t._getEntityIdsAsQueryTokens=function(n){var t=[];return n.forEach(function(n){(n.entityType.trim().toLowerCase()==w.UserEntity||n.entityType.trim().toLowerCase()==w.GroupEntity)&&t.push(n.entityId)}),t},t.prototype._cacheQueryTokenResult=function(n,t){n.queryToken&&n.queryToken.trim()&&n.identities&&n.identities.length==1&&t&&this._qtrCache.set(t,n)},t._removeQueryToken=function(n,t){var i=-1;return t.some(function(t,r){if(n==t.toLowerCase())return i=r,!0}),i>=0&&t.splice(i,1),t},t._getExceptionData=function(n){return n?n.serverError?n.serverError.typeName:n.name:""},t.getUniqueRequestString=function(n,i,r,u,f){var e=w.getIdentityTypeList(r).join(","),o=w.getOperationScopeList(i).join(",");return(n+";"+o+";"+e+";"+t.getExtensionUniqueRequestString(u)+";"+a.FilterByScope.GetHashCode(f).toString()).trim().toLowerCase()},t.getExtensionUniqueRequestString=function(n){return n?a.CommonHelpers.GetStringHashCode(n.collectionScopeName).toString()+a.CommonHelpers.GetStringHashCode(n.projectScopeName).toString()+a.CommonHelpers.GetStringHashCode(n.extensionId).toString()+a.CommonHelpers.GetStringListHashCode(n.constraints).toString():""},t.MIN_RESULTS=40,t.MAX_RESULTS=40,t}(f.VssService);t.IdentityService=k;d=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t.prototype.getMruIdentities=function(n,i,r,f,o){var l,h,p,s,a,k,b,d;if(!w.isAuthenticatedMember())return null;if(!n){s={source:"IdentityService",parameter:"operationScope",message:"operationScope null or undefined"};throw s;}if(i&&i.trim().toLowerCase()!=t.DEFAULT_IDENTITY_ID){s={source:"IdentityService",parameter:"identityId",message:"identityId can only be 'me'"};throw s;}if(i="me",r&&r.trim().toLowerCase()!=t.DEFAULT_FEATURE_ID){s={source:"IdentityService",parameter:"featureId",message:"featureId can only be 'common'"};throw s;}if(r="common",l=u.getScenarioManager().startScenario(v.Telemetry.Area,v.Telemetry.Scenario_GetMru_Rtt),h={},h=w.addScenarioProperties(this,h,null,null,f,o),p=w.getOperationScopeList(n),p.length==0){s={source:"IdentityService",parameter:"operationScope",message:"queried operationScope is unsupported"};throw s;}a=y.defer();k=a.promise;f&&f.httpClient?b=f.httpClient:(d=this.getConnection().getHttpClient(c.CommonIdentityPickerHttpClient),b=d);var g=w._defaultProperties.concat(w._defaultUserProperties).concat(w._defaultGroupProperties),nt={operationScopes:p,properties:g,filterByAncestorEntityIds:f&&f.filterByScope?f.filterByScope.filterByAncestorEntityIds:[],filterByEntityIds:f&&f.filterByScope?f.filterByScope.filterByEntityIds:[]},tt=function(n){l.addData(h);l.end();a.resolve(n.mruIdentities)},it=function(n){h[v.TelemetryProperties.exceptionData]=t._getExceptionData(n);l.addData(h);e.publishEvent(new e.TelemetryEventData(v.Telemetry.Area,v.Telemetry.Feature_ApiExceptions,h));l.end();a.reject(n)};return b.beginGetIdentityFeatureMru(i,r,nt).then(tt,it),k},t.prototype.removeMruIdentities=function(n,i,r,f,o,s){var a,l,b,h,p,d,k,g;if(!w.isAuthenticatedMember())return null;if(!n||n.length==0){h={source:"IdentityService",parameter:"objectIds",message:"objectIds null or undefined or empty"};throw h;}if(!i){h={source:"IdentityService",parameter:"operationScope",message:"operationScope null or undefined"};throw h;}if(r&&r.trim().toLowerCase()!=t.DEFAULT_IDENTITY_ID){h={source:"IdentityService",parameter:"identityId",message:"identityId can only be 'me'"};throw h;}if(r="me",f&&f.trim().toLowerCase()!=t.DEFAULT_FEATURE_ID){h={source:"IdentityService",parameter:"featureId",message:"featureId can only be 'common'"};throw h;}if(f="common",a=u.getScenarioManager().startScenario(v.Telemetry.Area,v.Telemetry.Scenario_RemoveMru_Rtt),l={},l=w.addScenarioProperties(this,l,null,null,o,s),b=w.getOperationScopeList(i),b.length==0){h={source:"IdentityService",parameter:"operationScope",message:"queried operationScope is unsupported"};throw h;}p=y.defer();d=p.promise;o&&o.httpClient?k=o.httpClient:(g=this.getConnection().getHttpClient(c.CommonIdentityPickerHttpClient),k=g);var nt=[{op:"remove",value:n,operationScopes:b}],tt=function(n){a.addData(l);a.end();p.resolve(n.result)},it=function(n){l[v.TelemetryProperties.exceptionData]=t._getExceptionData(n);a.addData(l);e.publishEvent(new e.TelemetryEventData(v.Telemetry.Area,v.Telemetry.Feature_ApiExceptions,l));a.end();p.reject(n)};return k.beginPatchIdentityFeatureMru(r,f,nt).then(tt,it),d},t.prototype.addMruIdentities=function(n,i,r,f,o,s){var b,h,a,l,p,d,k,g;if(!w.isAuthenticatedMember())return null;if(!n||n.length==0){h={source:"IdentityService",parameter:"objectIds",message:"objectIds null or undefined or empty"};throw h;}if(!i){h={source:"IdentityService",parameter:"operationScope",message:"operationScope null or undefined"};throw h;}if(r&&r.trim().toLowerCase()!=t.DEFAULT_IDENTITY_ID){h={source:"IdentityService",parameter:"identityId",message:"identityId can only be 'me'"};throw h;}if(r=t.DEFAULT_IDENTITY_ID,f&&f.trim().toLowerCase()!=t.DEFAULT_FEATURE_ID){h={source:"IdentityService",parameter:"featureId",message:"featureId can only be 'common'"};throw h;}if(f=t.DEFAULT_FEATURE_ID,b=w.getOperationScopeList(i),b.length==0){h={source:"IdentityService",parameter:"operationScope",message:"queried operationScope is unsupported"};throw h;}a=u.getScenarioManager().startScenario(v.Telemetry.Area,v.Telemetry.Scenario_AddMru_Rtt);l={};l=w.addScenarioProperties(this,l,null,null,o,s);p=y.defer();d=p.promise;o&&o.httpClient?k=o.httpClient:(g=this.getConnection().getHttpClient(c.CommonIdentityPickerHttpClient),k=g);var nt=[{op:"add",value:n,operationScopes:b}],tt=function(n){a.addData(l);a.end();p.resolve(n.result)},it=function(n){l[v.TelemetryProperties.exceptionData]=t._getExceptionData(n);a.addData(l);e.publishEvent(new e.TelemetryEventData(v.Telemetry.Area,v.Telemetry.Feature_ApiExceptions,l));a.end();p.reject(n)};return k.beginPatchIdentityFeatureMru(r,f,nt).then(tt,it),d},t._getExceptionData=function(n){return n?n.serverError?n.serverError.typeName:n.name:""},t.DEFAULT_IDENTITY_ID="me",t.DEFAULT_FEATURE_ID="common",t}(f.VssService);t.MruService=d});

var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)};define("VSS/Controls/PopupContent",["require","exports","VSS/Controls","VSS/Diag","VSS/Utils/Core","VSS/Utils/String","VSS/Utils/UI"],function(n,t,i,r,u,f,e){var v,h,o;Object.defineProperty(t,"__esModule",{value:!0});t.RichContentTooltip=t.RichContentTooltipO=t.PopupContentControl=t.PopupContentControlO=void 0;var c=e.domElem,l=u.delegate,a=100,y=1e3,s=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t._hasFocus=!1,t._blockFocusUntil=-a-1,t._hasMouse=!1,t._enabled=!0,t._handlers={},t}return __extends(t,n),t.prototype.initialize=function(){n.prototype.initialize.call(this);this._element[0].classList.add("popup-content-control");this._setAriaDescribedBy();!this._options.openDelay&&this._$dropElement.is(":focus")&&this.show();this._onForceHideDropPopupDelegate=this.onForceHideDropPopup.bind(this)},t.prototype.onForceHideDropPopup=function(){this.hide()},t.prototype.setTextContent=function(n){this._setContent(f.htmlEncode(n))},t.prototype.setHtmlContent=function(n){this._setContent(n)},t.prototype._setContent=function(n){this._$contentContainer.html(n);this._contentSet=!0;this._visible&&this._reposition()},t.prototype._initializeContent=function(){if(!this._contentSet){if(this._options.text)typeof this._options.text=="function"?this.setTextContent(this._options.text.call(this)):this.setTextContent(this._options.text);else if(this._options.html)typeof this._options.html=="function"?this.setHtmlContent(this._options.html.call(this)):this.setHtmlContent(this._options.html);else if(this._options.content){var n=this._options.content;typeof n=="function"?this._setContent(n.call(this)):this._setContent(n)}this._contentSet=!0}},t.prototype._setAriaDescribedBy=function(){if(this._options.setAriaDescribedBy){this._initializeContent();var t=this._$contentContainer.attr("id"),n=this._$dropElement.attr("aria-describedby")||"";n.indexOf(t)===-1&&this._$dropElement.attr("aria-describedby",(n?n+" ":"")+t)}},t.prototype.resetContent=function(){this._contentSet=!1},t.prototype.show=function(){this._show({useMousePosition:!1})},t.prototype.toggle=function(){this._element.is(":visible")?this.hide():this.show()},t.prototype._enhance=function(n){var u=this,t;this._createElement();this._$dropElement=n;t=this._options.menuContainer||$("#PopupContentContainer");t.length===0&&(t=$("<div id='PopupContentContainer'><\/div>").appendTo(document.body));this._element.appendTo(t);this._element.css("position","fixed");this._$contentContainer=$(c("div","popup-content-container")).attr({role:"tooltip",id:i.getHtmlId(),"aria-hidden":"true"}).appendTo(this._element);this._decorate();this._bind(n,"remove.removePopupDropElement",function(){u.dispose()})},t.prototype._decorate=function(){var n=this;this._options.openCloseOnHover?(this._listen("mouseover",this.onMouseOver),this._options.showOnFocus!==!1&&this._listen("focus",this._onFocus)):(this._documentEventDelegate=l(this,this._handleDocumentMouseDown),this._bind(this._$dropElement,"click",function(){n._element.is(":visible")?n.hide():n.show()}))},t.prototype._listen=function(n,t){!this._handlers[n]&&this._$dropElement.length>0&&this._$dropElement[0].addEventListener(n,this._handlers[n]=t.bind(this))},t.prototype._stopListening=function(n){var t=this._handlers[n];t&&this._$dropElement[0].removeEventListener(n,t)},t.prototype._onInteract=function(){this.hide();this._hasFocus=!1;this._blockFocusUntil=Date.now()+a},t.prototype._onFocus=function(n){n.target===this._$dropElement[0]&&Date.now()>this._blockFocusUntil&&(this._hasFocus=!0,this._listen("blur",this._onBlur),!this._hasMouse&&this._enabled&&this._showDelayed())},t.prototype._onBlur=function(){this._hasFocus=!1;this._hasMouse||this.hide()},t.prototype._onMouseMove=function(n){this._mousePosition?(this._mousePosition.left=n.pageX,this._mousePosition.top=n.pageY):this._mousePosition={left:n.pageX,top:n.pageY}},t.prototype.onMouseOver=function(n){(!this._options.mouseEventFilter||this._options.mouseEventFilter(n))&&(this._options.useStrictTarget&&n.target!==this._$dropElement[0]||(this._hasMouse=!0,this._enabled)&&(this._listen("mouseout",this._onMouseOut),this._listen("mousemove",this._onMouseMove),this._onMouseMove(n),this._showDelayed({useMousePosition:!0}),this._delayedHide&&this._delayedHide.cancel()))},t.prototype._onMouseOut=function(){var n=this;this._hasMouse=!1;this._delayedHide&&this._delayedHide.cancel();this._delayedHide=u.delay(this,100,function(){n.hide();n._delayedHide=null})},t.prototype.showDelayed=function(){this._showDelayed({useMousePosition:!1})},t.prototype._showDelayed=function(n){var t=this;this._visible||(n=n||{useMousePosition:!1},this._options.openDelay?(this._delayedShow&&this._delayedShow.cancel(),this._delayedShow=u.delay(this,this._options.openDelay,function(){t._show(n)})):this._show(n))},t.prototype._handleDocumentMouseDown=function(n){var t=$(n.target);this._$dropElement.has(n.target).length>0||this._$dropElement[0]===n.target||this._$contentContainer.has(n.target).length>0||this._$contentContainer[0]===n.target||this._element.has(n.target).length>0||this._element[0]===n.target||this.hide()},t.prototype._setPosition=function(){this._setPositionInternal({useMousePosition:!1})},t.prototype._setPositionInternal=function(n){if(this._visible){this._element.css({top:0,left:0});this._lastPositionContext={options:n};var t={elementAlign:this._options.elementAlign||"left-top",baseAlign:this._options.baseAlign||"left-bottom",overflow:this._options.overflow,supportScroll:this._options.supportScroll,leftOffsetPixels:this._options.leftOffsetPixels,topOffsetPixels:this._options.topOffsetPixels,skipZIndexSetting:this._options.skipZIndexSetting};n.useMousePosition&&this._options.useMousePosition!==!1?(this._lastPositionContext.mousePosition={left:this._mousePosition.left,top:this._mousePosition.top},t.leftOffsetPixels=this._options.mouseLeftOffsetPixels||t.leftOffsetPixels,t.topOffsetPixels=this._options.mouseTopOffsetPixels||t.topOffsetPixels,e.Positioning.positionAtLocation(this._element,this._mousePosition,t)):this._$dropElement.length>0&&e.Positioning.position(this._element,this._$dropElement,t)}},t.prototype._reposition=function(){this._lastPositionContext&&(this._lastPositionContext.mousePosition&&(this._mousePosition=this._lastPositionContext.mousePosition),this._setPositionInternal(this._lastPositionContext.options))},t.prototype._getDropElement=function(){return this._$dropElement},t.prototype._show=function(n){!this.isDisposed()&&this._getDropElement().is(":visible")&&(!this._options.onlyShowWhenOverflows||e.contentsOverflow(this._options.onlyShowWhenOverflows))&&(this._visible||(this._visible=!0,this._options.openCloseOnHover&&(this._listen("click",this._onInteract),this._listen("keypress",this._onInteract)),this._initializeContent(),this.getElement().show(),this._setPositionInternal(n),this._fire("popup-opened"),this._documentEventDelegate&&$(document).bind("mousedown",this._documentEventDelegate),e.attachResize(this._element,l(this,this._setPosition)),this._bind(this._$dropElement.parents(),"scroll",this._onForceHideDropPopupDelegate),this._escapeKeyHandler||(this._escapeKeyHandler=this.onEscapeKeyPressed.bind(this),document.addEventListener("keydown",this._escapeKeyHandler,!0)),this._delayedShow&&this._delayedShow.cancel(),this._$contentContainer.attr("aria-hidden","false")))},t.prototype.onEscapeKeyPressed=function(n){n.key==="Escape"&&(this.hide(),n.preventDefault(),n.stopPropagation())},t.prototype.hide=function(){(this._escapeKeyHandler&&document.removeEventListener("keydown",this._escapeKeyHandler,!0),this.isDisposed())||(this._delayedShow&&this._delayedShow.cancel(),this._visible)&&(this._visible=!1,this._documentEventDelegate&&$(document).unbind("mousedown",this._documentEventDelegate),e.detachResize(this._element),this._onForceHideDropPopupDelegate&&this._unbind(this._$dropElement.parents(),"scroll",this._onForceHideDropPopupDelegate),this._element.hide(),this._fire("popup-closed"),this._stopListening("mousemove"),this._$contentContainer.attr("aria-hidden","true"))},t.prototype.enable=function(){this._enabled=!0;(this._hasFocus||this._hasMouse)&&this._showDelayed()},t.prototype.disable=function(){this._enabled=!1;this.hide()},t.prototype._dispose=function(){if(n.prototype._dispose.call(this),this._options.setAriaDescribedBy){var i=this._$contentContainer.attr("id"),t=this._$dropElement.attr("aria-describedby")||"";t=t.replace(new RegExp("\\b".concat(i,"\\b"),"g"),"").trim().replace(/\s+/," ");t?this._$dropElement.attr("aria-describedby",t):this._$dropElement.removeAttr("aria-describedby")}this._documentEventDelegate&&($(document).unbind("mousedown",this._documentEventDelegate),this._documentEventDelegate=null);this._onForceHideDropPopupDelegate&&(this._unbind(this._$dropElement.parents(),"scroll",this._onForceHideDropPopupDelegate),this._onForceHideDropPopupDelegate=null);this._$dropElement&&this._$dropElement.length>=1&&(this._unbind(this._$dropElement,"click"),this._unbind(this._$dropElement,"remove.removePopupDropElement"),this._stopListening("mouseover"),this._stopListening("mouseout"),this._stopListening("mousemove"),this._stopListening("focus"),this._stopListening("blur"),this._stopListening("click"),this._stopListening("keypress"));e.detachResize(this._element)},t}(i.Control);t.PopupContentControlO=s;v=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t}(s);t.PopupContentControl=v;h=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t._onKeyDown=function(n){n.which===27&&t._visible&&(t._popupHasMouse=!1,t.hide())},t}return __extends(t,n),t.hide=function(){t._shownTooltip&&t._shownTooltip.hide()},t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({coreCssClass:"rich-content-tooltip",openCloseOnHover:!0,elementAlign:"middle-top",baseAlign:"middle-bottom",useMousePosition:!1},t))},t.prototype.initialize=function(){var i=this.getElement(),r=this._options,t;r.popupTag!==!1&&(this._$popupTag=$(c("div","popup-tag")).prependTo(i),this._popupHasMouse=!1,t=this,this._$popupTag[0].parentElement.addEventListener("mouseenter",function(){t._popupHasMouse=!0}),this._$popupTag[0].parentElement.addEventListener("mouseleave",function(){t._popupHasMouse=!1;t._delayedHide=u.delay(this,100,function(){t.hide();t._delayedHide=null})}));n.prototype.initialize.call(this);i[0].classList.add("v2");r.autoWidth&&i[0].classList.add("auto-width")},t.prototype._getPopupTooltipElement=function(){return this._$popupTag},t.prototype._show=function(i){if(document.addEventListener("keydown",this._onKeyDown),n.prototype._show.call(this,i),this._visible){var r=t._shownTooltip;r&&r!==this&&r.hide();t._shownTooltip=this}},t.prototype.hide=function(){this._popupHasMouse||(document.removeEventListener("keydown",this._onKeyDown),n.prototype.hide.call(this),t._shownTooltip===this&&(t._shownTooltip=null))},t.prototype._setPositionInternal=function(t){var f,i,r,e,o,s;if((n.prototype._setPositionInternal.call(this,t),this._visible)&&this._$popupTag){f=t&&t.useMousePosition&&this._options.useMousePosition!==!1;this._$popupTag.css({top:0,left:0});this._$contentContainer.toggleClass("mouse",f);i={left:parseInt(this._element.css("left"),10),top:parseInt(this._element.css("top"),10),width:this._element.outerWidth(),height:this._element.outerHeight()};r=void 0;f?r=this._mousePosition:(e=this._getDropElement(),o=e.offset(),r={left:o.left+e.outerWidth()/2,top:o.top});s=this._element.offset();r.left+=i.left-s.left;r.top+=i.top-s.top;var l=f?27:11,u=15,a=u*.5,c=u*(Math.SQRT2-1)*.5,v=c+u,h={left:Math.max(Math.min(r.left-a,i.left+i.width-v),i.left+c),top:i.top+l-u*.5};i.top<r.top-.5?(this._$popupTag.addClass("flipped"),h.top=i.top+i.height-11-u*.5):this._$popupTag.removeClass("flipped");this._$popupTag.css({left:h.left+"px",top:h.top+"px"})}},t.add=function(n,t,r){return r=__assign({openDelay:y,topOffsetPixels:0,mouseTopOffsetPixels:0,autoWidth:!0},r),typeof n=="string"?r.text=n:n&&(r.html=n),i.Enhancement.enhance(o,$(t),r)},t.addIfOverflow=function(n,t,i){return o.add(n,t,__assign(__assign({},i),{onlyShowWhenOverflows:t}))},t}(s);t.RichContentTooltipO=h;o=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t}(h);t.RichContentTooltip=o});

/*!
 * jQuery UI Button 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/button/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/button",["jquery", "./core", "./widget"], n) : n(jQuery) })(function (n) { var t, i = "ui-button ui-widget ui-state-default ui-corner-all", r = "ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only", f = function () { var t = n(this); setTimeout(function () { t.find(":ui-button").button("refresh") }, 1) }, u = function (t) { var i = t.name, r = t.form, u = n([]); return i && (i = i.replace(/'/g, "\\'"), u = r ? n(r).find("[name='" + i + "'][type=radio]") : n("[name='" + i + "'][type=radio]", t.ownerDocument).filter(function () { return !this.form })), u }; return n.widget("ui.button", { version: "1.11.4", defaultElement: "<button>", options: { disabled: null, text: !0, label: null, icons: { primary: null, secondary: null } }, _create: function () { this.element.closest("form").unbind("reset" + this.eventNamespace).bind("reset" + this.eventNamespace, f); typeof this.options.disabled != "boolean" ? this.options.disabled = !!this.element.prop("disabled") : this.element.prop("disabled", this.options.disabled); this._determineButtonType(); this.hasTitle = !!this.buttonElement.attr("title"); var e = this, r = this.options, o = this.type === "checkbox" || this.type === "radio", s = o ? "" : "ui-state-active"; r.label === null && (r.label = this.type === "input" ? this.buttonElement.val() : this.buttonElement.html()); this._hoverable(this.buttonElement); this.buttonElement.addClass(i).attr("role", "button").bind("mouseenter" + this.eventNamespace, function () { r.disabled || this === t && n(this).addClass("ui-state-active") }).bind("mouseleave" + this.eventNamespace, function () { r.disabled || n(this).removeClass(s) }).bind("click" + this.eventNamespace, function (n) { r.disabled && (n.preventDefault(), n.stopImmediatePropagation()) }); this._on({ focus: function () { this.buttonElement.addClass("ui-state-focus") }, blur: function () { this.buttonElement.removeClass("ui-state-focus") } }); o && this.element.bind("change" + this.eventNamespace, function () { e.refresh() }); this.type === "checkbox" ? this.buttonElement.bind("click" + this.eventNamespace, function () { if (r.disabled) return !1 }) : this.type === "radio" ? this.buttonElement.bind("click" + this.eventNamespace, function () { if (r.disabled) return !1; n(this).addClass("ui-state-active"); e.buttonElement.attr("aria-pressed", "true"); var t = e.element[0]; u(t).not(t).map(function () { return n(this).button("widget")[0] }).removeClass("ui-state-active").attr("aria-pressed", "false") }) : (this.buttonElement.bind("mousedown" + this.eventNamespace, function () { if (r.disabled) return !1; n(this).addClass("ui-state-active"); t = this; e.document.one("mouseup", function () { t = null }) }).bind("mouseup" + this.eventNamespace, function () { if (r.disabled) return !1; n(this).removeClass("ui-state-active") }).bind("keydown" + this.eventNamespace, function (t) { if (r.disabled) return !1; (t.keyCode === n.ui.keyCode.SPACE || t.keyCode === n.ui.keyCode.ENTER) && n(this).addClass("ui-state-active") }).bind("keyup" + this.eventNamespace + " blur" + this.eventNamespace, function () { n(this).removeClass("ui-state-active") }), this.buttonElement.is("a") && this.buttonElement.keyup(function (t) { t.keyCode === n.ui.keyCode.SPACE && n(this).click() })); this._setOption("disabled", r.disabled); this._resetButton() }, _determineButtonType: function () { var n, t, i; this.type = this.element.is("[type=checkbox]") ? "checkbox" : this.element.is("[type=radio]") ? "radio" : this.element.is("input") ? "input" : "button"; this.type === "checkbox" || this.type === "radio" ? (n = this.element.parents().last(), t = "label[for='" + this.element.attr("id") + "']", this.buttonElement = n.find(t), this.buttonElement.length || (n = n.length ? n.siblings() : this.element.siblings(), this.buttonElement = n.filter(t), this.buttonElement.length || (this.buttonElement = n.find(t))), this.element.addClass("ui-helper-hidden-accessible"), i = this.element.is(":checked"), i && this.buttonElement.addClass("ui-state-active"), this.buttonElement.prop("aria-pressed", i)) : this.buttonElement = this.element }, widget: function () { return this.buttonElement }, _destroy: function () { this.element.removeClass("ui-helper-hidden-accessible"); this.buttonElement.removeClass(i + " ui-state-active " + r).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()); this.hasTitle || this.buttonElement.removeAttr("title") }, _setOption: function (n, t) { if (this._super(n, t), n === "disabled") { this.widget().toggleClass("ui-state-disabled", !!t); this.element.prop("disabled", !!t); t && (this.type === "checkbox" || this.type === "radio" ? this.buttonElement.removeClass("ui-state-focus") : this.buttonElement.removeClass("ui-state-focus ui-state-active")); return } this._resetButton() }, refresh: function () { var t = this.element.is("input, button") ? this.element.is(":disabled") : this.element.hasClass("ui-button-disabled"); t !== this.options.disabled && this._setOption("disabled", t); this.type === "radio" ? u(this.element[0]).each(function () { n(this).is(":checked") ? n(this).button("widget").addClass("ui-state-active").attr("aria-pressed", "true") : n(this).button("widget").removeClass("ui-state-active").attr("aria-pressed", "false") }) : this.type === "checkbox" && (this.element.is(":checked") ? this.buttonElement.addClass("ui-state-active").attr("aria-pressed", "true") : this.buttonElement.removeClass("ui-state-active").attr("aria-pressed", "false")) }, _resetButton: function () { if (this.type === "input") { this.options.label && this.element.val(this.options.label); return } var i = this.buttonElement.removeClass(r), e = n("<span><\/span>", this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(i.empty()).text(), t = this.options.icons, f = t.primary && t.secondary, u = []; t.primary || t.secondary ? (this.options.text && u.push("ui-button-text-icon" + (f ? "s" : t.primary ? "-primary" : "-secondary")), t.primary && i.prepend("<span class='ui-button-icon-primary ui-icon " + t.primary + "'><\/span>"), t.secondary && i.append("<span class='ui-button-icon-secondary ui-icon " + t.secondary + "'><\/span>"), this.options.text || (u.push(f ? "ui-button-icons-only" : "ui-button-icon-only"), this.hasTitle || i.attr("title", n.trim(e)))) : u.push("ui-button-text-only"); i.addClass(u.join(" ")) } }), n.widget("ui.buttonset", { version: "1.11.4", options: { items: "button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)" }, _create: function () { this.element.addClass("ui-buttonset") }, _init: function () { this.refresh() }, _setOption: function (n, t) { n === "disabled" && this.buttons.button("option", n, t); this._super(n, t) }, refresh: function () { var i = this.element.css("direction") === "rtl", t = this.element.find(this.options.items), r = t.filter(":ui-button"); t.not(":ui-button").button(); r.button("refresh"); this.buttons = t.map(function () { return n(this).button("widget")[0] }).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(i ? "ui-corner-right" : "ui-corner-left").end().filter(":last").addClass(i ? "ui-corner-left" : "ui-corner-right").end().end() }, _destroy: function () { this.element.removeClass("ui-buttonset"); this.buttons.map(function () { return n(this).button("widget")[0] }).removeClass("ui-corner-left ui-corner-right").end().button("destroy") } }), n.ui.button });

/*!
 * jQuery UI Mouse 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/mouse/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/mouse",["jquery", "./widget"], n) : n(jQuery) })(function (n) { var t = !1; return n(document).mouseup(function () { t = !1 }), n.widget("ui.mouse", { version: "1.11.4", options: { cancel: "input,textarea,button,select,option", distance: 1, delay: 0 }, _mouseInit: function () { var t = this; this.element.bind("mousedown." + this.widgetName, function (n) { return t._mouseDown(n) }).bind("click." + this.widgetName, function (i) { if (!0 === n.data(i.target, t.widgetName + ".preventClickEvent")) return n.removeData(i.target, t.widgetName + ".preventClickEvent"), i.stopImmediatePropagation(), !1 }); this.started = !1 }, _mouseDestroy: function () { this.element.unbind("." + this.widgetName); this._mouseMoveDelegate && this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate) }, _mouseDown: function (i) { if (!t) { this._mouseMoved = !1; this._mouseStarted && this._mouseUp(i); this._mouseDownEvent = i; var r = this, u = i.which === 1, f = typeof this.options.cancel == "string" && i.target.nodeName ? n(i.target).closest(this.options.cancel).length : !1; return !u || f || !this._mouseCapture(i) ? !0 : (this.mouseDelayMet = !this.options.delay, this.mouseDelayMet || (this._mouseDelayTimer = setTimeout(function () { r.mouseDelayMet = !0 }, this.options.delay)), this._mouseDistanceMet(i) && this._mouseDelayMet(i) && (this._mouseStarted = this._mouseStart(i) !== !1, !this._mouseStarted)) ? (i.preventDefault(), !0) : (!0 === n.data(i.target, this.widgetName + ".preventClickEvent") && n.removeData(i.target, this.widgetName + ".preventClickEvent"), this._mouseMoveDelegate = function (n) { return r._mouseMove(n) }, this._mouseUpDelegate = function (n) { return r._mouseUp(n) }, this.document.bind("mousemove." + this.widgetName, this._mouseMoveDelegate).bind("mouseup." + this.widgetName, this._mouseUpDelegate), i.preventDefault(), t = !0, !0) } }, _mouseMove: function (t) { return this._mouseMoved && (n.ui.ie && (!document.documentMode || document.documentMode < 9) && !t.button || !t.which) ? this._mouseUp(t) : ((t.which || t.button) && (this._mouseMoved = !0), this._mouseStarted) ? (this._mouseDrag(t), t.preventDefault()) : (this._mouseDistanceMet(t) && this._mouseDelayMet(t) && (this._mouseStarted = this._mouseStart(this._mouseDownEvent, t) !== !1, this._mouseStarted ? this._mouseDrag(t) : this._mouseUp(t)), !this._mouseStarted) }, _mouseUp: function (i) { return this.document.unbind("mousemove." + this.widgetName, this._mouseMoveDelegate).unbind("mouseup." + this.widgetName, this._mouseUpDelegate), this._mouseStarted && (this._mouseStarted = !1, i.target === this._mouseDownEvent.target && n.data(i.target, this.widgetName + ".preventClickEvent", !0), this._mouseStop(i)), t = !1, !1 }, _mouseDistanceMet: function (n) { return Math.max(Math.abs(this._mouseDownEvent.pageX - n.pageX), Math.abs(this._mouseDownEvent.pageY - n.pageY)) >= this.options.distance }, _mouseDelayMet: function () { return this.mouseDelayMet }, _mouseStart: function () { }, _mouseDrag: function () { }, _mouseStop: function () { }, _mouseCapture: function () { return !0 } }) });

/*!
 * jQuery UI Draggable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/draggable/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/draggable",["jquery", "./core", "./mouse", "./widget"], n) : n(jQuery) })(function (n) { return n.widget("ui.draggable", n.ui.mouse, { version: "1.11.4", widgetEventPrefix: "drag", options: { addClasses: !0, appendTo: "parent", axis: !1, connectToSortable: !1, containment: !1, cursor: "auto", cursorAt: !1, grid: !1, handle: !1, helper: "original", iframeFix: !1, opacity: !1, refreshPositions: !1, revert: !1, revertDuration: 500, scope: "default", scroll: !0, scrollSensitivity: 20, scrollSpeed: 20, snap: !1, snapMode: "both", snapTolerance: 20, stack: !1, zIndex: !1, drag: null, start: null, stop: null }, _create: function () { this.options.helper === "original" && this._setPositionRelative(); this.options.addClasses && this.element.addClass("ui-draggable"); this.options.disabled && this.element.addClass("ui-draggable-disabled"); this._setHandleClassName(); this._mouseInit() }, _setOption: function (n, t) { this._super(n, t); n === "handle" && (this._removeHandleClassName(), this._setHandleClassName()) }, _destroy: function () { if ((this.helper || this.element).is(".ui-draggable-dragging")) { this.destroyOnClear = !0; return } this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"); this._removeHandleClassName(); this._mouseDestroy() }, _mouseCapture: function (t) { var i = this.options; return (this._blurActiveElement(t), this.helper || i.disabled || n(t.target).closest(".ui-resizable-handle").length > 0) ? !1 : (this.handle = this._getHandle(t), !this.handle) ? !1 : (this._blockFrames(i.iframeFix === !0 ? "iframe" : i.iframeFix), !0) }, _blockFrames: function (t) { this.iframeBlocks = this.document.find(t).map(function () { var t = n(this); return n("<div>").css("position", "absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0] }) }, _unblockFrames: function () { this.iframeBlocks && (this.iframeBlocks.remove(), delete this.iframeBlocks) }, _blurActiveElement: function (t) { var i = this.document[0]; if (this.handleElement.is(t.target)) try { i.activeElement && i.activeElement.nodeName.toLowerCase() !== "body" && n(i.activeElement).blur() } catch (r) { } }, _mouseStart: function (t) { var i = this.options; return (this.helper = this._createHelper(t), this.helper.addClass("ui-draggable-dragging"), this._cacheHelperProportions(), n.ui.ddmanager && (n.ui.ddmanager.current = this), this._cacheMargins(), this.cssPosition = this.helper.css("position"), this.scrollParent = this.helper.scrollParent(!0), this.offsetParent = this.helper.offsetParent(), this.hasFixedAncestor = this.helper.parents().filter(function () { return n(this).css("position") === "fixed" }).length > 0, this.positionAbs = this.element.offset(), this._refreshOffsets(t), this.originalPosition = this.position = this._generatePosition(t, !1), this.originalPageX = t.pageX, this.originalPageY = t.pageY, i.cursorAt && this._adjustOffsetFromHelper(i.cursorAt), this._setContainment(), this._trigger("start", t) === !1) ? (this._clear(), !1) : (this._cacheHelperProportions(), n.ui.ddmanager && !i.dropBehaviour && n.ui.ddmanager.prepareOffsets(this, t), this._normalizeRightBottom(), this._mouseDrag(t, !0), n.ui.ddmanager && n.ui.ddmanager.dragStart(this, t), !0) }, _refreshOffsets: function (n) { this.offset = { top: this.positionAbs.top - this.margins.top, left: this.positionAbs.left - this.margins.left, scroll: !1, parent: this._getParentOffset(), relative: this._getRelativeOffset() }; this.offset.click = { left: n.pageX - this.offset.left, top: n.pageY - this.offset.top } }, _mouseDrag: function (t, i) { if (this.hasFixedAncestor && (this.offset.parent = this._getParentOffset()), this.position = this._generatePosition(t, !0), this.positionAbs = this._convertPositionTo("absolute"), !i) { var r = this._uiHash(); if (this._trigger("drag", t, r) === !1) return this._mouseUp({}), !1; this.position = r.position } return this.helper[0].style.left = this.position.left + "px", this.helper[0].style.top = this.position.top + "px", n.ui.ddmanager && n.ui.ddmanager.drag(this, t), !1 }, _mouseStop: function (t) { var r = this, i = !1; return n.ui.ddmanager && !this.options.dropBehaviour && (i = n.ui.ddmanager.drop(this, t)), this.dropped && (i = this.dropped, this.dropped = !1), this.options.revert === "invalid" && !i || this.options.revert === "valid" && i || this.options.revert === !0 || n.isFunction(this.options.revert) && this.options.revert.call(this.element, i) ? n(this.helper).animate(this.originalPosition, parseInt(this.options.revertDuration, 10), function () { r._trigger("stop", t) !== !1 && r._clear() }) : this._trigger("stop", t) !== !1 && this._clear(), !1 }, _mouseUp: function (t) { return this._unblockFrames(), n.ui.ddmanager && n.ui.ddmanager.dragStop(this, t), this.handleElement.is(t.target) && this.element.focus(), n.ui.mouse.prototype._mouseUp.call(this, t) }, cancel: function () { return this.helper.is(".ui-draggable-dragging") ? this._mouseUp({}) : this._clear(), this }, _getHandle: function (t) { return this.options.handle ? !!n(t.target).closest(this.element.find(this.options.handle)).length : !0 }, _setHandleClassName: function () { this.handleElement = this.options.handle ? this.element.find(this.options.handle) : this.element; this.handleElement.addClass("ui-draggable-handle") }, _removeHandleClassName: function () { this.handleElement.removeClass("ui-draggable-handle") }, _createHelper: function (t) { var r = this.options, u = n.isFunction(r.helper), i = u ? n(r.helper.apply(this.element[0], [t])) : r.helper === "clone" ? this.element.clone().removeAttr("id") : this.element; return i.parents("body").length || i.appendTo(r.appendTo === "parent" ? this.element[0].parentNode : r.appendTo), u && i[0] === this.element[0] && this._setPositionRelative(), i[0] === this.element[0] || /(fixed|absolute)/.test(i.css("position")) || i.css("position", "absolute"), i }, _setPositionRelative: function () { /^(?:r|a|f)/.test(this.element.css("position")) || (this.element[0].style.position = "relative") }, _adjustOffsetFromHelper: function (t) { typeof t == "string" && (t = t.split(" ")); n.isArray(t) && (t = { left: +t[0], top: +t[1] || 0 }); "left" in t && (this.offset.click.left = t.left + this.margins.left); "right" in t && (this.offset.click.left = this.helperProportions.width - t.right + this.margins.left); "top" in t && (this.offset.click.top = t.top + this.margins.top); "bottom" in t && (this.offset.click.top = this.helperProportions.height - t.bottom + this.margins.top) }, _isRootNode: function (n) { return /(html|body)/i.test(n.tagName) || n === this.document[0] }, _getParentOffset: function () { var t = this.offsetParent.offset(), i = this.document[0]; return this.cssPosition === "absolute" && this.scrollParent[0] !== i && n.contains(this.scrollParent[0], this.offsetParent[0]) && (t.left += this.scrollParent.scrollLeft(), t.top += this.scrollParent.scrollTop()), this._isRootNode(this.offsetParent[0]) && (t = { top: 0, left: 0 }), { top: t.top + (parseInt(this.offsetParent.css("borderTopWidth"), 10) || 0), left: t.left + (parseInt(this.offsetParent.css("borderLeftWidth"), 10) || 0) } }, _getRelativeOffset: function () { if (this.cssPosition !== "relative") return { top: 0, left: 0 }; var n = this.element.position(), t = this._isRootNode(this.scrollParent[0]); return { top: n.top - (parseInt(this.helper.css("top"), 10) || 0) + (t ? 0 : this.scrollParent.scrollTop()), left: n.left - (parseInt(this.helper.css("left"), 10) || 0) + (t ? 0 : this.scrollParent.scrollLeft()) } }, _cacheMargins: function () { this.margins = { left: parseInt(this.element.css("marginLeft"), 10) || 0, top: parseInt(this.element.css("marginTop"), 10) || 0, right: parseInt(this.element.css("marginRight"), 10) || 0, bottom: parseInt(this.element.css("marginBottom"), 10) || 0 } }, _cacheHelperProportions: function () { this.helperProportions = { width: this.helper.outerWidth(), height: this.helper.outerHeight() } }, _setContainment: function () { var f, t, i, r = this.options, u = this.document[0]; if (this.relativeContainer = null, !r.containment) { this.containment = null; return } if (r.containment === "window") { this.containment = [n(window).scrollLeft() - this.offset.relative.left - this.offset.parent.left, n(window).scrollTop() - this.offset.relative.top - this.offset.parent.top, n(window).scrollLeft() + n(window).width() - this.helperProportions.width - this.margins.left, n(window).scrollTop() + (n(window).height() || u.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]; return } if (r.containment === "document") { this.containment = [0, 0, n(u).width() - this.helperProportions.width - this.margins.left, (n(u).height() || u.body.parentNode.scrollHeight) - this.helperProportions.height - this.margins.top]; return } if (r.containment.constructor === Array) { this.containment = r.containment; return } (r.containment === "parent" && (r.containment = this.helper[0].parentNode), t = n(r.containment), i = t[0], i) && (f = /(scroll|auto)/.test(t.css("overflow")), this.containment = [(parseInt(t.css("borderLeftWidth"), 10) || 0) + (parseInt(t.css("paddingLeft"), 10) || 0), (parseInt(t.css("borderTopWidth"), 10) || 0) + (parseInt(t.css("paddingTop"), 10) || 0), (f ? Math.max(i.scrollWidth, i.offsetWidth) : i.offsetWidth) - (parseInt(t.css("borderRightWidth"), 10) || 0) - (parseInt(t.css("paddingRight"), 10) || 0) - this.helperProportions.width - this.margins.left - this.margins.right, (f ? Math.max(i.scrollHeight, i.offsetHeight) : i.offsetHeight) - (parseInt(t.css("borderBottomWidth"), 10) || 0) - (parseInt(t.css("paddingBottom"), 10) || 0) - this.helperProportions.height - this.margins.top - this.margins.bottom], this.relativeContainer = t) }, _convertPositionTo: function (n, t) { t || (t = this.position); var i = n === "absolute" ? 1 : -1, r = this._isRootNode(this.scrollParent[0]); return { top: t.top + this.offset.relative.top * i + this.offset.parent.top * i - (this.cssPosition === "fixed" ? -this.offset.scroll.top : r ? 0 : this.offset.scroll.top) * i, left: t.left + this.offset.relative.left * i + this.offset.parent.left * i - (this.cssPosition === "fixed" ? -this.offset.scroll.left : r ? 0 : this.offset.scroll.left) * i } }, _generatePosition: function (n, t) { var i, s, u, f, r = this.options, h = this._isRootNode(this.scrollParent[0]), e = n.pageX, o = n.pageY; return h && this.offset.scroll || (this.offset.scroll = { top: this.scrollParent.scrollTop(), left: this.scrollParent.scrollLeft() }), t && (this.containment && (this.relativeContainer ? (s = this.relativeContainer.offset(), i = [this.containment[0] + s.left, this.containment[1] + s.top, this.containment[2] + s.left, this.containment[3] + s.top]) : i = this.containment, n.pageX - this.offset.click.left < i[0] && (e = i[0] + this.offset.click.left), n.pageY - this.offset.click.top < i[1] && (o = i[1] + this.offset.click.top), n.pageX - this.offset.click.left > i[2] && (e = i[2] + this.offset.click.left), n.pageY - this.offset.click.top > i[3] && (o = i[3] + this.offset.click.top)), r.grid && (u = r.grid[1] ? this.originalPageY + Math.round((o - this.originalPageY) / r.grid[1]) * r.grid[1] : this.originalPageY, o = i ? u - this.offset.click.top >= i[1] || u - this.offset.click.top > i[3] ? u : u - this.offset.click.top >= i[1] ? u - r.grid[1] : u + r.grid[1] : u, f = r.grid[0] ? this.originalPageX + Math.round((e - this.originalPageX) / r.grid[0]) * r.grid[0] : this.originalPageX, e = i ? f - this.offset.click.left >= i[0] || f - this.offset.click.left > i[2] ? f : f - this.offset.click.left >= i[0] ? f - r.grid[0] : f + r.grid[0] : f), r.axis === "y" && (e = this.originalPageX), r.axis === "x" && (o = this.originalPageY)), { top: o - this.offset.click.top - this.offset.relative.top - this.offset.parent.top + (this.cssPosition === "fixed" ? -this.offset.scroll.top : h ? 0 : this.offset.scroll.top), left: e - this.offset.click.left - this.offset.relative.left - this.offset.parent.left + (this.cssPosition === "fixed" ? -this.offset.scroll.left : h ? 0 : this.offset.scroll.left) } }, _clear: function () { this.helper.removeClass("ui-draggable-dragging"); this.helper[0] === this.element[0] || this.cancelHelperRemoval || this.helper.remove(); this.helper = null; this.cancelHelperRemoval = !1; this.destroyOnClear && this.destroy() }, _normalizeRightBottom: function () { this.options.axis !== "y" && this.helper.css("right") !== "auto" && (this.helper.width(this.helper.width()), this.helper.css("right", "auto")); this.options.axis !== "x" && this.helper.css("bottom") !== "auto" && (this.helper.height(this.helper.height()), this.helper.css("bottom", "auto")) }, _trigger: function (t, i, r) { return r = r || this._uiHash(), n.ui.plugin.call(this, t, [i, r, this], !0), /^(drag|start|stop)/.test(t) && (this.positionAbs = this._convertPositionTo("absolute"), r.offset = this.positionAbs), n.Widget.prototype._trigger.call(this, t, i, r) }, plugins: {}, _uiHash: function () { return { helper: this.helper, position: this.position, originalPosition: this.originalPosition, offset: this.positionAbs } } }), n.ui.plugin.add("draggable", "connectToSortable", { start: function (t, i, r) { var u = n.extend({}, i, { item: r.element }); r.sortables = []; n(r.options.connectToSortable).each(function () { var i = n(this).sortable("instance"); i && !i.options.disabled && (r.sortables.push(i), i.refreshPositions(), i._trigger("activate", t, u)) }) }, stop: function (t, i, r) { var u = n.extend({}, i, { item: r.element }); r.cancelHelperRemoval = !1; n.each(r.sortables, function () { var n = this; n.isOver ? (n.isOver = 0, r.cancelHelperRemoval = !0, n.cancelHelperRemoval = !1, n._storedCSS = { position: n.placeholder.css("position"), top: n.placeholder.css("top"), left: n.placeholder.css("left") }, n._mouseStop(t), n.options.helper = n.options._helper) : (n.cancelHelperRemoval = !0, n._trigger("deactivate", t, u)) }) }, drag: function (t, i, r) { n.each(r.sortables, function () { var f = !1, u = this; u.positionAbs = r.positionAbs; u.helperProportions = r.helperProportions; u.offset.click = r.offset.click; u._intersectsWith(u.containerCache) && (f = !0, n.each(r.sortables, function () { return this.positionAbs = r.positionAbs, this.helperProportions = r.helperProportions, this.offset.click = r.offset.click, this !== u && this._intersectsWith(this.containerCache) && n.contains(u.element[0], this.element[0]) && (f = !1), f })); f ? (u.isOver || (u.isOver = 1, r._parent = i.helper.parent(), u.currentItem = i.helper.appendTo(u.element).data("ui-sortable-item", !0), u.options._helper = u.options.helper, u.options.helper = function () { return i.helper[0] }, t.target = u.currentItem[0], u._mouseCapture(t, !0), u._mouseStart(t, !0, !0), u.offset.click.top = r.offset.click.top, u.offset.click.left = r.offset.click.left, u.offset.parent.left -= r.offset.parent.left - u.offset.parent.left, u.offset.parent.top -= r.offset.parent.top - u.offset.parent.top, r._trigger("toSortable", t), r.dropped = u.element, n.each(r.sortables, function () { this.refreshPositions() }), r.currentItem = r.element, u.fromOutside = r), u.currentItem && (u._mouseDrag(t), i.position = u.position)) : u.isOver && (u.isOver = 0, u.cancelHelperRemoval = !0, u.options._revert = u.options.revert, u.options.revert = !1, u._trigger("out", t, u._uiHash(u)), u._mouseStop(t, !0), u.options.revert = u.options._revert, u.options.helper = u.options._helper, u.placeholder && u.placeholder.remove(), i.helper.appendTo(r._parent), r._refreshOffsets(t), i.position = r._generatePosition(t, !0), r._trigger("fromSortable", t), r.dropped = !1, n.each(r.sortables, function () { this.refreshPositions() })) }) } }), n.ui.plugin.add("draggable", "cursor", { start: function (t, i, r) { var u = n("body"), f = r.options; u.css("cursor") && (f._cursor = u.css("cursor")); u.css("cursor", f.cursor) }, stop: function (t, i, r) { var u = r.options; u._cursor && n("body").css("cursor", u._cursor) } }), n.ui.plugin.add("draggable", "opacity", { start: function (t, i, r) { var u = n(i.helper), f = r.options; u.css("opacity") && (f._opacity = u.css("opacity")); u.css("opacity", f.opacity) }, stop: function (t, i, r) { var u = r.options; u._opacity && n(i.helper).css("opacity", u._opacity) } }), n.ui.plugin.add("draggable", "scroll", { start: function (n, t, i) { i.scrollParentNotHidden || (i.scrollParentNotHidden = i.helper.scrollParent(!1)); i.scrollParentNotHidden[0] !== i.document[0] && i.scrollParentNotHidden[0].tagName !== "HTML" && (i.overflowOffset = i.scrollParentNotHidden.offset()) }, drag: function (t, i, r) { var u = r.options, o = !1, e = r.scrollParentNotHidden[0], f = r.document[0]; e !== f && e.tagName !== "HTML" ? (u.axis && u.axis === "x" || (r.overflowOffset.top + e.offsetHeight - t.pageY < u.scrollSensitivity ? e.scrollTop = o = e.scrollTop + u.scrollSpeed : t.pageY - r.overflowOffset.top < u.scrollSensitivity && (e.scrollTop = o = e.scrollTop - u.scrollSpeed)), u.axis && u.axis === "y" || (r.overflowOffset.left + e.offsetWidth - t.pageX < u.scrollSensitivity ? e.scrollLeft = o = e.scrollLeft + u.scrollSpeed : t.pageX - r.overflowOffset.left < u.scrollSensitivity && (e.scrollLeft = o = e.scrollLeft - u.scrollSpeed))) : (u.axis && u.axis === "x" || (t.pageY - n(f).scrollTop() < u.scrollSensitivity ? o = n(f).scrollTop(n(f).scrollTop() - u.scrollSpeed) : n(window).height() - (t.pageY - n(f).scrollTop()) < u.scrollSensitivity && (o = n(f).scrollTop(n(f).scrollTop() + u.scrollSpeed))), u.axis && u.axis === "y" || (t.pageX - n(f).scrollLeft() < u.scrollSensitivity ? o = n(f).scrollLeft(n(f).scrollLeft() - u.scrollSpeed) : n(window).width() - (t.pageX - n(f).scrollLeft()) < u.scrollSensitivity && (o = n(f).scrollLeft(n(f).scrollLeft() + u.scrollSpeed)))); o !== !1 && n.ui.ddmanager && !u.dropBehaviour && n.ui.ddmanager.prepareOffsets(r, t) } }), n.ui.plugin.add("draggable", "snap", { start: function (t, i, r) { var u = r.options; r.snapElements = []; n(u.snap.constructor !== String ? u.snap.items || ":data(ui-draggable)" : u.snap).each(function () { var t = n(this), i = t.offset(); this !== r.element[0] && r.snapElements.push({ item: this, width: t.outerWidth(), height: t.outerHeight(), top: i.top, left: i.left }) }) }, drag: function (t, i, r) { for (var e, o, s, h, c, a, l, v, w, b = r.options, f = b.snapTolerance, y = i.offset.left, k = y + r.helperProportions.width, p = i.offset.top, d = p + r.helperProportions.height, u = r.snapElements.length - 1; u >= 0; u--) { if (c = r.snapElements[u].left - r.margins.left, a = c + r.snapElements[u].width, l = r.snapElements[u].top - r.margins.top, v = l + r.snapElements[u].height, k < c - f || y > a + f || d < l - f || p > v + f || !n.contains(r.snapElements[u].item.ownerDocument, r.snapElements[u].item)) { r.snapElements[u].snapping && r.options.snap.release && r.options.snap.release.call(r.element, t, n.extend(r._uiHash(), { snapItem: r.snapElements[u].item })); r.snapElements[u].snapping = !1; continue } b.snapMode !== "inner" && (e = Math.abs(l - d) <= f, o = Math.abs(v - p) <= f, s = Math.abs(c - k) <= f, h = Math.abs(a - y) <= f, e && (i.position.top = r._convertPositionTo("relative", { top: l - r.helperProportions.height, left: 0 }).top), o && (i.position.top = r._convertPositionTo("relative", { top: v, left: 0 }).top), s && (i.position.left = r._convertPositionTo("relative", { top: 0, left: c - r.helperProportions.width }).left), h && (i.position.left = r._convertPositionTo("relative", { top: 0, left: a }).left)); w = e || o || s || h; b.snapMode !== "outer" && (e = Math.abs(l - p) <= f, o = Math.abs(v - d) <= f, s = Math.abs(c - y) <= f, h = Math.abs(a - k) <= f, e && (i.position.top = r._convertPositionTo("relative", { top: l, left: 0 }).top), o && (i.position.top = r._convertPositionTo("relative", { top: v - r.helperProportions.height, left: 0 }).top), s && (i.position.left = r._convertPositionTo("relative", { top: 0, left: c }).left), h && (i.position.left = r._convertPositionTo("relative", { top: 0, left: a - r.helperProportions.width }).left)); !r.snapElements[u].snapping && (e || o || s || h || w) && r.options.snap.snap && r.options.snap.snap.call(r.element, t, n.extend(r._uiHash(), { snapItem: r.snapElements[u].item })); r.snapElements[u].snapping = e || o || s || h || w } } }), n.ui.plugin.add("draggable", "stack", { start: function (t, i, r) { var f, e = r.options, u = n.makeArray(n(e.stack)).sort(function (t, i) { return (parseInt(n(t).css("zIndex"), 10) || 0) - (parseInt(n(i).css("zIndex"), 10) || 0) }); u.length && (f = parseInt(n(u[0]).css("zIndex"), 10) || 0, n(u).each(function (t) { n(this).css("zIndex", f + t) }), this.css("zIndex", f + u.length)) } }), n.ui.plugin.add("draggable", "zIndex", { start: function (t, i, r) { var u = n(i.helper), f = r.options; u.css("zIndex") && (f._zIndex = u.css("zIndex")); u.css("zIndex", f.zIndex) }, stop: function (t, i, r) { var u = r.options; u._zIndex && n(i.helper).css("zIndex", u._zIndex) } }), n.ui.draggable });

/*!
 * jQuery UI Position 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */
(function(n){typeof define=="function"&&define.amd?define("jQueryUI/position",["jquery"],n):n(jQuery)})(function(n){return function(){function a(n,t,i){return[parseFloat(n[0])*(l.test(n[0])?t/100:1),parseFloat(n[1])*(l.test(n[1])?i/100:1)]}function r(t,i){return parseInt(n.css(t,i),10)||0}function y(t){var i=t[0];return i.nodeType===9?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:n.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}n.ui=n.ui||{};var u,f,i=Math.max,t=Math.abs,e=Math.round,o=/left|center|right/,s=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,l=/%$/,v=n.fn.position;n.position={scrollbarWidth:function(){if(u!==undefined)return u;var r,i,t=n("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'><\/div><\/div>"),f=t.children()[0];return n("body").append(t),r=f.offsetWidth,t.css("overflow","scroll"),i=f.offsetWidth,r===i&&(i=t[0].clientWidth),t.remove(),u=r-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),r=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),u=i==="scroll"||i==="auto"&&t.width<t.element[0].scrollWidth,f=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:f?n.position.scrollbarWidth():0,height:u?n.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=n(t||window),r=n.isWindow(i[0]),u=!!i[0]&&i[0].nodeType===9;return{element:i,isWindow:r,isDocument:u,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:r||u?i.width():i.outerWidth(),height:r||u?i.height():i.outerHeight()}}};n.fn.position=function(u){if(!u||!u.of)return v.apply(this,arguments);u=n.extend({},u);var k,l,p,b,w,g,nt=n(u.of),it=n.position.getWithinInfo(u.within),rt=n.position.getScrollInfo(it),d=(u.collision||"flip").split(" "),tt={};return g=y(nt),nt[0].preventDefault&&(u.at="left top"),l=g.width,p=g.height,b=g.offset,w=n.extend({},b),n.each(["my","at"],function(){var n=(u[this]||"").split(" "),t,i;n.length===1&&(n=o.test(n[0])?n.concat(["center"]):s.test(n[0])?["center"].concat(n):["center","center"]);n[0]=o.test(n[0])?n[0]:"center";n[1]=s.test(n[1])?n[1]:"center";t=h.exec(n[0]);i=h.exec(n[1]);tt[this]=[t?t[0]:0,i?i[0]:0];u[this]=[c.exec(n[0])[0],c.exec(n[1])[0]]}),d.length===1&&(d[1]=d[0]),u.at[0]==="right"?w.left+=l:u.at[0]==="center"&&(w.left+=l/2),u.at[1]==="bottom"?w.top+=p:u.at[1]==="center"&&(w.top+=p/2),k=a(tt.at,l,p),w.left+=k[0],w.top+=k[1],this.each(function(){var y,g,s=n(this),h=s.outerWidth(),c=s.outerHeight(),ut=r(this,"marginLeft"),ft=r(this,"marginTop"),et=h+ut+r(this,"marginRight")+rt.width,ot=c+ft+r(this,"marginBottom")+rt.height,o=n.extend({},w),v=a(tt.my,s.outerWidth(),s.outerHeight());u.my[0]==="right"?o.left-=h:u.my[0]==="center"&&(o.left-=h/2);u.my[1]==="bottom"?o.top-=c:u.my[1]==="center"&&(o.top-=c/2);o.left+=v[0];o.top+=v[1];f||(o.left=e(o.left),o.top=e(o.top));y={marginLeft:ut,marginTop:ft};n.each(["left","top"],function(t,i){n.ui.position[d[t]]&&n.ui.position[d[t]][i](o,{targetWidth:l,targetHeight:p,elemWidth:h,elemHeight:c,collisionPosition:y,collisionWidth:et,collisionHeight:ot,offset:[k[0]+v[0],k[1]+v[1]],my:u.my,at:u.at,within:it,elem:s})});u.using&&(g=function(n){var r=b.left-o.left,a=r+l-h,f=b.top-o.top,v=f+p-c,e={target:{element:nt,left:b.left,top:b.top,width:l,height:p},element:{element:s,left:o.left,top:o.top,width:h,height:c},horizontal:a<0?"left":r>0?"right":"center",vertical:v<0?"top":f>0?"bottom":"middle"};l<h&&t(r+a)<l&&(e.horizontal="center");p<c&&t(f+v)<p&&(e.vertical="middle");e.important=i(t(r),t(a))>i(t(f),t(v))?"horizontal":"vertical";u.using.call(this,n,e)});s.offset(n.extend(o,{using:g}))})};n.ui.position={fit:{left:function(n,t){var e=t.within,u=e.isWindow?e.scrollLeft:e.offset.left,o=e.width,s=n.left-t.collisionPosition.marginLeft,r=u-s,f=s+t.collisionWidth-o-u,h;t.collisionWidth>o?r>0&&f<=0?(h=n.left+r+t.collisionWidth-o-u,n.left+=r-h):n.left=f>0&&r<=0?u:r>f?u+o-t.collisionWidth:u:r>0?n.left+=r:f>0?n.left-=f:n.left=i(n.left-s,n.left)},top:function(n,t){var o=t.within,u=o.isWindow?o.scrollTop:o.offset.top,e=t.within.height,s=n.top-t.collisionPosition.marginTop,r=u-s,f=s+t.collisionHeight-e-u,h;t.collisionHeight>e?r>0&&f<=0?(h=n.top+r+t.collisionHeight-e-u,n.top+=r-h):n.top=f>0&&r<=0?u:r>f?u+e-t.collisionHeight:u:r>0?n.top+=r:f>0?n.top-=f:n.top=i(n.top-s,n.top)}},flip:{left:function(n,i){var r=i.within,y=r.offset.left+r.scrollLeft,c=r.width,o=r.isWindow?r.scrollLeft:r.offset.left,l=n.left-i.collisionPosition.marginLeft,a=l-o,v=l+i.collisionWidth-c-o,u=i.my[0]==="left"?-i.elemWidth:i.my[0]==="right"?i.elemWidth:0,f=i.at[0]==="left"?i.targetWidth:i.at[0]==="right"?-i.targetWidth:0,e=-2*i.offset[0],s,h;a<0?(s=n.left+u+f+e+i.collisionWidth-c-y,(s<0||s<t(a))&&(n.left+=u+f+e)):v>0&&(h=n.left-i.collisionPosition.marginLeft+u+f+e-o,(h>0||t(h)<v)&&(n.left+=u+f+e))},top:function(n,i){var r=i.within,y=r.offset.top+r.scrollTop,c=r.height,o=r.isWindow?r.scrollTop:r.offset.top,l=n.top-i.collisionPosition.marginTop,a=l-o,v=l+i.collisionHeight-c-o,p=i.my[1]==="top",u=p?-i.elemHeight:i.my[1]==="bottom"?i.elemHeight:0,f=i.at[1]==="top"?i.targetHeight:i.at[1]==="bottom"?-i.targetHeight:0,e=-2*i.offset[1],s,h;a<0?(h=n.top+u+f+e+i.collisionHeight-c-y,(h<0||h<t(a))&&(n.top+=u+f+e)):v>0&&(s=n.top-i.collisionPosition.marginTop+u+f+e-o,(s>0||t(s)<v)&&(n.top+=u+f+e))}},flipfit:{left:function(){n.ui.position.flip.left.apply(this,arguments);n.ui.position.fit.left.apply(this,arguments)},top:function(){n.ui.position.flip.top.apply(this,arguments);n.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,r,u,e,o=document.getElementsByTagName("body")[0],s=document.createElement("div");t=document.createElement(o?"div":"body");r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};o&&n.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(e in r)t.style[e]=r[e];t.appendChild(s);i=o||document.documentElement;i.insertBefore(t,i.firstChild);s.style.cssText="position: absolute; left: 10.7432222px;";u=n(s).offset().left;f=u>10&&u<11;t.innerHTML="";i.removeChild(t)}()}(),n.ui.position});

/*!
 * jQuery UI Resizable 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/resizable/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/resizable",["jquery", "./core", "./mouse", "./widget"], n) : n(jQuery) })(function (n) { return n.widget("ui.resizable", n.ui.mouse, { version: "1.11.4", widgetEventPrefix: "resize", options: { alsoResize: !1, animate: !1, animateDuration: "slow", animateEasing: "swing", aspectRatio: !1, autoHide: !1, containment: !1, ghost: !1, grid: !1, handles: "e,s,se", helper: !1, maxHeight: null, maxWidth: null, minHeight: 10, minWidth: 10, zIndex: 90, resize: null, start: null, stop: null }, _num: function (n) { return parseInt(n, 10) || 0 }, _isNumber: function (n) { return !isNaN(parseInt(n, 10)) }, _hasScroll: function (t, i) { if (n(t).css("overflow") === "hidden") return !1; var r = i && i === "left" ? "scrollLeft" : "scrollTop", u = !1; return t[r] > 0 ? !0 : (t[r] = 1, u = t[r] > 0, t[r] = 0, u) }, _create: function () { var e, f, u, i, o, r = this, t = this.options; if (this.element.addClass("ui-resizable"), n.extend(this, { _aspectRatio: !!t.aspectRatio, aspectRatio: t.aspectRatio, originalElement: this.element, _proportionallyResizeElements: [], _helper: t.helper || t.ghost || t.animate ? t.helper || "ui-resizable-helper" : null }), this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i) && (this.element.wrap(n("<div class='ui-wrapper' style='overflow: hidden;'><\/div>").css({ position: this.element.css("position"), width: this.element.outerWidth(), height: this.element.outerHeight(), top: this.element.css("top"), left: this.element.css("left") })), this.element = this.element.parent().data("ui-resizable", this.element.resizable("instance")), this.elementIsWrapper = !0, this.element.css({ marginLeft: this.originalElement.css("marginLeft"), marginTop: this.originalElement.css("marginTop"), marginRight: this.originalElement.css("marginRight"), marginBottom: this.originalElement.css("marginBottom") }), this.originalElement.css({ marginLeft: 0, marginTop: 0, marginRight: 0, marginBottom: 0 }), this.originalResizeStyle = this.originalElement.css("resize"), this.originalElement.css("resize", "none"), this._proportionallyResizeElements.push(this.originalElement.css({ position: "static", zoom: 1, display: "block" })), this.originalElement.css({ margin: this.originalElement.css("margin") }), this._proportionallyResize()), this.handles = t.handles || (n(".ui-resizable-handle", this.element).length ? { n: ".ui-resizable-n", e: ".ui-resizable-e", s: ".ui-resizable-s", w: ".ui-resizable-w", se: ".ui-resizable-se", sw: ".ui-resizable-sw", ne: ".ui-resizable-ne", nw: ".ui-resizable-nw" } : "e,s,se"), this._handles = n(), this.handles.constructor === String) for (this.handles === "all" && (this.handles = "n,e,s,w,se,sw,ne,nw"), e = this.handles.split(","), this.handles = {}, f = 0; f < e.length; f++) u = n.trim(e[f]), o = "ui-resizable-" + u, i = n("<div class='ui-resizable-handle " + o + "'><\/div>"), i.css({ zIndex: t.zIndex }), "se" === u && i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"), this.handles[u] = ".ui-resizable-" + u, this.element.append(i); this._renderAxis = function (t) { var i, u, f, e; t = t || this.element; for (i in this.handles) this.handles[i].constructor === String ? this.handles[i] = this.element.children(this.handles[i]).first().show() : (this.handles[i].jquery || this.handles[i].nodeType) && (this.handles[i] = n(this.handles[i]), this._on(this.handles[i], { mousedown: r._mouseDown })), this.elementIsWrapper && this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i) && (u = n(this.handles[i], this.element), e = /sw|ne|nw|se|n|s/.test(i) ? u.outerHeight() : u.outerWidth(), f = ["padding", /ne|nw|n/.test(i) ? "Top" : /se|sw|s/.test(i) ? "Bottom" : /^e$/.test(i) ? "Right" : "Left"].join(""), t.css(f, e), this._proportionallyResize()), this._handles = this._handles.add(this.handles[i]) }; this._renderAxis(this.element); this._handles = this._handles.add(this.element.find(".ui-resizable-handle")); this._handles.disableSelection(); this._handles.mouseover(function () { r.resizing || (this.className && (i = this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)), r.axis = i && i[1] ? i[1] : "se") }); t.autoHide && (this._handles.hide(), n(this.element).addClass("ui-resizable-autohide").mouseenter(function () { t.disabled || (n(this).removeClass("ui-resizable-autohide"), r._handles.show()) }).mouseleave(function () { t.disabled || r.resizing || (n(this).addClass("ui-resizable-autohide"), r._handles.hide()) })); this._mouseInit() }, _destroy: function () { this._mouseDestroy(); var t, i = function (t) { n(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove() }; return this.elementIsWrapper && (i(this.element), t = this.element, this.originalElement.css({ position: t.css("position"), width: t.outerWidth(), height: t.outerHeight(), top: t.css("top"), left: t.css("left") }).insertAfter(t), t.remove()), this.originalElement.css("resize", this.originalResizeStyle), i(this.originalElement), this }, _mouseCapture: function (t) { var r, i, u = !1; for (r in this.handles) i = n(this.handles[r])[0], (i === t.target || n.contains(i, t.target)) && (u = !0); return !this.options.disabled && u }, _mouseStart: function (t) { var u, f, e, r = this.options, i = this.element; return this.resizing = !0, this._renderProxy(), u = this._num(this.helper.css("left")), f = this._num(this.helper.css("top")), r.containment && (u += n(r.containment).scrollLeft() || 0, f += n(r.containment).scrollTop() || 0), this.offset = this.helper.offset(), this.position = { left: u, top: f }, this.size = this._helper ? { width: this.helper.width(), height: this.helper.height() } : { width: i.width(), height: i.height() }, this.originalSize = this._helper ? { width: i.outerWidth(), height: i.outerHeight() } : { width: i.width(), height: i.height() }, this.sizeDiff = { width: i.outerWidth() - i.width(), height: i.outerHeight() - i.height() }, this.originalPosition = { left: u, top: f }, this.originalMousePosition = { left: t.pageX, top: t.pageY }, this.aspectRatio = typeof r.aspectRatio == "number" ? r.aspectRatio : this.originalSize.width / this.originalSize.height || 1, e = n(".ui-resizable-" + this.axis).css("cursor"), n("body").css("cursor", e === "auto" ? this.axis + "-resize" : e), i.addClass("ui-resizable-resizing"), this._propagate("start", t), !0 }, _mouseDrag: function (t) { var i, r, u = this.originalMousePosition, e = this.axis, o = t.pageX - u.left || 0, s = t.pageY - u.top || 0, f = this._change[e]; return (this._updatePrevProperties(), !f) ? !1 : (i = f.apply(this, [t, o, s]), this._updateVirtualBoundaries(t.shiftKey), (this._aspectRatio || t.shiftKey) && (i = this._updateRatio(i, t)), i = this._respectSize(i, t), this._updateCache(i), this._propagate("resize", t), r = this._applyChanges(), !this._helper && this._proportionallyResizeElements.length && this._proportionallyResize(), n.isEmptyObject(r) || (this._updatePrevProperties(), this._trigger("resize", t, this.ui()), this._applyChanges()), !1) }, _mouseStop: function (t) { this.resizing = !1; var r, u, f, e, o, s, h, c = this.options, i = this; return this._helper && (r = this._proportionallyResizeElements, u = r.length && /textarea/i.test(r[0].nodeName), f = u && this._hasScroll(r[0], "left") ? 0 : i.sizeDiff.height, e = u ? 0 : i.sizeDiff.width, o = { width: i.helper.width() - e, height: i.helper.height() - f }, s = parseInt(i.element.css("left"), 10) + (i.position.left - i.originalPosition.left) || null, h = parseInt(i.element.css("top"), 10) + (i.position.top - i.originalPosition.top) || null, c.animate || this.element.css(n.extend(o, { top: h, left: s })), i.helper.height(i.size.height), i.helper.width(i.size.width), this._helper && !c.animate && this._proportionallyResize()), n("body").css("cursor", "auto"), this.element.removeClass("ui-resizable-resizing"), this._propagate("stop", t), this._helper && this.helper.remove(), !1 }, _updatePrevProperties: function () { this.prevPosition = { top: this.position.top, left: this.position.left }; this.prevSize = { width: this.size.width, height: this.size.height } }, _applyChanges: function () { var n = {}; return this.position.top !== this.prevPosition.top && (n.top = this.position.top + "px"), this.position.left !== this.prevPosition.left && (n.left = this.position.left + "px"), this.size.width !== this.prevSize.width && (n.width = this.size.width + "px"), this.size.height !== this.prevSize.height && (n.height = this.size.height + "px"), this.helper.css(n), n }, _updateVirtualBoundaries: function (n) { var r, u, f, e, t, i = this.options; t = { minWidth: this._isNumber(i.minWidth) ? i.minWidth : 0, maxWidth: this._isNumber(i.maxWidth) ? i.maxWidth : Infinity, minHeight: this._isNumber(i.minHeight) ? i.minHeight : 0, maxHeight: this._isNumber(i.maxHeight) ? i.maxHeight : Infinity }; (this._aspectRatio || n) && (r = t.minHeight * this.aspectRatio, f = t.minWidth / this.aspectRatio, u = t.maxHeight * this.aspectRatio, e = t.maxWidth / this.aspectRatio, r > t.minWidth && (t.minWidth = r), f > t.minHeight && (t.minHeight = f), u < t.maxWidth && (t.maxWidth = u), e < t.maxHeight && (t.maxHeight = e)); this._vBoundaries = t }, _updateCache: function (n) { this.offset = this.helper.offset(); this._isNumber(n.left) && (this.position.left = n.left); this._isNumber(n.top) && (this.position.top = n.top); this._isNumber(n.height) && (this.size.height = n.height); this._isNumber(n.width) && (this.size.width = n.width) }, _updateRatio: function (n) { var t = this.position, i = this.size, r = this.axis; return this._isNumber(n.height) ? n.width = n.height * this.aspectRatio : this._isNumber(n.width) && (n.height = n.width / this.aspectRatio), r === "sw" && (n.left = t.left + (i.width - n.width), n.top = null), r === "nw" && (n.top = t.top + (i.height - n.height), n.left = t.left + (i.width - n.width)), n }, _respectSize: function (n) { var t = this._vBoundaries, i = this.axis, r = this._isNumber(n.width) && t.maxWidth && t.maxWidth < n.width, u = this._isNumber(n.height) && t.maxHeight && t.maxHeight < n.height, f = this._isNumber(n.width) && t.minWidth && t.minWidth > n.width, e = this._isNumber(n.height) && t.minHeight && t.minHeight > n.height, o = this.originalPosition.left + this.originalSize.width, s = this.position.top + this.size.height, h = /sw|nw|w/.test(i), c = /nw|ne|n/.test(i); return f && (n.width = t.minWidth), e && (n.height = t.minHeight), r && (n.width = t.maxWidth), u && (n.height = t.maxHeight), f && h && (n.left = o - t.minWidth), r && h && (n.left = o - t.maxWidth), e && c && (n.top = s - t.minHeight), u && c && (n.top = s - t.maxHeight), n.width || n.height || n.left || !n.top ? n.width || n.height || n.top || !n.left || (n.left = null) : n.top = null, n }, _getPaddingPlusBorderDimensions: function (n) { for (var t = 0, i = [], r = [n.css("borderTopWidth"), n.css("borderRightWidth"), n.css("borderBottomWidth"), n.css("borderLeftWidth")], u = [n.css("paddingTop"), n.css("paddingRight"), n.css("paddingBottom"), n.css("paddingLeft")]; t < 4; t++) i[t] = parseInt(r[t], 10) || 0, i[t] += parseInt(u[t], 10) || 0; return { height: i[0] + i[2], width: i[1] + i[3] } }, _proportionallyResize: function () { if (this._proportionallyResizeElements.length) for (var n, t = 0, i = this.helper || this.element; t < this._proportionallyResizeElements.length; t++) n = this._proportionallyResizeElements[t], this.outerDimensions || (this.outerDimensions = this._getPaddingPlusBorderDimensions(n)), n.css({ height: i.height() - this.outerDimensions.height || 0, width: i.width() - this.outerDimensions.width || 0 }) }, _renderProxy: function () { var t = this.element, i = this.options; this.elementOffset = t.offset(); this._helper ? (this.helper = this.helper || n("<div style='overflow:hidden;'><\/div>"), this.helper.addClass(this._helper).css({ width: this.element.outerWidth() - 1, height: this.element.outerHeight() - 1, position: "absolute", left: this.elementOffset.left + "px", top: this.elementOffset.top + "px", zIndex: ++i.zIndex }), this.helper.appendTo("body").disableSelection()) : this.helper = this.element }, _change: { e: function (n, t) { return { width: this.originalSize.width + t } }, w: function (n, t) { var i = this.originalSize, r = this.originalPosition; return { left: r.left + t, width: i.width - t } }, n: function (n, t, i) { var r = this.originalSize, u = this.originalPosition; return { top: u.top + i, height: r.height - i } }, s: function (n, t, i) { return { height: this.originalSize.height + i } }, se: function (t, i, r) { return n.extend(this._change.s.apply(this, arguments), this._change.e.apply(this, [t, i, r])) }, sw: function (t, i, r) { return n.extend(this._change.s.apply(this, arguments), this._change.w.apply(this, [t, i, r])) }, ne: function (t, i, r) { return n.extend(this._change.n.apply(this, arguments), this._change.e.apply(this, [t, i, r])) }, nw: function (t, i, r) { return n.extend(this._change.n.apply(this, arguments), this._change.w.apply(this, [t, i, r])) } }, _propagate: function (t, i) { n.ui.plugin.call(this, t, [i, this.ui()]); t !== "resize" && this._trigger(t, i, this.ui()) }, plugins: {}, ui: function () { return { originalElement: this.originalElement, element: this.element, helper: this.helper, position: this.position, size: this.size, originalSize: this.originalSize, originalPosition: this.originalPosition } } }), n.ui.plugin.add("resizable", "animate", { stop: function (t) { var i = n(this).resizable("instance"), u = i.options, r = i._proportionallyResizeElements, f = r.length && /textarea/i.test(r[0].nodeName), s = f && i._hasScroll(r[0], "left") ? 0 : i.sizeDiff.height, h = f ? 0 : i.sizeDiff.width, c = { width: i.size.width - h, height: i.size.height - s }, e = parseInt(i.element.css("left"), 10) + (i.position.left - i.originalPosition.left) || null, o = parseInt(i.element.css("top"), 10) + (i.position.top - i.originalPosition.top) || null; i.element.animate(n.extend(c, o && e ? { top: o, left: e } : {}), { duration: u.animateDuration, easing: u.animateEasing, step: function () { var u = { width: parseInt(i.element.css("width"), 10), height: parseInt(i.element.css("height"), 10), top: parseInt(i.element.css("top"), 10), left: parseInt(i.element.css("left"), 10) }; r && r.length && n(r[0]).css({ width: u.width, height: u.height }); i._updateCache(u); i._propagate("resize", t) } }) } }), n.ui.plugin.add("resizable", "containment", { start: function () { var r, f, e, o, s, h, c, t = n(this).resizable("instance"), l = t.options, a = t.element, u = l.containment, i = u instanceof n ? u.get(0) : /parent/.test(u) ? a.parent().get(0) : u; i && (t.containerElement = n(i), /document/.test(u) || u === document ? (t.containerOffset = { left: 0, top: 0 }, t.containerPosition = { left: 0, top: 0 }, t.parentData = { element: n(document), left: 0, top: 0, width: n(document).width(), height: n(document).height() || document.body.parentNode.scrollHeight }) : (r = n(i), f = [], n(["Top", "Right", "Left", "Bottom"]).each(function (n, i) { f[n] = t._num(r.css("padding" + i)) }), t.containerOffset = r.offset(), t.containerPosition = r.position(), t.containerSize = { height: r.innerHeight() - f[3], width: r.innerWidth() - f[1] }, e = t.containerOffset, o = t.containerSize.height, s = t.containerSize.width, h = t._hasScroll(i, "left") ? i.scrollWidth : s, c = t._hasScroll(i) ? i.scrollHeight : o, t.parentData = { element: i, left: e.left, top: e.top, width: h, height: c })) }, resize: function (t) { var o, s, h, c, i = n(this).resizable("instance"), v = i.options, r = i.containerOffset, l = i.position, f = i._aspectRatio || t.shiftKey, e = { top: 0, left: 0 }, a = i.containerElement, u = !0; a[0] !== document && /static/.test(a.css("position")) && (e = r); l.left < (i._helper ? r.left : 0) && (i.size.width = i.size.width + (i._helper ? i.position.left - r.left : i.position.left - e.left), f && (i.size.height = i.size.width / i.aspectRatio, u = !1), i.position.left = v.helper ? r.left : 0); l.top < (i._helper ? r.top : 0) && (i.size.height = i.size.height + (i._helper ? i.position.top - r.top : i.position.top), f && (i.size.width = i.size.height * i.aspectRatio, u = !1), i.position.top = i._helper ? r.top : 0); h = i.containerElement.get(0) === i.element.parent().get(0); c = /relative|absolute/.test(i.containerElement.css("position")); h && c ? (i.offset.left = i.parentData.left + i.position.left, i.offset.top = i.parentData.top + i.position.top) : (i.offset.left = i.element.offset().left, i.offset.top = i.element.offset().top); o = Math.abs(i.sizeDiff.width + (i._helper ? i.offset.left - e.left : i.offset.left - r.left)); s = Math.abs(i.sizeDiff.height + (i._helper ? i.offset.top - e.top : i.offset.top - r.top)); o + i.size.width >= i.parentData.width && (i.size.width = i.parentData.width - o, f && (i.size.height = i.size.width / i.aspectRatio, u = !1)); s + i.size.height >= i.parentData.height && (i.size.height = i.parentData.height - s, f && (i.size.width = i.size.height * i.aspectRatio, u = !1)); u || (i.position.left = i.prevPosition.left, i.position.top = i.prevPosition.top, i.size.width = i.prevSize.width, i.size.height = i.prevSize.height) }, stop: function () { var t = n(this).resizable("instance"), r = t.options, u = t.containerOffset, f = t.containerPosition, e = t.containerElement, i = n(t.helper), o = i.offset(), s = i.outerWidth() - t.sizeDiff.width, h = i.outerHeight() - t.sizeDiff.height; t._helper && !r.animate && /relative/.test(e.css("position")) && n(this).css({ left: o.left - f.left - u.left, width: s, height: h }); t._helper && !r.animate && /static/.test(e.css("position")) && n(this).css({ left: o.left - f.left - u.left, width: s, height: h }) } }), n.ui.plugin.add("resizable", "alsoResize", { start: function () { var t = n(this).resizable("instance"), i = t.options; n(i.alsoResize).each(function () { var t = n(this); t.data("ui-resizable-alsoresize", { width: parseInt(t.width(), 10), height: parseInt(t.height(), 10), left: parseInt(t.css("left"), 10), top: parseInt(t.css("top"), 10) }) }) }, resize: function (t, i) { var r = n(this).resizable("instance"), e = r.options, u = r.originalSize, f = r.originalPosition, o = { height: r.size.height - u.height || 0, width: r.size.width - u.width || 0, top: r.position.top - f.top || 0, left: r.position.left - f.left || 0 }; n(e.alsoResize).each(function () { var t = n(this), u = n(this).data("ui-resizable-alsoresize"), r = {}, f = t.parents(i.originalElement[0]).length ? ["width", "height"] : ["width", "height", "top", "left"]; n.each(f, function (n, t) { var i = (u[t] || 0) + (o[t] || 0); i && i >= 0 && (r[t] = i || null) }); t.css(r) }) }, stop: function () { n(this).removeData("resizable-alsoresize") } }), n.ui.plugin.add("resizable", "ghost", { start: function () { var t = n(this).resizable("instance"), i = t.options, r = t.size; t.ghost = t.originalElement.clone(); t.ghost.css({ opacity: .25, display: "block", position: "relative", height: r.height, width: r.width, margin: 0, left: 0, top: 0 }).addClass("ui-resizable-ghost").addClass(typeof i.ghost == "string" ? i.ghost : ""); t.ghost.appendTo(t.helper) }, resize: function () { var t = n(this).resizable("instance"); t.ghost && t.ghost.css({ position: "relative", height: t.size.height, width: t.size.width }) }, stop: function () { var t = n(this).resizable("instance"); t.ghost && t.helper && t.helper.get(0).removeChild(t.ghost.get(0)) } }), n.ui.plugin.add("resizable", "grid", { resize: function () { var h, t = n(this).resizable("instance"), i = t.options, y = t.size, o = t.originalSize, s = t.originalPosition, c = t.axis, l = typeof i.grid == "number" ? [i.grid, i.grid] : i.grid, f = l[0] || 1, e = l[1] || 1, a = Math.round((y.width - o.width) / f) * f, v = Math.round((y.height - o.height) / e) * e, r = o.width + a, u = o.height + v, p = i.maxWidth && i.maxWidth < r, w = i.maxHeight && i.maxHeight < u, b = i.minWidth && i.minWidth > r, k = i.minHeight && i.minHeight > u; i.grid = l; b && (r += f); k && (u += e); p && (r -= f); w && (u -= e); /^(se|s|e)$/.test(c) ? (t.size.width = r, t.size.height = u) : /^(ne)$/.test(c) ? (t.size.width = r, t.size.height = u, t.position.top = s.top - v) : /^(sw)$/.test(c) ? (t.size.width = r, t.size.height = u, t.position.left = s.left - a) : ((u - e <= 0 || r - f <= 0) && (h = t._getPaddingPlusBorderDimensions(this)), u - e > 0 ? (t.size.height = u, t.position.top = s.top - v) : (u = e - h.height, t.size.height = u, t.position.top = s.top + o.height - u), r - f > 0 ? (t.size.width = r, t.position.left = s.left - a) : (r = f - h.width, t.size.width = r, t.position.left = s.left + o.width - r)) } }), n.ui.resizable });

/*!
 * jQuery UI Dialog 1.11.4
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/dialog/
 */
(function (n) { typeof define == "function" && define.amd ? define("jQueryUI/dialog",["jquery", "./core", "./widget", "./button", "./draggable", "./mouse", "./position", "./resizable"], n) : n(jQuery) })(function (n) { return n.widget("ui.dialog", { version: "1.11.4", options: { appendTo: "body", autoOpen: !0, buttons: [], closeOnEscape: !0, closeText: "Close", dialogClass: "", draggable: !0, hide: null, height: "auto", maxHeight: null, maxWidth: null, minHeight: 150, minWidth: 150, modal: !1, position: { my: "center", at: "center", of: window, collision: "fit", using: function (t) { var i = n(this).css(t).offset().top; i < 0 && n(this).css("top", t.top - i) } }, resizable: !0, show: null, title: null, width: 300, beforeClose: null, close: null, drag: null, dragStart: null, dragStop: null, focus: null, open: null, resize: null, resizeStart: null, resizeStop: null }, sizeRelatedOptions: { buttons: !0, height: !0, maxHeight: !0, maxWidth: !0, minHeight: !0, minWidth: !0, width: !0 }, resizableRelatedOptions: { maxHeight: !0, maxWidth: !0, minHeight: !0, minWidth: !0 }, _create: function () { this.originalCss = { display: this.element[0].style.display, width: this.element[0].style.width, minHeight: this.element[0].style.minHeight, maxHeight: this.element[0].style.maxHeight, height: this.element[0].style.height }; this.originalPosition = { parent: this.element.parent(), index: this.element.parent().children().index(this.element) }; this.originalTitle = this.element.attr("title"); this.options.title = this.options.title || this.originalTitle; this._createWrapper(); this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog); this._createTitlebar(); this._createButtonPane(); this.options.draggable && n.fn.draggable && this._makeDraggable(); this.options.resizable && n.fn.resizable && this._makeResizable(); this._isOpen = !1; this._trackFocus() }, _init: function () { this.options.autoOpen && this.open() }, _appendTo: function () { var t = this.options.appendTo; return t && (t.jquery || t.nodeType) ? n(t) : this.document.find(t || "body").eq(0) }, _destroy: function () { var n, t = this.originalPosition; this._untrackInstance(); this._destroyOverlay(); this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(); this.uiDialog.stop(!0, !0).remove(); this.originalTitle && this.element.attr("title", this.originalTitle); n = t.parent.children().eq(t.index); n.length && n[0] !== this.element[0] ? n.before(this.element) : t.parent.append(this.element) }, widget: function () { return this.uiDialog }, disable: n.noop, enable: n.noop, close: function (t) { var i, r = this; if (this._isOpen && this._trigger("beforeClose", t) !== !1) { if (this._isOpen = !1, this._focusedElement = null, this._destroyOverlay(), this._untrackInstance(), !this.opener.filter(":focusable").focus().length) try { i = this.document[0].activeElement; i && i.nodeName.toLowerCase() !== "body" && n(i).blur() } catch (u) { } this._hide(this.uiDialog, this.options.hide, function () { r._trigger("close", t) }) } }, isOpen: function () { return this._isOpen }, moveToTop: function () { this._moveToTop() }, _moveToTop: function (t, i) { var r = !1, f = this.uiDialog.siblings(".ui-front:visible").map(function () { return +n(this).css("z-index") }).get(), u = Math.max.apply(null, f); return u >= +this.uiDialog.css("z-index") && (this.uiDialog.css("z-index", u + 1), r = !0), r && !i && this._trigger("focus", t), r }, open: function () { var t = this; if (this._isOpen) { this._moveToTop() && this._focusTabbable(); return } this._isOpen = !0; this.opener = n(this.document[0].activeElement); this._size(); this._position(); this._createOverlay(); this._moveToTop(null, !0); this.overlay && this.overlay.css("z-index", this.uiDialog.css("z-index") - 1); this._show(this.uiDialog, this.options.show, function () { t._focusTabbable(); t._trigger("focus") }); this._makeFocusTarget(); this._trigger("open") }, _focusTabbable: function () { var n = this._focusedElement; n || (n = this.element.find("[autofocus]")); n.length || (n = this.element.find(":tabbable")); n.length || (n = this.uiDialogButtonPane.find(":tabbable")); n.length || (n = this.uiDialogTitlebarClose.filter(":tabbable")); n.length || (n = this.uiDialog); n.eq(0).focus() }, _keepFocus: function (t) { function i() { var t = this.document[0].activeElement, i = this.uiDialog[0] === t || n.contains(this.uiDialog[0], t); i || this._focusTabbable() } t.preventDefault(); i.call(this); this._delay(i) }, _createWrapper: function () { this.uiDialog = n("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front " + this.options.dialogClass).hide().attr({ tabIndex: -1, role: "dialog" }).appendTo(this._appendTo()); this._on(this.uiDialog, { keydown: function (t) { if (this.options.closeOnEscape && !t.isDefaultPrevented() && t.keyCode && t.keyCode === n.ui.keyCode.ESCAPE) { t.preventDefault(); this.close(t); return } if (t.keyCode === n.ui.keyCode.TAB && !t.isDefaultPrevented()) { var i = this.uiDialog.find(":tabbable"), r = i.filter(":first"), u = i.filter(":last"); t.target !== u[0] && t.target !== this.uiDialog[0] || t.shiftKey ? (t.target === r[0] || t.target === this.uiDialog[0]) && t.shiftKey && (this._delay(function () { u.focus() }), t.preventDefault()) : (this._delay(function () { r.focus() }), t.preventDefault()) } }, mousedown: function (n) { this._moveToTop(n) && this._focusTabbable() } }); this.element.find("[aria-describedby]").length || this.uiDialog.attr({ "aria-describedby": this.element.uniqueId().attr("id") }) }, _createTitlebar: function () { var t; this.uiDialogTitlebar = n("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog); this._on(this.uiDialogTitlebar, { mousedown: function (t) { n(t.target).closest(".ui-dialog-titlebar-close") || this.uiDialog.focus() } }); this.uiDialogTitlebarClose = n("<button type='button'><\/button>").button({ label: this.options.closeText, icons: { primary: "ui-icon-closethick" }, text: !1 }).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar); this._on(this.uiDialogTitlebarClose, { click: function (n) { n.preventDefault(); this.close(n) } }); t = n("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar); this._title(t); this.uiDialog.attr({ "aria-labelledby": t.attr("id") }) }, _title: function (n) { this.options.title || n.html("&#160;"); n.text(this.options.title) }, _createButtonPane: function () { this.uiDialogButtonPane = n("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"); this.uiButtonSet = n("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane); this._createButtons() }, _createButtons: function () { var i = this, t = this.options.buttons; if (this.uiDialogButtonPane.remove(), this.uiButtonSet.empty(), n.isEmptyObject(t) || n.isArray(t) && !t.length) { this.uiDialog.removeClass("ui-dialog-buttons"); return } n.each(t, function (t, r) { var u, f; r = n.isFunction(r) ? { click: r, text: t } : r; r = n.extend({ type: "button" }, r); u = r.click; r.click = function () { u.apply(i.element[0], arguments) }; f = { icons: r.icons, text: r.showText }; delete r.icons; delete r.showText; n("<button><\/button>", r).button(f).appendTo(i.uiButtonSet) }); this.uiDialog.addClass("ui-dialog-buttons"); this.uiDialogButtonPane.appendTo(this.uiDialog) }, _makeDraggable: function () { function i(n) { return { position: n.position, offset: n.offset } } var t = this, r = this.options; this.uiDialog.draggable({ cancel: ".ui-dialog-content, .ui-dialog-titlebar-close", handle: ".ui-dialog-titlebar", containment: "document", start: function (r, u) { n(this).addClass("ui-dialog-dragging"); t._blockFrames(); t._trigger("dragStart", r, i(u)) }, drag: function (n, r) { t._trigger("drag", n, i(r)) }, stop: function (u, f) { var e = f.offset.left - t.document.scrollLeft(), o = f.offset.top - t.document.scrollTop(); r.position = { my: "left top", at: "left" + (e >= 0 ? "+" : "") + e + " top" + (o >= 0 ? "+" : "") + o, of: t.window }; n(this).removeClass("ui-dialog-dragging"); t._unblockFrames(); t._trigger("dragStop", u, i(f)) } }) }, _makeResizable: function () { function r(n) { return { originalPosition: n.originalPosition, originalSize: n.originalSize, position: n.position, size: n.size } } var t = this, i = this.options, u = i.resizable, f = this.uiDialog.css("position"), e = typeof u == "string" ? u : "n,e,s,w,se,sw,ne,nw"; this.uiDialog.resizable({ cancel: ".ui-dialog-content", containment: "document", alsoResize: this.element, maxWidth: i.maxWidth, maxHeight: i.maxHeight, minWidth: i.minWidth, minHeight: this._minHeight(), handles: e, start: function (i, u) { n(this).addClass("ui-dialog-resizing"); t._blockFrames(); t._trigger("resizeStart", i, r(u)) }, resize: function (n, i) { t._trigger("resize", n, r(i)) }, stop: function (u, f) { var e = t.uiDialog.offset(), o = e.left - t.document.scrollLeft(), s = e.top - t.document.scrollTop(); i.height = t.uiDialog.height(); i.width = t.uiDialog.width(); i.position = { my: "left top", at: "left" + (o >= 0 ? "+" : "") + o + " top" + (s >= 0 ? "+" : "") + s, of: t.window }; n(this).removeClass("ui-dialog-resizing"); t._unblockFrames(); t._trigger("resizeStop", u, r(f)) } }).css("position", f) }, _trackFocus: function () { this._on(this.widget(), { focusin: function (t) { this._makeFocusTarget(); this._focusedElement = n(t.target) } }) }, _makeFocusTarget: function () { this._untrackInstance(); this._trackingInstances().unshift(this) }, _untrackInstance: function () { var t = this._trackingInstances(), i = n.inArray(this, t); i !== -1 && t.splice(i, 1) }, _trackingInstances: function () { var n = this.document.data("ui-dialog-instances"); return n || (n = [], this.document.data("ui-dialog-instances", n)), n }, _minHeight: function () { var n = this.options; return n.height === "auto" ? n.minHeight : Math.min(n.minHeight, n.height) }, _position: function () { var n = this.uiDialog.is(":visible"); n || this.uiDialog.show(); this.uiDialog.position(this.options.position); n || this.uiDialog.hide() }, _setOptions: function (t) { var i = this, r = !1, u = {}; n.each(t, function (n, t) { i._setOption(n, t); n in i.sizeRelatedOptions && (r = !0); n in i.resizableRelatedOptions && (u[n] = t) }); r && (this._size(), this._position()); this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", u) }, _setOption: function (n, t) { var u, r, i = this.uiDialog; (n === "dialogClass" && i.removeClass(this.options.dialogClass).addClass(t), n !== "disabled") && (this._super(n, t), n === "appendTo" && this.uiDialog.appendTo(this._appendTo()), n === "buttons" && this._createButtons(), n === "closeText" && this.uiDialogTitlebarClose.button({ label: "" + t }), n === "draggable" && (u = i.is(":data(ui-draggable)"), u && !t && i.draggable("destroy"), !u && t && this._makeDraggable()), n === "position" && this._position(), n === "resizable" && (r = i.is(":data(ui-resizable)"), r && !t && i.resizable("destroy"), r && typeof t == "string" && i.resizable("option", "handles", t), r || t === !1 || this._makeResizable()), n === "title" && this._title(this.uiDialogTitlebar.find(".ui-dialog-title"))) }, _size: function () { var t, i, r, n = this.options; this.element.show().css({ width: "auto", minHeight: 0, maxHeight: "none", height: 0 }); n.minWidth > n.width && (n.width = n.minWidth); t = this.uiDialog.css({ height: "auto", width: n.width }).outerHeight(); i = Math.max(0, n.minHeight - t); r = typeof n.maxHeight == "number" ? Math.max(0, n.maxHeight - t) : "none"; n.height === "auto" ? this.element.css({ minHeight: i, maxHeight: r, height: "auto" }) : this.element.height(Math.max(0, n.height - t)); this.uiDialog.is(":data(ui-resizable)") && this.uiDialog.resizable("option", "minHeight", this._minHeight()) }, _blockFrames: function () { this.iframeBlocks = this.document.find("iframe").map(function () { var t = n(this); return n("<div>").css({ position: "absolute", width: t.outerWidth(), height: t.outerHeight() }).appendTo(t.parent()).offset(t.offset())[0] }) }, _unblockFrames: function () { this.iframeBlocks && (this.iframeBlocks.remove(), delete this.iframeBlocks) }, _allowInteraction: function (t) { return n(t.target).closest(".ui-dialog").length ? !0 : !!n(t.target).closest(".ui-datepicker").length }, _createOverlay: function () { if (this.options.modal) { var t = !0; this._delay(function () { t = !1 }); this.document.data("ui-dialog-overlays") || this._on(this.document, { focusin: function (n) { t || this._allowInteraction(n) || (n.preventDefault(), this._trackingInstances()[0]._focusTabbable()) } }); this.overlay = n("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()); this._on(this.overlay, { mousedown: "_keepFocus" }); this.document.data("ui-dialog-overlays", (this.document.data("ui-dialog-overlays") || 0) + 1) } }, _destroyOverlay: function () { if (this.options.modal && this.overlay) { var n = this.document.data("ui-dialog-overlays") - 1; n ? this.document.data("ui-dialog-overlays", n) : this.document.unbind("focusin").removeData("ui-dialog-overlays"); this.overlay.remove(); this.overlay = null } } }) });

// Copyright (C) Microsoft Corporation. All rights reserved.
define("VSS/Identities/Picker/Controls",["require","exports","react","react-dom","VSS/Common/Constants/Platform","VSS/FeatureAvailability/Services","VSS/Context","VSS/Controls","VSS/Diag","VSS/Events/Services","VSS/Identities/Picker/Common","VSS/Identities/Picker/Constants","VSS/Identities/Picker/Services","VSS/Identities/Picker/Cache","VSS/Controls/Notifications","VSS/Resources/VSS.Resources.Platform","VSS/Service","VSS/Controls/StatusIndicator","VSS/Utils/Core","VSS/Utils/String","VSS/Utils/UI","VSS/Telemetry/Services","VSS/VSS","q","VSS/Controls/PopupContent","jQueryUI/core","jQueryUI/button","jQueryUI/dialog"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt){var lt,wt,dt,st,pt,kt,gt,ft,at,ni,bt,yt,ti,ii;Object.defineProperty(t,"__esModule",{value:!0});t.EntityOperationsFacade=t.SourceType=t.SourceId=t.EntityFactory=t.IdentityDisplayControl=t.EDisplayControlType=t.IdentityPickerControlSize=t.IdentityPickerSearchControl=t.IdCardDialog=t.IdentityPickerDropdownControl=void 0;var fi=g.domElem,ut=k.delegate,ot=g.KeyCode,ht;(function(n){n[n.SelectNone=-1]="SelectNone";n[n.SelectFirstItem=0]="SelectFirstItem"})(ht||(ht={}));lt=function(n){function t(t){var i=__construct(this,n,[t]);for(var r in i)i.hasOwnProperty(r)&&(this[r]=i[r]);return i._numItemsDisplayed=0,i._scrollTimeout=100,i._loadOnCreate=!1,i._isFiltered=!0,i._isRepositioning=!1,"eventOptions"in t&&t.eventOptions||(t.eventOptions={uniqueId:ft.getRandomString()}),i.initializeOptionsInternal(t),i}return __extends(t,n),t.prototype.initializeOptionsInternal=function(n){this._identityType=n.identityType?n.identityType:{User:!0};this._operationScope=n.operationScope?n.operationScope:{IMS:!0};this._size=n.size!==null&&n.size!==undefined?n.size:st.Large;this._options.getFilterByScope||(this._options.getFilterByScope=function(){return null});this._showContactCard=this._options.showContactCard;this._displayedEntities=[];this._showOnlyMruIdentities=!1;this._enableDirectorySearch();this._options.showMru&&this._disableDirectorySearch();this._isSearchActive=!1;this._preDropdownRender=n.preDropdownRender?n.preDropdownRender:null;this._onDirectorySearchFinished=n.onDirectorySearchFinished?n.onDirectorySearchFinished:null;this._loadOnCreate=n.loadOnCreate?n.loadOnCreate:!1;this._elementAlign=this._options.alignment&&this._options.alignment.elementAlign?this._options.alignment.elementAlign:"left-top";this._baseAlign=this._options.alignment&&this._options.alignment.baseAlign?this._options.alignment.baseAlign:"left-bottom";this._positioningElement=this._options.alignment&&this._options.alignment.positioningElement?this._options.alignment.positioningElement:null;this._prefix="";a.ServiceHelpers.isAuthenticatedMember()||(this._showContactCard=!1,this._disableDirectorySearch(),this._options.showMru=!1,this._loadOnCreate=!1);this._controlLoaded=null;this._loadOnCreate&&this.load();n.eventOptions&&(this._eventOptions=n.eventOptions)},t.prototype.initializeOptions=function(i){var r=t.DROPDOWN_BASE_CLASS+" "+ft.FIXED_POSTIION_CLASS;n.prototype.initializeOptions.call(this,$.extend({coreCssClass:r,pageSize:i.pageSize?i.pageSize:10},i))},t.prototype.initialize=function(){var i=this,r,u,f;n.prototype.initialize.call(this);r=function(n){n.preventDefault()};this._element.on("mousedown.identityPickerDropdown",ut(this,r));u=function(){return i._scrollTimeout!==null&&(clearTimeout(i._scrollTimeout),i._scrollTimeout=null),i._scrollTimeout=window.setTimeout(ut(i,i._loadNextPage),100),!1};this._options.smallScreenRender&&(this._$suggestedPeople=$("<div>").addClass("search"),$("<span>").addClass("status-message").text(p.IdentityPicker_SuggestedPeople).appendTo(this._$suggestedPeople),this._$suggestedPeople.appendTo(this._element));f=this._options.useRemainingSpace?"":Math.min((ft.getSizePx(this._size)+t.IMAGE_MARGINS_PX)*this._options.pageSize-10,t.MAX_HEIGHT)+"px";this._$itemsContainer=$("<ul>").addClass("items").attr({role:"listbox",id:o.getId().toString(),"aria-label":p.IdentityPicker_AriaLabel}).css({"max-height":f});this._$liveStatus=$("<div>").addClass("visually-hidden").attr("aria-live","polite");this._element.append(this._$itemsContainer).append(this._$liveStatus);this._$itemsContainer.scroll(ut(this,u))},t.prototype.getItemsListId=function(){return this._$itemsContainer.length?this._$itemsContainer.attr("id"):""},t.prototype.load=function(){return this._getEntityOperationsFacade().load({loadMru:this._options.showMru,filterByScope:this._options.getFilterByScope()})},t.prototype.addIdentitiesToMru=function(n){var r=this,i;if(a.ServiceHelpers.isAuthenticatedMember())try{if(!n||n.length==0)return;if(i=n.filter(function(n){if(!at.isStringPrefixedLocalId(n))return!0}),!i||i.length==0)return;var u=function(n){r._element&&n==!0&&r._getEntityOperationsFacade().refreshUserMru(r._options.getFilterByScope())},f=function(){},e=w.getService(a.MruService);e.addMruIdentities(i,{IMS:!0},a.MruService.DEFAULT_IDENTITY_ID,a.MruService.DEFAULT_FEATURE_ID,{httpClient:this._options.httpClient},{consumerId:this._options.consumerId}).then(u,f);this._disableDirectorySearch()}catch(t){if(t!==Object(t)||!("source"in t)||t.source!="MruService")throw t;}},t.prototype.isVisible=function(){return this._isVisible},t.prototype.isFiltered=function(){return this._isVisible&&this._isFiltered},t.prototype.showAllMruIdentities=function(n){var t=this,i;if(n===void 0&&(n=!0),!this._options.showMru){i={source:"showAllMruIdentities",message:"The showMru option needs to be enabled to call showAllMruIdentities"};throw i;}return this.load().then(ut(this,function(){return t._getUserMruEntitiesPostLoad(n)}),ut(this,function(){return t._getUserMruEntitiesPostLoad(n)}))},t.prototype.getIdentities=function(n,t){var i=this;return t===void 0&&(t=!0),this.load().then(ut(this,function(){return i._getIdentitiesPostLoad(n,t)}),ut(this,function(){return i._getIdentitiesPostLoad(n,t)}))},t.prototype.show=function(){var n=this;this.load().then(ut(this,function(){n._showPostLoad()}),ut(this,function(){n._showPostLoad()}))},t.prototype.hide=function(n,i){var r=this,u;if(i===void 0&&(i=!1),this._isVisible=!1,this._element&&(this._element.hide(),this._element.parents().off(".identityPickerDropdown"),["scroll","resize"].map(function(n){document.removeEventListener(n,ut(r,r._handleScrollAndResize))}),this._isRepositioning=!1),!i&&this._options.onHide)this._options.onHide(n);u={uniqueId:this._eventOptions?this._eventOptions.uniqueId:null};h.getService().fire(t.HIDE_DROPDOWN_EVENT_INTERNAL,u)},t.prototype.getSelectedIndex=function(){return this._selectedIndex==-1?null:this._selectedIndex<this._displayedEntities.length-1?this._selectedIndex:this._displayedEntities.length-1},t.prototype.getSelectedItem=function(){return this._selectedIndex==-1||this._selectedIndex>this._displayedEntities.length-1?null:this._displayedEntities[this._selectedIndex]},t.prototype.handleKeyEvent=function(n){if(!n||!n.keyCode)return!0;switch(n.keyCode){case ot.UP:return this.isVisible()?this._prevItem():!0;case ot.DOWN:return this.isVisible()?this._nextItem():(this.show(),!0);case ot.PAGE_UP:return this.isVisible()?this._prevPage():!0;case ot.PAGE_DOWN:return this.isVisible()?this._nextPage():!0;case ot.ENTER:return this.isVisible()&&this._searchButtonClickDelegate(),!0;case ot.ESCAPE:return this.isVisible()?(this.hide(n),n.stopPropagation(),!1):!0;case ot.RIGHT:return this.isVisible()&&this._showContactCard&&this._selectedIndex!=-1?(n.stopPropagation(),$(".identity-picker-contact-card-icon",this._indexedEntityMap[this._selectedIndex]).click(),!1):!0;case ot.DELETE:if(this.isVisible()&&this._options.showMru){var t=this.getSelectedItem();return t&&t.isMru&&et.isDirectoryEntityType(t)?(n.stopPropagation(),$(".identity-picker-delete-icon",this._indexedEntityMap[this._selectedIndex]).click(),!1):!0}return!0;default:return!0}},t.prototype.getPrefix=function(){return this._prefix},t.prototype.updatePrefix=function(n){this._prefix=n?n.toLowerCase().trim():"";this._prefix||(this._isSearchActive=!1,this._disableDirectorySearch())},t.prototype.dispose=function(){this._element&&(this._element.off(".identityPickerDropdown"),this._element.parents().off(".identityPickerDropdown"));n.prototype.dispose.call(this)},t.prototype.reset=function(){this._resetSearchStatuses();this._prefix="";this._enableDirectorySearch();this._displayedEntities=[];this._alterStateAndRender(!1,!1);this._disableDirectorySearch()},t.getClassSelector=function(n){return"."+n},t.prototype._getEntityOperationsFacade=function(){return this._entityOperationsFacade||(this._entityOperationsFacade=w.getService(yt)),this._entityOperationsFacade},t.prototype._getUserMruEntitiesPostLoad=function(n){var t=this;return n===void 0&&(n=!0),this._isFiltered=!1,this._showOnlyMruIdentities=!0,this._isDropdownVisibleInitially=this._isVisible,this._getEntityOperationsFacade().isUserMruReady(this._options.getFilterByScope())||this._alterStateAndRender(!0,!1,n),this.load().then(ut(this,function(){return t.getIdentities(t._prefix,n)}))},t.prototype._enableDirectorySearch=function(){this._isDirectorySearchEnabled=!0},t.prototype._disableDirectorySearch=function(){this._isDirectorySearchEnabled=!1},t.prototype._resetSearchStatuses=function(){this._isSearchActive=!1;this._disableDirectorySearch()},t.prototype._getIdentitiesPostLoad=function(n,t){var i,r;return(t===void 0&&(t=!0),i=it.defer(),!this._element)?(i.reject(null),i.promise):(this._showLoading(),this._isDropdownVisibleInitially=this._isVisible,this._isSearchActive=!1,this._displayedEntities=[],this._options.showMru&&(this._mruEntities=this._getEntityOperationsFacade().getMruEntitiesUnchecked(this._options.getFilterByScope()),r=a.ServiceHelpers.getIdentityTypeList(this._identityType),this._mruEntities=this._mruEntities.filter(function(n){return r.indexOf(n.entityType.trim().toLowerCase())>=0})),(!n||n.trim().length===0)&&!this._options.smallScreenRender&&(this._resetSearchStatuses(),!this._showOnlyMruIdentities))?(this._prefix=n,this._enableDirectorySearch(),this._alterStateAndRender(!0,!0),this._disableDirectorySearch(),i.resolve([]),i.promise):(n=n.toLowerCase().trim(),this._prefix=n,this._showOnlyMruIdentities)?(this._displayedEntities=this._mruEntities?this._mruEntities:[],this._alterStateAndRender(!1,!1,t),this._showOnlyMruIdentities=!1,this._getImagesForDisplayedEntities(),i.resolve(this._displayedEntities),i.promise):(this._options.showMru&&(this._displayedEntities=yt.filterEntities(this._mruEntities,n)),this._isFiltered=!0,this._options.showMru&&!this._isDirectorySearchEnabled)?(this._alterStateAndRender(!0,!1,t),this._getImagesForDisplayedEntities(),i.resolve(this._displayedEntities),i.promise):this._getDirectoryEntitiesWithRender(n,i)},t.prototype._getDirectoryEntitiesWithRender=function(n,t){return this._isSearchActive=!0,this._alterStateAndRender(!0),this._getDirectoryEntities(n,t)},t.prototype._checkIfServerException=function(n){return!n||!("serverError"in n)||!n.serverError||!("typeKey"in n.serverError)?!1:!0},t.prototype._getMessageForIpsAuthorizationException=function(n){if(n.serverError.typeKey.trim()=="IdentityPickerAuthorizationException"&&n.serverError.customProperties!=null){var i=n.serverError.customProperties.identityPickerAuthorizationExceptionType,t=p.IdentityPicker_ErrorAuthorizationException;return i==kt.IsGuestUser&&(t=p.IdentityPicker_GuestUserException),t}return null},t.prototype._getDirectoryEntities=function(n,i,r){var u=this,h,a;r===void 0&&(r=!1);var f=function(t){u._element&&(u._isSearchActive=!1,n===u._prefix&&n.length>=1&&(u._displayedEntities=t?t.identities:[],u._alterStateAndRender(!0)),u._onDirectorySearchFinished&&u._onDirectorySearchFinished(u._displayedEntities,n),i.resolve(u._displayedEntities))},e=function(r){if(r&&s.logError("_getDirectoryEntities/getIdentitiesErrorCallback:"+JSON.stringify(r)),n===u._prefix)if(u._checkIfServerException(r)){var f=u._getMessageForIpsAuthorizationException(r);f&&u._showError($("<span>").text(f+" [").append($("<a><\/a>").attr("href",t.IP_AUTHORIZATION_EXCEPTION_DETAILS_LINK).text(p.IdentityPicker_ErrorMoreDetails).attr("target","_blank")).append($("<span>").text("]")))}else u._showError(p.IdentityPicker_ErrorLoadingIdentities);u._isSearchActive=!1;i.reject(r?r:null)},o=this._options.getFilterByScope();return c.FilterByScope.isFilterByScopeEmpty(o)?f(null):(h={identityServiceOptions:{operationScope:this._operationScope,identityType:this._identityType,httpClient:this._options.httpClient,extensionData:this._options.extensionData},identityExtensionOptions:{consumerId:this._options?this._options.consumerId:l.ConsumerId.UnknownConsumer},prefix:n,sources:this._options.showMru?[ct.Directory,ct.Mru]:[ct.Directory],filterByScope:o},a=this._getEntityOperationsFacade().search(h).then(function(n){for(var t in n.queryTokenResponse)n.queryTokenResponse[t].then(ut(u,f),ut(u,e))},e)),i.promise},t.prototype._getImagesForDisplayedEntities=function(){var n=this,i=function(i){if(n._element){if(!i)return;n._displayedEntities.forEach(ut(n,function(r){i.hasOwnProperty(r.entityId)&&i[r.entityId]&&(r.image=i[r.entityId],$(t.getClassSelector(t.AVATAR_CLASS),n._$itemsContainer).each(function(n,t){t.hasAttribute("data-objectid")&&t.getAttribute("data-objectid")===r.entityId&&t.setAttribute("src",i[r.entityId])}))}))}},r=function(n){n&&s.logError("_getImagesForDisplayedEntities/getIdentityImagesErrorCallback:"+JSON.stringify(n))},u={identityServiceOptions:{operationScope:this._operationScope,identityType:this._identityType,httpClient:this._options.httpClient,extensionData:this._options.extensionData},identityExtensionOptions:{consumerId:this._options?this._options.consumerId:l.ConsumerId.UnknownConsumer},sources:[ct.Directory]};this._getEntityOperationsFacade().getImagesForEntities(this._displayedEntities,u).then(i,r)},t.prototype._showPostLoad=function(){var n=this,i;if(this._element){this._isVisible=!0;this._element.show();this._setPosition();this._element.parents().on("scroll.identityPickerDropdown resize.identityPickerDropdown",ut(this,this._handleScrollAndResize));["scroll","resize"].map(function(t){document.addEventListener(t,ut(n,n._handleScrollAndResize))});this._isRepositioning=!1;i={uniqueId:this._eventOptions?this._eventOptions.uniqueId:null};h.getService().fire(t.SHOW_DROPDOWN_EVENT_INTERNAL,i)}},t.prototype._handleScrollAndResize=function(){var n=this;this._isRepositioning||(this._isRepositioning=!0,k.delay(this,500,ut(this,function(){n._isRepositioning=!1;n._setPosition()})))},t.prototype._constructDropdown=function(n,t,i){n===void 0&&(n=!1);t===void 0&&(t=!0);i===void 0&&(i=!0);this._indexedEntityMap={};t&&this._setupDom();n?this._setSelectedIndex(this._selectedIndex<this._displayedEntities.length?this._selectedIndex:this._isSearchActive?this._displayedEntities.length-1:-1,!0,g.Positioning.VerticalScrollBehavior.Top):(this._selectedIndex=ht.SelectNone,i&&this._numItemsDisplayed>0?this._setSelectedIndex(ht.SelectFirstItem,!1):this._setSelectedIndex(ht.SelectNone,!1))},t.prototype._removeIdentityFromMru=function(n){var i=this;try{if(at.isStringPrefixedLocalId(n))return;var r=function(n){i._element&&n==!0&&i._getEntityOperationsFacade().refreshUserMru(i._options.getFilterByScope())},u=function(){},f=w.getService(a.MruService);f.removeMruIdentities([n],{IMS:!0},a.MruService.DEFAULT_IDENTITY_ID,a.MruService.DEFAULT_FEATURE_ID,{httpClient:this._options.httpClient},{consumerId:this._options.consumerId}).then(r,u);this._disableDirectorySearch()}catch(t){if(t!==Object(t)||!("source"in t)||t.source!="MruService")throw t;}},t.prototype._alterStateAndRender=function(n,t,i){if(t===void 0&&(t=!1),i===void 0&&(i=!0),this._element){if(n||this.hide(void 0,!0),this._prefix&&this._prefix.trim().length!=0||(this._isSearchActive=!1),this._displayedEntities=this._displayedEntities||[],this._preDropdownRender&&(this._displayedEntities=this._preDropdownRender(this._displayedEntities,this._isDirectorySearchEnabled)),this._constructDropdown(t,!0,i),!this._isSearchActive&&!this._prefix&&this._displayedEntities.length==0){this.hide();return}n&&(!this._isDropdownVisibleInitially||this._isVisible)&&this.show()}},t.prototype._fireActiveDescendantUpdate=function(n){var i={activeDescendantId:n,uniqueId:this._eventOptions?this._eventOptions.uniqueId:null};h.getService().fire(t.UPDATE_ACTIVE_DESCENDANT_ID,i)},t.prototype._setSelectedIndex=function(n,t,i){i===void 0&&(i=g.Positioning.VerticalScrollBehavior.Bottom);var r=n!==null&&n!==undefined&&this._indexedEntityMap&&this._indexedEntityMap[n]&&(this._selectedIndex!==n||!this._indexedEntityMap[this._selectedIndex].hasClass("selected"));r?(this._selectedIndex=n,this._clearItemsSelection(this._element.find(".search")),this._clearItemsSelection(this._$itemsContainer.find("li")),this._selectItem(this._indexedEntityMap[this._selectedIndex]),t&&this._scrollItemIntoView(this._selectedIndex,i)):$.isNumeric(n)&&(this._selectedIndex=n)},t.prototype._scrollItemIntoView=function(n,t){n!==null&&n!==undefined&&g.Positioning.scrollIntoViewVertical(this._indexedEntityMap[n],t)},t.prototype._setPosition=function(){var n,i,r,u,e,f,o;this._element&&(n=this._getPositioningElement(),this._options.width?this._element.width(this._options.width):(i=n.outerWidth()-t.DROPDOWN_BORDER_PX,this._element.width(i<t.MIN_WIDTH?t.MIN_WIDTH:i)),n.is(":visible")&&g.Positioning.position(this.getElement(),n,{elementAlign:this._elementAlign,baseAlign:this._baseAlign,overflow:"fit-flip"}),r=$(window),u=this._element.offset().top+this._element.height()-r.height()-r.scrollTop(),u>0&&(e=parseInt(this._$itemsContainer.css("max-height")),this._$itemsContainer.css("max-height",e-u+"px")),this._options.useRemainingSpace&&(this._element.width(""),this._element.css("left",""),this._element.addClass("use-remaining-space"),f=this._element.position().top,o="calc(100% - "+f+"px)",this._element.css("max-height",o),this._element.css("top",f+"px")),this._options.smallScreenRender&&this._element.addClass("small-screen"))},t.prototype._getPositioningElement=function(){var n=this._positioningElement;return $.isFunction(n)&&(n=n()),n||(n=this.getElement().parent()),n},t.prototype._showLoading=function(){this._$liveStatus.detach();this._$itemsContainer.detach();this._element.empty();this._$liveStatus.appendTo(this._element);this._$liveStatus.text(p.IdentityPicker_LoadingIdentities);this._$itemsContainer.empty().attr("aria-busy","true").appendTo(this._element);var n=$("<div>").addClass("search").appendTo(this._element),t=o.BaseControl.createIn(b.StatusIndicator,n,{center:!1,message:p.IdentityPicker_LoadingIdentities});t.start()},t.prototype._showError=function(n){var t=typeof n=="string"||n instanceof String?$("<span>").text(n):n,i,r;this._$liveStatus.text(t.text());i=$(".search",this._element).empty().addClass("search-error");r=o.BaseControl.createIn(y.MessageAreaControl,i,{closeable:!1,message:{header:t,type:y.MessageAreaType.Error},showIcon:!1})},t.prototype._nextPage=function(){var n=-1;return this._loadNextPage(!0),this._selectedIndex<this._displayedEntities.length-1&&this._selectedIndex!==-1&&(n=this._selectedIndex+this._options.pageSize),this._setSelectedIndex(n<this._displayedEntities.length?n:this._displayedEntities.length-1,!0,g.Positioning.VerticalScrollBehavior.Top),!1},t.prototype._prevPage=function(){var n=0;return this._selectedIndex===-1?n=this._displayedEntities.length-this._options.pageSize:this._selectedIndex>0&&(n=this._selectedIndex-this._options.pageSize),this._setSelectedIndex(n>=0?n:ht.SelectFirstItem,!0,g.Positioning.VerticalScrollBehavior.Top),!1},t.prototype._nextItem=function(){if(this._selectedIndex===this._displayedEntities.length-1){var n=this._element.find(".search");n.is(":visible")?(this._selectedIndex=ht.SelectNone,this._clearItemsSelection(this._$itemsContainer.find("li")),this._selectItem(n)):this._setSelectedIndex(ht.SelectFirstItem,!0)}else this._selectedIndex<this._displayedEntities.length-1&&this._setSelectedIndex(this._selectedIndex+1,!0);return!1},t.prototype._prevItem=function(){return this._selectedIndex===-1&&this._displayedEntities&&this._displayedEntities.length?(this._clearItemsSelection(this._element.find(".search")),this._setSelectedIndex(this._displayedEntities.length-1,!0)):this._selectedIndex>0&&this._setSelectedIndex(this._selectedIndex-1,!0,g.Positioning.VerticalScrollBehavior.Top),!1},t.prototype._selectItem=function(n){var t=n.attr("id")?n.attr("id"):o.getId().toString();n.addClass("selected").attr({id:t,"aria-selected":"true"});this._fireActiveDescendantUpdate(t)},t.prototype._clearItemsSelection=function(n){n.removeClass("selected").attr("aria-selected","false")},t.prototype._createItem=function(n){var t=this,r={deleteIconClickDelegate:ut(this,function(n,i){var r=t._mruEntities.indexOf(n);r>=0&&t._mruEntities.splice(r,1);r=t._displayedEntities.indexOf(n);r>=0&&t._displayedEntities.splice(r,1);i.remove();n.localId&&n.localId.trim()&&t._removeIdentityFromMru(n.localId);t._numItemsDisplayed=Math.min(t._displayedEntities.length,Math.max(t._options.pageSize,t._numItemsDisplayed));t._$searchResultStatus.remove();t._$searchResultStatus=t._constructSearchResultStatus();t._showAdditionalInformation()}),entityListItemClickDelegate:ut(this,function(n){if(t._logSelectedEntity(n),$.isFunction(t._options.onItemSelect))t._options.onItemSelect(n)})},u={operationScope:this._operationScope,identityType:this._identityType,httpClient:this._options.httpClient?this._options.httpClient:null},f={consumerId:this._options.consumerId},e=this._displayedEntities[n],i=(new ui).withIdentityServiceOptions(u).withIdentityExtensionOptions(f).withPrefix(this._prefix&&this._prefix.trim()&&!this._showOnlyMruIdentities?this._prefix:"").withEntity(e).forControlOfSize(this._size).registerCallbacks(r).withContactCard(this._showContactCard,this._options.focusElementOnContactCardClose).withHoverSupport(!this._options.useRemainingSpace).withSmallScreenRender(this._options.smallScreenRender).withDialogAppendTo(this._options.dialogAppendTo).build();return this._indexedEntityMap[n]=i,i},t.prototype._logSelectedEntity=function(n){var r=!1,u=!1,i,t,f;try{i=l.Telemetry.Feature_DropdownControl;(n.originDirectory.toLowerCase().trim()==a.ServiceHelpers.VisualStudioDirectory||n.localDirectory.toLowerCase().trim()==a.ServiceHelpers.VisualStudioDirectory)&&(r=!0);n.isMru&&(u=!0);this._prefix?this._options.showMru?i=this._isDirectorySearchEnabled?l.Telemetry.Feature_Select_Mru_Dir:l.Telemetry.Feature_Select_Mru_Prefix:this._isDirectorySearchEnabled&&(i=l.Telemetry.Feature_Select_Dir):this._options.showMru&&(i=l.Telemetry.Feature_Select_Mru_NoPrefix);t={};t[l.TelemetryProperties.prefixType]=a.ServiceHelpers.getPrefixTypeForTelemetry(this._prefix);t[l.TelemetryProperties.prefixLength]=this._prefix.length;t[l.TelemetryProperties.consumerId]=this._options&&this._options.consumerId?this._options.consumerId:null;t[l.TelemetryProperties.extensionId]=this._options&&this._options.extensionData&&this._options.extensionData.extensionId?this._options.extensionData.extensionId:null;t[l.TelemetryProperties.identityTypes]=a.ServiceHelpers.getIdentityTypeList(this._options.identityType);t[l.TelemetryProperties.operationScopes]=a.ServiceHelpers.getOperationScopeList(this._options.operationScope);t[l.TelemetryProperties.isMru]=u;t[l.TelemetryProperties.isNonMaterialized]=!r;t[l.TelemetryProperties.maxResults]=this._options&&this._options.maxResults?this._options.maxResults:a.IdentityService.MAX_RESULTS;t[l.TelemetryProperties.minResults]=this._options&&this._options.minResults?this._options.minResults:a.IdentityService.MIN_RESULTS;t[l.TelemetryProperties.entityId]=n.entityType.toLowerCase().trim()==at.STRING_ENTITY_TYPE?at.STRING_ENTITY_TYPE:n.entityId;t[l.TelemetryProperties.consumerId]=this._options.consumerId;f=w.getService(a.IdentityService);t=a.ServiceHelpers.addScenarioProperties(w.getService(a.IdentityService),t);nt.publishEvent(new nt.TelemetryEventData(l.Telemetry.Area,i,t))}catch(e){}},t.prototype._setupDom=function(){var n,t,i;this._$liveStatus.text("").detach();this._$itemsContainer.empty().removeAttr("aria-busy").detach();this._element.empty();this._$liveStatus.appendTo(this._element);this._setupEntitiesInDom();n=!1;!this._isDirectorySearchEnabled&&this._options.showMru&&this._prefix&&!this._showOnlyMruIdentities&&(t=this._constructSearchButton().appendTo(this._element),this._$itemsContainer.attr("aria-owns",t.attr("id")),n=!0,this._displayedEntities&&this._displayedEntities.length||(this._selectedIndex=ht.SelectNone,this._selectItem(t)));this._displayedEntities&&this._displayedEntities.length>0&&(this._$searchResultStatus=this._constructSearchResultStatus());n&&(i=this._$liveStatus.text(),this._$liveStatus.text((i?i+". ":"")+p.IdentityPicker_SearchButtonShownInDropdown));this._showAdditionalInformation()},t.prototype._showAdditionalInformation=function(){this._displayedEntities.length===0&&(this._isSearchActive||this._options.showMru&&!this._getEntityOperationsFacade().isUserMruReady(this._options.getFilterByScope())?this._showLoading():(!this._options.showMru||this._isDirectorySearchEnabled&&this._prefix||this._showOnlyMruIdentities)&&(this._$liveStatus.text(p.IdentityPicker_NoResult),(this._options.showNoIdentitiesFound||this._options.showNoIdentitiesFound===undefined||this._options.showNoIdentitiesFound===null)&&this._constructInformativeMessage(p.IdentityPicker_NoResult).appendTo(this._element)));this._$suggestedPeople&&(this._displayedEntities.length>0?this._$suggestedPeople.show():this._$suggestedPeople.hide())},t.prototype._setupEntitiesInDom=function(){var n,i;if(this._options.smallScreenRender&&this._$suggestedPeople.appendTo(this._element),this._$itemsContainer.empty().appendTo(this._element),this._displayedEntities.length==0)this._numItemsDisplayed=0;else for(this._numItemsDisplayed=Math.min(this._displayedEntities.length,Math.max(this._options.pageSize,this._numItemsDisplayed)),n=0;n<this._numItemsDisplayed;n++)n>this._displayedEntities.length-1||(i=this._createItem(n),i&&(this._$itemsContainer.append(i),this._options.smallScreenRender||i.height(i.height()+t.IMAGE_MARGINS_PX)))},t.prototype._constructSearchResultStatus=function(){var n=$("<div>").addClass("search-result-status").appendTo(this._element),t,i;return this._displayedEntities.length==1&&this._numItemsDisplayed==this._displayedEntities.length?(t=d.format(p.IdentityPicker_SingleResultStatus,this._displayedEntities.length),this._$liveStatus.text(t),n.text(t)):this._displayedEntities.length>1&&this._numItemsDisplayed<=this._displayedEntities.length?(i=d.format(p.IdentityPicker_MultipleResultStatus,this._displayedEntities.length),this._$liveStatus.text(i),n.text(i)):n.hide(),n},t.prototype._constructSearchButton=function(){var n=$("<div>").addClass("search").attr({role:"button option","aria-label":p.IdentityPicker_SearchButtonLabel,tabindex:"0",id:o.getId().toString()}),t=$("<span>").addClass("bowtie-icon bowtie-search identity-picker-search-icon"),i=$("<span>").addClass("status-message").text(p.IdentityPicker_SearchButton);return n.append(t).append(i),n.click(ut(this,this._searchButtonClickDelegate)),n},t.prototype._constructInformativeMessage=function(n){return $("<div>").addClass("no-result").append($("<span>").addClass("status-message").text(n).attr("role","alert"))},t.prototype._loadNextPage=function(n){var u,r,i;if(n===void 0&&(n=!1),u=this._$itemsContainer.scrollTop()+this._$itemsContainer.outerHeight()>=this._$itemsContainer[0].scrollHeight-5,n||u){for(r=this._numItemsDisplayed;r<this._numItemsDisplayed+Math.min(this._displayedEntities.length-this._numItemsDisplayed,this._options.pageSize);r++)i=this._createItem(r),i&&(this._$itemsContainer.append(i),i.height(i.height()+t.IMAGE_MARGINS_PX));this._numItemsDisplayed+=Math.min(this._displayedEntities.length-this._numItemsDisplayed,this._options.pageSize);this._$searchResultStatus.remove();this._$searchResultStatus=this._constructSearchResultStatus()}this._scrollTimeout!==null&&(clearTimeout(this._scrollTimeout),this._scrollTimeout=null)},t.prototype._searchButtonClickDelegate=function(){this._enableDirectorySearch();this.getIdentities(this._prefix)},t.SHOW_DROPDOWN_EVENT_INTERNAL="identity-picker-dropdown-show",t.HIDE_DROPDOWN_EVENT_INTERNAL="identity-picker-dropdown-hide",t.UPDATE_ACTIVE_DESCENDANT_ID="identity-picker-dropdown-update-active-descendant-id",t.DROPDOWN_BASE_CLASS="identity-picker-dropdown",t.IMAGE_MARGINS_PX=8,t.MIN_WIDTH=300,t.MAX_HEIGHT=240,t.DROPDOWN_BORDER_PX=2,t.IP_AUTHORIZATION_EXCEPTION_DETAILS_LINK="https://aka.ms/c0eo4d",t.AVATAR_CLASS="identity-picture",t}(o.Control);t.IdentityPickerDropdownControl=lt;wt=function(n){function t(t){var i=__construct(this,n,[t]);for(var r in i)i.hasOwnProperty(r)&&(this[r]=i[r]);return i._scrollTimeout=100,i._pageSize=10,i._selectedIndex=ht.SelectNone,i._identityType=t.identityType?t.identityType:{User:!0},i._operationScope=t.operationScope?t.operationScope:{IMS:!0},i}return __extends(t,n),t.prototype.initializeOptions=function(t){n.prototype.initializeOptions.call(this,$.extend({width:402,height:70,resizable:!1,modal:!1,draggable:!0,autoOpen:!0,closeOnEscape:!1,cssClass:"idcard-dialog-content",closeText:p.CloseButtonLabelText},t))},t.prototype.initialize=function(){var i,r,u;n.prototype.initialize.call(this);this._previousFocusedElement=$(document.activeElement);this._element.dialog(this._options);this._$idCardDialog=this._element.closest(t.JQUERY_UI_DIALOG_CLASS).addClass("idcard-dialog").attr("visibility","hidden");this._$idCardDialog.on("dialogclose.contactCard",ut(this,this._onIdCardClose));this._$idCardDialog.on("keydown.contactCard",ut(this,this._onKeyDown));if(this._$idCardDialog.css("z-index",t._getHigherZIndex("div"+t.JQUERY_UI_DIALOG_CLASS)),$(".ui-icon-closethick",this._$idCardDialog).addClass("bowtie-icon bowtie-navigate-close"),this._repositionDialog(),this._$idCardDialog.hide(),$(".ui-dialog-content",$(".idcard-dialog:visible")).dialog("close"),this._$idCardDialog.attr("id",t.ID_CARD_DIALOG_ID),this._options.identity){if(i=this._options.identity,!et.isDirectoryEntityType(i)){r={source:"IdCardDialog initialize",message:"The IdCardDialog can only be initialized with a user or group IEntity"};throw r;}u=et.getUniqueIdentifierForDisambiguation(i);this._$idCardDialog.attr("data-prefix",u.toLowerCase());this._getIdentitiesSuccess({queryToken:null,identities:[i]});!ft.isOnPremiseEnvironment()&&i.localDirectory&&i.localDirectory.toLowerCase().trim()==a.ServiceHelpers.VisualStudioDirectory&&this._operationScope&&(this._operationScope.AAD||this._operationScope.Source)&&this._getDirectoryEntities(i.entityId)}else this._$idCardDialog.attr("data-prefix",this._options.uniqueIdentifier.toLowerCase()),this._getDirectoryEntities(this._options.uniqueIdentifier)},t.prototype._getEntityOperationsFacade=function(){return this._entityOperationsFacade||(this._entityOperationsFacade=w.getService(yt)),this._entityOperationsFacade},t._getHigherZIndex=function(n){var t,i=1001;return $(n).each(function(n,r){t=$(r).css("z-index");!isNaN(t)&&t>i&&(i=t)}),++i},t.prototype._repositionDialog=function(){var t={elementAlign:"left-top",baseAlign:"left-bottom",overflow:"none-none"},n,i,r;this._options.anchorContainer?(n=$(this._options.anchorContainer).offset(),t.leftOffsetPixels=n.left,t.topOffsetPixels=n.top,t.skipZIndexSetting=!0):n=this._options.anchor.offset();g.Positioning.position(this._$idCardDialog,this._options.anchor,t);i=this._options.leftValue&&this._options.leftValue>0?this._options.leftValue:n.left;i+this._$idCardDialog.outerWidth()<$(window).width()+$(window).scrollLeft()?this._$idCardDialog.css("left",i):this._$idCardDialog.css("left",i-this._$idCardDialog.outerWidth()+this._options.anchor.outerWidth());r=this._options.topValue&&this._options.topValue>0?this._options.topValue:n.top+this._options.anchor.outerHeight();r+this._$idCardDialog.outerHeight()<$(window).height()+$(window).scrollTop()?this._$idCardDialog.css("top",r):this._$idCardDialog.css("top",r-this._$idCardDialog.outerHeight()-this._options.anchor.outerHeight())},t.prototype._getDirectoryEntities=function(n){var t=this,i={identityServiceOptions:{operationScope:this._operationScope,identityType:this._identityType,httpClient:this._options.httpClient,extensionData:this._options.extensionData},identityExtensionOptions:{consumerId:this._options?this._options.consumerId:l.ConsumerId.UnknownConsumer},prefix:n,queryTypeHint:{UID:!0},sources:[ct.Directory]},r=this._getEntityOperationsFacade().search(i).then(function(n){for(var i in n.queryTokenResponse)n.queryTokenResponse[i].then(ut(t,t._getIdentitiesSuccess),ut(t,t._getIdentitiesFailure))},this._getIdentitiesFailure)},t.prototype._getIdentitiesFailure=function(){h.getService().fire(t.IDCARD_LOADED_EVENT)},t.prototype._getIdentitiesSuccess=function(n){var r,e;if(!n||!n.identities||n.identities.length<1){this._getIdentitiesFailure(n);return}this._identity=n.identities[0];var o=f.FeatureAvailabilityService.isFeatureEnabled(u.WebPlatformFeatureFlags.ReactProfileCard),s=this._identity.entityType.trim().toLowerCase()==a.ServiceHelpers.UserEntity,i=this._identity.entityType.trim().toLowerCase()==a.ServiceHelpers.GroupEntity,c=window.top!==window.self,l=this._options.useOfficeFabricProfileCard!==null&&this._options.useOfficeFabricProfileCard!==undefined?this._options.useOfficeFabricProfileCard:!c;if(o&&l&&(s||i))this._displayReactIdCard(i);else{if(!a.ServiceHelpers.isAuthenticatedMember())return;r=et.getUniqueIdentifierForDisambiguation(this._identity);e=et.getSignInAddress(this._identity);(this._$idCardDialog.attr("data-prefix")&&r.toLowerCase().indexOf(this._$idCardDialog.attr("data-prefix").toLowerCase())===0||e.toLowerCase().indexOf(this._$idCardDialog.attr("data-prefix").toLowerCase())===0)&&this._element&&this._displayIdCard()}h.getService().fire(t.IDCARD_LOADED_EVENT)},t.prototype._displayReactIdCard=function(n){var t=this,s=$("body").eq(0),f=s.find(".cards-container"),u,e,o,h;if(f.length===0&&(f=$("<div class='cards-container' />").appendTo(s)),u=this._options.anchor,u&&u.attr("role")==="row"&&(u=u.children()),e=u[0],this._options.leftValue!==undefined&&this._options.topValue!==undefined&&this._options.leftValue!==null&&this._options.topValue!==null&&(e={x:this._options.leftValue,y:this._options.topValue}),o=function(){r.unmountComponentAtNode(f[0]);$(".ui-dialog-content",$(".idcard-dialog")).dialog("close")},n){var c=function(n){var i=w.getService(a.IdentityService);return i.getIdentityConnections(n,t._operationScope,{User:!0,Group:!0},{successors:!0},{httpClient:t._options.httpClient},{consumerId:t._options.consumerId})},v=function(n){var i={identityServiceOptions:{operationScope:t._operationScope,identityType:t._identityType,httpClient:null,extensionData:null},identityExtensionOptions:{consumerId:t._options?t._options.consumerId:l.ConsumerId.UnknownConsumer},prefix:n,queryTypeHint:{UID:!0},sources:["Directory"]};return t._getEntityOperationsFacade().search(i).then(function(n){var t=Object.keys(n.queryTokenResponse)[0];return n.queryTokenResponse[t].then(function(n){return n.identities[0]})})},y=u[0],p={getEntityFromUniqueAttribute:v,identity:this._identity,onDismissCallback:o,onRequestConnectionInformation:c,target:y};tt.using(["VSSUI/IdentityCard"],function(n){var t=i.createElement(n.IdentityCard,p);r.render(t,f[0])})}else h={identity:this._identity,target:e,entityOperationsFacade:this._getEntityOperationsFacade(),consumerId:this._options?this._options.consumerId:l.ConsumerId.UnknownConsumer,onDismissCallback:o},tt.using(["VSS/Identities/Picker/PersonaCard"],function(n){var t=i.createElement(n.PersonaCard,h);r.render(t,f[0])})},t.prototype._displayIdCard=function(){var n=this,t,e,o,f,s,v;this._$idCardDialog.attr("data-objectid",this._identity.entityId);$("body").on("mousedown.contactCard",ut(this,this._onIdCardBlur));$(".ui-dialog-buttonpane",this._$idCardDialog).hide();this._element.empty();$(".identity-picker-idcard-header").empty();var c=$("<div>").addClass("identity-picker-idcard-header").prependTo($(".ui-dialog-titlebar",this._$idCardDialog)),w=$("<div>").addClass("identity-picker-idcard-image").appendTo(c),l=$("<div>").addClass("identity-picker-idcard-basicinfo").appendTo(c),u=et.getDisplayName(this._identity),b=a.ServiceHelpers.getDefaultIdentityImage(this._identity),k=ft.createImgElement(b,this._identity.image?this._identity.image:"","user-picture-card");if(k.attr("alt",u).appendTo(w),t=et.getSignInAddress(this._identity),t.trim()||this._options.uniqueIdentifier&&ft.isValidEmail(this._options.uniqueIdentifier)&&(t=this._options.uniqueIdentifier),e=$("<div>").addClass("identity-picker-idcard-basicinfo-name").appendTo(l).text(u),rt.RichContentTooltip.addIfOverflow(u,e,{menuContainer:e}),o=$("<div>").addClass("identity-picker-idcard-ellipsis-overflow").appendTo(l),ft.isValidEmail(t)?$("<a>").attr({"aria-label":p.IdentityPicker_IdCardSendEmail,href:"mailto:"+t,tabindex:"0"}).text(t).appendTo(o):o.text(t),this._$liveStatus=$("<div>").addClass("visually-hidden").attr("aria-live","polite").appendTo(this._$idCardDialog),$(".ui-dialog-title",this._$idCardDialog).text(d.format(p.IdentityPicker_ContactCardInformation,u)),this._$idCardDialog.attr("name",u),f=(new ri).getIdentityAttributes(this._identity),this._identity.entityType.trim().toLowerCase()==a.ServiceHelpers.UserEntity){s=f.toRows();for(v in s)this._element.append(s[v])}else if(this._identity.entityType.trim().toLowerCase()==a.ServiceHelpers.GroupEntity){var y=$("<div>").addClass("identity-picker-idcard-row").attr("role","tablist").appendTo(this._element),i=$("<span>").addClass("identity-picker-idcard-tab").text(p.IdentityPicker_IdCardInfo).attr({tabindex:"0",id:"identity-picker-idcard-tab-info",role:"tab","aria-selected":"true"}).appendTo(y),r=$("<span>").addClass("identity-picker-idcard-tab identity-picker-idcard-unselected-tab").text(p.IdentityPicker_IdCardMembers).attr({tabindex:"0",id:"identity-picker-idcard-tab-members",role:"tab","aria-selected":"false"}).appendTo(y),h=f.toRows()[0].attr({role:"tabpanel","aria-labelledby":"identity-picker-idcard-tab-info"});this._element.append(h);this._constructMemberTabContent().appendTo(this._element);this._getDirectoryMemberEntities(this._identity);i.click(ut(this,function(){i.hasClass("identity-picker-idcard-unselected-tab")&&(i.removeClass("identity-picker-idcard-unselected-tab"),i.attr("aria-selected","true"),r.attr("aria-selected","false"),r.addClass("identity-picker-idcard-unselected-tab"),n._$groupMembersContainer.parent().hide(),h.show(),n._element.css("height","auto"),n._$idCardDialog.css("height","auto"))}));r.click(ut(this,function(){r.hasClass("identity-picker-idcard-unselected-tab")&&(r.removeClass("identity-picker-idcard-unselected-tab"),r.attr("aria-selected","true"),i.attr("aria-selected","false"),i.addClass("identity-picker-idcard-unselected-tab"),h.hide(),n._setSelectedIndex(ht.SelectFirstItem,g.Positioning.VerticalScrollBehavior.Top),n._$groupMembersContainer.parent().show(),n._element.css("height","auto"),n._$idCardDialog.css("height","auto"),n._groupMembers.length?n._groupMembers.length==1?n._$liveStatus.text(p.IdentityPicker_MembersSingleResultStatus):n._$liveStatus.text(d.format(p.IdentityPicker_MembersMultipleResultStatus,n._groupMembers.length)):n._$liveStatus.text(p.IdentityPicker_NoMembers))}))}f.isEmpty()?$(".ui-dialog-titlebar",this._$idCardDialog).addClass("no-content"):$(".ui-dialog-titlebar",this._$idCardDialog).removeClass("no-content");this._element.css("height","auto");this._repositionDialog();this._$idCardDialog.show();this._$idCardDialog.attr("visibility","");this._$idCardDialog.attr("tabindex","-1");this._$idCardDialog.focus()},t.prototype._constructMemberTabContent=function(){var n=$("<div>").addClass(t.ID_CARD_MEMBERS_DROPDOWN_CLASS+" "+t.ID_CARD_LIST_CLASS).attr({role:"tabpanel","aria-busy":"true","aria-labelledby":"identity-picker-idcard-tab-members"}).hide(),i;return this._$groupMembersContainer=$("<ul>").attr({role:"list","aria-labelledby":"identity-picker-idcard-tab-members",tabindex:"0"}).appendTo(n).css({"max-height":Math.min((ft.getSizePx(st.Large)+t.IMAGE_MARGINS_PX)*this._pageSize-10,t.MAX_HEIGHT)+"px"}),i=$("#identity-picker-idcard-tab-members-description.visually-hidden"),i.length||(i=$("<div>").text(p.IdentityPicker_IdCardMembersTabDescription).attr("id","identity-picker-idcard-tab-members-description").addClass("visually-hidden").appendTo("<body>")),this._$groupMembersContainer.attr("aria-describedby","identity-picker-idcard-tab-members-description"),this._$loading=$("<div>").addClass("identity-picker-idcard-word-wrap identity-picker-idcard-error").text(p.IdentityPicker_IdCardLoadingMembers).appendTo(n),n},t.prototype._getDirectoryMemberEntities=function(n){var t=this,r=w.getService(a.IdentityService),u=function(n){if(t._element){if(!n)return;t._groupMembers.forEach(ut(t,function(i){n.hasOwnProperty(i.entityId)&&n[i.entityId]&&(i.image=n[i.entityId],$(".identity-picture",t._$groupMembersContainer).each(function(t,r){r.hasAttribute("data-objectid")&&r.getAttribute("data-objectid")===i.entityId&&(r.setAttribute("src",n[i.entityId]),r.setAttribute("class","identity-picture small"))}))}))}},f=function(n){n&&s.logError("_getDirectoryMemberEntities/getIdentityImagesErrorCallback:"+JSON.stringify(n))},e=function(n){if(t._element){if(!n||!n.successors){ut(t,i)();return}if(t._groupMembers=n.successors,t._groupMembers&&t._groupMembers.length>0){t._groupMembers=ft.sortGroupMembersByName(t._groupMembers);t._groupMembers.forEach(function(n){(!n.image||n.image.trim())&&(n.image=a.ServiceHelpers.getDefaultIdentityImage(n))});var r={identityServiceOptions:{operationScope:t._operationScope,identityType:{User:!0,Group:!0},httpClient:t._options.httpClient,extensionData:t._options.extensionData},identityExtensionOptions:{consumerId:t._options.consumerId},sources:[ct.Directory]};t._getEntityOperationsFacade().getImagesForEntities(t._groupMembers,r).then(u,f);t._$loading.hide();t._renderMembersList()}else t._$loading.text(p.IdentityPicker_IdCardNoMembers);t._$groupMembersContainer.parent().removeAttr("aria-busy")}},i=function(n){t._element&&(t._$groupMembersContainer.parent().removeAttr("aria-busy"),t._$loading.text(p.IdentityPicker_IdCardErrorLoadingMembers));n&&s.logError("_displayIdCard/getConnectionsErrorCallback:".concat(JSON.stringify(n)))};r.getIdentityConnections(n,this._operationScope,{User:!0,Group:!0},{successors:!0},{httpClient:this._options.httpClient},{consumerId:this._options.consumerId}).then(ut(this,e),ut(this,i))},t.prototype._isMembersListVisible=function(){return this._$groupMembersContainer&&this._$groupMembersContainer.length&&this._$groupMembersContainer.parent()&&this._$groupMembersContainer.parent().is(":visible")},t.prototype._onIdCardBlur=function(n){this._element.hasClass("ui-dialog-content")&&n&&!$(n.target).closest("#"+t.ID_CARD_DIALOG_ID).length&&!$(n.target).is("#"+t.ID_CARD_DIALOG_ID)&&this._element.dialog("close")},t.prototype._onIdCardClose=function(){this._options.focusElementOnClose&&this._options.focusElementOnClose.is(":visible")?this._options.focusElementOnClose.focus():this._previousFocusedElement.focus();$("body").off("mousedown.contactCard");this._$idCardDialog.off(".contactCard");this._element.dialog("destroy")},t.prototype._onKeyDown=function(n){if(!n||!n.keyCode)return!0;switch(n.keyCode){case ot.UP:return this._isMembersListVisible()?this._prevItem():!0;case ot.DOWN:return this._isMembersListVisible()?this._nextItem():!0;case ot.PAGE_UP:return this._isMembersListVisible()?this._prevPage():!0;case ot.PAGE_DOWN:return this._isMembersListVisible()?this._nextPage():!0;case ot.ENTER:case ot.SPACE:return $(document.activeElement).hasClass("identity-picker-idcard-tab")&&$(document.activeElement).hasClass("identity-picker-idcard-unselected-tab")?(n.stopPropagation(),$(document.activeElement).click(),!1):$(document.activeElement).hasClass("ui-dialog-titlebar-close")?(n.stopPropagation(),this._element.dialog("close"),!1):this._isMembersListVisible()&&this._selectedIndex!=ht.SelectNone?(n.stopPropagation(),$("li",this._$groupMembersContainer).eq(this._selectedIndex).click(),!1):!0;case ot.ESCAPE:case ot.LEFT:return n.stopPropagation(),this._element.dialog("close"),!1;case ot.TAB:var r=$(":tabbable",this._$idCardDialog),t=r.filter(":first"),i=r.filter(":last");return i.length&&n.target===i[0]&&!n.shiftKey?(t.focus(),!1):t.length&&n.target===t[0]&&n.shiftKey?(i.focus(),!1):!0;default:return!0}},t.prototype._createItem=function(n){var i=this,f,s,e,u,r,h;return n?(s=a.ServiceHelpers.getDefaultIdentityImage(n),n.image&&(f=n.image),e=et.getDisplayName(n),u=et.getSignInAddress(n),u=d.isGuid(u)?"":u,r=$("<li>").attr("role","listitem").attr("id",o.getId().toString()).height(40),rt.RichContentTooltip.addIfOverflow(e,r,{menuContainer:r}),ft.createImgElement(s,f,"identity-picture small",n.entityId).addClass(f&&f.trim()?"":"hidden").appendTo(r),h=$("<div>").addClass("item-text-container").append($("<div>").addClass("title large").text(e)).append($("<div>").addClass("subtitle large").text(u)).appendTo(r),h.css("max-width",this._element.width()-t.MEMBERS_TAB_LEFT_PADDING_PX-t.IMAGE_MARGINS_PX-ft.getSizePx(st.Large)-ft.IDENTITY_ITEM_BUFFER_WIDTH_PX),r.click(ut(this,function(u){u.stopPropagation();var f={identity:n,anchor:r,leftValue:u.pageX!==undefined?u.pageX:r.offset().left,topValue:u.pageY!==undefined?u.pageY:r.offset().top,operationScope:i._operationScope,identityType:i._identityType,httpClient:i._options.httpClient?i._options.httpClient:null,focusElementOnClose:i._options.focusElementOnClose&&i._options.focusElementOnClose.is(":visible")?i._options.focusElementOnClose:i._previousFocusedElement,appendTo:i._options.appendTo,consumerId:i._options.consumerId};o.Enhancement.enhance(t,"<div/>",f)})),r):null},t.prototype._renderMembersList=function(){var n=this,r=function(){return n._scrollTimeout!==null&&(clearTimeout(n._scrollTimeout),n._scrollTimeout=null),n._scrollTimeout=window.setTimeout(ut(n,n._loadNextPage),100),!1},t,i;if(this._$groupMembersContainer.empty(),this._$groupMembersContainer.addClass("items"),this._$groupMembersContainer.scroll(ut(this,r)),this._groupMembers.length==0)this._numItemsDisplayed=0;else for(this._numItemsDisplayed=Math.min(this._groupMembers.length,this._pageSize),t=0;t<Math.min(this._groupMembers.length,this._pageSize);t++)i=this._createItem(this._groupMembers[t]),i&&this._$groupMembersContainer.append(i)},t.prototype._loadNextPage=function(){var t=this._$groupMembersContainer.scrollTop()+this._$groupMembersContainer.outerHeight()>=this._$groupMembersContainer[0].scrollHeight-5,n;if(t){for(n=this._numItemsDisplayed;n<this._numItemsDisplayed+Math.min(this._groupMembers.length-this._numItemsDisplayed,this._pageSize);n++)this._$groupMembersContainer.append(this._createItem(this._groupMembers[n]));this._numItemsDisplayed+=Math.min(this._groupMembers.length-this._numItemsDisplayed,this._pageSize)}this._scrollTimeout!==null&&(clearTimeout(this._scrollTimeout),this._scrollTimeout=null)},t.prototype._nextItem=function(){return this._selectedIndex===this._groupMembers.length-1?this._setSelectedIndex(ht.SelectFirstItem):this._selectedIndex<this._groupMembers.length-1&&this._setSelectedIndex(this._selectedIndex+1),!1},t.prototype._prevItem=function(){return this._selectedIndex===-1&&this._groupMembers&&this._groupMembers.length?this._setSelectedIndex(this._groupMembers.length-1):this._selectedIndex>0&&this._setSelectedIndex(this._selectedIndex-1,g.Positioning.VerticalScrollBehavior.Top),!1},t.prototype._nextPage=function(){var n=-1;return this._loadNextPage(),this._selectedIndex<this._groupMembers.length-1&&this._selectedIndex!==-1&&(n=this._selectedIndex+this._pageSize),this._setSelectedIndex(n<this._groupMembers.length?n:this._groupMembers.length-1,g.Positioning.VerticalScrollBehavior.Top),!1},t.prototype._prevPage=function(){var n=0;return this._selectedIndex===-1?n=this._groupMembers.length-this._pageSize:this._selectedIndex>0&&(n=this._selectedIndex-this._pageSize),this._setSelectedIndex(n>=0?n:ht.SelectFirstItem,g.Positioning.VerticalScrollBehavior.Top),!1},t.prototype._setSelectedIndex=function(n,t){var i,u,r,f;t===void 0&&(t=g.Positioning.VerticalScrollBehavior.Bottom);i=$("li",this._$groupMembersContainer);u=n!==null&&n!==undefined&&i.length&&i.eq(n).length&&(this._selectedIndex!==n||!i.eq(this._selectedIndex).hasClass("selected"));u?(this._selectedIndex=n,i.removeClass("selected").attr("aria-selected","false").removeAttr("id"),r=i.eq(this._selectedIndex),f=r.attr("id")?r.attr("id"):o.getId().toString(),r.addClass("selected").attr({id:f,"aria-selected":"true"}),this._$liveStatus.text(d.format(p.IdentityPicker_SelectedMember,et.getDisplayName(this._groupMembers[n]))),g.Positioning.scrollIntoViewVertical(r,t)):$.isNumeric(n)&&(this._selectedIndex=n)},t.IDCARD_LOADED_EVENT="idcard-finished-loading",t.MAX_HEIGHT=240,t.IMAGE_MARGINS_PX=8,t.MEMBERS_TAB_LEFT_PADDING_PX=11,t.ID_CARD_LIST_CLASS="identity-picker-idcard-list",t.ID_CARD_MEMBERS_DROPDOWN_CLASS=lt.DROPDOWN_BASE_CLASS,t.JQUERY_UI_DIALOG_CLASS=".ui-dialog",t.ID_CARD_DIALOG_ID="idcard-dialog",t}(o.Control);t.IdCardDialog=wt;dt=function(n){function t(i,r){var u,f;return r===void 0&&(r=!1),u=n.call(this,i)||this,u._resolvedIEntity=null,u._loadOnCreate=!1,u._previousInput="",u._isSearchEverIssued=!1,u._readOnlyMode=!1,u._showMruExpander=!1,u._trackTabKeyDown=!1,u._queryTokensRequested={},u._onDocumentLoad=function(){u._$container.is(":visible")?u._recalculateInputWidth():setTimeout(u._onDocumentLoad,50)},u._recalculateInputWidth=function(){if(u._$input)if(u._controlWidth=Math.max(u._$container.width(),t.DEFAULT_WIDTH),u._$input.prev(".identity-picker-resolved")[0]){var n=u._$input.prev(".identity-picker-resolved"),f=u._$container[0].scrollHeight>u._$container.innerHeight(),i=u._$container.offset().left+Math.max(u._$container.outerWidth(),t.DEFAULT_WIDTH)-n.offset().left-n.outerWidth()-parseInt(n.css("margin-right"))-parseInt(u._$container.css("padding-right"))-parseInt(u._$container.css("border-right-width"))-(f?ft.SCROLL_BAR_WIDTH_PX:0)-(u._showMruExpander?t.TRIANGLE_WIDTH_PX:0)-1,r=u._$input.attr("placeholder").length;i>(r?r:15)*6?u._$input.outerWidth(i):u._$input.outerWidth(u._controlWidth-ft.SCROLL_BAR_WIDTH_PX-(u._showMruExpander?t.TRIANGLE_WIDTH_PX:0))}else u._$input.outerWidth(u._controlWidth-(u._showMruExpander?t.TRIANGLE_WIDTH_PX:0)-(u._options.smallScreenRender?u._$closeInput.outerWidth():0))},r||(f=i,f.dropdownContainer||(f.dropdownContainer=ut(u,function(){return $("body")})),u.initializeOptionsInternal(f)),u}return __extends(t,n),t.prototype.initializeOptionsInternal=function(n){if(this._identityType=n.identityType?n.identityType:{User:!0},this._operationScope=n.operationScope?n.operationScope:{IMS:!0},this._size=n.size!==null&&n.size!==undefined?n.size:st.Medium,this._dropdownContainerDelegate=n.dropdownContainer,this._preDropdownRender=this._options.callbacks&&n.callbacks.preDropdownRender?n.callbacks.preDropdownRender:null,this._onDirectorySearchFinished=this._options.callbacks&&n.callbacks.onDirectorySearchFinished?n.callbacks.onDirectorySearchFinished:null,this._loadOnCreate=n.loadOnCreate?n.loadOnCreate:!1,n.placeholderText&&n.placeholderText.trim())this._placeholderText=n.placeholderText;else{var t=a.ServiceHelpers.getIdentityTypeList(this._identityType);this._placeholderText=this._generatePlaceHolder(t)}this._controlLoaded=null;this._delaySearchTimeOutValue=n.delaySearchTimeoutValue||0},t.prototype.initialize=function(){var i=this,r,e,u,f,s,c;n.prototype.initialize.call(this);r=this._options.items;this._selectedItems=[];this._unresolvedItems=[];this._$currentlyFocusedItem=null;this._$container=this._element.parent();this._controlWidth=Math.max(this._$container.innerWidth(),t.DEFAULT_WIDTH);this._element.addClass("identity-picker-search-box");this._options.smallScreenRender&&this._element.addClass("small-screen");this._element.height(ft.getSizePx(this._size)+t.OUTER_PADDING_PX);e=function(n){$(n.target).hasClass("identity-picker-input")||$(n.target).hasClass("identity-picker-search-multiple-name")||$(n.target).hasClass(t.SEARCH_MRU_TRIANGLE_CLASS)||i.focusOnSearchInput()};this._element.on("click.identityPicker",ut(this,e));this._element.on("remove.identityPicker",ut(this,this.dispose));if(this._$input=$("<input>").attr("type","text").attr("spellcheck","false").attr("autocomplete","off").attr("placeholder",this._placeholderText).addClass("identity-picker-input").attr("role","combobox").attr("aria-autocomplete","list").attr("aria-expanded","false"),!this._options.required||this._$input.attr("required","true"),!this._options.ariaDescribedby||this._$input.attr("aria-describedby",this._getAriaDescribedby(this._options.ariaDescribedby)),this._options.excludeAriaLabel||this._$input.attr("aria-label",this._options.ariaLabel?this._options.ariaLabel:this._placeholderText),this._options.elementId&&this._$input.attr("id",this._options.elementId),this._$input.appendTo(this._element),ft.styleElementBySize(this._$input,this._size,!0),this._options.multiIdentitySearch&&(f=o.getId().toString(),u=$("<label>").addClass("visually-hidden").attr("id",f).appendTo(this._element),this._$input.attr("aria-describedby",this._getAriaDescribedby(f))),this._options.smallScreenRender&&(this._$closeInput=this._createCloseButton(),ft.styleElementBySize(this._$closeInput,this._size,!1),this._$closeInput.hide(),this._$closeInput.appendTo(this._element),this._$closeInput.mousedown(ut(this,function(n){i._setInputText("");i.focusOnSearchInput();i._recalculateInputWidth();n.preventDefault();i._$closeInput.hide()}))),this._options.showMruTriangle=this._options.forceOpen?!1:this._options.showMruTriangle,this._showMruExpander=this._options.showMruTriangle?!0:!1,this._isReadOnly()&&(this._showMruExpander=!1),this._showMruExpander){this._$mruTriangle=$("<span>").addClass(t.SEARCH_MRU_TRIANGLE_CLASS).addClass("bowtie-icon bowtie-triangle-down").appendTo(this._element);this._$mruTriangle.on("mousedown.identityPicker",ut(this,function(n){i._onMruTriangleMousedown(n)}));this._$mruTriangle.on("click.identityPicker",ut(this,function(n){i._onMruTriangleClick(n)}))}this._recalculateInputWidth();$(window).on("resize.identityPicker",ut(this,function(){i._recalculateInputWidth()}));this._$input.on("focus.identityPicker",ut(this,function(){i._$currentlyFocusedItem=null;i._options.multiIdentitySearch&&(i._selectedItems.length||i._unresolvedItems.length?u.text(d.format(p.IdentityPicker_SelectedIdentities,i._selectedItems.length+i._unresolvedItems.length)):u&&u.text(""));i._$container.triggerHandler("focus")}));if(this._options.showMruOnClick&&this._options.showMru)this._$input.on("mouseup.identityPicker",ut(this,function(n){i._identityPickerDropdown&&!i._identityPickerDropdown.isVisible()&&n.button===0&&i._showAllMruInDropdown(!1,!0)}));if(this._options.multiIdentitySearch&&(this._options.highlightResolved=!1,this._options.watermark=null),this._options.highlightResolved||(this._options.watermark=null),this._options.watermark&&this._showWatermark(),this._options.getFilterByScope||(this._options.getFilterByScope=function(){return null}),this._showContactCard=this._options.showContactCard==!1?!1:!0,a.ServiceHelpers.isAuthenticatedMember()){this._element.on("keydown.identityPicker",ut(this,this._onInputKeyDown));this._$input.on("keyup.identityPicker",ut(this,this._onInputKeyUp));this._$input.on("blur.identityPicker",ut(this,this._onInputBlur));this._$input.on("input.identityPicker",ut(this,this._onInputChange));this._$input.on("click.identityPicker",ut(this,this._onInputClick));this._externalEventDelegate=ut(this,this._onInputBlur);this._dropdownShowEventDelegate=ut(this,this._attachHandlersOnShowDropdown);this._dropdownHideEventDelegate=ut(this,this._detachHandlersOnHideDropdown);this._updateActiveDescendantIdEventDelegate=ut(this,this._updateActiveDescendantId);s=this._dropdownContainerDelegate();this._identityPickerDropdownUniqueId=ft.getRandomString();h.getService().attachEvent(lt.SHOW_DROPDOWN_EVENT_INTERNAL,this._dropdownShowEventDelegate);h.getService().attachEvent(lt.HIDE_DROPDOWN_EVENT_INTERNAL,this._dropdownHideEventDelegate);h.getService().attachEvent(lt.UPDATE_ACTIVE_DESCENDANT_ID,this._updateActiveDescendantIdEventDelegate);c={pageSize:this._options.pageSize,useRemainingSpace:this._options.useRemainingSpace,smallScreenRender:this._options.smallScreenRender,dialogAppendTo:this._options.dialogAppendTo,onItemSelect:ut(this,function(n){if(i._resolveItem(n),i.focusOnSearchInput(),i._options.callbacks&&i._options.callbacks.onItemSelect)i._options.callbacks.onItemSelect(n)}),identityType:this._identityType,operationScope:this._operationScope,httpClient:this._options.httpClient?this._options.httpClient:null,showContactCard:this._showContactCard,showMru:this._isShowMruEnabledInDropdown(),showNoIdentitiesFound:this._options.showNoIdentitiesFound,getFilterByScope:this._options.getFilterByScope,preDropdownRender:this._preDropdownRender,onDirectorySearchFinished:this._onDirectorySearchFinished,loadOnCreate:this._loadOnCreate,extensionData:this._options.extensionData,size:this._options.dropdownSize!==null&&this._options.dropdownSize!==undefined?this._options.dropdownSize:st.Large,width:this._options.dropdownWidth,focusElementOnContactCardClose:this._$input,eventOptions:{uniqueId:this._identityPickerDropdownUniqueId},alignment:{positioningElement:this._$container},consumerId:this._options.consumerId};this._identityPickerDropdown=o.create(lt,s,c);this._attachHandlersOnShowDropdown({uniqueId:this._identityPickerDropdownUniqueId})}else this._showContactCard=!1,this._loadOnCreate=!1,this._options.showMru=!1,this._options.forceOpen=!1,this.enableReadOnlyMode();r&&((typeof r=="string"||r instanceof String)&&r?this.setEntities([],r.trim().split(";")):r instanceof Array&&r.length>0&&this.setEntities(r,[]));this._loadOnCreate&&this.load();this._options.forceOpen&&this._showAllMruInDropdownWithoutDefaultSelection();$(this._onDocumentLoad)},t.prototype.load=function(){var n=this;return this._controlLoaded?this._controlLoaded.promise:(this._controlLoaded=it.defer(),this._identityPickerDropdown.load().then(ut(this,function(){n._controlLoaded.resolve(!0)}),ut(this,function(){n._controlLoaded.resolve(!1)})))},t.prototype.getIdentitySearchResult=function(){return{resolvedEntities:this._selectedItems,unresolvedQueryTokens:this._unresolvedItems}},t.prototype.clear=function(){this._element&&(this._clearSearchControl(),!this._options.multiIdentitySearch&&this._options.watermark&&this._showWatermark())},t.prototype.isDropdownVisible=function(){return this._identityPickerDropdown&&this._identityPickerDropdown.isVisible()},t.prototype.isDropdownFiltered=function(){return this._identityPickerDropdown&&this._identityPickerDropdown.isFiltered()},t.prototype.addIdentitiesToMru=function(n){if(a.ServiceHelpers.isAuthenticatedMember()){var t=n.map(function(n){if(et.isDirectoryEntityType(n))return n.localId});this._identityPickerDropdown.addIdentitiesToMru(t)}},t.prototype.setEntities=function(n,t,i){var o=n?n.length:0,s=t?t.length:0,l,a,u,e,r,h,c,f;if(o+s!=0){if(!this._options.multiIdentitySearch&&o+s>1){l={source:"setEntities",message:"Can't set more than one entity for a single select control"};throw l;}if(a={UID:!0},s>0){if(u="",this._options.multiIdentitySearch||(u=t[0]?t[0].trim():u),this._options.showTemporaryDisplayName){this._options.watermark&&$(".identity-picker-resolved:has(> .identity-picker-watermark-name)",this._element).off(".identityPicker").remove();e=[];for(f in t)r=t[f].trim(),r.charAt(r.length-1)==">"&&r.indexOf("<")>=0?(h=r.substring(0,r.indexOf("<")-1).trim(),c=r.substring(r.indexOf("<")+1,r.length-1).trim(),e.push(c),this._createTemporaryItem(h,c.toLowerCase()),this._options.multiIdentitySearch||(u=h)):e.push(r);t=e}this._resolveInputToIdentities(t.join(";"),a,i,u)}if(o>0)for(f in n)n[f]&&this._resolveItem(n[f])}},t.prototype.getDropdownPrefix=function(){return this._identityPickerDropdown?this._identityPickerDropdown.getPrefix():""},t.prototype.showMruDropdown=function(){this._showMruExpander&&this._$mruTriangle.trigger("click")},t.prototype.focusOnSearchInput=function(){if(this._$currentlyFocusedItem=null,this._$input.is(":visible"))this._$input.focus();else{var n=$(".identity-picker-resolved:visible",this._element);n.length<=0?(this._$input.show(),this._$input.focus()):($(n[0]).focus(),this._$currentlyFocusedItem=$(n[0]))}this._$container.triggerHandler("focus")},t.prototype.enableReadOnlyMode=function(){this._readOnlyMode=!0;this._showMruExpander=!1;this._hideMruTriangle();this._$container.addClass("identity-picker-readonly");$(".identity-picker-resolved-name",this._element).removeAttr("tabindex");$(".identity-picker-watermark-name",this._element).removeAttr("tabindex");$(".identity-picker-resolved-close",this._element).hide();$(".identity-picker-resolved-name",this._element).attr("aria-label",d.format(p.ReadOnlyPrefix,this._options.ariaLabel?this._options.ariaLabel:this._placeholderText));this._element.removeAttr("aria-label");var n=$(".identity-picker-resolved",this._element);n.removeAttr("aria-describedby");n.attr("tabindex","-1");n.attr("aria-disabled","true");$("visually-hidden",n).remove();this._$input.attr("disabled","");this._$input.removeAttr("role");this._$input.removeAttr("aria-expanded")},t.prototype.disableReadOnlyMode=function(){this._readOnlyMode=!1;this._showMruExpander=this._options.showMruTriangle?!0:!1;this._showMruTriangle();this._$container.removeClass("identity-picker-readonly");this._element.attr("aria-label",this._options.ariaLabel?this._options.ariaLabel:this._placeholderText);$(".identity-picker-watermark-name",this._element).attr("tabindex","0");var t=$(".identity-picker-resolved",this._element),n=$(".identity-picker-resolved-name",this._element);n.length&&(this._options.highlightResolved&&n.attr("tabindex","0"),n.removeAttr("aria-label"),this._element.find(".identity-picker-resolved-close").show(),this._showContactCard&&!this._options.highlightResolved&&t.attr("aria-haspopup","true"));this._$input.removeAttr("disabled");this._$input.attr("role","combobox");this._$input.attr("aria-expanded","false");this._options.highlightResolved||t.attr("tabindex","0");this._setResolvedItemRole(t,n.text())},t.prototype.hasPendingRequests=function(){return this._queryTokensRequested&&Object.keys(this._queryTokensRequested).length>0},t.prototype.dispose=function(){this._detachHandlersOnHideDropdown({uniqueId:this._identityPickerDropdownUniqueId});this._dropdownShowEventDelegate&&h.getService().detachEvent(lt.SHOW_DROPDOWN_EVENT_INTERNAL,this._dropdownShowEventDelegate);this._dropdownHideEventDelegate&&h.getService().detachEvent(lt.HIDE_DROPDOWN_EVENT_INTERNAL,this._dropdownHideEventDelegate);this._updateActiveDescendantIdEventDelegate&&h.getService().detachEvent(lt.UPDATE_ACTIVE_DESCENDANT_ID,this._updateActiveDescendantIdEventDelegate);this._identityPickerDropdown&&this._identityPickerDropdown.dispose();this._$input&&this._$input.off(".identityPicker");this._showMruExpander&&this._$mruTriangle&&this._$mruTriangle.off(".identityPicker");this._element&&this._element.off(".identityPicker");$(window).off("resize.identityPicker");n.prototype.dispose.call(this)},t.prototype._getEntityOperationsFacade=function(){return this._entityOperationsFacade||(this._entityOperationsFacade=w.getService(yt)),this._entityOperationsFacade},t.prototype._isReadOnly=function(){return this._readOnlyMode||!a.ServiceHelpers.isAuthenticatedMember()},t.prototype._hideMruTriangle=function(){this._$mruTriangle&&this._$mruTriangle.addClass("identity-picker-element-hide")},t.prototype._showMruTriangle=function(){this._showMruExpander&&this._$mruTriangle&&this._$mruTriangle.removeClass("identity-picker-element-hide")},t.prototype._getAriaDescribedby=function(n){var t=this._$input.attr("aria-describedby");return t?t.concat(" "+n):n},t.prototype._resetSearchControl=function(n,t){n===void 0&&(n=!0);t===void 0&&(t=!0);this._options.watermark&&!this._options.forceOpen?n?this._showWatermark():this._clearWatermark():(this._$input.show(),this._recalculateInputWidth());this._showMruTriangle();t&&this.focusOnSearchInput()},t.prototype._clearSearchControl=function(){$(".identity-picker-resolved",this._element).off(".identityPicker").remove();this._queryTokensRequested={};this._options.multiIdentitySearch||this._resetSearchControl(!1,!1);this._selectedItems=[];this._unresolvedItems=[];this._$currentlyFocusedItem=null;this._resolvedIEntity=null;this._setInputText("");this._fireInvalidInput()},t.prototype._showAllMruInDropdownWithoutDefaultSelection=function(n){n===void 0&&(n=!0);this._showAllMruInDropdown(n,!1)},t.prototype._showAllMruInDropdown=function(n,t){var i=this,r;n===void 0&&(n=!0);t===void 0&&(t=!0);r=function(t){i._element&&((t&&t.length>0||n)&&i._showDropdown(),i._$input.off("input.identityPicker"),i.focusOnSearchInput(),k.delay(i,0,function(){i._$input.on("input.identityPicker",ut(i,i._onInputChange))}))};this._isSearchEverIssued=!0;this._identityPickerDropdown.showAllMruIdentities(t).then(r)},t.prototype._showProgressCursor=function(){this._fire(t.SEARCH_STARTED_EVENT,null);$(".identity-picker-input",this._element).css("cursor","progress")},t.prototype._stopProgressCursor=function(){this._fire(t.SEARCH_FINISHED_EVENT,null);$(".identity-picker-input",this._element).css("cursor","text")},t.prototype._fireInvalidInput=function(){this._fire(t.INVALID_INPUT_EVENT,null)},t.prototype._fireValidInput=function(){this._fire(t.VALID_INPUT_EVENT,null)},t.prototype._fireRemoveResolvedInput=function(n){this._fire(t.RESOLVED_INPUT_REMOVED_EVENT,n?!0:null)},t.prototype._updateActiveDescendantId=function(n){n&&n.uniqueId&&this._identityPickerDropdownUniqueId&&this._identityPickerDropdownUniqueId===n.uniqueId&&this._$input.attr("aria-activedescendant",n.activeDescendantId)},t.prototype._isShowMruEnabledInDropdown=function(){return this._options.showMru||this._showMruExpander},t.prototype._attachHandlersOnShowDropdown=function(n){if(n&&n.uniqueId&&this._identityPickerDropdownUniqueId&&this._identityPickerDropdownUniqueId===n.uniqueId){if(this._element)this._element.parents().on("scroll.identityPicker resize.identityPicker",ut(this,this._onInputBlur));this.isDropdownVisible()&&(this._$input.attr("aria-expanded","true"),this._$input.attr("aria-owns",this._identityPickerDropdown.getItemsListId()));h.getService().attachEvent(t.DIALOG_MOVE_EVENT,this._externalEventDelegate)}},t.prototype._detachHandlersOnHideDropdown=function(n){n&&n.uniqueId&&this._identityPickerDropdownUniqueId&&this._identityPickerDropdownUniqueId===n.uniqueId&&(this._element&&this._element.parents().off("scroll.identityPicker resize.identityPicker"),this._$input.attr("aria-expanded","false"),this._$input.removeAttr("aria-activedescendant"),h.getService().detachEvent(t.DIALOG_MOVE_EVENT,this._externalEventDelegate))},t.prototype._hideDropdown=function(n){this._identityPickerDropdown&&!this._options.forceOpen&&(this._detachHandlersOnHideDropdown({uniqueId:this._identityPickerDropdownUniqueId}),this._identityPickerDropdown.hide(n),this._$input.removeAttr("aria-activedescendant"))},t.prototype._showDropdown=function(){this._attachHandlersOnShowDropdown({uniqueId:this._identityPickerDropdownUniqueId});this._identityPickerDropdown.show()},t.prototype._compareInputOnInputChangeEvent=function(n){return n=n?n:"",this._previousInput==n},t.prototype._setInputText=function(n){n=n?n:"";this._$input.val(n);this._previousInput=n;this._options.smallScreenRender&&n&&this._$closeInput.show()},t.prototype._resetPreviousInput=function(){this._previousInput=""},t.prototype._onInputChange=function(n){var i=this,t;this._delaySearchTimer||(t=function(){i._inputChangeActions(n)},this._delaySearchTimer=new k.DelayedFunction(this,this._delaySearchTimeOutValue,"inputFieldChanged",t));this._delaySearchTimer.reset()},t.prototype._inputChangeActions=function(n){var t=this.getInputText(),i,r,u,f;if(this._options.smallScreenRender&&(t?this._$closeInput.show():this._$closeInput.hide()),this._compareInputOnInputChangeEvent(t))return!0;if(t=t?t:"",this._previousInput=t,this._resolvedIEntity=null,this._recalculateInputWidth(),t&&t.indexOf(";")<=0?this._fireInvalidInput():this._fireInputValidityEvent(),!t||!this._options.multiIdentitySearch||t.indexOf(";")<0){if(this._isSearchEverIssued=!0,t&&!this._options.multiIdentitySearch){i=t.split(";");r="";for(u in i)if(f=i[u]?i[u].trim():"",f){r=f;break}t=r}return this._identityPickerDropdown.getIdentities(t),!0}this._resolveInputToIdentities(this.getInputText());n.stopPropagation()},t.prototype._onInputClick=function(n){var t=this.getInputText();t&&(this._isSearchEverIssued?this._showDropdown(n):this._options.showMru&&this._showAllMruInDropdown(!1))},t.prototype._onMruTriangleMousedown=function(n){n.preventDefault();n.stopPropagation()},t.prototype._onMruTriangleClick=function(n){if(this._isReadOnly())return!1;this.isDropdownVisible()?this._hideDropdown(n):this._showAllMruInDropdownWithoutDefaultSelection();this.focusOnSearchInput();n.stopPropagation()},t.prototype._isDropdownHovered=function(){return this._identityPickerDropdown.getElement()&&$(this._identityPickerDropdown.getElement()).filter(":hover").length>0},t.prototype._isContactCardHovered=function(){return $(".idcard-dialog").length>0&&$(".idcard-dialog").filter(":hover").length>0},t.prototype._onInputBlur=function(n){if(this._identityPickerDropdown&&!this._isDropdownHovered()&&!($(".idcard-dialog").length||$(".idcard-dialog-content").length)&&this._$input.is(":visible")){var t=!1;this._trackTabKeyDown&&(this.isDropdownVisible()&&this._identityPickerDropdown.getSelectedItem()&&(this._resolveSelectedItem(!0),t=!0),this._trackTabKeyDown=!1);this._options.highlightResolved&&!t&&(this._resolvedIEntity?this._resolveItem(this._resolvedIEntity):this._options.watermark&&!this.getInputText()&&(this._showWatermark(),this._showMruTriangle()));this.isDropdownVisible()&&this._hideDropdown(n);this._options.callbacks&&this._options.callbacks.onInputBlur&&this._options.callbacks.onInputBlur()}},t.prototype._focusOnResolvedItem=function(n){n.is(":visible")?(n.focus(),this._$container.triggerHandler("focus")):this.focusOnSearchInput()},t.prototype._onInputKeyDown=function(n){var i,t;if(!n||this._isReadOnly())return!0;if(n.keyCode===ot.ESCAPE&&this.isDropdownVisible()&&n.stopPropagation(),n.keyCode===ot.UP)return this.isDropdownVisible()&&this._identityPickerDropdown.handleKeyEvent(n),n.preventDefault(),!0;if(n.keyCode===ot.DOWN)return this._identityPickerDropdown&&(this._identityPickerDropdown.isVisible()?this._identityPickerDropdown.handleKeyEvent(n):this._isShowMruEnabledInDropdown()?this._showAllMruInDropdown():this._showDropdown(n)),n.preventDefault(),!0;if(n.keyCode===ot.TAB)return this._trackTabKeyDown=!0,!0;if(n.keyCode===ot.ENTER)return this.isDropdownVisible()?(this.focusOnSearchInput(),this._resolveSelectedItem(),!1):this._options.multiIdentitySearch&&this._$currentlyFocusedItem?(this._$currentlyFocusedItem.click(),!1):!0;if(n.keyCode===ot.RIGHT&&this._showContactCard&&this.isDropdownVisible()&&this._identityPickerDropdown.getSelectedItem()&&this._$input[0].selectionEnd==this._$input.val().length||n.keyCode===ot.DELETE&&this._isShowMruEnabledInDropdown()&&this.isDropdownVisible()&&(i=this._identityPickerDropdown.getSelectedItem(),i&&i.isMru&&et.isDirectoryEntityType(i)))return this._identityPickerDropdown.handleKeyEvent(n),n.preventDefault(),!1;if(!this._$currentlyFocusedItem&&this._$input[0]===document.activeElement&&this._$input[0].selectionStart>0)return!0;if(this._options.callbacks&&this._options.callbacks.onKeyPress)this._options.callbacks.onKeyPress(n.keyCode);switch(n.keyCode){case ot.LEFT:return this._options.multiIdentitySearch?this._$currentlyFocusedItem&&this._$currentlyFocusedItem.prev(".identity-picker-resolved")[0]?(this._$currentlyFocusedItem.blur(),this._$currentlyFocusedItem=this._$currentlyFocusedItem.prev(".identity-picker-resolved"),this._focusOnResolvedItem(this._$currentlyFocusedItem),!1):!this._$currentlyFocusedItem&&(this._selectedItems&&this._selectedItems.length>0||this._unresolvedItems&&this._unresolvedItems.length>0)&&this._$input[0]===document.activeElement&&!this._$input[0].selectionStart?(this._$currentlyFocusedItem=this._$input.prev(".identity-picker-resolved"),this._focusOnResolvedItem(this._$currentlyFocusedItem),!1):!0:!0;case ot.RIGHT:return this._options.multiIdentitySearch?this._$currentlyFocusedItem?(this._$currentlyFocusedItem.blur(),this._$currentlyFocusedItem.next(".identity-picker-resolved")[0]?(this._$currentlyFocusedItem=this._$currentlyFocusedItem.next(".identity-picker-resolved"),this._focusOnResolvedItem(this._$currentlyFocusedItem)):this.focusOnSearchInput(),!1):!0:!0;case ot.BACKSPACE:return this._options.multiIdentitySearch?this._$currentlyFocusedItem?(t=this._$currentlyFocusedItem,this._$currentlyFocusedItem.prev(".identity-picker-resolved")[0]?(this._$currentlyFocusedItem=this._$currentlyFocusedItem.prev(".identity-picker-resolved"),this._focusOnResolvedItem(this._$currentlyFocusedItem)):this._$currentlyFocusedItem.next(".identity-picker-resolved")[0]?(this._$currentlyFocusedItem=this._$currentlyFocusedItem.next(".identity-picker-resolved"),this._focusOnResolvedItem(this._$currentlyFocusedItem)):this.focusOnSearchInput(),this._removeFromResolved(t.attr("data-signin")),this._removeFromUnresolved(t.attr("data-signin")),t.off(".identityPicker").remove(),this._recalculateInputWidth(),!1):(this._selectedItems&&this._selectedItems.length>0||this._unresolvedItems&&this._unresolvedItems.length>0)&&this._$input[0]===document.activeElement&&!this._$input[0].selectionStart?(this._removeFromResolved(this._$input.prev(".identity-picker-resolved").attr("data-signin")),this._removeFromUnresolved(this._$input.prev(".identity-picker-resolved").attr("data-signin")),this._$input.prev(".identity-picker-resolved").off(".identityPicker").remove(),this._recalculateInputWidth(),!1):!0:this._selectedItems&&this._selectedItems.length>0?(this._removeFromResolved(this._$input.prev(".identity-picker-resolved").attr("data-signin")),this._$input.prev(".identity-picker-resolved").off(".identityPicker").remove(),this._resetSearchControl(),!1):!0;case ot.DELETE:return this._options.multiIdentitySearch?this._$currentlyFocusedItem?(t=this._$currentlyFocusedItem,this._$currentlyFocusedItem.next(".identity-picker-resolved")[0]?(this._$currentlyFocusedItem=this._$currentlyFocusedItem.next(".identity-picker-resolved"),this._focusOnResolvedItem(this._$currentlyFocusedItem)):this.focusOnSearchInput(),this._removeFromResolved(t.attr("data-signin")),this._removeFromUnresolved(t.attr("data-signin")),t.off(".identityPicker").remove(),this._recalculateInputWidth(),!1):!0:this._selectedItems&&this._selectedItems.length>0?(this._removeFromResolved(this._$input.prev(".identity-picker-resolved").attr("data-signin")),this._$input.prev(".identity-picker-resolved").off(".identityPicker").remove(),this._resetSearchControl(),!1):!0;case ot.SPACE:return this._options.multiIdentitySearch&&this._$currentlyFocusedItem?(this._$currentlyFocusedItem.click(),!1):!0;default:return!0}},t.prototype._fireInputValidityEvent=function(){!this.getInputText().length&&this._selectedItems&&this._selectedItems.length>0&&(!this._unresolvedItems||!this._unresolvedItems.length)?this._fireValidInput():this._fireInvalidInput()},t.prototype._resolveSelectedItem=function(n){if(n===void 0&&(n=!1),this.isDropdownVisible()){var t=this._identityPickerDropdown.getSelectedItem();if(t&&(this._resolveItem(t,!0,null,n),this._options.callbacks&&this._options.callbacks.onItemSelect))this._options.callbacks.onItemSelect(t)}},t.prototype._onInputKeyUp=function(n){return n&&n.keyCode!==ot.DOWN&&n.keyCode!==ot.UP&&n.keyCode!==ot.RIGHT&&this._identityPickerDropdown&&this._identityPickerDropdown.handleKeyEvent(n),!0},t.prototype._removeFromUnresolved=function(n){for(var i=this._getSearchPrefix(n).toLowerCase(),t=this._unresolvedItems.indexOf(i);t>=0;)this._unresolvedItems.splice(t,1),t=this._unresolvedItems.indexOf(i);this._fireInputValidityEvent()},t.prototype._removeFromResolved=function(n,t){function r(t){var i=et.getUniqueIdentifierForDisambiguation(t);return i.toLowerCase()===n.toLowerCase()?($(".idcard-dialog").each(function(){if($(this).is(":visible")&&$(this).attr("data-prefix")&&n.toLowerCase().indexOf($(this).attr("data-prefix").toLowerCase())===0)return $(".ui-dialog-content",$(this)).dialog("close"),!1}),!1):!0}var i=this._selectedItems.filter(r);i.length!=this._selectedItems.length&&(this._selectedItems=i,this._fireInputValidityEvent(),this._fireRemoveResolvedInput(t))},t.prototype.getInputText=function(){return this._$input.val().trim()},t.prototype._resolveInputToIdentities=function(n,i,r,u){var f=this,b=function(n){if(f._element){if(!n||!n.queryToken||!n.identities){v();return}if(n.identities.length!=1)if(i&&i.UID){var e=d.htmlEncode(n.queryToken),r={entityId:t.INACTIVE_ENTITY_ID_PREFIX+"_"+e,entityType:t.INACTIVE_ENTITY_TYPE,originDirectory:ft.VisualStudioDirectory,originId:t.INACTIVE_ORIGIN_ID_PREFIX+"_"+e,isMru:!1,active:!1,displayName:u?u:n.queryToken,signInAddress:n.queryToken,samAccountName:ft.isOnPremiseEnvironment()&&n.queryToken.indexOf("\\")>=0?n.queryToken.split("\\",2)[1]:"",scopeName:ft.isOnPremiseEnvironment()&&n.queryToken.indexOf("\\")>=0?n.queryToken.split("\\",1)[0]:""};r.image=a.ServiceHelpers.getDefaultIdentityImage(r);f._resolveItem(r,!1,n.queryToken)}else f._fireInvalidInput();else n.queryToken.toLowerCase().trim()in f._queryTokensRequested&&f._resolveItem(n.identities[0],!1,n.queryToken);f._hideDropdown();f._stopProgressCursor()}},v=function(n){f._element&&(f._stopProgressCursor(),f._fireValidInput());n&&s.logError("_resolveInputToIdentities/getIdentitiesErrorCallback:"+JSON.stringify(n))},p=n.split(a.ServiceHelpers.GetIdentities_Prefix_Separator),o=[],y,h,w,k,e,g,nt,c;for(h in p)y=p[h]?p[h].trim():"",y.length>0&&(o.push(y),this._unresolveItem(y));this._options.multiIdentitySearch||(this._queryTokensRequested={});for(h in o)this._queryTokensRequested[o[h].toLowerCase().trim()]=!0;if(w=o.length,w)for(this._showProgressCursor(),k=function(){var n=o.slice(50*c,50*c+50);g={identityServiceOptions:{operationScope:r?r:e._operationScope,identityType:e._identityType,httpClient:e._options.httpClient,extensionData:e._options.extensionData},identityExtensionOptions:{consumerId:e._options?e._options.consumerId:l.ConsumerId.UnknownConsumer},prefix:n.join(";"),queryTypeHint:i,sources:[ct.Directory],filterByScope:e._options.getFilterByScope()};nt=e._getEntityOperationsFacade().search(g).then(function(t){if(f._options.retainInputIdentitiesSequenceWithinPage)f._resolveIdentityResponseInSequence(t,n,b,v);else for(var i in t.queryTokenResponse)t.queryTokenResponse[i].then(b,v)},v)},e=this,c=0;c<=w/50;c++)k()},t.prototype._resolveIdentityResponseInSequence=function(n,i,r,u){var o=this,f=[];for(var e in n.queryTokenResponse)n.queryTokenResponse.hasOwnProperty(e)&&f.push(n.queryTokenResponse[e]);it.allSettled(f).then(function(n){for(var a,e,v,k,f,s,y,d,p=[],w=[],c=0,b=n;c<b.length;c++)f=b[c],f.state===l.PromiseResultStatus.Fulfilled?p.push(f.value):f.state===l.PromiseResultStatus.Rejected&&w.push(f.reason);for(a={},p.forEach(function(n){return a[n.queryToken]=n}),e=0,v=i;e<v.length;e++)k=v[e],f=a[k],f&&r(f);for(s=0,y=w;s<y.length;s++)d=y[s],u(d);h.getService().fire(t.SEQUENCED_IDENTITIES_IN_PAGE_RESOLVED_EVENT_INTERNAL,o)},u)},t.prototype._replaceAndCleanup=function(n){for(var i=!1,t=new RegExp("(( *;+ *)+|^ *)("+n.replace(/[.^$*+?()[{\\|\]-]/g,"\\$&")+")(( *;+ *)+| *$)","gi");this.getInputText().search(t)>=0;)this._setInputText(this.getInputText().replace(t,";")),i=!0;return t=new RegExp("^( *;+ *)+$"),this.getInputText().search(t)||this._setInputText(""),i},t.prototype._findInSelectedItems=function(n){var i=-1,t,r;if(!n)return i;for(t=0,r=this._selectedItems.length;t<r;t++)if(this._selectedItems[t].entityId===n.entityId){i=t;break}return i},t.prototype._showIdCardDialog=function(n){if(this._showContactCard&&a.ServiceHelpers.isAuthenticatedMember()){var t={identity:n.identity,anchor:n.anchor,leftValue:n.leftValue,topValue:n.topValue,operationScope:this._operationScope,identityType:this._identityType,httpClient:this._options.httpClient?this._options.httpClient:null,consumerId:this._options.consumerId,appendTo:this._options.dialogAppendTo,useOfficeFabricProfileCard:this._options.useOfficeFabricProfileCard};o.Enhancement.enhance(wt,"<div/>",t)}},t.prototype._clearWatermark=function(){this.isDropdownVisible()&&this._hideDropdown();!this._options.forceOpen&&this._identityPickerDropdown&&this._identityPickerDropdown.reset();this._$input.hide();this._options.smallScreenRender&&this._$closeInput.hide();this._setInputText("")},t.prototype._showWatermark=function(){var n=this,l=this._isControlInFocus(),r,i,f,o,s,h,u,e,c;this._controlWidth=Math.max(this._$container.width(),t.DEFAULT_WIDTH);this._clearWatermark();r=this._options.watermark;i=$("<span>").addClass("identity-picker-resolved").addClass("identity-picker-resolved-single-search");i.attr("tabindex","-1");i.blur(ut(this,function(t){n._identityPickerDropdown&&!n._isDropdownHovered()&&!n._isContactCardHovered()&&i.is(":visible")&&(n.isDropdownVisible()&&n._hideDropdown(t),n._options.callbacks&&n._options.callbacks.onInputBlur&&n._options.callbacks.onInputBlur())}));ft.styleElementBySize(i,this._size,!0);this._options.smallScreenRender?f=$("<span>").addClass("icon identity-picker-text-search-icon bowtie-icon bowtie-search"):(s=a.ServiceHelpers.getDefaultIdentityImage(r),r.image&&(o=r.image),f=ft.createImgElement(s,o,"user-picture-resolved",r.entityId));ft.styleElementBySize(f,this._size,!1);h=et.getDisplayName(r);u=$("<span>").addClass("identity-picker-watermark-name").addClass("text-cursor").text(h);i.append(f).append(u).insertBefore(this._$input);i.width(this._controlWidth-t.OUTER_PADDING_PX-(this._showMruExpander?t.TRIANGLE_WIDTH_PX:0));u.attr("tabindex","0");e=function(t){t.stopPropagation();i.off(".identityPicker").remove();n._$input.show();n._showMruTriangle();n._recalculateInputWidth();n.focusOnSearchInput();n._setInputText("")};u.on("focus.identityPicker",ut(this,function(t){if(n._isReadOnly())return!1;e(t)}));i.on("mousedown.identityPicker",ut(this,function(t){if(n._isReadOnly())return!1;t.preventDefault();e(t);n._showAllMruInDropdown(!1)}));l&&this.focusOnSearchInput();this._options.callbacks&&this._options.callbacks.getCustomTooltip&&(c=ft.createTooltip(r,this._options.callbacks.getCustomTooltip()),rt.RichContentTooltip.add(c,u,{showOnFocus:!this._options.smallScreenRender}))},t.prototype._createTemporaryItem=function(n,t){var i=$("<span>").addClass("identity-picker-resolved identity-picker-temp").attr("data-signin",ft.replaceBackslash(t)).attr("tabindex","-1"),u,r;ft.styleElementBySize(i,this._size,!0);u=ft.createImgElement(a.ServiceHelpers.DefaultUserImage,"","user-picture-resolved");ft.styleElementBySize(u,this._size,!1);r=$("<span>").addClass("identity-picker-resolved-name").text(n);this._options.multiIdentitySearch?(i.addClass("identity-picker-resolved-bg"),r.addClass("identity-picker-search-multiple-name").css("max-width",this._getItemNameContainerMaxWidth([]))):(i.addClass("identity-picker-resolved-single-search"),this._options.highlightResolved||(i.attr("tabindex","0"),i.addClass("identity-picker-resolved-single-bg")),$(".identity-picker-resolved",this._element).off(".identityPicker").remove());this._options.highlightResolved&&r.addClass("text-cursor");i.append(u).append(r).insertBefore(this._$input);this._options.multiIdentitySearch?this._recalculateInputWidth():(this._$input.hide(),this._options.smallScreenRender&&this._$closeInput.hide());this._isControlInFocus()&&this.focusOnSearchInput();this._options.callbacks&&this._options.callbacks.getCustomTooltip&&rt.RichContentTooltip.add(n,r,{showOnFocus:!this._options.smallScreenRender})},t.prototype._isControlInFocus=function(){var n=$(document.activeElement);return n.length>0&&(this._element.is(n[0])||this._element.has(n[0]).length>0)},t.prototype._createResolvedItem=function(n){var t=$("<span>").addClass("identity-picker-resolved").attr("data-signin",ft.replaceBackslash(n));return this._isReadOnly()||t.attr("tabindex","-1"),this._options.multiIdentitySearch?t.addClass("identity-picker-resolved-bg"):(t.addClass("identity-picker-resolved-single-search"),this._showMruExpander&&this._options.highlightResolved&&t.addClass("identity-picker-drop-icon-padding"),this._options.highlightResolved||(t.attr("tabindex","0"),!this._options.ariaDescribedby||t.attr("aria-describedby",this._getAriaDescribedby(this._options.ariaDescribedby)),t.addClass("identity-picker-resolved-single-bg"))),t},t.prototype._setResolvedItemRole=function(n,t){n.attr("role","button").attr("aria-disabled","false").attr("aria-label",d.format(p.IdentityPicker_ButtonResolvedItemLabel,d.htmlEncodeJavascriptAttribute(t)));var i=o.getId().toString(),r=$("<div>").attr("id",i).addClass("visually-hidden").appendTo(n);n.attr("aria-describedby",this._getAriaDescribedby(i));this._options.highlightResolved?r.text(p.IdentityPicker_FocusChangeValue):r.text(d.format(p.IdentityPicker_ButtonResolvedItemDescription,d.htmlEncodeJavascriptAttribute(t))+". "+(this._showContactCard&&!this._options.highlightResolved?p.IdentityPicker_EnterSpaceMessage+". ":"")+p.IdentityPicker_DeleteBackspaceMessage)},t.prototype._resolveItem=function(n,i,r,u){var f=this,k,h,l,e,g,nt,v,c,o,s,b,y,w;if(i===void 0&&(i=!0),r===void 0&&(r=null),u===void 0&&(u=!1),this._controlWidth=Math.max(this._$container.width(),t.DEFAULT_WIDTH),n){if(k=this._isControlInFocus(),!this._options.multiIdentitySearch&&this._selectedItems&&this._selectedItems.length>0&&this._clearSearchControl(),this.isDropdownVisible()&&this._hideDropdown(),!this._options.forceOpen&&(this._options.multiIdentitySearch||!this._options.highlightResolved)&&this._identityPickerDropdown&&this._identityPickerDropdown.reset(),this._resetPreviousInput(),i&&this._setInputText(""),h=r?this._getSearchPrefix(r):"",h&&(this._replaceAndCleanup(h.toLowerCase()),this._removeFromUnresolved(h.toLowerCase()),this._element.find('.identity-picker-resolved[data-signin="'+ft.replaceBackslash(h.toLowerCase())+'"][data-unresolved="true"]').off(".identityPicker").remove()),this._options.showTemporaryDisplayName&&(this._options.multiIdentitySearch?this._element.find('.identity-picker-temp[data-signin="'+ft.replaceBackslash(h.toLowerCase())+'"]').remove():$(".identity-picker-temp",this._element).remove()),this._findInSelectedItems(n)!=-1){this._fireInputValidityEvent();return}if(this._selectedItems.push(n),$(".ui-dialog-content",$(".idcard-dialog:visible")).dialog("close"),l=et.getUniqueIdentifierForDisambiguation(n),this._$input.width(10),e=this._createResolvedItem(l.toLowerCase()),ft.styleElementBySize(e,this._size,!0),nt=a.ServiceHelpers.getDefaultIdentityImage(n),n.image&&(g=n.image),v=ft.createImgElement(nt,g,"user-picture-resolved",n.entityId),ft.styleElementBySize(v,this._size,!1),c=et.getDisplayName(n),this._options.smallScreenRender&&this._$closeInput.hide(),o=this._createCloseButton(),this._options.multiIdentitySearch&&o.addClass("identity-picker-resolved-bg"),this._options.highlightResolved||o.addClass("identity-picker-resolved-single-bg"),ft.styleElementBySize(o,this._size,!1),o.click(ut(this,function(n){if(f._removeFromResolved(l.toLowerCase(),!0),e.off(".identityPicker").remove(),f._identityPickerDropdown&&f._identityPickerDropdown.updatePrefix(""),f._resolvedIEntity=null,!f._options.multiIdentitySearch){f._resetSearchControl();return}f._recalculateInputWidth();f.focusOnSearchInput();n.stopPropagation()})),e.append(v).append(o).insertBefore(this._$input),s=$("<span>").addClass("identity-picker-resolved-name").text(c),this._readOnlyMode&&s.attr("aria-label",d.format(p.ReadOnlyPrefix,this._options.ariaLabel?this._options.ariaLabel:this._placeholderText)),this._options.multiIdentitySearch&&s.addClass("identity-picker-search-multiple-name").css("max-width",this._getItemNameContainerMaxWidth([v,o])),this._options.highlightResolved?s.addClass("text-cursor"):et.isDirectoryEntityType(n)&&s.addClass("pointer-cursor"),n.active!==!1||et.isAadGroup(n)||s.addClass("identity-picker-inactive-name"),this._isReadOnly()?o.hide():this._setResolvedItemRole(e,c),e.append(s),this._options.multiIdentitySearch?this._recalculateInputWidth():(this._$input.hide(),this._options.smallScreenRender&&this._$closeInput.hide(),this._showMruExpander&&this._hideMruTriangle(),this._options.watermark&&$(".identity-picker-resolved:has(> .identity-picker-watermark-name)",this._element).off(".identityPicker").remove(),this._options.highlightResolved&&!this._isReadOnly()&&s.attr("tabindex","0")),b=function(t){t.stopPropagation();f._resolvedIEntity=n;f._removeFromResolved(l.toLowerCase());e.off(".identityPicker").remove();f._$input.show();f._showMruTriangle();f._recalculateInputWidth();f.focusOnSearchInput();f._setInputText(c);f._identityPickerDropdown&&f._identityPickerDropdown.updatePrefix(c);f._$input.select()},this._options.highlightResolved)s.on("focus.identityPicker",ut(this,function(n){if(f._isReadOnly())return!1;b(n)}));y=function(t){if($.contains(o[0],t.target)||o[0]===t.target)return!0;if(f._isReadOnly())return!1;if(w)return w=!1,!1;if(w=!0,t.preventDefault(),f._options.highlightResolved)b(t);else if(t.stopPropagation(),et.isDirectoryEntityType(n)){f._showIdCardDialog({anchor:e,identity:n,leftValue:0,consumerId:f._options.consumerId});var i=function(n){n.stopPropagation();e.off("click.identityPicker",i)};e.on("click.identityPicker",i)}f._options.highlightResolved&&f._showAllMruInDropdownWithoutDefaultSelection(!1)};w=!1;e.on("mousedown.identityPicker",ut(this,function(n){y(n)}));e.on("click.identityPicker",ut(this,function(n){y(n)}));if(!this._options.multiIdentitySearch&&!this._options.highlightResolved)e.on("keypress.identityPicker",ut(this,function(n){n&&n.keyCode===ot.ENTER&&y(n)}));e.blur(ut(this,function(n){f._identityPickerDropdown&&!f._isDropdownHovered()&&!f._isContactCardHovered()&&e.is(":visible")&&(f.isDropdownVisible()&&f._hideDropdown(n),f._options.callbacks&&f._options.callbacks.onInputBlur&&f._options.callbacks.onInputBlur())}));this._isReadOnly()||!this._showContactCard||this._options.highlightResolved||e.attr("aria-haspopup","true");this._fireInputValidityEvent();this._$container[0].scrollTop=this._$container[0].scrollHeight;k&&!u&&this.focusOnSearchInput();this._options.highlightResolved&&a.ServiceHelpers.isAuthenticatedMember()&&rt.RichContentTooltip.add(ft.createTooltip(n),s,{showOnFocus:!this._options.smallScreenRender})}},t.prototype._getItemNameContainerMaxWidth=function(n){var t=this._controlWidth-ft.SCROLL_BAR_WIDTH_PX;for(var i in n)n.hasOwnProperty(i)&&(t-=parseInt(n[i].css("width"),10));return t},t.prototype._createCloseButton=function(){var n=$("<span>").addClass("identity-picker-resolved-close-icon bowtie-icon");return n.addClass(this._options.smallScreenRender?"bowtie-edit-remove":"bowtie-edit-delete"),$("<span>").addClass("identity-picker-resolved-close").append(n)},t.prototype._getSearchPrefix=function(n){var t=/^.*[(<{\[]\s*([^\s]+@[^\s]+\.[^\s]+[^)>}\]])\s*[)>}\]]+\s*$/.exec(n);return t&&t[0]===n?t[1]:n},t.prototype._unresolveItem=function(n){var e=this,u,i,s,r,f,h,c;if(this._controlWidth=Math.max(this._$container.width(),t.DEFAULT_WIDTH),this._resetPreviousInput(),n){if(u=this._getSearchPrefix(n),this._unresolvedItems.indexOf(u.toLowerCase())!=-1){this._replaceAndCleanup(n.toLowerCase());return}if(!this._replaceAndCleanup(n.toLowerCase()))return;this._options.showTemporaryDisplayName&&(this._options.multiIdentitySearch?this._element.find('.identity-picker-temp[data-signin="'+ft.replaceBackslash(u.toLowerCase())+'"]').remove():$(".identity-picker-temp",this._element).remove());this._fireInvalidInput();this._unresolvedItems.push(u.toLowerCase());this._$input.width(10);i=this._createResolvedItem(u.toLowerCase()).attr("data-unresolved","true");ft.styleElementBySize(i,this._size,!0);s=$("<span>").addClass("identity-picker-resolved-close-icon bowtie-icon bowtie-edit-delete");s.addClass(this._options.smallScreenRender?"bowtie-edit-remove":"bowtie-edit-delete");r=$("<span>").addClass("identity-picker-resolved-close").append(s);this._options.multiIdentitySearch?r.addClass("identity-picker-resolved-bg"):this._options.highlightResolved||r.addClass("identity-picker-resolved-single-bg");ft.styleElementBySize(r,this._size,!1);r.click(ut(this,function(){e._removeFromUnresolved(n.toLowerCase());i.off(".identityPicker").remove();e._recalculateInputWidth();e.focusOnSearchInput()}));i.append(r).insertBefore(this._$input);f=$("<span>").addClass("identity-picker-unresolved-name").text(d.decodeHtmlSpecialChars(n));this._options.multiIdentitySearch&&f.addClass("identity-picker-search-multiple-name").css("max-width",this._getItemNameContainerMaxWidth([r]));i.attr("role","button").attr("aria-label",d.format(p.IdentityPicker_ButtonUnresolvedItemLabel,n));h=o.getId().toString();c=$("<div>").attr("id",h).addClass("visually-hidden").appendTo(i);c.text(d.format(p.IdentityPicker_ButtonUnresolvedItemDescription,n)+". "+p.IdentityPicker_DeleteBackspaceMessage);i.attr("aria-describedby",h);i.append(f);this._recalculateInputWidth();this.focusOnSearchInput();this._$container[0].scrollTop=this._$container[0].scrollHeight;rt.RichContentTooltip.add(p.IdentityPicker_UnresolvedIdentity+": "+n,f,{showOnFocus:!this._options.smallScreenRender})}},t.prototype._generatePlaceHolder=function(n){return this._isInArray(a.ServiceHelpers.UserEntity,n)&&this._isInArray(a.ServiceHelpers.GroupEntity,n)?p.IdentityPicker_PlaceholderTextUserGroup:this._isInArray(a.ServiceHelpers.UserEntity,n)&&!this._isInArray(a.ServiceHelpers.GroupEntity,n)?p.IdentityPicker_PlaceholderTextUser:!this._isInArray(a.ServiceHelpers.UserEntity,n)&&this._isInArray(a.ServiceHelpers.GroupEntity,n)?p.IdentityPicker_PlaceholderTextGroup:p.IdentityPicker_PlaceholderTextPrefix},t.prototype._isInArray=function(n,t){return t.indexOf(n)>=0},t.INVALID_INPUT_EVENT="identity-picker-search-invalid-input",t.VALID_INPUT_EVENT="identity-picker-search-valid-input",t.RESOLVED_INPUT_REMOVED_EVENT="identity-picker-resolved-input-removed",t.SEARCH_STARTED_EVENT="identity-picker-search-started",t.SEARCH_FINISHED_EVENT="identity-picker-search-finished",t.DIALOG_MOVE_EVENT="dialog-move",t.SEQUENCED_IDENTITIES_IN_PAGE_RESOLVED_EVENT_INTERNAL="identity-picker-sequenced-identities-in-page-resolved-internal",t.SEARCH_MRU_TRIANGLE_CLASS="identity-picker-search-drop-icon",t.DEFAULT_WIDTH=140,t.OUTER_PADDING_PX=2,t.TRIANGLE_WIDTH_PX=19,t.NAME_PADDING_PX=8,t.INACTIVE_ENTITY_TYPE="inactive_entitytype",t.INACTIVE_ENTITY_ID_PREFIX="INACTIVE_ENTITY_ID",t.INACTIVE_ORIGIN_ID_PREFIX="INACTIVE_ORIGIN_ID",t}(o.Control);t.IdentityPickerSearchControl=dt,function(n){n[n.Small=0]="Small";n[n.Medium=1]="Medium";n[n.Large=2]="Large"}(st=t.IdentityPickerControlSize||(t.IdentityPickerControlSize={})),function(n){n[n.AvatarText=0]="AvatarText";n[n.AvatarOnly=1]="AvatarOnly";n[n.TextOnly=2]="TextOnly"}(pt=t.EDisplayControlType||(t.EDisplayControlType={})),function(n){n[n.ExpiredAccessToken=0]="ExpiredAccessToken";n[n.IsGuestUser=1]="IsGuestUser"}(kt||(kt={}));gt=function(n){function t(t){var i=__construct(this,n,[t]);for(var r in i)i.hasOwnProperty(r)&&(this[r]=i[r]);return i._displayedEntity=null,i._identityType=t.identityType?t.identityType:{User:!0},i._operationScope=t.operationScope?t.operationScope:{IMS:!0},i._size=t.size!==null&&t.size!==undefined?t.size:st.Medium,i._turnOffHover=t.turnOffHover?t.turnOffHover:!1,i}return __extends(t,n),t.prototype.initialize=function(){var t,i;if(n.prototype.initialize.call(this),a.ServiceHelpers.isAuthenticatedMember()||(this._turnOffHover=!0),t=this._options.item,!t||(typeof t=="string"||t instanceof String)&&!t.trim()){i={source:"IdentityDisplayControl.initialize()",message:"The item argument to the IdentityDisplayControl cannot be null or empty"};throw i;}this._displayType=this._options.displayType?this._options.displayType:pt.AvatarText;(typeof t=="string"||t instanceof String)&&t?(t=t.trim(),this._displayString(t),this._resolveStringToEntity(t)):this._displayEntity(t,"")},t.prototype.getDisplayedEntity=function(){if(this._displayedEntity)return this._displayedEntity;throw{source:"getResolvedEntity",message:"No resolved entity found."};},t.prototype._getEntityOperationsFacade=function(){return this._entityOperationsFacade||(this._entityOperationsFacade=w.getService(yt)),this._entityOperationsFacade},t.prototype._resolveStringToEntity=function(n){var t=this,r=function(i){if(t._element){if(!i||!i.queryToken||!i.identities)return;if(i.identities.length!=1)return;t._getEntityOperationsFacade().queryTokenEntityImageCache.set(n,i.identities[0].image);t._displayEntity(i.identities[0],n)}},i=function(n){n&&s.logWarning("_resolveStringToEntity/getIdentitiesErrorCallback:"+JSON.stringify(n))},u={identityServiceOptions:{operationScope:this._operationScope,identityType:this._identityType,httpClient:this._options.httpClient,extensionData:this._options.extensionData},identityExtensionOptions:{consumerId:this._options?this._options.consumerId:l.ConsumerId.UnknownConsumer},prefix:n,queryTypeHint:{UID:!0},sources:[ct.Directory]},f=this._getEntityOperationsFacade().search(u).then(function(n){for(var u in n.queryTokenResponse)n.queryTokenResponse[u].then(ut(t,r),ut(t,i))},i)},t.prototype._showIdCardDialog=function(n){a.ServiceHelpers.isAuthenticatedMember()&&o.Enhancement.enhance(wt,"<div/>",{identity:n.identity,anchor:n.anchor,leftValue:n.leftValue,operationScope:this._operationScope,identityType:this._identityType,httpClient:this._options.httpClient?this._options.httpClient:null,consumerId:this._options.consumerId,appendTo:this._options.dialogAppendTo})},t.prototype._displayString=function(n){var t=$("<span>").addClass("identity-picker-display").attr("data-item",n).attr("tabindex","-1"),i,r,u,f;this._turnOffHover||rt.RichContentTooltip.add(this._options.friendlyDisplayName?this._options.friendlyDisplayName+" <"+n+">":n,t);ft.styleElementBySize(t,this._size,!0);i=null;this._displayType!=pt.TextOnly&&(r=this._getEntityOperationsFacade().queryTokenEntityImageCache.get(n),u=r?r:a.ServiceHelpers.DefaultUserImage,i=ft.createImgElement(u,"","user-picture-resolved"),ft.styleElementBySize(i,this._size,!1),t.append(i));this._displayType!=pt.AvatarOnly?(f=$("<span>").addClass("identity-picker-resolved-name").text(this._options.friendlyDisplayName?this._options.friendlyDisplayName:n),t.append(f)):i.attr("alt",this._options.friendlyDisplayName?this._options.friendlyDisplayName+" <"+n+">":n);t.appendTo(this._element)},t.prototype._displayEntity=function(n,i){var r=this,f,o,c,h,l,v;if(n){this._displayedEntity=n;var e=et.getDisplayName(this._displayedEntity),y=et.getUniqueIdentifierForDisambiguation(this._displayedEntity),u=$("<span>").addClass("identity-picker-display").attr("data-signin",ft.replaceBackslash(y.toLowerCase())).attr("tabindex","-1");ft.styleElementBySize(u,this._size,!0);f=null;o=null;this._displayType!=pt.TextOnly&&(c=a.ServiceHelpers.getDefaultIdentityImage(this._displayedEntity),f=ft.createImgElement(c,this._displayedEntity.image?this._displayedEntity.image:"","user-picture-resolved",this._displayedEntity.entityId),ft.styleElementBySize(f,this._size,!1),u.append(f));this._displayType!=pt.AvatarOnly?(o=$("<span>").addClass("identity-picker-resolved-name").text(e),$('.identity-picker-display[data-item="'+i+'"]',this._element).remove(),u.append(o)):(h=et.getSignInAddress(this._displayedEntity),f.attr("alt",e!==h?e+" <"+h+">":e));l=function(){var n=$('.idcard-dialog[data-objectid="'+r._displayedEntity.entityId+'"]');n.length&&$(".ui-dialog-content",n).dialog("close")};v=function(){r._hoverIdCardEnterTimer=new k.DelayedFunction(r,t.DEFAULT_HOVER_WAIT_ENTER_INTERVAL,"showDisplayControlContactCard",function(){r._element.parent().length>0&&r._element.is(":visible")&&r._showIdCardDialog({anchor:u,identity:r._displayedEntity,leftValue:0,consumerId:r._options.consumerId})})};!this._turnOffHover&&et.isDirectoryEntityType(this._displayedEntity)&&u.hover(function(){r._hoverIdCardEnterTimer?r._hoverIdCardEnterTimer.reset():(v(),r._hoverIdCardEnterTimer.start())},function(){r._hoverIdCardEnterTimer&&r._hoverIdCardEnterTimer.cancel();var n=$('.idcard-dialog[data-objectid="'+r._displayedEntity.entityId+'"]'),i=function(){r._hoverIdCardExitTimer?r._hoverIdCardExitTimer.reset():(r._hoverIdCardExitTimer=new k.DelayedFunction(r,t.DEFAULT_HOVER_WAIT_EXIT_INTERVAL,"closeDisplayControlContactCard",l),r._hoverIdCardExitTimer.start())};n&&n.length&&n.mouseenter(function(){r._hoverIdCardExitTimer.cancel();n.mouseleave(function(){i()})});i()});this._element.empty();u.appendTo(this._element)}},t.DEFAULT_HOVER_WAIT_ENTER_INTERVAL=800,t.DEFAULT_HOVER_WAIT_EXIT_INTERVAL=200,t.MIN_WIDTH=100,t.OUTER_PADDING_PX=2,t}(o.Control);t.IdentityDisplayControl=gt;ft=function(){function n(){}return n.styleElementBySize=function(n,t,i){i===void 0&&(i=!0);switch(t){case st.Small:i?n.addClass("element-height-small"):n.addClass("element-2d-small");n.hasClass("identity-picker-resolved-single-search")&&n.addClass("element-height-small-compensate-padding");break;case st.Medium:i?n.addClass("element-height-medium"):n.addClass("element-2d-medium");n.hasClass("identity-picker-resolved-single-search")&&n.addClass("element-height-medium-compensate-padding");break;case st.Large:i?n.addClass("element-height-large"):n.addClass("element-2d-large");n.hasClass("identity-picker-resolved-single-search")&&n.addClass("element-height-large-compensate-padding")}},n.createImgElement=function(n,t,i,r){t===void 0&&(t="");i===void 0&&(i="");r===void 0&&(r="");var u=$("<img>").css("background","url('".concat(n,"') no-repeat")).css("background-size","100%").attr("src",t?t:n).attr("alt","").attr("draggable","false").on("dragstart",function(){return!1});u.on("error",function(){u.attr("src")&&u.attr("src")===n?(u.off("error"),u.css("background-color","#7d7d7d").css("background-size","100%")):u.attr("src",n)});return u.load(function(){u.attr("src")&&u.attr("src")!==n&&u.css("background-image","none")}),i&&u.addClass(i),r&&u.attr("data-objectid",r),u},n.getRandomString=function(){return Math.random().toString(36).substring(5)},n.getSizePx=function(n){switch(n){case st.Small:return 16;case st.Medium:return 24;case st.Large:return 32}},n.isValidEmail=function(n){var t=n.split("@");return t.length===2&&t[0].length>=1&&t[1].length>=1?!0:!1},n.isOnPremiseEnvironment=function(){return!e.getPageContext().webAccessConfiguration.isHosted==!0},n.sortGroupMembersByName=function(n){return n.sort(function(n,t){return!n||!n.displayName?-1:!t||!t.displayName?1:n.displayName.toLocaleLowerCase().localeCompare(t.displayName.toLocaleLowerCase())})},n.createTooltip=function(t,i){var u,r,f;return i?i:t?(u=t.displayName&&t.displayName.trim()?t.displayName:"",r="",n.isOnPremiseEnvironment()?t.samAccountName&&t.samAccountName.trim()&&(r="("+(t.scopeName&&t.scopeName.trim()?t.scopeName+"\\":"")+t.samAccountName+")"):t.signInAddress&&t.signInAddress.trim()&&(r="<"+t.signInAddress+">"),f="",t.active!==!1||et.isAadGroup(t)||(f=" - "+(t.entityType.toLowerCase().trim()==a.ServiceHelpers.UserEntity?p.IdentityPicker_InactiveUser:t.entityType.toLowerCase().trim()==a.ServiceHelpers.GroupEntity?p.IdentityPicker_InactiveGroup:p.IdentityPicker_InactiveIdentity)),(u?u:"")+(r?" "+r:"")+f):""},n.replaceBackslash=function(n){return n.replace(/\\/g,"%")},n.UserEntityType=a.ServiceHelpers.UserEntity,n.GroupEntityType=a.ServiceHelpers.GroupEntity,n.VisualStudioDirectory=a.ServiceHelpers.VisualStudioDirectory,n.AzureActiveDirectory=a.ServiceHelpers.AzureActiveDirectory,n.SourceDirectory=a.ServiceHelpers.SourceDirectory,n.FIXED_POSTIION_CLASS="identity-picker-fixed-position",n.SCROLL_BAR_WIDTH_PX=20,n.IDENTITY_ITEM_BUFFER_WIDTH_PX=18,n}();at=function(){function n(){}return n.createStringEntity=function(t,i){var r=d.htmlEncode(t),u={entityId:n.STRING_ENTITY_ID_PREFIX+"_"+r,entityType:n.STRING_ENTITY_TYPE,originDirectory:n.STRING_DIRECTORY,originId:n.STRING_ORIGIN_ID_PREFIX+"_"+r,localDirectory:n.STRING_DIRECTORY,localId:n.STRING_LOCAL_ID_PREFIX+"_"+r,isMru:!1,displayName:r};return u.image=i||a.ServiceHelpers.getDefaultIdentityImage(u),u},n.isStringEntityId=function(t){return!t||!t.trim()?!1:t.indexOf(n.STRING_ENTITY_ID_PREFIX)==0?!0:!1},n.isStringPrefixedLocalId=function(t){return!t||!t.trim()?!1:t.indexOf(n.STRING_LOCAL_ID_PREFIX)==0},n.STRING_ENTITY_TYPE="string_entitytype",n.STRING_ENTITY_ID_PREFIX="STRING_ENTITYID",n.STRING_DIRECTORY="STRING_DIRECTORY",n.STRING_ORIGIN_ID_PREFIX="STRING_ORIGINID",n.STRING_LOCAL_ID_PREFIX="STRING_LOCALID",n}();t.EntityFactory=at;var et=function(){function n(){}return n.isDirectoryEntityType=function(n){return n.entityType?n.entityType.toLowerCase().trim()==a.ServiceHelpers.UserEntity||n.entityType.toLowerCase().trim()==a.ServiceHelpers.GroupEntity:!1},n.isAadGroup=function(n){return n.entityType&&n.entityType.toLowerCase().trim()==a.ServiceHelpers.GroupEntity&&n.originDirectory.toLowerCase().trim()==a.ServiceHelpers.AzureActiveDirectory},n.getUniqueIdentifierForDisambiguation=function(n){return ft.isOnPremiseEnvironment()||n.entityType.toLowerCase().trim()!=a.ServiceHelpers.UserEntity?n.entityId:n.signInAddress&&ft.isValidEmail(n.signInAddress)?n.signInAddress:n.entityId},n.getDisplayName=function(t){return t.displayName&&t.displayName.trim()?t.displayName:n.getSignInAddress(t,n.isGitHubIdentity(t))},n.isGitHubIdentity=function(n){return n.originDirectory&&n.originDirectory.toLowerCase().trim()==a.ServiceHelpers.GitHubDirectory},n.getNonDiacriticDisplayName=function(n){return this.replaceDiacriticCharacters(this.getDisplayName(n))},n.replaceDiacriticCharacters=function(n){var t,i,r;if(n){for(t=n,i=0;i<t.length;i++)r=t.charAt(i),r in l.diacriticsRemovalMap&&(t=t.replace(r,l.diacriticsRemovalMap[r]));return t}return n},n.getSignInAddress=function(n,t){return(t===void 0&&(t=!1),ft.isOnPremiseEnvironment()&&n.samAccountName&&n.samAccountName.trim())?(n.scopeName&&n.scopeName.trim()?n.scopeName+"\\":"")+n.samAccountName:!t&&n.signInAddress&&n.signInAddress.trim()?n.signInAddress:!t&&n.mail&&n.mail.trim()?n.mail:n.mailNickname&&n.mailNickname.trim()?n.mailNickname:""},n}(),ri=function(){function n(){}return n.prototype.getIdentityAttributes=function(n){if(n.entityType.trim().toLowerCase()==a.ServiceHelpers.UserEntity)return new ti(n);if(n.entityType.trim().toLowerCase()==a.ServiceHelpers.GroupEntity)return new ii(n);throw{source:"getIdentityAttributes",message:"identity entityType do not match existing type"};},n}(),vt=function(){function n(n,t,i){this._displayTitle=n;this._displayContent=t;this._needWordWrap=i?i:!1}return n.prototype.getDisplayTitle=function(){return this._displayTitle},n.prototype.getDisplayContent=function(){return this._displayContent},n.prototype.constructAttribute=function(n){var r=$("<div>").addClass("identity-picker-idcard-attribute-name").attr("id","identity-picker-idcard-attribute-name_"+n).text(this.getDisplayTitle()),i=this.getDisplayContent(),t=$("<div>").addClass("identity-picker-idcard-ellipsis-overflow"),u;return rt.RichContentTooltip.addIfOverflow(i,t,{menuContainer:t}),this._isValidSendEmailAttribute()?u=$("<a>").attr({"aria-labelledby":"identity-picker-idcard-attribute-name_"+n,href:"mailto:"+i,tabindex:"0"}).text(i).appendTo(t):t.text(this.getDisplayContent()),this._needWordWrap&&t.addClass("identity-picker-idcard-word-wrap"),[r,t]},n.prototype._isValidSendEmailAttribute=function(){return p.IdentityPicker_IdCardMail.toLowerCase()==this.getDisplayTitle().toLowerCase().trim()&&ft.isValidEmail(this.getDisplayContent())},n}(),ui=function(){function n(){this._withContactCard=!1;this._smallScreenRender=!1;this._withContactCard=!0;this._focusElementOnContactCardClose=null}return n.prototype.withPrefix=function(n){return this._prefix=n,this},n.prototype.withEntity=function(n){return this._entity=n,this},n.prototype.withContactCard=function(n,t){return this._withContactCard=n,this._withContactCard&&(this._focusElementOnContactCardClose=t),this},n.prototype.forControlOfSize=function(n){return this._size=n,this},n.prototype.withIdentityServiceOptions=function(n){return this._identityServiceOptions=n,this},n.prototype.withIdentityExtensionOptions=function(n){return this._identityExtensionOptions=n,this},n.prototype.withHoverSupport=function(n){return this._supportsHover=n,this},n.prototype.withSmallScreenRender=function(n){return this._smallScreenRender=n,this},n.prototype.withDialogAppendTo=function(n){return this._dialogAppendTo=n,this},n.prototype.registerCallbacks=function(n){return this._callbacks=n,this},n.prototype.build=function(){var i=this,t,h,u,f,e,o,r,c,s,a,v;return!this._entity||this._size===null||this._size===undefined||!this._identityServiceOptions||!this._identityServiceOptions.identityType||!this._identityServiceOptions.operationScope||!this._callbacks?null:(t=$("<li>").attr("role","option"),this._smallScreenRender&&(h=$("<i>").addClass("ms-Icon ms-Icon--CheckMark"),u=$("<span>").addClass("container"),h.appendTo(u),f=$("<span>").addClass("selected-fade"),u.appendTo(f),f.appendTo(t)),ft.styleElementBySize(t,this._size,!0),n._appendImage(this._entity,t,this._size),e=et.isGitHubIdentity(this._entity),o=!e&&this._withContactCard&&et.isDirectoryEntityType(this._entity),this._entity.isMru&&et.isDirectoryEntityType(this._entity)&&(r=$("<div>").addClass("bowtie-icon bowtie-edit-delete bowtie-icon-small identity-picker-delete-icon").attr("role","button").appendTo(t),rt.RichContentTooltip.add(p.IdentityPicker_RemoveFromMru,r,{menuContainer:r}),ft.styleElementBySize(r,this._size,!1),o&&r.addClass("with-idcard"),r.hide(),c=ut(this,function(){var n={};n[l.TelemetryProperties.entityId]=i._entity.entityId;n[l.TelemetryProperties.consumerId]=i._identityExtensionOptions?i._identityExtensionOptions.consumerId:l.ConsumerId.UnknownConsumer;nt.publishEvent(new nt.TelemetryEventData(l.Telemetry.Area,l.Telemetry.Feature_Click_Remove_Mru,n));i._callbacks.deleteIconClickDelegate(i._entity,t)}),this._callbacks.deleteIconClickDelegate&&r.click(c)),o&&!et.isGitHubIdentity(this._entity)&&n._appendIdCard(this._entity,t,this._size,this._identityServiceOptions,this._identityExtensionOptions,this._callbacks,this._focusElementOnContactCardClose,this._dialogAppendTo),s=n._appendTextContainer(this._entity,t,this._size,this._prefix,this._smallScreenRender),this._size==st.Small&&(a=this._entity.entityType.toLowerCase().trim()==at.STRING_ENTITY_TYPE?this._entity.displayName:et.getSignInAddress(this._entity,e),rt.RichContentTooltip.add(a,s,{menuContainer:s})),v=function(){var n,r;i._smallScreenRender&&(n=17,k.delay(null,n,function(){t.children(".selected-fade").attr("class","selected-fade-active")}),r=400,k.delay(null,n+r,function(){t.children(".selected-fade").attr("class","selected-fade")}));i._callbacks.entityListItemClickDelegate(i._entity)},this._callbacks.entityListItemClickDelegate&&t.click(v),this._entity.isMru&&this._supportsHover&&t.hover(ut(this,function(){t.children(".identity-picker-delete-icon").show()}),ut(this,function(){t.children(".identity-picker-delete-icon").hide()})),t)},n._appendTextContainer=function(t,i,r,u,f){var s,o,e;return f===void 0&&(f=!1),s=et.isGitHubIdentity(t)&&!(t.displayName&&t.displayName.trim()),s?o=$("<div>").addClass("item-text-container").append($("<div>").append($("<div>").addClass("bowtie-icon bowtie-brand-github list-icon")).addClass("title-only").addClass(r==st.Large?"large":"").append(n._highlightPrefix(et.getDisplayName(t),u,!0))):(o=$("<div>").addClass("item-text-container").append($("<div>").addClass("title").addClass(r==st.Large?"large":"").append(n._highlightPrefix(et.getDisplayName(t),u,!0))),e=et.getSignInAddress(t,et.isGitHubIdentity(t)),e=d.isGuid(e)?"":e,r!=st.Small&&e&&e.trim()&&o.append($("<div>").append($("<div>").addClass(et.isGitHubIdentity(t)?"bowtie-icon bowtie-brand-github list-icon":"")).addClass("subtitle").addClass(r==st.Large?"large":"").append(n._highlightPrefix(e,u)))),o.appendTo(i),f||o.height(ft.getSizePx(r)+lt.IMAGE_MARGINS_PX),o},n._appendImage=function(n,t,i){var f=a.ServiceHelpers.getDefaultIdentityImage(n),r,u;n.image&&(r=n.image);u=ft.createImgElement(f,r,r&&r.trim()?"identity-picture":"identity-picture hidden",n.entityId).appendTo(t);ft.styleElementBySize(u,i,!1)},n._appendIdCard=function(n,t,i,r,u,f,e,s){var h=$("<div>").addClass("bowtie-icon bowtie-contact-card identity-picker-contact-card-icon").attr("role","button").appendTo(t),c;rt.RichContentTooltip.add(p.IdentityPicker_ShowContactCardTitle,h,{menuContainer:h});ft.styleElementBySize(h,i,!1);c=ut(this,function(t){t.stopPropagation();var f={identity:n,anchor:h,operationScope:r.operationScope,identityType:r.identityType,httpClient:r.httpClient?r.httpClient:null,focusElementOnClose:e,leftValue:h.offset().left,topValue:h.offset().top+h.outerHeight(),consumerId:u.consumerId,appendTo:s},i={};i[l.TelemetryProperties.entityId]=n.entityId;i[l.TelemetryProperties.consumerId]=u?u.consumerId:l.ConsumerId.UnknownConsumer;nt.publishEvent(new nt.TelemetryEventData(l.Telemetry.Area,l.Telemetry.Feature_Click_IdCard,i));o.Enhancement.enhance(wt,"<div/>",f)});h.click(c)},n._highlightPrefix=function(n,t,i){var u;if(i===void 0&&(i=!1),!n)return null;var o=et.replaceDiacriticCharacters(n),s=et.replaceDiacriticCharacters(t),r=o.toLowerCase().indexOf(s.toLowerCase()),f=function(n,t,i){return $("<span>").append(d.htmlEncode(n.substring(0,i))).append($("<b>").text(n.substr(i,t))).append(d.htmlEncode(n.substr(i+t)))},e=function(n,t,i,r){for(var u=et.replaceDiacriticCharacters(n),e=et.replaceDiacriticCharacters(t);i>0&&u.charAt(i-1)!=r;)i=u.toLowerCase().indexOf(e.toLowerCase(),i+1);return i>0?f(n,t.length,i):null};if(r){if(r>0){if(i&&(u=e(n,t,r," "),u)||ft.isOnPremiseEnvironment()&&t.indexOf("\\")<0&&(u=e(n,t,r,"\\"),u))return u}else if(ft.isOnPremiseEnvironment()&&t.indexOf("\\")>0)if(t=t.substring(t.indexOf("\\")+1),r=o.toLowerCase().indexOf(s.toLowerCase()),r){if(i&&(u=e(n,t,r," "),u))return u}else return f(n,t.length,r)}else return f(n,t.length,r);return $("<span>").text(n)},n}(),ct=function(){function n(){}return n.Directory="Directory",n.Mru="Mru",n.Persistent="Persistent",n.String="String",n}();t.SourceId=ct,function(n){n[n.Sync=0]="Sync";n[n.Async=1]="Async"}(ni=t.SourceType||(t.SourceType={}));bt=function(){function n(){}return n.PreferFirst="preferfirst",n.PreferSecond="prefersecond",n}();yt=function(n){function t(){var t=__construct(this,n,[]);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t._mruEntities={},t._syncSources={},t._requestStack=[],t._deferredStack=[],t._userMruReady={},t._entityRetrieverPrepComplete={},t._mruEntitiesPromise={},t._mruEntities={},t.registerSyncSource({id:ct.Mru,sourceType:ni.Sync,getEntities:t._mruSourceGetEntitiesHandler,sortRank:10}),t.queryTokenEntityImageCache=new v.HashCache,t}return __extends(t,n),t.prototype.registerSyncSource=function(n){if(!(n.id in this._syncSources)){for(var t in this._syncSources)if(this._syncSources[t].sortRank==n.sortRank)return;this._syncSources[n.id]=n}},t.prototype.search=function(n){var i=this,e,u,f;if(!n.sources||n.sources.length==0||!n.identityServiceOptions){e={source:"EntityOperationsFacade: search",message:"missing arguments"};throw e;}var o=it.defer(),s=o.promise,r=c.FilterByScope.GetHashCode(n.filterByScope);return typeof this._requestStack[r]=="undefined"&&(this._requestStack[r]=[]),this._requestStack[r].push(n),typeof this._deferredStack[r]=="undefined"&&(this._deferredStack[r]=[]),this._deferredStack[r].push(o),u=ut(this,function(){for(var e=function(){var e=i._requestStack[r].pop(),o=i._deferredStack[r].pop();n=[];f=i._getRegisteredSyncSourcesSorted().filter(function(n){return e.sources.indexOf(n)!=-1});f&&f.forEach(ut(i,function(r){var u=i._syncSources[r].getEntities.bind(i),f=u(n,e);n=t.mergeEntities(f,n)}));u={entityResponse:[],queryTokenResponse:{}};e.sources.indexOf(ct.Directory)!=-1&&(u.queryTokenResponse=i._directorySourceGetEntities(n,e));n.length>0?i.getImagesForEntities(n,e).then(function(t){n.forEach(ut(i,function(n){t.hasOwnProperty(n.entityId)&&(n.image=t[n.entityId])}));u.entityResponse=n;o.resolve(u)}):o.resolve(u)},n,f,u;i._requestStack[r].length>0;)e()}),f=this.load({loadMru:n.sources.indexOf(ct.Mru)!=-1,filterByScope:n.filterByScope}),f.isFulfilled()?u():f.then(u,u),s},t.prototype.isUserMruReady=function(n){return this._userMruReady[c.FilterByScope.GetHashCode(n)]},t.prototype.getMruEntitiesUnchecked=function(n){return this._mruEntities[c.FilterByScope.GetHashCode(n)]},t.prototype.refreshUserMru=function(n){return this._getUserMruEntities(null,null,n)},t.prototype.load=function(n){var i=this,t=c.FilterByScope.GetHashCode(n.filterByScope);return this._entityRetrieverPrepComplete[t]&&(!n.loadMru||this._userMruReady[t])?this._entityRetrieverPrepComplete[t].promise:(this._entityRetrieverPrepComplete[t]=it.defer(),n.loadMru?this._mruEntitiesPromise[t]?this._mruEntitiesPromise[t].then(ut(this,function(){i._entityRetrieverPrepComplete[t].resolve(!0)}),ut(this,function(){i._entityRetrieverPrepComplete[t].resolve(!1)})):(this._mruEntitiesPromise[t]=this._getUserMruEntities(null,null,n.filterByScope),this._mruEntitiesPromise[t].then(ut(this,function(){i._entityRetrieverPrepComplete[t].resolve(!0)}),ut(this,function(){i._entityRetrieverPrepComplete[t].resolve(!1)}))):this._entityRetrieverPrepComplete[t].resolve(!0),this._entityRetrieverPrepComplete[t].promise)},t.filterEntities=function(n,t){return!n||n.length==0?[]:n.filter(function(n){return n.displayName&&et.getNonDiacriticDisplayName(n).toLowerCase().indexOf(et.replaceDiacriticCharacters(t))==0?!0:ft.isOnPremiseEnvironment()&&n.samAccountName&&n.samAccountName.trim().toLowerCase().indexOf(t)==0||ft.isOnPremiseEnvironment()&&n.scopeName&&n.samAccountName&&(n.scopeName+"\\"+n.samAccountName).trim().toLowerCase().indexOf(t)==0||n.signInAddress&&n.signInAddress.trim().toLowerCase().indexOf(t)==0||!n.signInAddress&&n.mail&&n.mail.trim().toLowerCase().indexOf(t)==0||!n.signInAddress&&!n.mail&&n.mailNickname&&n.mailNickname.trim().toLowerCase().indexOf(t)==0?!0:!1})},t.mergeEntities=function(n,i,r){var u,f,e;if(r===void 0&&(r=bt.PreferFirst),u={},f=[],!n&&!i)return[];if(!i||i.length==0)return n?n:[];if(!n||n.length==0)return i?i:[];n.forEach(function(n){var i=t._getMergingKeyFromEntity(n);u[i]=u.hasOwnProperty(i)?t._mergeSimilarEntities(u[i],n,r):n});i.forEach(function(n){var i=t._getMergingKeyFromEntity(n),f;i in u?(f=t._mergeSimilarEntities(u[i],n,r),u[i]=f):u[i]=n});for(e in u)u[e].isMru?f.unshift(u[e]):f.push(u[e]);return f},t.prototype.getImagesForEntities=function(n,t){var r=it.defer(),h=r.promise,e={},c=w.getService(a.IdentityService),u,f,o;try{u=c.getIdentityImages(n,{httpClient:t&&t.identityServiceOptions&&t.identityServiceOptions.httpClient?t.identityServiceOptions.httpClient:null});f=[];for(o in u)f.push(u[o]);it.allSettled(f).then(function(n){n.forEach(function(n){if(n.state==l.PromiseResultStatus.Fulfilled){if(!n.value||Object.keys(n.value).length!=1||!Object.keys(n.value)[0]||!Object.keys(n.value)[0].trim())return;var i=Object.keys(n.value)[0],t=n.value[i];if(!t||!t.trim())return;e[i]=t}else n.state==l.PromiseResultStatus.Rejected&&n.reason&&s.logError("_getImagesForEntities/_getImagesForEntitiesErrorCallback:"+JSON.stringify(n.reason))});r.resolve(e)},function(n){n&&s.logError("_getImagesForEntities/_getImagesForEntitiesErrorCallback:"+JSON.stringify(n));r.reject(n)})}catch(i){if(i!==Object(i)||!("source"in i)||i.source!="IdentityService")throw i;}return h},t._getMergingKeyFromEntity=function(n){var t,i;return ft.isOnPremiseEnvironment()&&n&&n.entityType&&n.localId&&n.localDirectory.toLowerCase().trim()==a.ServiceHelpers.VisualStudioDirectory&&(n.entityType.toLowerCase().trim()==a.ServiceHelpers.UserEntity||n.entityType.toLowerCase().trim()==a.ServiceHelpers.GroupEntity)?n.localId:n.entityType.toLowerCase().trim()==a.ServiceHelpers.UserEntity?(t=et.getSignInAddress(n),i=t?t:n.entityId,i):n.entityType.toLowerCase().trim()==a.ServiceHelpers.GroupEntity?n.displayName&&n.displayName.trim()?n.mailNickname&&n.mailNickname.trim()?n.displayName+n.mailNickname:n.mail&&n.mail.trim()?n.displayName+n.mail:n.displayName:n.entityId:n.entityType.toLowerCase().trim()==at.STRING_ENTITY_TYPE?n.entityId:void 0},t._mergeSimilarEntities=function(n,i,r){var f,u,e;if(r===void 0&&(r=bt.PreferFirst),n==null)return i;if(i==null)return n;f={entityId:t._computeValue("entityId",n,i,r),entityType:t._computeValue("entityType",n,i,r),originDirectory:t._computeValue("originDirectory",n,i,r),originId:t._computeValue("originId",n,i,r),localDirectory:t._computeValue("localDirectory",n,i,r),localId:t._computeValue("localId",n,i,r)};u=["displayName","scopeName","department","jobTitle","mail","mailNickname","physicalDeliveryOfficeName","signInAddress","surname","guest","description","image","isMru","samAccountName","active","telephoneNumber"];for(e in u)f[u[e]]=t._computeValue(u[e],n,i,r);return f},t._computeValue=function(n,t,i,r){r===void 0&&(r=bt.PreferFirst);return r==bt.PreferFirst?t[n]?typeof t[n]=="string"||t[n]instanceof String?t[n].trim()?t[n]:i[n]:t[n]:i[n]:i[n]?typeof i[n]=="string"||i[n]instanceof String?i[n].trim()?i[n]:t[n]:i[n]:t[n]},t._filterMruEntitiesByIdentityType=function(n,t){if(!n.identityServiceOptions||!n.identityServiceOptions.identityType)return t;var i=a.ServiceHelpers.getIdentityTypeList(n.identityServiceOptions.identityType);return t.filter(function(n){return i.indexOf(n.entityType.trim().toLowerCase())>=0})},t.prototype._mruSourceGetEntitiesHandler=function(n,i){var r=t._filterMruEntitiesByIdentityType(i,this._mruEntities[c.FilterByScope.GetHashCode(i.filterByScope)]);return i.prefix&&(r=t.filterEntities(r,i.prefix)),r},t.prototype._directorySourceGetEntities=function(n,i){var e=this,c,o,u,l;if(!i||!i.prefix)return{};var r={},h={},v=w.getService(a.IdentityService);try{c={httpClient:i.identityServiceOptions.httpClient,minResults:i.identityServiceOptions.minResults?i.identityServiceOptions.minResults:n?n.length>a.IdentityService.MIN_RESULTS?0:a.IdentityService.MIN_RESULTS-n.length:a.IdentityService.MIN_RESULTS,maxResults:i.identityServiceOptions.minResults?i.identityServiceOptions.minResults:a.IdentityService.MAX_RESULTS,extensionData:i.identityServiceOptions.extensionData,getFilterByScope:function(){return i.filterByScope}};o=v.getIdentities(i.prefix,i.identityServiceOptions.operationScope,i.identityServiceOptions.identityType,c,i.queryTypeHint,i.identityExtensionOptions);for(u in o)l=ut(this,function(u){o[u].then(ut(e,function(f){i.prefix&&i.prefix.length>=1&&(f.identities=f&&f.identities?t.mergeEntities(f.identities,n):n);f.identities.length>0?e.getImagesForEntities(f.identities,i).then(function(n){f.identities.forEach(function(t){n.hasOwnProperty(t.entityId)&&(t.image=n[t.entityId])});r[u].resolve(f)}):r[u].resolve(f)}),ut(e,function(n){n&&s.logWarning("_directorySourceGetEntities/getIdentitiesErrorCallback:"+JSON.stringify(n));r[u].reject(n?n:null)}))}),l(u),r[u]=it.defer(),h[u]=r[u].promise}catch(f){if(f!==Object(f)||!("source"in f)||f.source!="IdentityService")throw f;}return h},t.prototype._getRegisteredSyncSourcesSorted=function(){var n=this,t=Object.keys(this._syncSources);return t.sort(function(t,i){return n._syncSources[t].sortRank>n._syncSources[i].sortRank?1:-1}),t},t.prototype._getUserMruEntities=function(n,t,i){var f=this,e=it.defer(),v=e.promise,r=c.FilterByScope.GetHashCode(i),o,s,h;try{return(this._userMruReady[r]=!1,o=ut(this,function(n){f._userMruReady[r]=!0;f._mruEntities[r]=n.filter(function(n){return n.active!==!1});f._mruEntities[r].forEach(function(n){n.image=a.ServiceHelpers.getDefaultIdentityImage(n)});e.resolve(!0)}),s=ut(this,function(){f._mruEntities[r]=[];e.resolve(!1)}),c.FilterByScope.isFilterByScopeEmpty(i))?it(o([])):(h=w.getService(a.MruService),h.getMruIdentities({IMS:!0},a.MruService.DEFAULT_IDENTITY_ID,a.MruService.DEFAULT_FEATURE_ID,{httpClient:n?n.httpClient:null,filterByScope:i},{consumerId:t?t.consumerId:l.ConsumerId.UnknownConsumer}).then(o,s))}catch(u){if(u!==Object(u)||!("source"in u)||u.source!="MruService")throw u;}return v},t}(w.VssService);t.EntityOperationsFacade=yt;ti=function(){function n(n){this._attributes=this._mapEntityPropertiesToAttributes(n)}return n.prototype._mapEntityPropertiesToAttributes=function(n){var t=[];return n.jobTitle&&t.push(new vt(p.IdentityPicker_IdCardJobTitle,n.jobTitle)),n.mailNickname&&!d.isGuid(n.mailNickname)&&t.push(new vt(p.IdentityPicker_IdCardAlias,n.mailNickname)),n.physicalDeliveryOfficeName&&t.push(new vt(p.IdentityPicker_IdCardOffice,n.physicalDeliveryOfficeName)),n.department&&t.push(new vt(p.IdentityPicker_IdCardDepartment,n.department)),t},n.prototype.isEmpty=function(){return!(this._attributes.length>0)},n.prototype._appendAttributeBlock=function(t,i){var r=this._attributes[t].constructAttribute(n._idCardEntityAttributeCounter++);for(var u in r)r[u].appendTo(i)},n.prototype.toRows=function(){var i=[],n,r,t,u,f;for(r in this._attributes)t=parseInt(r),this._isEven(t)?(n&&i.push(n),n=$("<div>").addClass("identity-picker-idcard-row"),u=$("<div>").addClass("identity-picker-idcard-left-attribute").appendTo(n),this._appendAttributeBlock(t,u)):(f=$("<div>").addClass("identity-picker-idcard-right-attribute").appendTo(n),this._appendAttributeBlock(t,f));return n&&i.push(n),i},n.prototype._isEven=function(n){return n%2==0},n._idCardEntityAttributeCounter=0,n}();ii=function(){function n(n){this._attributes=this._mapEntityPropertiesToAttributes(n)}return n.prototype._mapEntityPropertiesToAttributes=function(n){var t=[],i=new vt(p.IdentityPicker_IdCardDescription,n.description?n.description:"",!0);return t.push(i),n.scopeName&&t.push(new vt(p.IdentityPicker_IdCardGroupSource,this._getScopeNameByDirectoryType(n))),n.mail&&t.push(new vt(p.IdentityPicker_IdCardMail,n.mail)),n.mailNickname&&!d.isGuid(n.mailNickname)&&t.push(new vt(p.IdentityPicker_IdCardAlias,n.mailNickname)),t},n.prototype._getScopeNameByDirectoryType=function(n){var t=n.originDirectory.trim().toLowerCase()==a.ServiceHelpers.VisualStudioDirectory?p.IdentityPicker_IdCardImsGroupSource:p.IdentityPicker_IdCardAadGroupSource;return d.format(t,n.scopeName)},n.prototype.isEmpty=function(){return!(this._attributes.length>0)},n.prototype._appendAttributeBlock=function(t,i){var r=this._attributes[t].constructAttribute(n._idCardEntityAttributeCounter++);for(var u in r)r[u].appendTo(i)},n.prototype.toRows=function(){var t=$("<div>").addClass("identity-picker-idcard-info"),r,n,u,f,e,o,i;if(this._isValidIndex(1))for(r=$("<div>").addClass("identity-picker-idcard-column").appendTo(t),n=1;this._isValidIndex(n);)u=$("<div>").addClass("identity-picker-idcard-row").appendTo(r),f=$("<div>").addClass("identity-picker-idcard-left-attribute").appendTo(u),this._appendAttributeBlock(n,f),n++;return this._attributes[0].getDisplayContent()&&(e=$("<div>").addClass("identity-picker-idcard-column").appendTo(t),o=$("<div>").addClass("identity-picker-idcard-left-attribute").appendTo(e),this._appendAttributeBlock(0,o)),i=[],i.push(t),i},n.prototype._isValidIndex=function(n){return typeof this._attributes[n]!="undefined"},n._idCardEntityAttributeCounter=0,n}()});

define("VSS/Identities/Picker/PersonaCardContracts",["require","exports"],function(n,t){var i,r;Object.defineProperty(t,"__esModule",{value:!0});t.personaCardEntity=t.CardType=void 0,function(n){n[n.Default=0]="Default";n[n.Contact=1]="Contact";n[n.Organization=2]="Organization"}(i=t.CardType||(t.CardType={})),function(n){n.contactCard="ContactCard";n.clicked="Clicked";n.featureName="PersonaCard";n.loaded="Loaded";n.orgCard="OrgCard";n.orgCardManagerChain="OrgCardManagerChain";n.orgCardDirectReport="OrgCardDirectReport";n.personaCard="PersonaCard";n.reportingManager="ReportingManager"}(r=t.personaCardEntity||(t.personaCardEntity={}))});

define("VSS/Identities/Picker/ContactCard",["require","exports","react","OfficeFabric/Label","VSS/Identities/Picker/PersonaCardContracts","VSS/Resources/VSS.Resources.Platform","VSS/Utils/String","VSS/LoaderPlugins/Css!PersonaCard"],function(n,t,i,r,u,f,e){var o,s;Object.defineProperty(t,"__esModule",{value:!0});t.ContactCard=t.ContactCardContactLine=void 0;o=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t.prototype.render=function(){var n=this;return i.createElement("div",null,i.createElement("div",{className:this.props.padTop?"contact-card-line-top":"contact-card-line"},i.createElement("div",{className:"contact-card-span-label"},this.props.label),i.createElement("div",{className:"contact-card-span-content"},this.props.link&&this.props.content&&i.createElement("a",{className:"profile-card-tab-element",href:this.props.link,onClick:function(){n.props.publishTelemetry(e.format("{0}",n.props.label),u.personaCardEntity.clicked)}},this.props.content),!this.props.link&&this.props.content)),i.createElement("div",{style:{clear:"both"}}))},t}(i.Component);t.ContactCardContactLine=o;s=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t.prototype.render=function(){var n=this.props.identity;return i.createElement("div",{className:"contact-or-organization-card-wrapper"},i.createElement("div",{className:"contact-card-header-wrapper"},i.createElement("div",{style:{fontSize:14}},i.createElement(r.Label,null,f.ProfileCard_ContactInformation))),i.createElement("div",{className:"contact-card-info-wrapper"},i.createElement(o,{label:f.ProfileCard_Email,content:n.mail,link:"mailto:"+n.mail,publishTelemetry:this.props.publishTelemetry}),i.createElement(o,{label:f.ProfileCard_TelephoneNumber,content:n.telephoneNumber,link:"tel:"+n.telephoneNumber,publishTelemetry:this.props.publishTelemetry}),i.createElement(o,{label:f.ProfileCard_PhysicalDeliveryOfficeName,content:n.physicalDeliveryOfficeName}),i.createElement(o,{label:f.ProfileCard_JobTitle,content:n.jobTitle,padTop:!0}),i.createElement(o,{label:f.ProfileCard_Department,content:n.department}),i.createElement(o,{label:f.ProfileCard_Alias,content:n.mailNickname})))},t}(i.Component);t.ContactCard=s});

define("VSS/Identities/Picker/DefaultCard",["require","exports","react","OfficeFabric/Icon","OfficeFabric/components/Persona/Persona","OfficeFabric/components/Persona/Persona.types","OfficeFabric/Label","OfficeFabric/Tooltip","VSS/Identities/Picker/PersonaCardContracts","VSS/Resources/VSS.Resources.Platform","VSS/Utils/String","VSS/LoaderPlugins/Css!PersonaCard"],function(n,t,i,r,u,f,e,o,s,h,c){var l,a;Object.defineProperty(t,"__esModule",{value:!0});t.DefaultCard=t.DefaultCardContactLine=void 0;l=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t.prototype.render=function(){var n=this;return i.createElement("div",{className:"default-card-contact-line-wrapper"},i.createElement(e.Label,{className:"default-card-contact-line"},i.createElement(r.Icon,{iconName:this.props.iconName,className:"default-card-contact-line-label"}),this.props.link&&i.createElement("a",{href:this.props.link,className:"default-card-contact-line-link profile-card-tab-element",onClick:function(){n.props.publishTelemetry(c.format("{0}",n.props.iconName),s.personaCardEntity.clicked)}},this.props.content),!this.props.link&&i.createElement("span",{className:"default-card-contact-line-no-link"},this.props.content)))},t}(i.Component);t.DefaultCardContactLine=l;a=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t.prototype.componentDidMount=function(){this.props.setFocus&&this.props.setFocus()},t.prototype.render=function(){var r=this,v=this.props,n=v.identity,p=v.isPreviousHeader,c={imageUrl:this.props.identity.image,primaryText:this.props.identity.displayName,secondaryText:this.props.identity.jobTitle,tertiaryText:this.props.identity.department},w=i.createElement("div",null,i.createElement(u.Persona,__assign({},c,{key:this.props.identity.entityId+this.props.identity.signInAddress,size:f.PersonaSize.large,className:"persona-main",onRenderPrimaryText:function(){return i.createElement(o.TooltipHost,{key:"".concat(r.props.identity.entityId,".primarytext.tooltip"),content:c.primaryText,overflowMode:o.TooltipOverflowMode.Parent},i.createElement("span",{className:"persona-main-text-primary"},c.primaryText))},onRenderSecondaryText:function(){return i.createElement(o.TooltipHost,{key:"".concat(r.props.identity.entityId,".secondarytext.tooltip"),content:c.secondaryText,overflowMode:o.TooltipOverflowMode.Parent},i.createElement("span",{className:"persona-main-text-secondary"},c.secondaryText))},onRenderTertiaryText:function(){return i.createElement("div",{className:"persona-main-text-tertiary"},c.tertiaryText)},imageShouldFadeIn:!1}))),y=null,t,a;return this.props.manager&&(t=this.props.manager,a={imageUrl:t.image,primaryText:t.displayName,secondaryText:t.jobTitle,tertiaryText:t.department},y=i.createElement("div",{className:"persona-list-manager-element profile-card-tab-element","aria-label":t.displayName,key:t.entityId+t.signInAddress,onClick:function(){r.props.publishTelemetry(s.personaCardEntity.personaCard,s.personaCardEntity.loaded,s.personaCardEntity.reportingManager);r.props.onClickEntity(t)},"data-is-focusable":!0,role:"button"},i.createElement(u.Persona,__assign({},a,{size:f.PersonaSize.size40,onRenderPrimaryText:function(){return i.createElement("div",{className:"persona-list-element-text-primary"},a.primaryText)},onRenderSecondaryText:function(){return i.createElement("div",{className:"persona-list-element-text-secondary"},a.secondaryText)},imageShouldFadeIn:!1})))),i.createElement("div",{className:p?"default-card-with-header":"default-card-without-header"},w,i.createElement("div",null,(n.mail||n.telephoneNumber||n.physicalDeliveryOfficeName)&&i.createElement("div",{className:"default-card-contact-info-wrapper"},i.createElement("hr",{className:"hr-main"}),i.createElement("div",{className:"default-card-header-wrapper"},i.createElement("span",{className:"default-card-header pointer profile-card-tab-element",onClick:function(){r.props.publishTelemetry(s.personaCardEntity.contactCard,s.personaCardEntity.loaded);r.props.showContactCard()},"aria-label":h.ProfileCard_ContactHeader,"data-is-focusable":!0,role:"button"},i.createElement(e.Label,{className:"pointer"},i.createElement("b",{className:"default-card-header-space"},h.ProfileCard_ContactHeader),i.createElement("span",{className:"icon bowtie-icon bowtie-chevron-right-light default-card-header-chevron"})))),i.createElement("div",{className:"default-card-contact-info-container"},n.mail&&i.createElement(l,{iconName:"Mail",content:n.mail,link:"mailto:"+n.mail,publishTelemetry:this.props.publishTelemetry}),n.mail&&i.createElement(l,{iconName:"Chat",content:h.ProfileCard_SendChat,link:"sip:"+n.mail,publishTelemetry:this.props.publishTelemetry}),n.telephoneNumber&&i.createElement(l,{iconName:"Phone",content:n.telephoneNumber,link:"tel:"+n.telephoneNumber,publishTelemetry:this.props.publishTelemetry}),n.physicalDeliveryOfficeName&&i.createElement(l,{iconName:"POI",content:n.physicalDeliveryOfficeName}))),this._renderDirectManagerElement(y)))},t.prototype._renderDirectManagerElement=function(n){var t=this;return n?i.createElement("div",{className:"default-card-direct-manager-wrapper"},i.createElement("hr",{className:"hr-secondary"}),i.createElement("div",{className:"default-card-header-wrapper"},i.createElement("span",{className:"default-card-header pointer profile-card-tab-element",onClick:function(){t.props.publishTelemetry(s.personaCardEntity.orgCard,s.personaCardEntity.loaded);t.props.showOrganizationCard()},"aria-label":h.ProfileCard_Organization,"data-is-focusable":!0,role:"button"},i.createElement(e.Label,{className:"pointer"},i.createElement("b",{className:"default-card-header-space"},h.ProfileCard_Organization),i.createElement("span",{className:"icon bowtie-icon bowtie-chevron-right-light default-card-header-chevron"})))),i.createElement("div",{className:"default-card-direct-manager"},i.createElement("div",{className:"default-card-header-reportsto"},h.ProfileCard_ReportsToHeader),n)):null},t}(i.Component);t.DefaultCard=a});

define("VSS/Identities/Picker/DefaultAbridgedCard",["require","exports","react","OfficeFabric/components/Persona/Persona","OfficeFabric/components/Persona/Persona.types","OfficeFabric/Label","OfficeFabric/Tooltip","VSS/Identities/Picker/DefaultCard","VSS/Resources/VSS.Resources.Platform","VSS/LoaderPlugins/Css!PersonaCard"],function(n,t,i,r,u,f,e,o,s){Object.defineProperty(t,"__esModule",{value:!0});t.DefaultAbridgedCard=void 0;var h=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t.prototype.render=function(){var t=this,n={imageUrl:this.props.identity.image,primaryText:this.props.identity.displayName},h=i.createElement("div",null,i.createElement(r.Persona,__assign({},n,{key:this.props.identity.entityId,size:u.PersonaSize.large,className:"persona-main",onRenderPrimaryText:function(){return i.createElement(e.TooltipHost,{key:"".concat(t.props.identity.entityId,".primarytext.tooltip"),content:n.primaryText,overflowMode:e.TooltipOverflowMode.Parent},i.createElement("span",{className:"persona-main-text-primary"},n.primaryText))},imageShouldFadeIn:!1})));return i.createElement("div",{className:"default-card-abridged"},h,this._verifySignInAddress()&&i.createElement("div",null,i.createElement("div",{className:"default-card-contact-info-wrapper"},i.createElement("hr",{className:"hr-main"}),i.createElement("div",{className:"default-card-header-wrapper"},i.createElement("span",{className:"default-card-header"},i.createElement(f.Label,null,i.createElement("b",{className:"default-card-header-space"},s.ProfileCard_ContactHeader)))),i.createElement("div",{className:"default-card-contact-info-container"},i.createElement(o.DefaultCardContactLine,{iconName:"Mail",content:this.props.identity.signInAddress,link:"mailto:"+this.props.identity.signInAddress,publishTelemetry:this.props.publishTelemetry}),i.createElement(o.DefaultCardContactLine,{iconName:"Chat",content:s.ProfileCard_SendChat,link:"sip:"+this.props.identity.signInAddress,publishTelemetry:this.props.publishTelemetry})))))},t.prototype._verifySignInAddress=function(){if(!this.props.identity.signInAddress)return!1;return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(this.props.identity.signInAddress)?!0:!1},t}(i.Component);t.DefaultAbridgedCard=h});

define("VSS/Identities/Picker/DefaultSimpleCard",["require","exports","react","OfficeFabric/components/Persona/Persona","OfficeFabric/components/Persona/Persona.types","OfficeFabric/Tooltip","VSS/LoaderPlugins/Css!PersonaCard"],function(n,t,i,r,u,f){Object.defineProperty(t,"__esModule",{value:!0});t.DefaultSimpleCard=void 0;var e=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t.prototype.render=function(){var t=this,n={imageUrl:this.props.identity.image,primaryText:this.props.identity.displayName,secondaryText:this.props.identity.scopeName&&this.props.identity.signInAddress?this.props.identity.scopeName+"\\"+this.props.identity.signInAddress:this.props.identity.signInAddress?this.props.identity.signInAddress:""};return i.createElement("div",{className:"default-card-simple"},i.createElement("div",null,i.createElement(r.Persona,__assign({},n,{key:this.props.identity.entityId,size:u.PersonaSize.large,className:"persona-main",onRenderPrimaryText:function(){return i.createElement(f.TooltipHost,{key:"".concat(t.props.identity.entityId,".primarytext.tooltip"),content:n.primaryText,overflowMode:f.TooltipOverflowMode.Parent},i.createElement("span",{className:"persona-main-text-primary"},n.primaryText))},onRenderSecondaryText:function(){return i.createElement(f.TooltipHost,{key:"".concat(t.props.identity.entityId,".secondarytext.tooltip"),content:n.secondaryText,overflowMode:f.TooltipOverflowMode.Parent},i.createElement("span",{className:"persona-main-text-secondary"},n.secondaryText))},imageShouldFadeIn:!1}))))},t}(i.Component);t.DefaultSimpleCard=e});

define("VSS/Identities/Picker/OrganizationCard",["require","exports","react","OfficeFabric/components/Persona/Persona","OfficeFabric/components/Persona/Persona.types","OfficeFabric/Label","VSS/Identities/Picker/PersonaCardContracts","VSS/Resources/VSS.Resources.Platform","VSS/Utils/String","VSS/LoaderPlugins/Css!PersonaCard"],function(n,t,i,r,u,f,e,o,s){Object.defineProperty(t,"__esModule",{value:!0});t.OrganizationCard=void 0;var h=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t.prototype.render=function(){var n=this.props,u=n.identity,e=n.managerList,h=n.directReportList,r=this.createManagerChainPersonaElements(),t=this.createDirectReportsPersonaElements();return i.createElement("div",{className:"contact-or-organization-card-wrapper"},i.createElement("div",{className:"organization-card-content"},i.createElement("div",{className:"organization-card-header-wrapper"},i.createElement("div",{style:{fontSize:14}},i.createElement(f.Label,null,o.ProfileCard_Organization))),i.createElement("div",{className:"organization-card-manager-chain-wrapper"},r),t.length>0&&i.createElement("div",{className:"organization-card-direct-reports-wrapper"},i.createElement(f.Label,{className:"organization-card-direct-reports-label"},s.format(o.ProfileCard_ReportingToPhrase,this.props.identity.displayName,this.props.directReportList.length)),t)))},t.prototype.createManagerChainPersonaElements=function(){var o=this,n=this,f=this.props.managerList.map(function(t){var f={imageUrl:t.image,primaryText:t.displayName?t.displayName:"",secondaryText:t.jobTitle?t.jobTitle:"",tertiaryText:t.department?t.department:""};return i.createElement("div",{className:"persona-list-element profile-card-tab-element","aria-label":t.displayName,key:t.entityId+t.signInAddress,onClick:function(){n.props.publishTelemetry(e.personaCardEntity.orgCardManagerChain,e.personaCardEntity.loaded,e.personaCardEntity.orgCard);n.props.onClickEntity(t)},"data-is-focusable":!0,role:"button"},i.createElement(r.Persona,__assign({},f,{size:u.PersonaSize.size40,onRenderPrimaryText:function(){return i.createElement("div",{className:"persona-list-element-text-primary"},f.primaryText)},onRenderSecondaryText:function(){return i.createElement("div",{className:"persona-list-element-text-secondary"},f.secondaryText)},imageShouldFadeIn:!1})))}),t={imageUrl:this.props.identity.image,primaryText:this.props.identity.displayName,secondaryText:this.props.identity.jobTitle,tertiaryText:this.props.identity.department};return f.push(i.createElement("div",{className:"persona-list-element profile-card-tab-element","aria-label":this.props.identity.displayName,key:this.props.identity.entityId+this.props.identity.signInAddress,onClick:function(){n.props.publishTelemetry(e.personaCardEntity.personaCard,e.personaCardEntity.loaded,e.personaCardEntity.orgCard);n.props.onClickEntity(o.props.identity)},"data-is-focusable":!0,role:"button"},i.createElement(r.Persona,__assign({},t,{size:u.PersonaSize.size40,onRenderPrimaryText:function(){return i.createElement("div",{className:"persona-list-element-text-primary"},t.primaryText)},onRenderSecondaryText:function(){return i.createElement("div",{className:"persona-list-element-text-secondary"},t.secondaryText)},imageShouldFadeIn:!1})))),f},t.prototype.createDirectReportsPersonaElements=function(){var n=this;return this.props.directReportList.map(function(t){var f={imageUrl:t.image,primaryText:t.displayName?t.displayName:"",secondaryText:t.jobTitle?t.jobTitle:"",tertiaryText:t.department?t.department:""};return i.createElement("div",{className:"persona-list-element profile-card-tab-element","aria-label":t.displayName,key:t.entityId+t.signInAddress,onClick:function(){n.props.publishTelemetry(e.personaCardEntity.orgCardDirectReport,e.personaCardEntity.loaded,e.personaCardEntity.orgCard);n.props.onClickEntity(t)},"data-is-focusable":!0,role:"button"},i.createElement(r.Persona,__assign({},f,{size:u.PersonaSize.size40,onRenderPrimaryText:function(){return i.createElement("div",{className:"persona-list-element-text-primary"},f.primaryText)},onRenderSecondaryText:function(){return i.createElement("div",{className:"persona-list-element-text-secondary"},f.secondaryText)},imageShouldFadeIn:!1})))})},t}(i.Component);t.OrganizationCard=h});

define("VSS/Identities/Picker/PersonaCardIdentityUtils",["require","exports","VSS/Identities/Picker/Services"],function(n,t,i){function s(n){return n?r(n)||u(n)?!!(n.mail||n.mailNickname||n.jobTitle||n.department||n.physicalDeliveryOfficeName||n.manager||n.surname||n.telephoneNumber):f(n)||e(n)?!!n.signInAddress:o(n)?!!(n.scopeName||n.signInAddress):!1:!1}function r(n){return n&&n.originDirectory.trim().toLowerCase()===i.ServiceHelpers.AzureActiveDirectory}function u(n){return n&&n.originDirectory.trim().toLowerCase()===i.ServiceHelpers.ActiveDirectory}function f(n){return n&&n.originDirectory.trim().toLowerCase()===i.ServiceHelpers.VisualStudioDirectory}function e(n){return n&&n.originDirectory.trim().toLowerCase()===i.ServiceHelpers.GitHubDirectory}function o(n){return n&&n.originDirectory.trim().toLowerCase()===i.ServiceHelpers.WindowsMachineDirectory}Object.defineProperty(t,"__esModule",{value:!0});t.isWmdUser=t.isGitHubUser=t.isVsdUser=t.isAdUser=t.isAadUser=t.isCompleteIdentity=void 0;t.isCompleteIdentity=s;t.isAadUser=r;t.isAdUser=u;t.isVsdUser=f;t.isGitHubUser=e;t.isWmdUser=o});

define("VSS/Identities/Picker/PersonaCardHeaderElement",["require","exports","react","OfficeFabric/components/Persona/Persona","OfficeFabric/components/Persona/Persona.types","OfficeFabric/Icon","OfficeFabric/Tooltip","VSS/Resources/VSS.Resources.Platform","VSS/LoaderPlugins/Css!PersonaCard"],function(n,t,i,r,u,f,e,o){Object.defineProperty(t,"__esModule",{value:!0});t.PersonaCardHeaderElement=void 0;var s=function(n){function t(t){return n.call(this,t)||this}return __extends(t,n),t.prototype.componentDidMount=function(){this.props.setFocus()},t.prototype.componentDidUpdate=function(){this.props.setFocus()},t.prototype.render=function(){var s=this,n,t;return this.props.identity?(n=this.props.identity,t={imageUrl:n.image,primaryText:n.displayName,secondaryText:n.jobTitle,tertiaryText:n.department},i.createElement("div",{className:"go-back-persona-wrapper",onClick:this.props.onClickFunction,"aria-label":o.ProfileCard_HeaderButtonAriaLabel,ref:function(n){s._personaElement=n},"data-is-focusable":!0,role:"button"},i.createElement("div",null,i.createElement(f.Icon,{iconName:"ChevronLeft",className:"go-back-chevron"})),i.createElement("div",{className:"go-back-positioning"},i.createElement(r.Persona,__assign({},t,{size:u.PersonaSize.extraExtraSmall,className:"go-back-persona",onRenderPrimaryText:function(){return i.createElement(e.TooltipHost,{key:"".concat(n.entityId,".tooltip"),content:n.displayName,overflowMode:e.TooltipOverflowMode.Parent},i.createElement("span",{className:"persona-header-text-primary"},n.displayName))},imageShouldFadeIn:!1}))))):null},t.prototype.setFocus=function(){this._personaElement&&this._personaElement.focus()},t}(i.Component);t.PersonaCardHeaderElement=s});

var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__decorate=this&&this.__decorate||function(n,t,i,r){var f=arguments.length,u=f<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,e,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(n,t,i,r);else for(o=n.length-1;o>=0;o--)(e=n[o])&&(u=(f<3?e(u):f>3?e(t,i,u):e(t,i))||u);return f>3&&u&&Object.defineProperty(t,i,u),u};define("VSS/Identities/Picker/PersonaCardContent",["require","exports","react","OfficeFabric/Callout","OfficeFabric/FocusZone","OfficeFabric/Spinner","OfficeFabric/Utilities","VSS/Context","VSS/Identities/Picker/ContactCard","VSS/Identities/Picker/DefaultAbridgedCard","VSS/Identities/Picker/DefaultSimpleCard","VSS/Identities/Picker/DefaultCard","VSS/Identities/Picker/OrganizationCard","VSS/Identities/Picker/PersonaCardContracts","VSS/Identities/Picker/PersonaCardIdentityUtils","VSS/Identities/Picker/PersonaCardHeaderElement","VSS/Resources/VSS.Resources.Platform","VSS/Telemetry/Services","VSS/Utils/String"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){Object.defineProperty(t,"__esModule",{value:!0});t.PersonaCardContent=void 0;var d=function(n){function t(){var t=__construct(this,n,arguments);for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);return t}return __extends(t,n),t.prototype.componentDidMount=function(){this._publishTelemetry(v.personaCardEntity.personaCard,v.personaCardEntity.loaded)},t.prototype.componentDidUpdate=function(){var n=y.isVsdUser(this.props.dataProps.identity);this.props.dataProps.header||n||this._focusOnUpdate()},t.prototype.render=function(){var n=this.props.referenceHTMLComponent?this.props.referenceHTMLComponent:this.props.target;return i.createElement("div",null,i.createElement(r.Callout,{onDismiss:this._onDismissCallout,target:n,ariaLabel:w.ProfileCard_AriaLabel,role:"alert",isBeakVisible:!1,gapSpace:10,className:"persona-card-callout"},i.createElement("div",null,this._renderCard())))},t.prototype._renderCard=function(){var n="persona-card-styles";if(this.props.working&&!y.isCompleteIdentity(this.props.dataProps.identity))return i.createElement("div",{className:e.css(n,"loading")},i.createElement(e.DelayedRender,{delay:300},i.createElement(f.Spinner,{label:w.Loading,type:f.SpinnerType.large,className:"persona-card-loading-spinner"})));var r=y.isAdUser(this.props.dataProps.identity)||y.isAadUser(this.props.dataProps.identity),t=this.props.dataProps.header||null,o=this.props.dataProps.cardType===v.CardType.Organization?u.FocusZoneDirection.vertical:u.FocusZoneDirection.horizontal;return i.createElement(u.FocusZone,{className:n,handleTabKey:1,isCircularNavigation:!0,componentRef:this._onFocusZoneRef,direction:o},r&&t&&i.createElement(p.PersonaCardHeaderElement,{identity:t,onClickFunction:this.props.onHeaderClick,setFocus:this._focusOnUpdate}),this._renderInnerCard())},t.prototype._onFocusZoneRef=function(n){this._focusZone=n;this._focusOnUpdate()},t.prototype._focusOnUpdate=function(){var t=this.props.dataProps.directReportList,n=this.props.dataProps.identity,i=y.isAadUser(n),r=y.isAdUser(n),u=y.isVsdUser(n);this.props.dataProps.cardType===v.CardType.Default&&t?this._focusZone.focus():this.props.dataProps.cardType!==v.CardType.Default&&this._focusZone.focus()},t.prototype._renderInnerCard=function(){var r=this.props.dataProps,n=r.identity,t=r.managerList,f=r.directReportList,u;if(!n)return null;var e=y.isVsdUser(n),o=y.isWmdUser(n),p=y.isAadUser(n),w=y.isAdUser(n);if(e)return i.createElement(h.DefaultAbridgedCard,{identity:n,publishTelemetry:this._publishTelemetry});if(o)return i.createElement(c.DefaultSimpleCard,{identity:n});if(p||w)switch(this.props.dataProps.cardType){case v.CardType.Default:return u=t&&t.length>0?t[t.length-1]:null,i.createElement(l.DefaultCard,{identity:n,manager:u,isPreviousHeader:!!this.props.dataProps.previousDataState||!!this.props.initialHeader,showContactCard:this.props.onShowContactCard,showOrganizationCard:this.props.onShowOrganizationCard,onClickEntity:this.props.onClickEntity,publishTelemetry:this._publishTelemetry,setFocus:this._focusOnUpdate});case v.CardType.Contact:return i.createElement(s.ContactCard,{identity:n,publishTelemetry:this._publishTelemetry});case v.CardType.Organization:return i.createElement(a.OrganizationCard,{identity:n,managerList:t,directReportList:f,onClickEntity:this.props.onClickEntity,publishTelemetry:this._publishTelemetry})}return null},t.prototype._onDismissCallout=function(){this.props.onDismissCallback&&this.props.onDismissCallback()},t.prototype._publishTelemetry=function(n,t,i){var u=o.getPageContext().navigation.routeId,r={Action:k.format("{0}{1}",n,t)};this.props.consumer&&(r.Consumer=this.props.consumer);i&&(r.Source=i);b.publishEvent(new b.TelemetryEventData(u,v.personaCardEntity.featureName,r))},__decorate([e.autobind],t.prototype,"_onFocusZoneRef",null),__decorate([e.autobind],t.prototype,"_focusOnUpdate",null),__decorate([e.autobind],t.prototype,"_onDismissCallout",null),__decorate([e.autobind],t.prototype,"_publishTelemetry",null),t}(i.Component);t.PersonaCardContent=d});

var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},__decorate=this&&this.__decorate||function(n,t,i,r){var f=arguments.length,u=f<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,e,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(n,t,i,r);else for(o=n.length-1;o>=0;o--)(e=n[o])&&(u=(f<3?e(u):f>3?e(t,i,u):e(t,i))||u);return f>3&&u&&Object.defineProperty(t,i,u),u},__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))};define("VSS/Identities/Picker/PersonaCard",["require","exports","react","OfficeFabric/Utilities","VSS/Context","VSS/Diag","VSS/Identities/Picker/Constants","VSS/Identities/Picker/PersonaCardContent","VSS/Identities/Picker/PersonaCardContracts","VSS/Identities/Picker/PersonaCardIdentityUtils","VSS/Identities/Picker/Services","VSS/Performance","VSS/Resources/VSS.Resources.Platform","VSS/Service","VSS/Telemetry/Services","VSS/Utils/String","VSS/LoaderPlugins/Css!PersonaCard"],function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var w,b;Object.defineProperty(t,"__esModule",{value:!0});t.PersonaCard=t.managerConnectionType=t.managerAndDirectReportsConnectionType=t.userIdentityType=t.sourceImsAdOperationScope=t.sourceImsOperationScope=t.sourceAdOperationScope=t.sourceOperationScope=void 0;t.sourceOperationScope={Source:!0};t.sourceAdOperationScope={Source:!0,AD:!0};t.sourceImsOperationScope={Source:!0,IMS:!0};t.sourceImsAdOperationScope={Source:!0,IMS:!0,AD:!0};t.userIdentityType={User:!0};t.managerAndDirectReportsConnectionType={managers:!0,directReports:!0};t.managerConnectionType={managers:!0};w=function(n){return(n.uniqueAttribute||n.identity||n.displayName)&&!h.isGitHubUser(n.identity)?i.createElement(b,__assign({},n)):null};t.PersonaCard=w;b=function(n){function w(t){var i=__construct(this,n,[t]),u,r,f;for(u in i)i.hasOwnProperty(u)&&(this[u]=i[u]);return i._IdentityService=v.getService(c.IdentityService),r={identity:t.identity,managerList:null,directReportList:null,previousDataState:null,cardType:s.CardType.Default,header:t.initialHeader?t.initialHeader.identity:null,displayName:t.displayName,imageUrl:t.imageUrl,email:i._getEmail()},f=!0,t.identity||t.uniqueAttribute||!t.displayName||(r.identity={entityId:"",entityType:"user",originDirectory:"vsd",originId:"",displayName:t.displayName,image:t.imageUrl,signInAddress:r.email},f=!1),i.state={dataState:r,working:f},f&&i._setupInitialData(r,t.uniqueAttribute),i}return __extends(w,n),w.prototype.componentDidMount=function(){this._routeId=u.getPageContext().navigation.routeId;this._scenarioDescriptor=l.getScenarioManager().startScenario(this._routeId,s.personaCardEntity.featureName)},w.prototype.componentDidUpdate=function(n,t){this._scenarioDescriptor.isActive()&&(this.state.dataState.cardType===s.CardType.Default?this.state.working&&t.working?(this._contactSectionLoad=l.getTimestamp(),this._scenarioDescriptor.addSplitTiming("ContactSectionLoaded",this._contactSectionLoad-this._scenarioDescriptor.getStartTime())):!this.state.working&&t.working&&this._scenarioDescriptor.addSplitTiming("ManagerSectionLoaded",l.getTimestamp()-this._contactSectionLoad):this.state.dataState.cardType===s.CardType.Organization&&(this.state.working&&!t.working?this._orgCardLoad=l.getTimestamp():!this.state.working&&t.working&&this._scenarioDescriptor.addSplitTiming("ManagerAndReportsToChainLoaded",l.getTimestamp()-this._orgCardLoad)))},w.prototype.componentWillUnmount=function(){this._dismissed=!0;this._scenarioDescriptor.isActive()&&this._scenarioDescriptor.end()},w.prototype.render=function(){return i.createElement(o.PersonaCardContent,__assign({},this.props,{dataProps:this.state.dataState,onClickEntity:this._onClickEntity,onDismissCallback:this._onDismissCallback,onShowContactCard:this._onShowContactCard,onShowOrganizationCard:this._onShowOrganizationCard,working:this.state.working,onHeaderClick:this._headerOnClickHandler}))},w.prototype._onDismissCallback=function(){this._scenarioDescriptor.isActive()&&!h.isCompleteIdentity(this.state.dataState.identity)&&(this._scenarioDescriptor.addSplitTiming("Spinner load time for card dismissal before identity fetch"),this._scenarioDescriptor.end());this.props.onDismissCallback()},w.prototype._headerOnClickHandler=function(){this.state.dataState.previousDataState?this.setState({dataState:this.state.dataState.previousDataState,working:!1}):this.props.initialHeader&&this.props.initialHeader.onClickFunction&&this.props.initialHeader.onClickFunction()},w.prototype._onShowContactCard=function(){var n=__assign(__assign({},this.state.dataState),{previousDataState:this.state.dataState,cardType:s.CardType.Contact,header:this.state.dataState.identity});this.setState({dataState:n})},w.prototype._onShowOrganizationCard=function(){var n=this,e,f,i,u,r;this.state.working||(e=function(t,i){i&&i.managers&&i.directReports&&!n._dismissed&&(i.managers.reverse(),n.state.dataState&&n.state.dataState.identity===t&&(n.setState({dataState:__assign(__assign({},n.state.dataState),{managerList:i.managers,directReportList:i.directReports}),working:!1}),n._getImagesForDataState()))},f=this.state.dataState,f.managerList&&f.managerList.length<=1?(i=this.state.dataState,r=__assign(__assign({},i),{cardType:s.CardType.Organization,header:i.identity,previousDataState:i}),this.setState({dataState:r,working:!0}),this._IdentityService.getIdentityConnections(i.identity,h.isAdUser(i.identity)?t.sourceAdOperationScope:t.sourceOperationScope,t.userIdentityType,t.managerAndDirectReportsConnectionType,null,null,6).then(function(n){return e(i.identity,n)},function(t){n._publishErrorTelemetry("ConnectionsOrgCard",t)})):(u=this.state.dataState,r=__assign(__assign({},u),{cardType:s.CardType.Organization,header:u.identity,previousDataState:u}),this.setState({dataState:r,working:!1})))},w.prototype._onClickEntity=function(n){if(!this.state.working){this._scenarioDescriptor.isActive()&&(this._scenarioDescriptor.end(),this._scenarioDescriptor=l.getScenarioManager().startScenario(this._routeId,s.personaCardEntity.featureName));var t=this.state.dataState,i={identity:n,cardType:s.CardType.Default,header:t.identity,directReportList:[],managerList:[],previousDataState:t,displayName:n.displayName,imageUrl:n.image,email:n.mail};this.setState({dataState:i,working:!0});this._getIdentityByUniqueAttribute(n)}},w.prototype._setupInitialData=function(n,i){var r=this;n.identity?h.isCompleteIdentity(n.identity)?c.ServiceHelpers.isAuthenticatedMember()&&this._IdentityService.getIdentityConnections(n.identity,h.isAdUser(n.identity)?t.sourceAdOperationScope:t.sourceOperationScope,t.userIdentityType,t.managerConnectionType,null,null,1).then(function(t){return r._getConnectionsSuccessCallback(n,t)},function(n){r._publishErrorTelemetry("ConnectionsIdentityPassedInDirectManager",n)}):this._getIdentityByUniqueAttribute(n.identity):this._getIdentityByUniqueAttribute(i)},w.prototype._getIdentityByUniqueAttribute=function(n){var i=this,r,o,s;r=typeof n=="string"?n:h.isAadUser(n)||h.isAdUser(n)?n.entityId:n.signInAddress;o={UID:!0};s={identityServiceOptions:{operationScope:u.getPageContext().webAccessConfiguration.isHosted?t.sourceImsOperationScope:t.sourceImsAdOperationScope,identityType:t.userIdentityType,httpClient:null,extensionData:null},identityExtensionOptions:{consumerId:this.props.consumerId||e.ConsumerId.UnknownConsumer},prefix:r,queryTypeHint:o,sources:["Directory"]};this.props.entityOperationsFacade.search(s).then(function(n){for(var t in n.queryTokenResponse)n.queryTokenResponse[t].then(function(n){return i._getIdentitiesSuccessCallback(n)},function(n){i._publishErrorTelemetry("IdentityNotPresent",n)})},function(n){i._publishErrorTelemetry("IdentitySearch",n);(function(n){return f.logError("_resolveInputToIdentities/getIdentitiesErrorCallback:"+JSON.stringify(n))})})},w.prototype._getIdentitiesSuccessCallback=function(n){var u=this,f;if(n&&!this._dismissed)if(n.identities&&n.identities.length!=0){var i=n.identities[0],e=h.isCompleteIdentity(this.state.dataState.identity),o=h.isAadUser(i)||h.isAdUser(i),s=this.props.imageUrl?this.props.imageUrl:i.image,r=__assign(__assign({},this.state.dataState),{identity:i,displayName:i.displayName,imageUrl:s}),l=c.ServiceHelpers.isAuthenticatedMember();l?!e&&o?(this.setState({dataState:r,working:!0}),this._IdentityService.getIdentityConnections(i,h.isAdUser(i)?t.sourceAdOperationScope:t.sourceOperationScope,t.userIdentityType,t.managerConnectionType,null,null,1).then(function(n){return u._getConnectionsSuccessCallback(r,n)},function(n){u._publishErrorTelemetry("ConnectionsIdentityFetchedDirectManager",n)})):(this.setState({working:!0}),this._setupInitialData(r)):(this.setState({dataState:r,working:!1}),this._getImagesForDataState())}else f=__assign(__assign({},this.state.dataState),{identity:this._getDerivedIdentity()}),this.setState({dataState:f,working:!1})},w.prototype._getConnectionsSuccessCallback=function(n,t){t&&t.managers&&!this._dismissed&&(this.setState({dataState:__assign(__assign({},n),{managerList:t.managers.reverse(),directReportList:t.directReports}),working:!1}),this._getImagesForDataState())},w.prototype._getDerivedIdentity=function(){if(this.state.dataState.identity)return this.state.dataState.identity;var n=this.props.imageUrl?this.props.imageUrl:this.state.dataState.imageUrl;return{entityId:"",entityType:"user",originDirectory:"vsd",originId:"",displayName:this.state.dataState.displayName?this.state.dataState.displayName:a.IdentityPicker_NoResult,image:n,signInAddress:this.state.dataState.email}},w.prototype._getImagesForDataState=function(){var i=this,n=this.state.dataState,t=__spreadArray(__spreadArray(__spreadArray([],n.identity.image?[]:[n.identity],!0),(n.managerList||[]).filter(function(n){return!n.image}),!0),(n.directReportList||[]).filter(function(n){return!n.image}),!0);t&&t.length>0&&this.props.entityOperationsFacade.getImagesForEntities(t).then(this._getImagesForEntitiesCallback.bind(this),function(n){i._publishErrorTelemetry("Image",n)})},w.prototype._getImagesForEntitiesCallback=function(n){var t,r,i;if(n&&!this._dismissed){var u=this.state.dataState.identity,f=this.state.dataState.managerList,e=this.state.dataState.directReportList||[],o=__spreadArray(__spreadArray(__spreadArray([],e,!0),f,!0),[u],!1);for(t=0,r=o;t<r.length;t++)i=r[t],i.entityId in n&&(i.image=n[i.entityId]);this.setState({dataState:__assign(__assign({},this.state.dataState),{identity:u,managerList:f,directReportList:e})})}},w.prototype._getEmail=function(){var n,t;return h.isAadUser(this.props.identity)||h.isAdUser(this.props.identity)?this.props.identity.mail:this.props.identity&&this.props.identity.signInAddress?this.props.identity.signInAddress:this.props.identity&&this.props.identity.mail?this.props.identity.mail:this.props.uniqueAttribute&&(n=this.props.uniqueAttribute.split("@"),n.length===2&&n[0].length>=1&&n[1].length>=3&&(t=n[1].split("."),t.length>1))?this.props.uniqueAttribute:null},w.prototype._publishErrorTelemetry=function(n,t){var i=u.getPageContext().navigation.routeId,r={Action:p.format("{0} fetch failed",n),ErrorName:t.name,ErrorMessage:t.message};y.publishEvent(new y.TelemetryEventData(i,s.personaCardEntity.featureName,r))},__decorate([r.autobind],w.prototype,"_onDismissCallback",null),__decorate([r.autobind],w.prototype,"_headerOnClickHandler",null),__decorate([r.autobind],w.prototype,"_onShowContactCard",null),__decorate([r.autobind],w.prototype,"_onShowOrganizationCard",null),__decorate([r.autobind],w.prototype,"_onClickEntity",null),__decorate([r.autobind],w.prototype,"_getConnectionsSuccessCallback",null),w}(i.Component)});

define("VSSPreview/Providers/IdentityDetailsProvider",["require","exports","react","VSS/Common/Contracts/Platform","VSS/Context","VSS/Contributions/LocalPageData","VSS/FeatureAvailability/Services","VSS/Identities/Picker/Controls","VSS/Identities/Picker/PersonaCard","VSS/Locations","VSS/Service","VSS/Utils/Url","VSS/WebApi/Constants"],function(n,t,i,r,u,f,e,o,s,h,c,l,a){Object.defineProperty(t,"__esModule",{value:!0});t.IdentityDetailsProvider=void 0;var v=function(){function n(n,t){this._identity=n;this._consumerId=t}return n.prototype.getIdentityImageUrl=function(n){var t=this._identity,i;return t._links&&t._links.avatar&&t._links.avatar.href&&!e.FeatureAvailabilityService.isFeatureEnabled("VisualStudio.Services.WebPlatform.DisableNewAvatarImage",!1)?(i=new l.Uri(t._links.avatar.href),i.addQueryParam("size",""+this._getServerImageSize(n),!0),i.absoluteUri):this._getOldStyleImageUrl(n)},n.prototype._getOldStyleImageUrl=function(n){var i=this._identity,t,f,e;return i.id?(t={id:i.id},f=this._getImageId(i.id),f&&(t.t=f),e=u.getPageContext(),e&&e.webAccessConfiguration.isHosted&&(t.size=this._getServerImageSize(n)),h.urlHelper.getMvcUrl({serviceInstanceId:a.ServiceInstanceTypes.TFS,action:"IdentityImage",area:"api",controller:"common",level:r.NavigationContextLevels.Collection,queryParams:t})):null},n.prototype.getDisplayName=function(){if(this._identity.displayName)return this._identity.displayName;var n=this._getIdentityDetails(this._identity.id);return n&&n.displayName},n.prototype.onRenderPersonaCard=function(n,t){return!this._identity.isContainer&&i.createElement(s.PersonaCard,{uniqueAttribute:this._identity.uniqueName,target:n,entityOperationsFacade:c.getService(o.EntityOperationsFacade),onDismissCallback:t,displayName:this._identity.displayName,consumerId:this._consumerId})},n.prototype._getIdentityDetails=function(n){if(!n)return null;var t=f.getSharedData("_identityDetails");return t&&t[n]},n.prototype._getImageId=function(n){var t=this._getIdentityDetails(n);return t&&t.identityImageId},n.prototype._getServerImageSize=function(n){return n<=34?0:n<=44?1:2},n}();t.IdentityDetailsProvider=v});

define("Presentation/Scripts/TFS/TFS.Host.TfsContext",["require","exports","VSS/VSS","VSS/Context","VSS/Diag","VSS/Common/Contracts/Platform","VSS/Contributions/LocalPageData"],function(n,t,i,r,u,f,e){function l(){h=$.now()}var h,s,a,o,c;Object.defineProperty(t,"__esModule",{value:!0});t.TfsContext=t.TeamFoundationHostType=t.NavigationContextLevels=t.Configuration=t.setImageTimestamp=void 0;t.setImageTimestamp=l;s=function(){function n(n){this._options=n||{}}return n.prototype.getRootPath=function(){return this._options.rootPath||"/"},n.prototype.getTheme=function(){return this._options.theme||"Default"},n.prototype.getResourcesPath=function(){return this._options.resourcesPath||this.getRootPath()+"_content/"},n.prototype.getResourcesFile=function(n){return this.getResourcesPath()+encodeURIComponent(n)},n.prototype.getTfsStaticRootPath=function(){return this._options.staticRootTfs||"/tfs/_static/tfs/12/"},n.prototype.get3rdPartyStaticRootPath=function(){return this._options.staticRoot3rdParty||"/tfs/_static/3rdParty/"},n.prototype.getThemedFile=function(n){return this.getTfsStaticRootPath()+"App_Themes/"+encodeURIComponent(this.getTheme())+"/"+encodeURIComponent(n)},n.prototype.getWebApiVersion=function(){return this._options.webApiVersion||"1"},n.prototype.getMailSettings=function(){return this._options.mailSettings},n}();t.Configuration=s,function(n){n[n.None=0]="None";n[n.Deployment=1]="Deployment";n[n.Application=2]="Application";n[n.Collection=4]="Collection";n[n.Project=8]="Project";n[n.Team=16]="Team";n[n.ApplicationAll=15]="ApplicationAll";n[n.All=31]="All"}(a=t.NavigationContextLevels||(t.NavigationContextLevels={})),function(n){n[n.Parent=-1]="Parent";n[n.Unknown=0]="Unknown";n[n.Deployment=1]="Deployment";n[n.Application=2]="Application";n[n.ProjectCollection=4]="ProjectCollection"}(o=t.TeamFoundationHostType||(t.TeamFoundationHostType={}));c=function(){function n(t){n._addedFpsCallback||(n._addedFpsCallback=!0,document.body.addEventListener("legacyFpsComplete",function(){n._defaultTfsContext=undefined}));this.initialize(t)}return n.getContextOrDefault=function(t){var i=r.parseWebContext(t);return i?new n(i):n.getDefault()},n.getDefault=function(){if(!n._defaultTfsContext){var t=r.getDefaultWebContext();if(!t)throw new Error("Default context information is missing.");n.setDefaultContext(t)}return n._defaultTfsContext},n.tryGetDefaultContext=function(){if(typeof n._defaultTfsContext=="undefined"){var t=r.getDefaultWebContext();t?n.setDefaultContext(t):n._defaultTfsContext=null}return n._defaultTfsContext},n.setDefaultContext=function(t){n._previousTfsContext?(n._previousTfsContext.initialize(t),n._defaultTfsContext=n._previousTfsContext):(n._defaultTfsContext=new n(t),n._previousTfsContext=n._defaultTfsContext)},n.prototype.initialize=function(t){this.contextData=t;var i=r.getPageContext();this.navigation={applicationServiceHost:n.createServiceHost(t.account,f.ContextHostType.Application,t,i.webAccessConfiguration.paths.rootPath),area:i.navigation.area,areaPrefix:i.webAccessConfiguration.api.areaPrefix,collection:n.createServiceHost(t.collection,f.ContextHostType.ProjectCollection,t,i.webAccessConfiguration.paths.rootPath),controllerPrefix:i.webAccessConfiguration.api.controllerPrefix,currentAction:i.navigation.currentAction,currentController:i.navigation.currentController,currentParameters:i.navigation.currentParameters,project:null,projectId:null,publicAccessPoint:{authority:t.host.authority,scheme:t.host.scheme,uri:t.account?t.account.uri:t.host.uri},serviceHost:n.createServiceHost(t.host,t.host.hostType,t,i.webAccessConfiguration.paths.rootPath),topMostLevel:i.navigation.topMostLevel,team:null,teamId:null};this.navigation.publicAccessPoint.uri[this.navigation.publicAccessPoint.uri.length-1]!=="/"&&(this.navigation.publicAccessPoint.uri+="/");t.project&&(this.navigation.project=t.project.name,this.navigation.projectId=t.project.id);t.team&&i.navigation.topMostLevel===f.NavigationContextLevels.Team&&(this.navigation.team=t.team.name,this.navigation.teamId=t.team.id);this.configuration=new s({mailSettings:i.webAccessConfiguration.mailSettings,resourcesPath:i.webAccessConfiguration.paths.resourcesPath,rootPath:i.webAccessConfiguration.paths.rootPath,staticRoot3rdParty:i.webAccessConfiguration.paths.staticRoot3rdParty,staticRootTfs:i.webAccessConfiguration.paths.staticRootTfs,theme:i.globalization.theme,webApiVersion:i.webAccessConfiguration.api.webApiVersion});this.isHosted=!!i.webAccessConfiguration.isHosted;this.allowStatsCollection=!!i.diagnostics.allowStatsCollection;this.activityId=i.diagnostics.activityId;this.sessionId=i.diagnostics.sessionId;this.isAADAccount=!!t.host.isAADAccount;this.isSameHost=window.self==window.top;t.user&&(this.currentUser=t.user.name,this.standardAccessMode=!t.user.limitedAccess,this.currentIdentity={displayName:t.user.name,email:t.user.email,id:t.user.id,isActive:!0,isContainer:!1,uniqueName:t.user.uniqueName});t.team&&(this.currentTeam={name:t.team.name,identity:{displayName:t.team.name,id:t.team.id,isActive:!0,isContainer:!0,email:null,uniqueName:null}})},n.createServiceHost=function(n,t,i,r){return n?{hostType:t,name:n.name,instanceId:n.id,uri:n.uri,relVDir:this.trimVirtualPath(n.relativeUri,r),vDir:n.relativeUri}:null},n.trimVirtualPath=function(n,t){if(!n||n.length===0)return n;for(n.toLowerCase().indexOf(t.toLowerCase())===0&&(n=n.substr(t.length));n.length>0&&n[0]==="/";)n=n.substr(1);while(n.length>0&&n[n.length-1]==="/")n=n.substr(0,n.length-1);return n},n.prototype.getSessionId=function(){var t,r,i,u,n;for(t=this.sessionId,r=document.cookie?document.cookie.split("; "):[],i=0,u=r.length;i<u;i++)if(n=r[i].split("="),n&&n.length===2&&n[0]==="Tfs-SessionId"){t=n[1];break}return this.sessionId=t,t},n.prototype.getHostUrl=function(){return this.navigation.publicAccessPoint.scheme+"://"+this.navigation.publicAccessPoint.authority},n.prototype.getServiceHostUrl=function(){return this.navigation.serviceHost.vDir},n.prototype.getPublicActionUrl=function(n,t,i){var r=this._constructActionUrl(n,t,i);return this.getHostUrl()+this.configuration.getRootPath()+r},n.prototype.getActionUrl=function(n,t,i){if(!this.isSameHost)return this.getPublicActionUrl(n,t,i);var r=this._constructActionUrl(n,t,i);return this.configuration.getRootPath()+r},n.prototype.getCollectionActionUrl=function(n,t,i,r){var u=this._getCollectionTfsContext(n);return u.getActionUrl(t,i,r)},n.prototype.getCollectionTfsContext=function(n){var t=$.extend(!0,{},this);return t.navigation.serviceHost=n,t.navigation.collection=n,t.contextData=$.extend(!0,{},t.contextData),t.contextData.host.id=n.instanceId,t.contextData.host.name=n.name,t.contextData.host.uri=n.uri,t.contextData.host.relativeUri=n.vDir,t.contextData.host.hostType=f.ContextHostType.ProjectCollection,t.contextData.collection=t.contextData.host,t},n.prototype._getCollectionTfsContext=function(n){if(this.navigation.serviceHost.hostType===o.ProjectCollection&&this.navigation.serviceHost.name.toLowerCase()===n.toLowerCase())return this;var t={instanceId:"",name:n,hostType:o.ProjectCollection,vDir:"",relVDir:n};return this.getCollectionTfsContext(t)},n.prototype.getPermalinkUrl=function(n,t,i){var r=this._constructPermalinkUrl(n,t,i);return this.configuration.getRootPath()+r},n.prototype.getIdentityImageUrl=function(t,i){var r=e.getSharedData("_identityDetails"),u={area:n._API,project:"",id:t,t:r&&r[t]?r[t].identityImageId:h};return this.getActionUrl("IdentityImage","common",$.extend(u,i))},n.prototype.isEmbedded=function(){return!!this.getClientHost()},n.prototype.getClientHost=function(){return r.getPageContext().webAccessConfiguration.clientHost},n.prototype._constructActionUrl=function(t,r,u){var h=this.navigation,e=[],c,a,v,f,l,w,b,d,s,k,y,p;if(b=h.areaPrefix||"",d=h.controllerPrefix||"",f=$.extend({},u),s=f.area,typeof s=="undefined"&&(s=h.area),delete f.area,c=f.serviceHost,typeof c=="undefined"&&(c=h.serviceHost),c&&(c.relVDir&&e.push(encodeURI(c.relVDir)),c.hostType===o.ProjectCollection&&(k=this._shouldBuildApiUrl(s,f),a=f.project,typeof a=="undefined"&&(a=k?h.projectId:h.project),a&&(e.push(encodeURIComponent(a)),v=f.team,(typeof f.includeTeam=="undefined"||f.includeTeam===null)&&(f.includeTeam=!0),f.includeTeam&&(typeof v=="undefined"&&(v=k?h.teamId:h.team),v&&e.push(encodeURIComponent(v)))))),delete f.serviceHost,delete f.project,delete f.team,delete f.includeTeam,s)if($.isArray(s))for(y=s,y.length>0&&e.push(encodeURIComponent(b+y[0])),p=1;p<y.length;p++)e.push(encodeURIComponent(y[p]));else e.push(encodeURIComponent(b+s));return r||(r=f.controller),delete f.controller,t||(t=f.action),delete f.action,l=f.parameters,delete f.parameters,l&&(r||(r=n._DEFAULT_CONTROLLER_NAME),t||(t=n._DEFAULT_ACTION_NAME)),r&&(e.push(encodeURIComponent(d+r)),t&&(e.push(encodeURIComponent(t)),l&&($.isArray(l)?e.push.apply(e,$.map(l,encodeURIComponent)):e.push(encodeURIComponent(l))))),(f.includeVersion||s===n._API)&&(f[n._VERSION]=this.configuration.getWebApiVersion()),f.includeLanguage&&i.uiCulture&&(f[n._LANGUAGE]=i.uiCulture),delete f.includeVersion,f.area!==n._API&&this.getClientHost()&&(f[n._CLIENTHOST]=this.getClientHost()),w=$.param(f),e.join("/")+(w?"?"+w:"")},n.prototype._constructPermalinkUrl=function(t,i,r){var s=this.navigation,u=[],f=$.extend({},r),o,h=s.controllerPrefix||"",c=i||f.controller||n._DEFAULT_CONTROLLER_NAME,l=t||f.action||n._DEFAULT_ACTION_NAME,e=f.parameters;return u.push(n._PERMALINK_PREFIX),u.push(encodeURIComponent(h+c)),u.push(encodeURIComponent(l)),delete f.controller,delete f.action,delete f.parameters,e&&($.isArray(e)?u.push.apply(u,$.map(e,encodeURIComponent)):u.push(encodeURIComponent(e))),o=$.param(f),u.join("/")+(o?"?"+o:"")},n.prototype._shouldBuildApiUrl=function(t,i){var r;return t&&(r=$.isArray(t)?t[0]:t),i.useApiUrl||r===n._API&&(typeof i.useApiUrl=="undefined"||i.useApiUrl)},n._DEFAULT_CONTROLLER_NAME="home",n._DEFAULT_ACTION_NAME="index",n._CLIENTHOST="clientHost",n._VERSION="__v",n._LANGUAGE="__loc",n._PERMALINK_PREFIX="_permalink",n._API="api",n.ControlExtensions={initializeEnhancementOptions:function(t,i){return $.extend({},i,{tfsContext:n.getContextOrDefault(t)})}},n}();t.TfsContext=c});

define("ProjectOverview/Scripts/Components/ProjectMember",["require","exports","react","VSS/LWP","VSS/Utils/String","VSSPreview/Providers/IdentityDetailsProvider","VSSUI/VssPersona","Presentation/Scripts/TFS/TFS.Host.TfsContext","VSS/LoaderPlugins/Css!ProjectOverview/Scripts/Components/ProjectMember"],function(n,t,i,r,u,f,e,o){Object.defineProperty(t,"__esModule",{value:!0});t.ProjectMember=void 0;var h="F3F79DA5-C502-4451-9089-1918BB16209D",s=function(n){function t(t){var i=__construct(this,n,[t]);for(var r in i)i.hasOwnProperty(r)&&(this[r]=i[r]);var u=t.member,f=u.id,e=u.name,s=u.mail,h=o.TfsContext.getDefault().getIdentityImageUrl(f),c={id:f,directoryAlias:null,displayName:e,uniqueName:s,imageUrl:h,inactive:!1,isAadIdentity:!1,isContainer:!1,profileUrl:"",url:""};return i.state={identity:c},i}return __extends(t,n),t.prototype.render=function(){var n=this.props.member,t=n.id,r=n.name,o=n.mail,s=this.state.identity,c=!o?u.format("{0}",r):u.format("{0} <{1}>",r,o);return i.createElement("div",{className:"project-member",key:t,id:t,"aria-label":c},i.createElement(e.VssPersona,{identityDetailsProvider:new f.IdentityDetailsProvider(s,h),dataIsFocusable:!0}))},t}(i.Component);t.ProjectMember=s;r.registerLWPComponent("TFS.ProjectOverview.ProjectMember",s)});

if (window.performance && window.performance.mark) { window.performance.mark('endLoadBundleInner-async'); }