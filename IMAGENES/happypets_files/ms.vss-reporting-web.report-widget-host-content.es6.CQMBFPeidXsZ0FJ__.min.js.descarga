"use strict";define("Reporting/ReportWidgetHost",["require","exports","Dashboards/Common/RestClient/Dashboard","VSS/Core/Util/String","VSS/Platform/Trace","Dashboards/WidgetHost/WidgetHost","react","VSS/Platform/Layout","VSSUI/Spinner"],function(e,t,i,o,s,n,r,a,d){var g,c;g=t.Resources={},t.Resources.WidgetCopySucceeded="Widget {0} copied to {1}",function(e){function n(e){return{contributionId:e.sourceWidget.contributionId,name:e.sourceWidget.name,size:e.sourceWidget.size,settings:e.sourceWidget.settings,settingsVersion:e.sourceWidget.settingsVersion}}c=t.CopyWidget={},t.CopyWidget.copyWidget=async function(e,t){try{const r=n(t),a=function(e){const t=e.getService("ITfsPageService").getData();if(!t||!t.project)throw new Error("Couldn't fetch project information.");return t.project}(e),d={teamId:t.destinationDashboard.groupId||"",projectId:a.id},c=(0,i.getDashboardClient)(e),p=await c.createWidget(r,d,t.destinationDashboard.id);null!=p&&p.id!=r.id&&e.getService("IGlobalMessagesService").addToast({duration:3e3,message:(0,o.format)(g.WidgetCopySucceeded,t.sourceWidget.name,t.destinationDashboard.name)})}catch(t){(0,s.traceException)(e,"ReportingWidgetHost","copyWidget()",t),console.log(t)}},t.CopyWidget.packWidget=n}(),function(e){t.ReportWidgetHost={};t.ReportWidgetHost.ReportWidgetHostContainer=class extends a.VssComponent{render(){return r.createElement("div",{className:"report-widget-host-container flex-column"},r.createElement(i,Object.assign({},this.props)))}};class i extends a.VssComponent{constructor(e){super(e),this.onCopyWidget=(e=>{(0,c.copyWidget)(this.context.pageContext,e)}),this.onWidgetLoaded=(()=>{this.setState({isLoading:!1})}),this.getWidgetPixelSize=(()=>this.props.renderSize),this.state={isLoading:!0,iterationKey:0}}componentWillReceiveProps(e){e.settings===this.props.settings&&e.lastRefreshDate===this.props.lastRefreshDate||this.setState({isLoading:!0,iterationKey:this.state.iterationKey+1})}render(){const e=this.assembleWidgetProps(this.props),t=this.props.allowPinning;return r.createElement(r.Fragment,null,this.state.isLoading&&r.createElement("div",{style:this.props.renderSize},r.createElement(d.Spinner,{className:"report-host-spinner"})," "),r.createElement("div",{className:this.state.isLoading?"hidden":""},r.createElement(n.WidgetHost,{key:this.state.iterationKey,widgetHostParentProps:{onWidgetLoaded:this.onWidgetLoaded,onCopyWidget:t?this.onCopyWidget:void 0},convertToPixelSize:this.getWidgetPixelSize,widgetPresentationMode:"embedded-View",parentPageName:this.props.parentPageName,widgetProps:e,shouldNotShowTitle:!0,userCanConfigure:!0,openLinksInNewTab:!0,showLoadAnimations:0===this.state.iterationKey,teamContext:this.props.teamContext})))}assembleWidgetProps(e){return{contributionId:e.contributionId,name:e.name,size:this.props.widgetPinningSize,settings:e.settings,settingsVersion:e.settingsVersion||{major:1,minor:0,patch:0},isEnabled:!0,position:{column:0,row:0},areSettingsBlockedForUser:!1,configurationContributionId:"FAKE - UNUSED",isNameConfigurable:!1}}}t.ReportWidgetHost.ReportWidgetHost=i}()},["Resources","CopyWidget","ReportWidgetHost"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-reporting-web.report-widget-host-content"}}));