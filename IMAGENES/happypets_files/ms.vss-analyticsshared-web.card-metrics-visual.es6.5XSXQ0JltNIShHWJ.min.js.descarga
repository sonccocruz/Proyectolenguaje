"use strict";define("Analytics/Shared/Visuals/CardMetricsVisual",["require","exports","Analytics/Shared/Common/AnalyticsDataValidator","Analytics/Shared/Common/Types","Analytics/Shared/Utils/Number","Analytics/Shared/Visuals/Common/Components/AnalyticsUnavailableMessage","react","roosterjs-html-sanitizer/index","roosterjs-html-sanitizer/Sanitizer","VSS/Core/Util/String","VSS/Platform/Components/ErrorBoundary","VSS/Platform/Layout","VSSUI/Card","VSSUI/Header","VSSUI/Icon","VSSUI/Link","VSSUI/Spinner","VSSUI/Util"],function(e,t,a,r,s,i,n,l,o,c,m,d,p,h,g,f,u,y){var C;C=t.Resources={},t.Resources.DataNotReady="This typically takes few minutes, but can take longer depending on the amount of data in your organization.</br></br>Please, check back later.",t.Resources.LearnMore="Learn more",t.Resources.TrendFormat="{0}%",t.Resources.ErrorMessage="There was an error",t.Resources.ViewFullReport="View full report",function(e){var x;t.CardMetricsVisual={},function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large",e[e.XLarge=3]="XLarge",e[e.XXLarge=4]="XXLarge",e[e.XXXLarge=5]="XXXLarge"}(x=t.CardMetricsVisual.MetricSize||(t.CardMetricsVisual.MetricSize={}));t.CardMetricsVisual.CardMetricsVisual=class extends d.VssComponent{constructor(){super(...arguments),this._onLinkClick=(e=>{e.stopPropagation(),this.props.onLinkClick&&this.props.onLinkClick(e)}),this._onCardClick=(e=>{this.props.onCardClick&&this.props.onCardClick(e)}),this._onCardKeyDown=(e=>{13!==e.keyCode&&32!==e.keyCode||this.props.onCardClick(e)}),this._getMessage=(e=>{if(e!==r.ViewType.DataNotReadyView)return""}),this._getSuggestion=((e,t)=>e===r.ViewType.DataNotReadyView?C.DataNotReady:e===r.ViewType.ErrorView?t:void 0),this._checkIfMetricDataPresent=(()=>null!=this.props.primaryMetric||null!=this.props.secondaryMetric)}render(){return n.createElement("div",{className:(0,y.css)("analytics-cardmetrics-area flex-column flex-grow",this.props.className||""),onClick:this._onCardClick,onKeyDown:this._onCardKeyDown,tabIndex:0},n.createElement(m.ErrorBoundary,{handlerComponentType:"tfs.page-error-handler"},n.createElement(p.CustomCard,{className:"flex-grow analytics-card"},n.createElement(h.Header,{className:"analytics-card-header bolt-card-header",title:this.props.title,description:this._checkIfMetricDataPresent()&&!this.props.errorText?this.props.subtitle:""}),n.createElement(p.CardContent,null,n.createElement(a.AnalyticsDataValidator,{dataValidationPromises:this.props.dataValidationPromises,compactView:!0,getMessage:this._getMessage,getSuggestion:this._getSuggestion},n.createElement("div",{className:"flex-column flex-grow"},this._getElementToDisplay(),this.props.children))),n.createElement(p.CardFooter,{className:"analytics-card-footer"},n.createElement("div",{className:"flex-column flex-grow flex-self-end"},this.props.insight&&this._checkIfMetricDataPresent()&&n.createElement("div",{className:"card-metrics-insight flex-row font-size-m font-weight-normal secondary-text"},n.createElement("div",{className:"flex-self-start"},n.createElement(g.Icon,{className:"card-metric-insight-icon icon-margin font-size-ml",iconName:"CRMCustomerInsightsApp"})),n.createElement("span",{className:"card-metrics-insight-text",dangerouslySetInnerHTML:{__html:l.HtmlSanitizer.sanitizeHtml(this.props.insight,o.sanitizeHtmlOptions)}})),n.createElement("div",{className:"flex-row"},this.props.linkTarget&&n.createElement(f.Link,{className:"flex flex-grow flex-self-end",onClick:this._onLinkClick,target:"_blank",href:this.props.linkTarget},C.LearnMore),!this.props.errorText&&n.createElement("div",{className:"flex flex-grow view-report font-size-m font-weight-semibold"},n.createElement(g.Icon,{className:"icon-margin",iconName:"ChevronRight"}),n.createElement("span",null,C.ViewFullReport))))))))}_getPrimaryMetricElement(e,t){return n.createElement("div",{className:"card-metrics-element flex-row"},n.createElement("div",{className:"card-metrics-value font-size-lll flex-self-end"},e.value,e.suffix&&n.createElement("span",{className:"font-size-ll"},e.suffix)),t&&n.createElement("div",{className:(0,y.css)("pipeline-trend flex-self-end font-weight-semibold",this.props.isTrendGood?"positive-color":"negative-color")},n.createElement(g.Icon,{className:"trend-icon font-size-xs",iconName:t.trendType===r.TrendType.Increased?"TriangleSolidUp12":"TriangleSolidDown12"}),n.createElement("span",{className:"font-size-m"},(0,c.localeFormat)(C.TrendFormat,s.formatAbbreviatedNumber(t.percentageVariation||0)))))}getFontClassName(e){let t="";switch(e){case x.Small:t="fontSizeS";break;case x.Medium:t="font-size-m";break;case x.Large:t="font-size-l";break;case x.XLarge:t="font-size-xl";break;case x.XXLarge:t="font-size-xxl";break;case x.XXXLarge:t="font-size-xxxl"}return t}_getMetricElement(e){let t="font-size-m",a="body-xl";const r=this.props.secondaryMetricSize;return r&&(void 0!==r.label&&(t=this.getFontClassName(r.label)),void 0!==r.value&&(a=this.getFontClassName(r.value))),n.createElement("div",{className:"card-metrics-element flex-column"},n.createElement("div",{className:`card-metrics-label ${t} secondary-text`},e.label),n.createElement("div",{className:`card-metrics-value ${a} font-weight-semibold`},e.value),e.footer&&n.createElement("div",{className:"font-size-m secondary-text"},e.footer))}_getElementToDisplay(){return this.props.errorText?n.createElement(i.AnalyticsUnavailableMessage,{message:C.ErrorMessage,suggestion:this.props.errorText,iconName:this.props.iconName,messageClassName:"ax-unavailable-error-message"}):this.props.info?n.createElement(i.AnalyticsUnavailableMessage,{info:this.props.info,iconName:this.props.iconName}):this._checkIfMetricDataPresent()?n.createElement(n.Fragment,null,n.createElement("div",{className:"flex-row flex-wrap"},this.props.primaryMetric&&this._getPrimaryMetricElement(this.props.primaryMetric,this.props.trend),this.props.secondaryMetric&&this._getMetricElement(this.props.secondaryMetric))):n.createElement(u.Spinner,{className:"card-spinner flex-column flex-grow",size:"large"})}}}()},["Resources","CardMetricsVisual"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-analyticsshared-web.card-metrics-visual"}}));