"use strict";define("Dashboards/WidgetHost",["require","exports","Dashboards/Common/TelemetryConstants","VSS/Platform/Trace","Dashboards/AddToDashboard/AddToDashboardPanel","react","VSS/Platform/Context","VSS/Platform/Layout","VSS/Core/Util/String","VSSUI/Link","Reporting/Visuals/VisualMessages/ErrorMessage","VSSUI/Button","VSSUI/Components/VssContextualMenu/index","VSSUI/FocusWithin","Dashboards/WidgetCatalog/WidgetCatalogQuery","Dashboards/WidgetCatalog/WidgetContributionsHelper","Dashboards/WidgetContracts/Internal/WidgetHostProps","Dashboards/WidgetContracts/WidgetProps","Reporting/Lightbox/Lightbox","VSS/Platform/Feature","VSS/Platform/Util/Url","VSSUI/Spinner","VSS/Legacy/Legacy","Reporting/Visuals/VisualMessages/AccessRestrictedImage","Reporting/Visuals/VisualMessages/ActionRequiredContent","VSS/Platform/UserClaims"],function(e,t,o,i,s,n,r,a,d,g,l,p,c,u,h,m,C,b,w,W,f,x,S,y,L,M){var D,P,H,I,v,E,T,O,A,k,F,R,N,V,z;D=t.Resources={},t.Resources.MoreActionsButtonText="More actions",t.Resources.ConfigureWidgetText="Configure",t.Resources.CopyToDashboardText="Copy to Dashboard",t.Resources.DeleteWidgetText="Delete",t.Resources.AboutThisWidgetText="About this Widget",t.Resources.LightboxTitle="Expand view",t.Resources.LightboxAriaLabel="Open the detailed view of the widget",t.Resources.WidgetError_BodyMessage="Widget failed to load",t.Resources.WidgetError_LinkText="More details",t.Resources.WidgetError_LinkAriaMessage="{0} widget failed to load. Click to open a dialog box that has error details.",t.Resources.WidgetLoadError_DialogTitle="Widget error",t.Resources.DisabledWidget_DialogHeading="Access not supported",t.Resources.DisabledWidget_DialogContentText_DialogSubHeading="You aren't logged in as a member of this team project.",t.Resources.DisabledWidget_DialogMessage="Only logged in members can view this widget.",t.Resources.DisabledWidget_DialogLicenseTypesLinkText_AzureDevOps="Learn more about the different types of projects and access levels for Azure DevOps",t.Resources.ExtensionDisabledWidget_DialogHeading="Widget unavailable",t.Resources.ExtensionDisabledWidget_DialogContentText="This widget has been disabled or removed by an administrator.â€‹",t.Resources.ExtensionFailedWidget_DialogContentFormatText="{0} has a problem.",t.Resources.WidgetError_NoContent="No error information was available.",t.Resources.WidgetError_RenderingFailed="This widget could not render, due to {0}",function(e){function o(e,t,o){const i=o(t.size);return Object.assign(Object.assign({},t),{size:i})}function i(){return{width:.85*window.innerWidth,height:.85*window.innerHeight}}P=t[e]={},t[e].generateWidgetProps=function(e,t,i,s){const n=null!=t.showLoadAnimations?t.showLoadAnimations:"dashboard-config-preview"!==e&&"dashboard-edit-view"!==e,r=null!=t.avoidShowingModalUI?t.avoidShowingModalUI:"lightbox-view"===e;return Object.assign(Object.assign({},o(e,t.widgetProps,s)),{presentationMode:e,showLoadAnimations:n,shouldNotShowTitle:t.shouldNotShowTitle,openLinksInNewTab:!0===t.openLinksInNewTab,avoidShowingModalUI:r,onWidgetLoaded:i.onWidgetLoaded,onConfigure:i.onConfigure,setMenuColorMode:i.setMenuColorMode,setCustomContextMenuItems:i.setCustomContextMenuItems,teamContext:t.teamContext})},t[e].convertToWidgetProps=o,t[e].getSize=function(e,t,o){return"lightbox-view"===e?i():o(t.size)},t[e].getLightboxSize=i,t[e].getLegacyLightboxGridSize=function(){const e=i();return{columnSpan:Math.floor((e.width-20)/170),rowSpan:Math.floor((e.height-20)/170)}}}("HelpersPresentationContextHelpers"),function(e){function s(e){const t=function e(t){return t?"string"==typeof t?t:t.message?t.message:t.description?t.description:"function"==typeof t?e(t()):t.toString():"Error message could not be extracted."}(e),o=function(e){let t=null,o=e.match("VS[0-9]+");return null!=o&&o.length>=1?t=o[0]:null!=(o=e.match("TF[0-9]+"))&&o.length>=1&&(t=o[0]),t}(t),i={errorMessage:t,errorId:o};return e.message&&e.stack&&(i.errorStack=e.stack),i}function n(e){return e instanceof Error?Object.assign(Object.assign({},e),s(e)):e}H=t[e]={},t[e].publishWidgetHostLoadStarted=function(e,t){e.getService("IVssTelemetryService").publishEvent(o.DashboardsTelemetryConstants.Area,"onWidgetHostLoadStarted",t)},t[e].publishWidgetHostLoadFailed=function(e,t,i){const r=s(i.error),a=Object.assign(Object.assign({errorType:i.errorType,errorExtendedDetail:n(i.extendedDiagnosticDetail)},r),t);e.getService("IVssTelemetryService").publishEvent(o.DashboardsTelemetryConstants.Area,"WidgetLoadFailed",a)},t[e].getErrorPropertiesForTelemetry=s,t[e].publishWidgetHostInteraction=function(e,t,i){e.getService("IVssTelemetryService").publishEvent(o.DashboardsTelemetryConstants.Area,t,{contributionId:i})},t[e].traceWidgetHostWarning=function(e,t,s,n){(0,i.traceWarning)(e,o.DashboardsTelemetryConstants.Area,t,s,{contributionId:n})}}("HelpersWidgetHostTelemetry"),function(e){I=t.HostImplementationKeyboardHandler={},t.HostImplementationKeyboardHandler.getUpdatedWidgetPosition=function(e,t){let o=[];switch(e.key){case"ArrowUp":o.push({id:t.id,row:t.position.row-1,rowSpan:t.size.rowSpan,column:t.position.column,columnSpan:t.size.columnSpan});break;case"ArrowDown":o.push({id:t.id,row:t.position.row+1,rowSpan:t.size.rowSpan,column:t.position.column,columnSpan:t.size.columnSpan});break;case"ArrowRight":o.push({id:t.id,row:t.position.row,rowSpan:t.size.rowSpan,column:t.position.column+1,columnSpan:t.size.columnSpan});break;case"ArrowLeft":o.push({id:t.id,row:t.position.row,rowSpan:t.size.rowSpan,column:t.position.column-1,columnSpan:t.size.columnSpan})}return o}}(),function(e){t.HelpersDashboardsPanelManager={};r.Services.add("IDashboardsPanelManager",{serviceFactory:class extends r.VssService{copyWidget(e,t,o){this.pageContext.getService("IVssLayoutManager").renderCallout(i=>n.createElement(s.AddToDashboardPanel,{isOpen:!0,onOk:o=>{t({sourceWidget:e,destinationDashboard:o}),i()},onDismiss:()=>{o(),i()},widgetName:e.name}))}}})}(),function(e){v=t.MessageComponentsDefaultWidgetFailedMessage={};t.MessageComponentsDefaultWidgetFailedMessage.DefaultWidgetFailedMessage=class extends a.VssComponent{render(){return n.createElement("div",{className:"widget-failed-dialog-content"},this.props.errorText)}}}(),function(e){E=t.MessageComponentsExtensionFailedMessage={};t.MessageComponentsExtensionFailedMessage.ExtensionFailedMessage=class extends a.VssComponent{render(){return n.createElement("div",{className:"extension-failed-dialog-content"},n.createElement("span",{className:"flex-self-center"},n.createElement(g.Link,{href:this.props.extensionUrl,target:"_blank"},(0,d.localeFormat)(D.ExtensionFailedWidget_DialogContentFormatText,this.props.extensionName))))}}}(),function(e){T=t.MessageComponentsWidgetErrorMessage={};t.MessageComponentsWidgetErrorMessage.WidgetErrorMessage=class extends a.VssComponent{render(){const e={ariaLabel:(0,d.localeFormat)(D.WidgetError_LinkAriaMessage,this.props.widgetName),text:D.WidgetError_LinkText,onClick:()=>{this.props.onClick()}};return n.createElement(l.ErrorMessage,{visualTitle:this.props.widgetName,messageBodyText:D.WidgetError_BodyMessage,size:this.props.size,action:e,hideTitle:this.props.hideTitle})}}}(),function(e){O=t.OverlayComponentsWidgetHostEditOverlay={};t.OverlayComponentsWidgetHostEditOverlay.WidgetHostEditOverlay=class extends a.VssComponent{render(){return n.createElement("div",{className:"widget-host-edit-overlay interaction-overlay"},n.createElement("div",{className:(0,a.css)("widget-host-edit-row","inline-flex-row")},this.props.canConfigureWidget&&n.createElement(p.Button,{subtle:!0,className:"configure-widget-button",iconProps:{iconName:"Settings"},onClick:this.props.onConfigureWidget,ariaLabel:D.ConfigureWidgetText,ref:e=>this._configRef=e,onKeyDown:e=>this.props.onKeyDown(e,this.props.canConfigureWidget)}),n.createElement(p.Button,{subtle:!0,className:"delete-widget-button",iconProps:{iconName:"Cancel"},onClick:this.props.onDeleteWidget,ariaLabel:D.DeleteWidgetText,ref:e=>this._closeRef=e,onKeyDown:e=>{this.props.onKeyDown(e,!this.props.canConfigureWidget)}})))}focus(){this._configRef?this._configRef.focus():this._closeRef&&this._closeRef.focus()}}}(),function(e){A=t.OverlayComponentsWidgetHostOverlay={};t.OverlayComponentsWidgetHostOverlay.WidgetHostOverlay=class extends a.VssComponent{constructor(e,t){super(e,t),this.renderOverlay=(e=>{const t=this.getMenuItems();return n.createElement("div",{className:"widget-host-overlay"},n.createElement("div",{className:(0,a.css)("widget-host-menu-header","inline-flex-row",this.props.isPointerInsideParent&&"mouse-is-over-widget",this.state.isContextMenuVisible&&"context-menu-is-active",e.hasFocus&&"overlay-has-focus",this.props.useDarkOverlay&&"button-is-dark")},this.props.allowLightbox&&this.props.onLightbox&&n.createElement(p.Button,{className:"lightbox-widget-button",iconProps:{iconName:"FullScreen"},onClick:this.props.onLightbox,onFocus:e.onFocus,onBlur:e.onBlur,ariaLabel:D.LightboxAriaLabel,tooltipProps:{text:D.LightboxTitle}}),this.state.isContextMenuVisible&&this.renderMenu(t),t.length>0&&n.createElement(p.Button,{className:"configure-widget-button",iconProps:{iconName:"More"},ref:e=>{this._moreActionsButton=e},onClick:this.onShowMenu,onFocus:e.onFocus,onBlur:e.onBlur,tooltipProps:{text:D.MoreActionsButtonText},ariaLabel:D.MoreActionsButtonText,ariaHasPopup:!0,ariaExpanded:this.state.isContextMenuVisible})))}),this.renderMenu=(e=>n.createElement(c.VssContextualMenu,{items:e,shouldFocusOnMount:!0,target:this.state.target,onDismiss:this.onDismiss,directionalHint:6})),this.getMenuItems=(()=>{let e=[];return this.props.canConfigureWidget&&this.props.onConfigureWidget&&e.push({key:"Configure",iconProps:{iconName:"Settings"},name:D.ConfigureWidgetText,onClick:this.props.onConfigureWidget}),this.props.canCopyWidget&&this.props.onCopyToDashboard&&e.push({key:"Copy",iconProps:{iconName:"Add"},name:D.CopyToDashboardText,onClick:this._onCopyToDashboardClicked}),this.props.customMenuItems&&Array.isArray(this.props.customMenuItems)&&(e=e.concat(this.props.customMenuItems)),this.props.canViewWidgetInformation&&this.props.onViewWidgetInformation&&e.push({key:"Info",iconProps:{iconName:"Info"},name:D.AboutThisWidgetText,onClick:this.props.onViewWidgetInformation}),this.props.canDeleteWidget&&this.props.onDeleteWidget&&e.push({key:"Delete",iconProps:{iconName:"Cancel",className:"widget-host-delete-menu-icon"},name:D.DeleteWidgetText,onClick:this.props.onDeleteWidget}),e}),this.onShowMenu=(e=>{this.setState({isContextMenuVisible:!0,target:e.target})}),this.onDismiss=(()=>{this.setState({isContextMenuVisible:!1})}),this._onCopyToDashboardClicked=(()=>{this.props.onCopyToDashboard&&this.props.onCopyToDashboard(this._moreActionsButton)}),this.state={isContextMenuVisible:!1,target:null}}render(){return n.createElement(u.FocusWithin,null,this.renderOverlay)}componentDidMount(){this.focusMoreActionsButton()}componentDidUpdate(){this.focusMoreActionsButton()}focusMoreActionsButton(){this._moreActionsButton&&this.props.shouldFocusMoreActionsButtonByDefault&&this._moreActionsButton.focus()}}}(),function(e){k=t.HostImplementationWidgetHostImplementationBase={};class o extends a.VssComponent{constructor(e,t){super(e,t),this.showErrorDialog=(()=>{const e=this.context.pageContext.getService("IVssLayoutManager");this.getErrorContent().then(t=>{e.renderCallout(e=>n.createElement(w.Lightbox,{onDismiss:e,title:D.WidgetLoadError_DialogTitle,retainDefaultLayout:!0},t))})}),this.onLoadTimeout=(()=>{this.state.widgetLoadStatus!==b.LoadingStatus.loading||this.isUnmounted||(this.onFirstLoadTransition(C.WidgetHostLoadOutcome.Timeout),this.state.hasSignaledFirstLoad||(0,H.publishWidgetHostLoadFailed)(this.context.pageContext,this.getWidgetTelemetryInfo(),{errorType:C.WidgetHostLoadOutcome[C.WidgetHostLoadOutcome.Timeout],error:"The widget timed out."}),this.setState({hasSignaledFirstLoad:!0,widgetLoadStatus:b.LoadingStatus.failure,widgetLoadOutcomeDescription:`Widget ${this.props.widgetProps.contributionId} did not load within allowed time.`}))}),this.onSpinnerAllowedTimeout=(()=>{this.setState({readyForLoadingSpinner:!0})}),this.renderLoadingComponent=(()=>n.createElement(x.Spinner,{className:"absolute-fill"})),this.renderFailedComponent=(()=>n.createElement(T.WidgetErrorMessage,{widgetName:this.props.widgetProps.name,size:this.getRenderSize(),onClick:this.showErrorDialog,hideTitle:this.props.shouldNotShowTitle})),this.onCopyToDashboard=(e=>{this._moreActionsButton=e,this.context.pageContext.getService("IDashboardsPanelManager").copyWidget(this.props.widgetProps,this.onCopyWidget,this._onAddDashboardPanelDismiss)}),this._onAddDashboardPanelDismiss=(()=>{this._moreActionsButton&&this._moreActionsButton.focus()}),this.onViewWidgetInformation=(()=>{this.canViewWidgetInformation()&&(this.openInformationLink(),(0,H.publishWidgetHostInteraction)(this.context.pageContext,"WidgetHost-ViewInformation",this.props.widgetProps.contributionId))}),this.onConfigureWidget=(()=>{this.props.userCanConfigure&&this.props.widgetHostParentProps&&this.props.widgetHostParentProps.onConfigureWidget&&this.props.widgetHostParentProps.onConfigureWidget(this.props.widgetProps)}),this.onCopyWidget=(e=>{this.props.widgetHostParentProps&&this.props.widgetHostParentProps.onCopyWidget&&this.props.widgetHostParentProps.onCopyWidget(e)}),this.onDeleteWidget=(()=>{this.props.userCanConfigure&&this.props.widgetHostParentProps&&this.props.widgetHostParentProps.onDeleteWidget&&this.props.widgetHostParentProps.onDeleteWidget(this.props.widgetProps)}),this.onWidgetLoadComplete=(e=>{let t=e||{outcome:b.LoadingStatus.success,outcomeDescription:void 0};if(t=this.normalizeEventInfo(t),this.state.widgetLoadStatus===b.LoadingStatus.loading&&t.outcome!==b.LoadingStatus.loading&&!this.isUnmounted){const e=t.outcome===b.LoadingStatus.success?C.WidgetHostLoadOutcome.Success:C.WidgetHostLoadOutcome.HandledFailure;this.onFirstLoadTransition(e),t.outcome!==b.LoadingStatus.failure||this.state.hasSignaledFirstLoad||(0,H.publishWidgetHostLoadFailed)(this.context.pageContext,this.getWidgetTelemetryInfo(),{errorType:C.WidgetHostLoadOutcome[C.WidgetHostLoadOutcome.HandledFailure],error:t.outcomeDescription,extendedDiagnosticDetail:t.extendedDiagnosticDetail}),this.setState({hasSignaledFirstLoad:!0,widgetLoadStatus:t.outcome,widgetLoadOutcomeDescription:null!=t.outcomeDescription?t.outcomeDescription.toString():D.WidgetError_NoContent})}}),this.setMenuColorMode=(e=>{this.setState({widgetContextMenuColorMode:e})}),this.setCustomContextMenuItems=(e=>{this.setState({customMenuItems:e})}),this.onMouseEnterWidget=(()=>{this.setState({isMouseInsideWidget:!0})}),this.onMouseLeaveWidget=(()=>{this.setState({isMouseInsideWidget:!1})}),this.state={isMouseInsideWidget:!1,readyForLoadingSpinner:!1,hasSignaledFirstLoad:!1,widgetLoadStatus:b.LoadingStatus.loading,widgetLoadOutcomeDescription:void 0,widgetContextMenuColorMode:void 0}}componentDidMount(){super.componentDidMount(),(0,H.publishWidgetHostLoadStarted)(this.context.pageContext,this.getWidgetTelemetryInfo()),this.hostTimeoutId=this.setTimeout(this.onLoadTimeout,o.widgetClientTimeoutInMS),this.setTimeout(this.onSpinnerAllowedTimeout,o.spinnerStartTimeoutInMS)}componentWillUnmount(){super.componentWillUnmount(),this.isUnmounted=!0}componentWillReceiveProps(e){JSON.stringify(e.widgetProps)!=JSON.stringify(this.props.widgetProps)&&this.setState({widgetLoadStatus:b.LoadingStatus.loading,widgetLoadOutcomeDescription:void 0})}componentDidCatch(e,t){this.onFirstLoadTransition(C.WidgetHostLoadOutcome.UnhandledFailure),this.state.widgetLoadStatus!==b.LoadingStatus.loading||this.isUnmounted||(this.state.hasSignaledFirstLoad||(0,H.publishWidgetHostLoadFailed)(this.context.pageContext,this.getWidgetTelemetryInfo(),{errorType:C.WidgetHostLoadOutcome[C.WidgetHostLoadOutcome.UnhandledFailure],error:e}),this.setState({hasSignaledFirstLoad:!0,widgetLoadStatus:b.LoadingStatus.failure,widgetLoadOutcomeDescription:`Widget ${this.props.widgetProps.contributionId} failed to load with an unhandled exception. ${e.message}`}))}render(){return n.createElement("div",{className:(0,a.css)("widget-host",this.getModeClass()),style:this.getRenderSize(),onMouseEnter:this.onMouseEnterWidget,onMouseLeave:this.onMouseLeaveWidget},this.renderWidgetHostContent(),this.renderOverlay())}setPredeterminedOutcome(e){this.onFirstLoadTransition(e),this.state.widgetLoadStatus===b.LoadingStatus.loading&&(this.state.hasSignaledFirstLoad||(0,H.publishWidgetHostLoadFailed)(this.context.pageContext,this.getWidgetTelemetryInfo(),{errorType:C.WidgetHostLoadOutcome[e],error:"Widget was disabled, in the fashion described by errorType."}),this.setState({hasSignaledFirstLoad:!0,widgetLoadStatus:b.LoadingStatus.success}))}getErrorContent(){const e=this.props.widgetProps.contributionId;return(0,m.isInternalContribution)(e)?Promise.resolve(n.createElement(v.DefaultWidgetFailedMessage,{errorText:this.state.widgetLoadOutcomeDescription||""})):(0,m.getProviderInfo)(this.context.pageContext,e).then(e=>n.createElement(E.ExtensionFailedMessage,{extensionName:e.providerDisplayName,extensionUrl:e.marketplaceUrl}))}renderWidgetHostContent(){const e={onWidgetLoaded:this.onWidgetLoadComplete,onConfigure:this.onConfigureWidget,setMenuColorMode:this.setMenuColorMode,setCustomContextMenuItems:this.setCustomContextMenuItems},t=(0,P.generateWidgetProps)(this.props.widgetPresentationMode,this.props,e,this.props.convertToPixelSize);t.size=this.getRenderSize();const o=!this.state.hasSignaledFirstLoad&&this.state.widgetLoadStatus===b.LoadingStatus.loading,i=!this.state.hasSignaledFirstLoad||this.state.widgetLoadStatus===b.LoadingStatus.failure;return n.createElement("div",{className:"widget-container"},o&&this.state.readyForLoadingSpinner&&this.renderLoadingComponent(),this.state.widgetLoadStatus===b.LoadingStatus.failure&&this.renderFailedComponent(),n.createElement("div",{className:(0,a.css)("content-container ",i?"invisible":""),ref:e=>{this.contentContainerElement=e},tabIndex:0,onKeyDown:this.onKeydown.bind(this)},this.state.widgetLoadStatus!==b.LoadingStatus.failure?this.renderWidgetHostImplementation(t):null))}canUseLightbox(){return null!=this.props.widgetContributionRenderingProps.lightbox}canConfigureWidget(){return!(!this.props.userCanConfigure||!this.props.isWidgetConfigurable)}canDeleteWidget(){return this.props.userCanConfigure}canCopyWidget(){return!0}canViewWidgetInformation(){return(0,W.isFeatureEnabled)(this.context.pageContext,"ms.vss-dashboards.dashboard-widget-help-feature",!1)&&this.props.widgetProps.isEnabled}normalizeEventInfo(e){return e}getWidgetTelemetryInfo(){return{widgetHostType:this.getHostType(),contributionId:this.props.widgetProps.contributionId,widgetId:this.props.widgetProps.id,presentationMode:this.props.widgetPresentationMode,parentPageName:this.props.parentPageName}}getModeClass(){return this.props.widgetPresentationMode}renderOverlay(){switch(this.props.widgetPresentationMode){case"embedded-View":return this.renderEmbeddedOverlay();case"dashboard-edit-view":return this.renderEditOverlay();case"dashboard-view":return this.renderViewOverlay();case"dashboard-config-preview":return n.createElement("div",{className:"interaction-overlay"});case"lightbox-view":default:return null}}renderEmbeddedOverlay(){const e=this.props.widgetHostParentProps&&this.props.widgetHostParentProps.onCopyWidget?this.onCopyToDashboard:void 0;return n.createElement(A.WidgetHostOverlay,{isPointerInsideParent:this.state.isMouseInsideWidget,canCopyWidget:this.canCopyWidget(),useDarkOverlay:this.state.widgetContextMenuColorMode===b.WidgetContextMenuColorMode.Dark,customMenuItems:this.state.customMenuItems,onCopyToDashboard:e,shouldFocusMoreActionsButtonByDefault:this.props.shouldFocusMoreActionsButtonByDefault})}renderEditOverlay(){return n.createElement(O.WidgetHostEditOverlay,{canConfigureWidget:this.canConfigureWidget(),onConfigureWidget:this.onConfigureWidget,onDeleteWidget:this.onDeleteWidget,ref:e=>{this.editOverlayElement=e},onKeyDown:(e,t)=>{t&&e.shiftKey&&9===e.keyCode&&(e.preventDefault(),this.contentContainerElement.focus())}})}renderViewOverlay(){return n.createElement(A.WidgetHostOverlay,{isPointerInsideParent:this.state.isMouseInsideWidget,allowLightbox:this.canUseLightbox(),canConfigureWidget:this.canConfigureWidget(),canDeleteWidget:this.canDeleteWidget(),canCopyWidget:this.canCopyWidget(),canViewWidgetInformation:this.canViewWidgetInformation(),useDarkOverlay:this.state.widgetContextMenuColorMode===b.WidgetContextMenuColorMode.Dark,customMenuItems:this.state.customMenuItems,onConfigureWidget:this.onConfigureWidget,onDeleteWidget:this.onDeleteWidget,onLightbox:this.onShowLightbox,onCopyToDashboard:this.onCopyToDashboard,onViewWidgetInformation:this.onViewWidgetInformation,shouldFocusMoreActionsButtonByDefault:this.props.shouldFocusMoreActionsButtonByDefault})}async openInformationLink(){const e=this.props.widgetProps.contributionId,t=this.context.pageContext.getService("IDashboardsCacheableQueryService"),o=new h.WidgetCatalogQuery(void 0),i=(await t.getCacheableQueryResult(o)).catalogEntries,s=i.findIndex(e=>e.contributionId===this.props.widgetProps.contributionId);if(s>=0){const t=i[s].catalogInfoURI;if(null!=t){const e=new f.Uri(t);window.open(e.absoluteUri,"_blank","noopener noreferrer")&&(window.opener=null)}else(0,H.traceWidgetHostWarning)(this.context.pageContext,"WidgetHost-OpenConfirmationLink","Information link for contribution was not found.",e)}else(0,H.traceWidgetHostWarning)(this.context.pageContext,"WidgetHost-OpenConfirmationLink","Widget contribution was not found.",e)}onFirstLoadTransition(e){this.stopTimer(),!this.state.hasSignaledFirstLoad&&this.props.widgetHostParentProps&&this.props.widgetHostParentProps.onWidgetLoaded&&this.state.widgetLoadStatus==b.LoadingStatus.loading&&this.props.widgetHostParentProps.onWidgetLoaded({outcome:e,widget:this.props.widgetProps})}stopTimer(){this.clearTimeout(this.hostTimeoutId)}onKeydown(e){if("dashboard-edit-view"==this.props.widgetPresentationMode&&this.props.widgetHostParentProps&&this.props.widgetHostParentProps.onWidgetMoved){const t=(0,I.getUpdatedWidgetPosition)(e,this.props.widgetProps);t.length>0?this.props.widgetHostParentProps.onWidgetMoved(t):9!==e.keyCode||e.shiftKey||(e.preventDefault(),this.editOverlayElement.focus())}}}t.HostImplementationWidgetHostImplementationBase.WidgetHostImplementationBase=o,o.widgetClientTimeoutInMS=12e4,o.spinnerStartTimeoutInMS=500}(),function(e){F=t.HostImplementationDisabledWidgetHostImplementation={};t.HostImplementationDisabledWidgetHostImplementation.DisabledWidgetHostImplementation=class extends k.WidgetHostImplementationBase{constructor(){super(...arguments),this.onShowLightbox=(()=>{throw Error("Lightbox is Not supported on disabled widgets.")})}componentDidMount(){super.componentDidMount(),this.setPredeterminedOutcome(this.props.preDeterminedloadOutcome)}canConfigureWidget(){return!1}canCopyWidget(){return!1}getHostType(){return"DisabledWidgetHost"}renderWidgetHostImplementation(e){return n.createElement(n.Fragment,null,this.props.children)}getRenderSize(){return this.props.convertToPixelSize(this.props.widgetProps.size)}canUseLightbox(){return!1}}}(),function(e){R=t.HostImplementationLegacyWidgetHostImplementation={};class o extends k.WidgetHostImplementationBase{constructor(){super(...arguments),this.onShowLightbox=(()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout(e=>{const t=Object.assign({},this.props.widgetProps);t.size=(0,P.getLegacyLightboxGridSize)();const i=this.props.convertToPixelSize(t.size);return n.createElement(w.Lightbox,{onDismiss:e,title:D.LightboxTitle},n.createElement("div",{style:i},n.createElement("div",{className:"widget-host render-in-lightbox",style:i},n.createElement(o,Object.assign({},this.props,{widgetProps:t,widgetPresentationMode:"lightbox-view"})))))})})}getHostType(){return"LegacyWidgetHost"}renderWidgetHostImplementation(e){return n.createElement(i,Object.assign({key:e.id},e))}getRenderSize(){return"lightbox-view"===this.props.widgetPresentationMode?this.props.convertToPixelSize((0,P.getLegacyLightboxGridSize)()):this.props.convertToPixelSize(this.props.widgetProps.size)}}t.HostImplementationLegacyWidgetHostImplementation.LegacyWidgetHostImplementation=o;class i extends n.PureComponent{render(){return n.createElement(S.LegacyComponent,Object.assign({key:this.props.id,modules:["Dashboards/Components/LegacyWidgetHostAdapter"],wrappedType:"LegacyWidgetHostAdapter"},this.props))}}}(),function(e){N=t.HostImplementationModernWidgetHostImplementation={};class o extends k.WidgetHostImplementationBase{constructor(){super(...arguments),this.onShowLightbox=(()=>{this.context.pageContext.getService("IVssLayoutManager").renderCallout(e=>n.createElement(w.Lightbox,{onDismiss:e,title:D.LightboxTitle},n.createElement("div",{style:(0,P.getLightboxSize)()},n.createElement("div",{className:"widget-host render-in-lightbox",style:(0,P.getLightboxSize)()},n.createElement(o,Object.assign({},this.props,{widgetPresentationMode:"lightbox-view"}))))))})}getHostType(){return"ModernWidgetHost"}renderWidgetHostImplementation(e){const t=this.getRenderSize();return n.createElement(i,Object.assign({key:this.props.widgetProps.id,widgetContributionComponentProps:this.props.widgetContributionComponentProps,size:t,shouldNotShowTitle:this.props.shouldNotShowTitle},e))}getRenderSize(){return"lightbox-view"===this.props.widgetPresentationMode?(0,P.getLightboxSize)():this.props.convertToPixelSize(this.props.widgetProps.size)}normalizeEventInfo(e){return null!=e&&null==e.outcome&&(e={outcome:b.LoadingStatus.failure,outcomeDescription:e}),e}}t.HostImplementationModernWidgetHostImplementation.ModernWidgetHostImplementation=o;class i extends a.VssComponent{shouldComponentUpdate(e,t,o){return this.props.name!==e.name||this.props.settings!==e.settings||!this.stringEqual(this.props.settingsVersion,e.settingsVersion)||!this.stringEqual(this.props.size,e.size)}render(){try{return n.createElement(a.WrappedComponent,{key:this.props.id,style:{width:this.props.size.width,height:this.props.size.height},wrappedType:this.props.widgetContributionComponentProps.componentType,dependencies:this.props.widgetContributionComponentProps.includes,wrappedProps:this.props})}catch(e){return this.props.onWidgetLoaded({outcome:b.LoadingStatus.failure,outcomeDescription:(0,d.format)(D.WidgetError_RenderingFailed,e)}),null}}stringEqual(e,t){return JSON.stringify(e)===JSON.stringify(t)}}}(),function(e){V=t.MessageComponentsAccessNotSupportedMessage={};t.MessageComponentsAccessNotSupportedMessage.AccessNotSupportedMessage=class extends a.VssComponent{render(){return n.createElement("div",{className:"access-not-supported-dialog-content inline-flex-row"},n.createElement("span",{className:"flex-self-center"},n.createElement(y.AccessRestrictedImage,null)),n.createElement("div",{className:"flex-self-center separate-child-elements"},n.createElement("div",{className:"fontWeightSemiBold"},D.DisabledWidget_DialogContentText_DialogSubHeading),n.createElement("div",null,D.DisabledWidget_DialogMessage),n.createElement(g.Link,{href:"https://go.microsoft.com/fwlink/?linkid=867452",target:"_blank"},D.DisabledWidget_DialogLicenseTypesLinkText_AzureDevOps)))}}}(),function(e){z=t.MessageComponentsExtensionDisabledMessage={};t.MessageComponentsExtensionDisabledMessage.ExtensionDisabledMessage=class extends a.VssComponent{render(){return n.createElement("div",{className:"extension-disabled-dialog-content inline-flex-row"},n.createElement("span",{className:"flex-self-center"},n.createElement(y.AccessRestrictedImage,null)),n.createElement("span",{className:"flex-self-center"},D.ExtensionDisabledWidget_DialogContentText))}}}(),function(e){var o;t.WidgetHost={},function(e){e[e.loading=0]="loading",e[e.renderLegacyWidgetHost=1]="renderLegacyWidgetHost",e[e.renderModernWidgetHost=2]="renderModernWidgetHost",e[e.renderAsContentBlocked=3]="renderAsContentBlocked",e[e.renderAsExtensionUninstalled=4]="renderAsExtensionUninstalled"}(o||(o={}));t.WidgetHost.WidgetHost=class extends a.VssComponent{constructor(e,t){super(e,t),this.contributionLoadingComponent=(()=>n.createElement("div",{className:"contribution-loading"})),this.state={widgetContributionRenderingProps:void 0,widgetComponentContributionProps:void 0,terminalMode:void 0}}componentDidMount(){this.props.widgetProps.areSettingsBlockedForUser?this.setState({terminalMode:o.renderAsContentBlocked}):this.loadCoreContribution()}render(){let e=null;const t=null!=this.props.widgetProps.configurationContributionId&&""!=this.props.widgetProps.configurationContributionId||null!=this.state.widgetContributionRenderingProps&&null!=this.state.widgetContributionRenderingProps.configComponentContributionId&&""!=this.state.widgetContributionRenderingProps.configComponentContributionId,i=null!=this.state.widgetContributionRenderingProps&&this.state.widgetContributionRenderingProps.supportedSizes.length>1,s=this.props.widgetProps.isNameConfigurable||i||t;switch(this.determineMode()){case o.renderAsContentBlocked:e=this.renderError(C.WidgetHostLoadOutcome.AccessNotSupported,n.createElement(V.AccessNotSupportedMessage,null));break;case o.renderAsExtensionUninstalled:e=this.renderError(C.WidgetHostLoadOutcome.ExtensionDisabled,n.createElement(z.ExtensionDisabledMessage,null));break;case o.loading:e=this.contributionLoadingComponent();break;case o.renderLegacyWidgetHost:e=n.createElement(R.LegacyWidgetHostImplementation,Object.assign({isWidgetConfigurable:s,widgetContributionRenderingProps:this.state.widgetContributionRenderingProps},this.props));break;case o.renderModernWidgetHost:e=n.createElement(N.ModernWidgetHostImplementation,Object.assign({},this.props,{isWidgetConfigurable:s,widgetContributionRenderingProps:this.state.widgetContributionRenderingProps,widgetContributionComponentProps:this.state.widgetComponentContributionProps}))}return e}renderError(e,t){return n.createElement(F.DisabledWidgetHostImplementation,Object.assign({preDeterminedloadOutcome:e,isWidgetConfigurable:!0,widgetContributionRenderingProps:this.state.widgetContributionRenderingProps},this.props),n.createElement("div",{className:"widget-host-error"},n.createElement(L.ActionRequiredContent,{visualTitle:this.props.widgetProps.name,onClick:()=>{(0,w.showActionRequiredDialog)(this.context.pageContext,D.DisabledWidget_DialogHeading,t)}})))}async loadCoreContribution(){try{const e=await(0,m.resolveWidgetContributionAsync)(this.context.pageContext,this.props.widgetProps.contributionId),t={widgetContributionRenderingProps:e};if(this.setState(t),e&&e.widgetComponentContributionId){const t=await(0,m.resolveComponentContributionAsync)(this.context.pageContext,e.widgetComponentContributionId);t?this.setState({widgetComponentContributionProps:t}):this.setState({fallbackToLegacyRendering:!0})}}catch(e){const t=(0,M.userHasClaim)(this.context.pageContext,"member")?o.renderAsExtensionUninstalled:o.renderAsContentBlocked;this.setState({terminalMode:t})}}determineMode(){return this.state.terminalMode?this.state.terminalMode:this.state.widgetContributionRenderingProps?this.state.widgetContributionRenderingProps.widgetComponentContributionId&&!this.state.fallbackToLegacyRendering?this.state.widgetComponentContributionProps?o.renderModernWidgetHost:o.loading:o.renderLegacyWidgetHost:o.loading}}}()},["Resources","Helpers/PresentationContextHelpers","Helpers/WidgetHostTelemetry","HostImplementation/KeyboardHandler","Helpers/DashboardsPanelManager","MessageComponents/DefaultWidgetFailedMessage","MessageComponents/ExtensionFailedMessage","MessageComponents/WidgetErrorMessage","OverlayComponents/WidgetHostEditOverlay","OverlayComponents/WidgetHostOverlay","HostImplementation/WidgetHostImplementationBase","HostImplementation/DisabledWidgetHostImplementation","HostImplementation/LegacyWidgetHostImplementation","HostImplementation/ModernWidgetHostImplementation","MessageComponents/AccessNotSupportedMessage","MessageComponents/ExtensionDisabledMessage","WidgetHost"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-dashboards.dashboards-widget-host"}}));