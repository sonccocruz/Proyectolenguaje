"use strict";define("Dashboards/DashboardPickerProvider",["require","exports","Dashboards/DashboardPanel/CreateDashboardPanel","Favorites/Common/Constants","Favorites/Picker/ArtifactPickerProvider","react","VSS/Core/Util/String","VSS/Legacy/Legacy","VSS/Platform/Feature","VSS/Platform/FPS"],function(e,a,r,t,o,s,i,d,c,n){var h;h=a.Resources={},a.Resources.DashboardsPicker_FavoriteGroupHeader="Favorites",a.Resources.DashboardsPicker_DefaultGroupHeader="A to Z",a.Resources.DashboardsPicker_SearchNoResultsText="No results found",a.Resources.DashboardsPicker_SearchTextPlaceholder="Search dashboards",a.Resources.DashboardsPicker_BrowseAllDashboardsText="Browse all dashboards",a.Resources.DashboardsPicker_LoadingDashboardsText="Loading dashboards",a.Resources.DashboardsPicker_SearchResultsLoadingText="Searching dashboards",a.Resources.DashboardsPicker_NewDashboard="New dashboard",function(e){a[e]={};class b{constructor(e,a,t){this.pageContext=e,this.project=a,this.currentDashboard=t,this.onNewDashboardClick=(()=>{const e=this.pageContext.getService("IVssLayoutManager"),a=e=>{const a=this.pageContext.getService("IVssLocationService"),r={project:this.project.name,id:e.id};e.teamId&&(r.team=e.teamId);const t=a.routeUrl("ms.vss-dashboards-web.dashboards-new-experience-route",r);(0,n.FastPageSwitch)(this.pageContext,t,!0)};(0,c.isFeatureEnabled)(this.pageContext,"ms.vss-dashboards.new-dashboard-management-experience-feature",!1)?Promise.all([u(this.pageContext),l(this.pageContext)]).then(([t,o])=>{e.renderCallout(e=>s.createElement(r.CreateDashboardPanel,{onDismiss:e,onDashboardCreated:a,project:this.project,userTeams:t,allTeams:o.map(e=>e.value)}))}):e.renderCallout(e=>s.createElement(d.LegacyComponent,{modules:["Dashboards/Components/Shared/CreateDashboardDialog/CreateDashboardDialog"],wrappedType:"CreateDashboardDialog",allowTeamSelection:!0,onDashboardCreated:a,onDismiss:e}))})}build(e=!1,a=!1){return this.getArtifactPicker(this.currentDashboard,e,a)}getArtifactPicker(e,a,r){const s={pageContext:this.pageContext,favoritesContext:{artifactType:b.DashboardFavoriteType,artifactScope:{id:this.project.id,name:this.project.name,type:t.FavoriteStorageScopes.Project}},selectedArtifact:e,artifactComparer:(e,a)=>(0,i.localeIgnoreCaseComparer)(this.getArtifactName(e),this.getArtifactName(a)),getSearchResults:e=>v(this.pageContext).then(a=>a.filter(a=>(0,i.caseInsensitiveContains)(this.getArtifactName(a),e))),searchNoResultsText:h.DashboardsPicker_SearchNoResultsText,searchTextPlaceholder:h.DashboardsPicker_SearchTextPlaceholder,browseAllText:h.DashboardsPicker_BrowseAllDashboardsText,loadingText:h.DashboardsPicker_LoadingDashboardsText,searchResultsLoadingText:h.DashboardsPicker_SearchResultsLoadingText,onBrowseAllClick:void 0===a||a?()=>{const e=this.pageContext.getService("IVssLocationService").routeUrl("ms.vss-dashboards-web.dashboards-directory-route",{project:this.project.name});(0,n.FastPageSwitch)(this.pageContext,e,!0)}:void 0,otherActions:this.getOtherActionsForPicker(r),groups:m(this.pageContext),getArtifacts:()=>v(this.pageContext),getArtifactId:e=>e.dashboard.id,getArtifactName:e=>this.getArtifactName(e),getFavoriteFromArtifact:e=>this.getFavoriteForDashboard(e),getArtifactFromFavorite:e=>this.getDashboardForFavorite(e),getArtifactIcon:()=>({iconName:"ViewDashboard",iconType:0}),getArtifactHref:e=>this.getDashboardUrl(e),onArtifactClicked:e=>{const a=this.getDashboardUrl(e);return(0,n.FastPageSwitch)(this.pageContext,a,!0),!0},favoriteGroupHeader:h.DashboardsPicker_FavoriteGroupHeader,defaultGroupHeader:h.DashboardsPicker_DefaultGroupHeader,getArtifactListGroupId:e=>e?e.owner.id:""};return new o.ArtifactPickerProvider(s)}getDashboardUrl(e){const a=this.pageContext.getService("IVssLocationService"),r={project:this.project.name,id:e.dashboard.id};return a.routeUrl("ms.vss-dashboards-web.dashboards-new-experience-route",r)}getArtifactName(e){const a=this.getFavoriteForDashboard(e),r=this.pageContext.getService("dashboard-favorite-provider-data-service");return null!=r&&r.getDisplayName?r.getDisplayName(a):e.dashboard.name}getOtherActionsForPicker(e){return e?[{name:h.DashboardsPicker_NewDashboard,iconProps:{iconName:"CalculatorAddition",iconType:0},onClick:this.onNewDashboardClick}]:[]}getFavoriteForDashboard(e){const a={ownerId:e.owner.id,ownerName:e.owner.name,groupId:e.dashboard.groupId},r={artifactId:e.dashboard.id,artifactName:e.dashboard.name,artifactType:b.DashboardFavoriteType,artifactScope:{id:this.project.id,name:this.project.name,type:t.FavoriteStorageScopes.Project},artifactProperties:a};return Object.assign(Object.assign({},r),{artifactIsDeleted:!1,creationDate:new Date,id:"",owner:{},url:"",_links:void 0})}getDashboardForFavorite(e){const a=e.artifactProperties,r={id:a.ownerId,name:a.ownerName};return{owner:r,dashboard:{id:e.artifactId,name:e.artifactName,ownerId:r.id,groupId:a.groupId}}}}function l(e){return p(e,"ms.vss-dashboards-web.dashboards-team-list-data-provider","Failed to retrieve 'all teams'.")}function u(e){return p(e,"ms.vss-dashboards-web.dashboards-team-memberships-provider","Failed to retrieve 'my teams'.")}function g(e){return p(e,"ms.vss-dashboards-web.my-dashboards-data-provider","Failed to retrieve 'my dashboards'.")}async function p(e,a,r){const t=e.getService("IVssContributionService"),o=await t.getDataAsync(a,void 0,!0);if(!o){const e=t.getDataProviderExceptions()[a],o=[r,e&&e.message].join(" ");throw new Error(o)}return o}function m(e){return u(e).then(e=>D(e))}function D(e){const a=[];return e?(e.forEach(e=>{a.push({key:e.id,name:e.name})}),a.sort((e,a)=>(0,i.localeIgnoreCaseComparer)(e.name,a.name))):[]}function v(e){const a=g(e),r=u(e);return Promise.all([a,r]).then(([e,a])=>f(e,a))}function f(e,a){const r=[];if(e&&a)for(const t of a)r.push(...e.filter(e=>e.ownerId===t.id).map(e=>P(e,t)));return r}function P(e,a){return{owner:a,dashboard:e}}a[e].DashboardPickerProviderFactory=b,b.DashboardFavoriteType="Microsoft.TeamFoundation.Dashboards.Dashboard",a[e].getAllTeams=l,a[e].getMyTeams=u,a[e].getMyDashboards=g,a[e].getMyTeamGroups=m,a[e].packTeamsAsGroups=D,a[e].getMyDashboardsItems=v,a[e].packDashboards=f,a[e].createPickerDashboardItem=P}("DashboardPickerProviderFactory")},["Resources","DashboardPickerProviderFactory"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-dashboards.dashboard-picker-provider"}}));