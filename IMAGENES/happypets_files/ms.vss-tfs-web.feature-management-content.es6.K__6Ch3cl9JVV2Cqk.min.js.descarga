"use strict";define("TFS/FeatureManagement",["require","exports","react","VSS/Core/Util/Promise","VSSUI/MessageBar","VSSUI/Button","VSSUI/Checkbox","VSSUI/Dialog","VSSUI/Dropdown","VSSUI/Utilities/DropdownSelection","VSSUI/FormItem","VSSUI/Util","VSSUI/Link","VSS/Core/Observable","VSSUI/Observer","VSSUI/Panel","VSSUI/TextField","VSSUI/Toggle","VSS/Platform/Layout","VSS/Core/Util/String","VSS/Platform/Components/Format","VSSUI/Callout","react-dom","VSS/Platform/Context","VSSUI/ButtonGroup","VSSUI/Utilities/ScreenSize","VSS/Platform/RestClientBase"],function(e,t,a,s,r,o,n,i,u,l,c,p,d,m,h,f,S,g,F,v,C,T,b,x,M,y,E){var I,_,D,w;I=t.Resources={},t.Resources.CancelButtonText="Cancel",t.Resources.CloseButtonText="Close",t.Resources.Loading="Loading...",t.Resources.ManageFeaturesOnLabel="On",t.Resources.ManageFeaturesOffLabel="Off",t.Resources.ToggleFeatureOnAriaLabelFormat="{0}: on. Press enter to turn the feature off.",t.Resources.ToggleFeatureOffAriaLabelFormat="{0}: off. Press enter to turn the feature on.",t.Resources.FeatureLearnMoreAriaLabel="Learn more about feature: {0}",t.Resources.LearnMore="Learn more",t.Resources.TurnOffFeatureDialogLabel="How can we make this feature better?",t.Resources.TurnOffFeatureDialogPrivacyText="Your privacy is important to us.",t.Resources.TurnOffFeatureDialogPrivacyLink="https://go.microsoft.com/fwlink/?LinkId=264782",t.Resources.AllowMicrosoftToContactForDetails="It's okay to contact me for more details on my comments.",t.Resources.TurnOnFeatureDialogTitleFormat="Turn on {0}?",t.Resources.TurnOffFeatureDialogTitleFormat="Turn off {0}?",t.Resources.TurnOnFeatureButtonText="Turn on",t.Resources.TurnOffFeatureButtonText="Turn off",t.Resources.ManageFeaturesHeader="Preview features",t.Resources.ManageFeaturesHeaderOnPrem="Manage features",t.Resources.ManageFeaturesSubHeading="The following preview features are available for your evaluation. Help us make them better!",t.Resources.ManageFeaturesSubHeadingOnPrem="The following features are optional and can be turned on or off.",t.Resources.FeatureScope="Feature scope",t.Resources.NoFeatureScopeWritePermission="You don't have permission to manage these features.",t.Resources.NoFeaturesAvailable="No features are available to manage.",t.Resources.DevModeFeaturesHeaderTooltip="This section lists all features and does not appear in retail builds.",t.Resources.DevModeFeaturesHeader="Experimental [Debug build only].",t.Resources.DevModeEnableAllLabel="Feeling lucky?",t.Resources.DevModeEnableAllLinkText="Enable all features",t.Resources.ManageFeaturesScopeAccount="for this organization [{0}]",t.Resources.ManageFeaturesScopeCollection="for this collection [{0}]",t.Resources.ManageFeaturesScopeMe="for me [{0}]",t.Resources.ManageFeaturesScopeProject="for this project [{0}]",t.Resources.ManageFeaturesScopeTeam="for this team [{0}]",t.Resources.ToggleFeatureForAccountWarning="This will affect all users in your organization.",t.Resources.ToggleFeatureForCollectionWarning="This will affect all users in your collection.",t.Resources.ToggleFeatureForProjectWarning="This will affect all users in your project.",t.Resources.ToggleFeatureForTeamWarning="This will affect all users in your team.",t.Resources.FeatureBannerDismissButton="Not now",t.Resources.FeatureBannerNameFormat="{0}:",t.Resources.FeatureBannerTryItButton="Try it!",t.Resources.FeatureDismissedCalloutBody="You can turn on this and other features in {0} under your profile menu.",t.Resources.FeatureDismissedCalloutHeader="No problem. If you change your mind...",t.Resources.FeatureEnabledCalloutBody="You can turn off this feature by going to {0} under your profile menu.",t.Resources.PreviewFeaturesMenuHosted="Preview features",t.Resources.PreviewFeaturesMenuOnPrem="Manage features",t.Resources.FeatureEnabledCalloutHeader="{0} is now on",t.Resources.FilterFeatures="Filter Features",function(e){_=t.ComponentsFeaturePanelFeaturePanel={};function C(e){const{collectFeedback:t,features:s,featureStates:r,scope:o,setFeatureState:n}=e;return a.createElement("div",{className:"features-list body-m"},s.map((e,s)=>a.createElement(b,{collectFeedback:t&&"ms."===e.id.substr(0,3),feature:e,featureState:r[e.id],key:e.id,scope:o,setFeatureState:n})))}t.ComponentsFeaturePanelFeaturePanel.FeatureManagementPanelComponent=class extends F.VssComponent{constructor(e){super(e),this.featureStates={},this.filter=new m.ObservableValue(""),this._isMatch=((e,t)=>e.name.toLocaleLowerCase().indexOf(t)>=0||e.description.toLocaleLowerCase().indexOf(t)>=0),this._closePanel=(()=>{this.props.onDismiss&&this.props.onDismiss()}),this.enableAllFeatures=(()=>{let{selectedScope:e}=this.state;if(!e&&this.scopes&&this.scopes.length>0&&(e=this.scopes[0]),e){const t=this.getEnableableFeatures();for(const a of t)this._setFeatureState(a,e.featureScope.userScoped,e.featureScope.settingScope,1)}}),this.filterChange=((e,t)=>{this.filter.value=t}),this._isFeatureInScope=((e,t)=>{for(const a of e.scopes)if(this._isSameScope(a,t))return!0;return!1}),this._onFeatureStateChanged=(e=>{this.featureStates[e.featureId]&&(this.featureStates[e.featureId].value=e)}),this._onScopeChanged=((e,t)=>{this.scopes&&t&&t.data&&(this.featureStates={},this._setSelectedScope(t.data))}),this._setFeatureState=((e,t,a,s,r,o)=>{this.props.featureService.setFeatureState(e,t,a,this.props.scopeValues[a],s,r,o)}),this._setSelectedScope=(e=>{const t=this.allDevFeatures&&this.allDevFeatures.filter((t,a)=>this._isFeatureInScope(t,e.featureScope)),a=this.allReleaseFeatures&&this.allReleaseFeatures.filter((t,a)=>this._isFeatureInScope(t,e.featureScope));if(this.setState({selectedScope:e,selectedDevFeatures:t,selectedReleaseFeatures:a}),e&&this.scopes){const t=this.scopes.findIndex(t=>this._isSameScope(t.featureScope,e.featureScope));t>=0&&!this.scopeSelection.selected(t)&&this.scopeSelection.select(t)}if(this.featurePromises)for(const e of this.featurePromises)e.cancel();this.featurePromises=[];const r=(new Array).concat(a||[],t||[]);if(r.length>0){const t=this.props.featureService.getFeatureStates(r,e.featureScope.userScoped,e.featureScope.settingScope,this.props.scopeValues);for(const e of t){const t=(0,s.makeCancelable)(e);this.featurePromises.push(t),t.promise.then(e=>{for(const t in e)this.featureStates[t]?this.featureStates[t].value=e[t]:this.featureStates[t]=new m.ObservableValue(e[t]);this.forceUpdate()})}}}),this.scopeSelection=new l.DropdownSelection,this.state={},this.observe([{propertyName:"featureService",observer:this._onFeatureStateChanged,action:"featureStateUpdated"}])}render(){const{selectedDevFeatures:e,selectedReleaseFeatures:t}=this.state,{isHosted:s,scopeValues:n}=this.props;let{selectedScope:i}=this.state;return!i&&this.scopes&&this.scopes.length>0&&(i=this.scopes[0],this.scopeSelection.select(0,1)),a.createElement(f.Panel,{lightDismiss:!0,className:"features-panel",titleProps:{text:s?I.ManageFeaturesHeader:I.ManageFeaturesHeaderOnPrem},onDismiss:this._closePanel},a.createElement("div",{className:"feature-management-container title-xs"},this.scopes?a.createElement(a.Fragment,null,a.createElement("div",null,s?I.ManageFeaturesSubHeading:I.ManageFeaturesSubHeadingOnPrem),this.scopes.length<=1?null:a.createElement(u.Dropdown,{ariaLabel:I.FeatureScope,className:"feature-scope-picklist",calloutContentClassName:"feature-scope-callout",selection:this.scopeSelection,onSelect:this._onScopeChanged,items:this.scopes.map(e=>({data:e,id:e.displayName,text:e.displayName}))}),i&&!i.canManage?a.createElement(r.MessageBar,{className:"scope-no-write-permission-message",severity:"Info"},I.NoFeatureScopeWritePermission):null,t&&n&&i&&Object.keys(this.featureStates).length>0?a.createElement(C,{collectFeedback:s,features:t?[...t]:[],featureStates:this.featureStates,scope:i,setFeatureState:this._setFeatureState}):a.createElement("div",{className:"feature-message"},I.NoFeaturesAvailable),e&&e.length&&n&&i?a.createElement("div",{className:"dev-mode-features"},a.createElement("div",{className:"dev-mode-label body-l",title:I.DevModeFeaturesHeaderTooltip},I.DevModeFeaturesHeader),this.getEnableableFeatures().length&&a.createElement("div",{className:"enable-all-features flex-row flex-center"},a.createElement("span",null,I.DevModeEnableAllLabel,"Â "),a.createElement(o.Button,{subtle:!0,onClick:this.enableAllFeatures,text:I.DevModeEnableAllLinkText})),a.createElement(h.Observer,{filterText:this.filter},t=>{let s=e;if(t.filterText&&e){const a=t.filterText.trim().toLocaleLowerCase();s=e.filter(e=>this._isMatch(e,a))}return i&&a.createElement(a.Fragment,null,a.createElement(c.FormItem,{label:I.FilterFeatures},a.createElement(S.TextField,{value:t.filterText,onChange:this.filterChange})),a.createElement(C,{collectFeedback:!1,features:s?[...s]:[],featureStates:this.featureStates,scope:i,setFeatureState:this._setFeatureState}))})):null):a.createElement("div",{className:"feature-message"},I.Loading)))}componentDidMount(){super.componentDidMount(),this.props.featureService.getFeatureDefinitions(void 0,!0,void 0,["product"]).then(e=>{const t={},a=[];if(e){if(e.features){this.allReleaseFeatures=e.features.slice().sort((e,t)=>e.name.localeCompare(t.name));for(const e of this.allReleaseFeatures)for(const a of e.scopes)t[a.settingScope||""]=!0}if(e.devModeFeatures){this.allDevFeatures=e.devModeFeatures.slice().sort((e,t)=>e.name.localeCompare(t.name));for(const e of this.allDevFeatures)for(const a of e.scopes)t[a.settingScope||""]=!0}if(this.props.supportedScopes&&e.managementScopes)for(const s of this.props.supportedScopes)if(t[s.featureScope.settingScope]){const t=Object.assign({},s);s.hasOwnProperty("canManage")?t.canManage=s.canManage:t.canManage=e.managementScopes[s.featureScope.settingScope],a.push(t)}}if(this.scopes=a,a&&a.length){let e=a[0];if(this.props.initialScope)for(const t of a)if(this._isSameScope(this.props.initialScope,t.featureScope)){e=t;break}this._setSelectedScope(e)}})}getEnableableFeatures(){const{selectedDevFeatures:e,selectedReleaseFeatures:t}=this.state,a=[...t||[],...e||[]];let s=[];return this.featureStates&&(s=a.filter(e=>{const t=this.featureStates[e.id];return t&&1!==t.value.state&&!t.value.overridden})),s}_isSameScope(e,t){return e.userScoped===t.userScoped&&(e.settingScope||"")===(t.settingScope||"")}};const T="AllowContact";class b extends F.VssComponent{constructor(e){super(e),this._feedbackText=new m.ObservableValue(""),this._allowContact=new m.ObservableValue(!1),this._onFeedbackChanged=((e,t)=>{this._feedbackText.value=t}),this._onAllowContactChanged=((e,t)=>{this._allowContact.value=t}),this._onFeatureStateChanged=(e=>{this.forceUpdate()}),this._onToggleChanged=(()=>{if(!this.props.featureState||!this.props.featureState.value)return;const e=1===this.props.featureState.value.state?0:1,t=0===e,a=t&&this.props.collectFeedback&&!this.state.hasBeenToggled;this._feedbackText.value="";const s=this.props.scope.scopeWarningText;a||s?this.setState({collectFeedback:a,confirmDialogTitle:(0,v.format)(t?I.TurnOffFeatureDialogTitleFormat:I.TurnOnFeatureDialogTitleFormat,this.props.feature.name),confirmScopeMessage:s,confirmButtonText:t?I.TurnOffFeatureButtonText:I.TurnOnFeatureButtonText}):this._setFeatureState(e,void 0)}),this.state={},this.observe([{propertyName:"featureState",observer:this._onFeatureStateChanged}])}render(){const{feature:e,featureState:t,scope:s}=this.props;let o=!1,u=!1,l=void 0;t&&t.value&&(o=1===t.value.state,u=t.value.overridden,l=t.value.reason);const m=l?{text:l}:void 0;return a.createElement("div",{className:"feature flex-grow"},a.createElement("div",{className:"feature-header"},a.createElement("div",{className:"feature-name title-xs"},e.name),a.createElement(g.Toggle,{"aria-disabled":!t||void 0,checked:o,className:t?void 0:"loading",disabled:!s.canManage||u,offAriaLabel:(0,v.format)(I.ToggleFeatureOffAriaLabelFormat,e.name)+" "+e.description,offText:I.ManageFeaturesOffLabel,onAriaLabel:(0,v.format)(I.ToggleFeatureOnAriaLabelFormat,e.name)+" "+e.description,onChange:this._onToggleChanged,onText:I.ManageFeaturesOnLabel,tooltipProps:m})),a.createElement("div",{className:"feature-description"},a.createElement("span",null,e.description),e._links&&e._links.learn?a.createElement(d.Link,{href:e._links.learn.href,className:"learn-more",ariaLabel:(0,v.format)(I.FeatureLearnMoreAriaLabel,e.name),target:"_blank"},I.LearnMore):null),this.state.errorText?a.createElement(r.MessageBar,{className:"feature-toggle-error",severity:"Error",onDismiss:()=>{this.setState({errorText:void 0})}},this.state.errorText):null,this.state.confirmDialogTitle?a.createElement(i.Dialog,{defaultActiveElement:"#"+(0,p.getSafeId)("feature-feedback-input"),calloutContentClassName:"feature-feedback-dialog",footerButtonProps:[{onClick:()=>{this._closeConfirmDialog(!1)},text:I.CancelButtonText},{primary:!0,onClick:()=>{this._closeConfirmDialog(!0)},text:this.state.confirmButtonText}],lightDismiss:!1,onDismiss:()=>{this._closeConfirmDialog(!1)},titleProps:{text:this.state.confirmDialogTitle}},this.state.confirmScopeMessage?a.createElement(r.MessageBar,{className:"feature-toggle-error",severity:"Warning"},this.state.confirmScopeMessage):null,this.state.collectFeedback?a.createElement(c.FormItem,{className:"feature-feedback-text",label:I.TurnOffFeatureDialogLabel},a.createElement(S.TextField,{inputId:"feature-feedback-input",multiline:!0,onChange:this._onFeedbackChanged,value:this._feedbackText}),a.createElement(n.Checkbox,{className:"margin-top-4",label:I.AllowMicrosoftToContactForDetails,onChange:this._onAllowContactChanged,checked:this._allowContact}),a.createElement(d.Link,{className:"margin-top-4",target:"_blank",rel:"noopener noreferrer",href:I.TurnOffFeatureDialogPrivacyLink},I.TurnOffFeatureDialogPrivacyText)):null):null)}_closeConfirmDialog(e){if(this.setState({collectFeedback:!1,confirmButtonText:void 0,confirmDialogTitle:void 0,confirmScopeMessage:void 0}),e&&this.props.featureState&&this.props.featureState.value){const e=1===this.props.featureState.value.state?0:1;this._setFeatureState(e,this._feedbackText.value,this._allowContact.value)}}_setFeatureState(e,t,a){const{feature:s,scope:{featureScope:r}}=this.props;this.props.setFeatureState(s,r.userScoped,r.settingScope,e,t,a?T:void 0),this.state.hasBeenToggled||this.setState({hasBeenToggled:!0})}}}(),function(e){D=t.ComponentsFeatureBannerFeatureCallout={};class s extends a.Component{constructor(e){super(e),this._onMouseEnter=(()=>{this._initialMouseEnterTimeout||this._mouseEntered||(this._mouseEntered=!0,window.clearTimeout(this._fadingTimeout),this.setState({fadingOut:!1}))}),this._onMouseLeave=(()=>{!this._initialMouseEnterTimeout&&this._mouseEntered&&(this._mouseEntered=!1,this.props.onDismiss())}),this.state={fadingOut:!1}}componentDidMount(){this._initialFadeTimeout=window.setTimeout(()=>{this._mouseEntered||this._startFadeOut()},s.INITIAL_START_FADE_TIMEOUT),this._initialMouseEnterTimeout=window.setTimeout(()=>{this._initialMouseEnterTimeout=void 0},s.INITIAL_ENTER_TIMEOUT)}componentWillUnmount(){window.clearTimeout(this._fadingTimeout),window.clearTimeout(this._initialFadeTimeout),window.clearTimeout(this._initialMouseEnterTimeout)}render(){return a.createElement(T.Callout,{anchorElement:document.querySelector(".navigation-profile-menu, .me-control-div"),anchorOrigin:{horizontal:"end",vertical:"end"},anchorOffset:{horizontal:0,vertical:1},calloutOrigin:{horizontal:"end",vertical:"start"},className:"features-callout"+(this.state.fadingOut?" fading-out":""),contentShadow:!0,onDismiss:this.props.onDismiss},a.createElement("div",{className:"callout-content",onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},a.createElement("p",{className:"callout-header"},this.props.headerText),a.createElement(C.FormatComponent,{elementType:"p",format:this.props.bodyFormat},this.props.bodyFormatArgs)))}_startFadeOut(){this.setState({fadingOut:!0}),this._fadingTimeout=window.setTimeout(()=>{this.props.onDismiss()},s.FADE_CLOSE_TIMEOUT)}}t.ComponentsFeatureBannerFeatureCallout.FeatureCalloutComponent=s,s.INITIAL_START_FADE_TIMEOUT=3e3,s.FADE_CLOSE_TIMEOUT=3e3,s.INITIAL_ENTER_TIMEOUT=2e3}(),function(e){t.FeatureAdsService={};const s="FeatureAds/Dismissed/",r="FeatureAds/DismissCalloutShown";x.Services.add("IFeatureAdsService",{serviceFactory:class extends x.VssService{dismissFeatureAd(e){const t={};return t[s+e]=!0,t[r]=!0,this.pageContext.getRestClient("ISettingsRestClient").setEntries(t,"me")}prepareShowFeatureEnabledCallout(e){let t="";0===window.location.protocol.toLowerCase().indexOf("https")&&(t=";secure"),document.cookie="Feature-Enabled-Callout="+e+";path=/;max-age=10"+t}showFeatureEnabledCallout(e,t){this.showFeatureCallout((0,v.format)(I.FeatureEnabledCalloutHeader,e),I.FeatureEnabledCalloutBody,t)}showFeatureAdDismissedCallout(e){this.showFeatureCallout(I.FeatureDismissedCalloutHeader,I.FeatureDismissedCalloutBody,e)}showFeatureCallout(e,t,s){let r=!1;const o=this.pageContext.getService("IVssPageService").getData();o&&(r=o.isHosted);const n=r?I.PreviewFeaturesMenuHosted:I.PreviewFeaturesMenuOnPrem,i=[a.createElement("b",{key:"featureMenu"},[n])],u=document.createElement("div");document.body.appendChild(u),b.render(a.createElement(D.FeatureCalloutComponent,{headerText:e,bodyFormat:t,bodyFormatArgs:i,onDismiss:()=>{b.unmountComponentAtNode(u),u.remove(),s&&s()}}),u)}}});class o extends F.VssComponent{constructor(e,t){super(e,t),t.pageContext.getService("IFeatureAdsService").showFeatureEnabledCallout(e.feature.name,e.onClose)}render(){return null}}o.componentType="featureEnabledCallout",F.VssComponent.register(o.componentType,o)}(),w=t.FeaturePanel={},__exportStar(_,t.FeaturePanel),function(e){let s;t.FeaturePanelService={};x.Services.add("IFeaturePanel",{serviceFactory:class extends x.VssService{constructor(){super(...arguments),this._onFeatureStateUpdate=(e=>{this.changesMade=!0})}show(e){if(s)return;const t=this.pageContext.getService("IVssPageService").getData();t&&(this.isHosted=t.isHosted);const r=this.pageContext.getService("ITfsPageService"),o=r.getData(),n={};o&&o.project&&(n.project=o.project.id);const i=r.getHorizontalNavigationTeamData();i&&(n.team=i.id);const u=[];t&&t.user&&u.push({featureScope:{userScoped:!0,settingScope:""},displayName:(0,v.format)(I.ManageFeaturesScopeMe,t.user.displayName),canManage:!0}),i&&u.push({featureScope:{userScoped:!1,settingScope:"team"},displayName:(0,v.format)(I.ManageFeaturesScopeTeam,i.name),scopeWarningText:I.ToggleFeatureForTeamWarning}),o&&o.project&&u.push({featureScope:{userScoped:!1,settingScope:"project"},displayName:(0,v.format)(I.ManageFeaturesScopeProject,o.project.name),scopeWarningText:I.ToggleFeatureForProjectWarning}),t&&u.push({featureScope:{userScoped:!1,settingScope:""},displayName:this.isHosted?(0,v.format)(I.ManageFeaturesScopeAccount,t.hostName):(0,v.format)(I.ManageFeaturesScopeCollection,t.hostName),scopeWarningText:this.isHosted?I.ToggleFeatureForAccountWarning:I.ToggleFeatureForCollectionWarning});const l=this.pageContext.getService("ITfsFeatureService");l.subscribe(this._onFeatureStateUpdate),this.pageContext.getService("IVssLayoutManager").renderCallout(t=>a.createElement(w.FeatureManagementPanelComponent,{featureService:l,isHosted:this.isHosted,onDismiss:()=>{s=!1,l.unsubscribe(this._onFeatureStateUpdate),this.changesMade?window.location.reload():t()},supportedScopes:u,scopeValues:n,initialScope:e},null)),s=!0}}})}(),function(e){t.ComponentsFeatureBannerFeatureBanner={};const s="FeatureBanner";class r extends F.VssComponent{constructor(e,t){super(e,t),this.onFeatureStateChanged=(e=>{e.featureId===this.props.feature.id&&this.dismissAd().then(()=>{this.context.pageContext.getService("IFeatureAdsService").prepareShowFeatureEnabledCallout(this.props.feature.id),this.reloadOnFeatureSet&&window.location.reload()})}),this.onTryItClicked=(()=>{this.reloadOnFeatureSet=!0;const e=this.props.feature.scopes.filter(e=>e.userScoped).length>0;if(this.context.pageContext.getService("IVssTelemetryService").publishEvent(s,"bannerTryItClicked",{featureId:this.props.feature.id,openedPanel:!e}),e){this.featureService.setFeatureState(this.props.feature,!0,void 0,void 0,1)}else{this.context.pageContext.getService("IFeaturePanel").show(this.props.feature.scopes[0])}}),this.onDismissedClicked=(()=>{if(this.context.pageContext.getService("IVssTelemetryService").publishEvent(s,"bannerDismissed",{featureId:this.props.feature.id}),this.props.onDismiss(),this.dismissAd(),this.props.showDismissCallout){this.context.pageContext.getService("IFeatureAdsService").showFeatureAdDismissedCallout()}}),this.state={},this.featureService=t.pageContext.getService("ITfsFeatureService"),this.featureService.subscribe(this.onFeatureStateChanged,"featureStateUpdated")}render(){return a.createElement(y.ScreenSizeObserver,null,e=>{const t=e.screenSize<=0;return a.createElement("div",{className:t?"flex-column rhythm-vertical-16":"flex-row flex-center rhythm-horizontal-16"},a.createElement("div",{className:"rhythm-horizontal-4"},a.createElement("span",{className:"font-weight-semibold"},(0,v.format)(I.FeatureBannerNameFormat,this.props.feature.name)),a.createElement("span",null,this.props.message||this.props.feature.description||""),this.props.feature._links&&this.props.feature._links.learn?a.createElement(d.Link,{href:this.props.feature._links.learn.href,className:"learn-more flex-noshrink",target:"_blank"},I.LearnMore):null),a.createElement(M.ButtonGroup,{className:"flex-noshrink"},a.createElement(o.Button,{onClick:this.onDismissedClicked},I.FeatureBannerDismissButton),a.createElement(o.Button,{primary:!0,onClick:this.onTryItClicked},I.FeatureBannerTryItButton)))})}componentWillUnmount(){this.featureService.unsubscribe(this.onFeatureStateChanged,"featureStateUpdated"),super.componentWillUnmount()}dismissAd(){return this.context.pageContext.getService("IFeatureAdsService").dismissFeatureAd(this.props.feature.id)}}r.componentType="featureGlobalMessageBanner",F.VssComponent.register(r.componentType,r)}(),function(e){t.ComponentsFeatureDialogFeatureDialog={};const s="FeatureDialog";class r extends F.VssComponent{constructor(e,t){super(e,t),this.onFeatureStateChanged=(e=>{e.featureId===this.props.feature.id&&this.dismissAd().then(()=>{this.context.pageContext.getService("IFeatureAdsService").prepareShowFeatureEnabledCallout(this.props.feature.id),this.reloadOnFeatureSet&&window.location.reload()})}),this.onTryItClicked=(()=>{this.reloadOnFeatureSet=!0;const e=this.props.feature.scopes.filter(e=>e.userScoped).length>0;if(this.context.pageContext.getService("IVssTelemetryService").publishEvent(s,"bannerTryItClicked",{featureId:this.props.feature.id,openedPanel:!e}),e){this.featureService.setFeatureState(this.props.feature,!0,void 0,void 0,1)}else{this.context.pageContext.getService("IFeaturePanel").show(this.props.feature.scopes[0])}}),this.onDismissedClicked=(()=>{if(this.context.pageContext.getService("IVssTelemetryService").publishEvent(s,"bannerDismissed",{featureId:this.props.feature.id}),this.props.onDismiss(),this.dismissAd(),this.props.showDismissCallout){this.context.pageContext.getService("IFeatureAdsService").showFeatureAdDismissedCallout()}}),this.featureService=t.pageContext.getService("ITfsFeatureService")}componentDidMount(){this.featureService.subscribe(this.onFeatureStateChanged,"featureStateUpdated")}render(){const e=[];return this.props.feature._links&&this.props.feature._links.learn&&e.push({className:"flex-noshrink",text:I.LearnMore,href:this.props.feature._links.learn.href,target:"_blank"}),e.push({primary:!0,className:"flex-noshrink",onClick:this.onTryItClicked,text:I.FeatureBannerTryItButton}),a.createElement(i.CornerDialog,{onDismiss:this.onDismissedClicked,className:"feature-dialog",footerButtonProps:e,titleProps:{text:this.props.feature.name,className:"feature-name flex-noshrink"}},a.createElement("div",{className:"flex-column"},a.createElement("span",{className:"description-text"},this.props.message||this.props.feature.description||"")))}componentWillUnmount(){this.featureService.unsubscribe(this.onFeatureStateChanged,"featureStateUpdated"),super.componentWillUnmount()}dismissAd(){return this.context.pageContext.getService("IFeatureAdsService").dismissFeatureAd(this.props.feature.id)}}r.componentType="featureGlobalDialog",F.VssComponent.register(r.componentType,r)}(),function(e){t[e]={};t[e].FeatureManagementClientName="IFeatureManagementRestClient",t[e].getFeatureManagementClient=function(a,s){return a.getRestClient(t[e].FeatureManagementClientName,s)},x.RestClients.add(t[e].FeatureManagementClientName,{factory:class extends E.RestClientBase{constructor(e){super(e)}async getFeature(e){return this.beginRequest({apiVersion:"4.1-preview.1",routeTemplate:"_apis/FeatureManagement/Features/{featureId}",routeValues:{featureId:e}})}async getFeatures(e){const t={targetContributionId:e};return this.beginRequest({apiVersion:"4.1-preview.1",routeTemplate:"_apis/FeatureManagement/Features/{featureId}",queryParams:t})}async getFeatureState(e,t){return this.beginRequest({apiVersion:"4.1-preview.1",routeTemplate:"_apis/FeatureManagement/FeatureStates/{userScope}/{featureId}",routeValues:{featureId:e,userScope:t}})}async setFeatureState(e,t,a,s,r){const o={reason:s,reasonCode:r};return this.beginRequest({apiVersion:"4.1-preview.1",method:"PATCH",routeTemplate:"_apis/FeatureManagement/FeatureStates/{userScope}/{featureId}",routeValues:{featureId:t,userScope:a},queryParams:o,body:e})}async getFeatureStateForScope(e,t,a,s){return this.beginRequest({apiVersion:"4.1-preview.1",routeTemplate:"_apis/FeatureManagement/FeatureStates/{userScope}/{scopeName}/{scopeValue}/{featureId}",routeValues:{featureId:e,userScope:t,scopeName:a,scopeValue:s}})}async setFeatureStateForScope(e,t,a,s,r,o,n){const i={reason:o,reasonCode:n};return this.beginRequest({apiVersion:"4.1-preview.1",method:"PATCH",routeTemplate:"_apis/FeatureManagement/FeatureStates/{userScope}/{scopeName}/{scopeValue}/{featureId}",routeValues:{featureId:t,userScope:a,scopeName:s,scopeValue:r},queryParams:i,body:e})}async queryFeatureStates(e){return this.beginRequest({apiVersion:"4.1-preview.1",method:"POST",routeTemplate:"_apis/FeatureManagement/FeatureStatesQuery",body:e})}async queryFeatureStatesForDefaultScope(e,t){return this.beginRequest({apiVersion:"4.1-preview.1",method:"POST",routeTemplate:"_apis/FeatureManagement/FeatureStatesQuery/{userScope}",routeValues:{userScope:t},body:e})}async queryFeatureStatesForNamedScope(e,t,a,s){return this.beginRequest({apiVersion:"4.1-preview.1",method:"POST",routeTemplate:"_apis/FeatureManagement/FeatureStatesQuery/{userScope}/{scopeName}/{scopeValue}",routeValues:{userScope:t,scopeName:a,scopeValue:s},body:e})}}})}("RestClientFeatureManagement"),function(e){t.TfsFeatureService={};x.Services.add("ITfsFeatureService",{serviceFactory:class extends x.VssObservableService{getFeatureDefinitions(e,t,a,s){const r=this.pageContext.getService("ITfsPageService").getData(),o={};return r&&r.project&&(o.project=r.project.id),this.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-tfs-web.manage-features-data-provider",{targetContributionId:e,includeDevModeFeatures:t,featureScopes:o}).then(e=>{const t=e?Object.assign({},e):{features:[],devModeFeatures:[],managementScopes:{}};return a&&(t.features&&(t.features=t.features.filter(e=>e.tags&&e.tags.some(e=>a.indexOf(e)>=0))),t.devModeFeatures&&(t.devModeFeatures=t.devModeFeatures.filter(e=>e.tags&&e.tags.some(e=>a.indexOf(e)>=0)))),s&&(t.features&&(t.features=t.features.filter(e=>!e.tags||!e.tags.some(e=>s.indexOf(e)>=0))),t.devModeFeatures&&(t.devModeFeatures=t.devModeFeatures.filter(e=>!e.tags||!e.tags.some(e=>s.indexOf(e)>=0)))),t})}getFeatureStates(e,t,a,s){const r=this.pageContext.getService("IVssPageService").getData(),o={};if(r&&r.isHosted)for(const t of e){let e=t.serviceInstanceType;e&&t.serviceInstanceType!==r.serviceInstanceType||(e="");let a=o[e];a||(a=[],o[e]=a),a.push(t)}else o[""]=e;const n=[],i=t?"me":"host";for(const e in o){const t={featureIds:o[e].map(e=>e.id),featureStates:{},scopeValues:s},r=this.pageContext.getRestClient("IFeatureManagementRestClient",{serviceInstanceType:e});let u;u=a?r.queryFeatureStatesForNamedScope(t,i,a,s[a]):r.queryFeatureStatesForDefaultScope(t,i),n.push(new Promise((e,t)=>{u.then(t=>{const a={};if(t.featureStates)for(const e in t.featureStates)a[e]=t.featureStates[e];e(a)},t)}))}return n}setFeatureState(e,t,a,s,r,o,n){const i=this.pageContext.getRestClient("IFeatureManagementRestClient",{serviceInstanceType:e.serviceInstanceType}),u={featureId:e.id,scope:{settingScope:a,userScoped:t},state:r};return a?i.setFeatureStateForScope(u,e.id,t?"me":"host",a,s,o,n).then(e=>(this._notify(e,"featureStateUpdated"),e),t=>{throw this._notify({feature:e,error:t},"featureStateUpdateError"),t}):i.setFeatureState(u,e.id,t?"me":"host",o,n).then(e=>(this._notify(e,"featureStateUpdated"),e),t=>{throw this._notify({feature:e,error:t},"featureStateUpdateError"),t})}}})}()},["Resources","Components/FeaturePanel/FeaturePanel","Components/FeatureBanner/FeatureCallout","FeatureAdsService","FeaturePanel","FeaturePanelService","Components/FeatureBanner/FeatureBanner","Components/FeatureDialog/FeatureDialog","RestClient/FeatureManagement","TfsFeatureService"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-tfs-web.feature-management-content"}}));