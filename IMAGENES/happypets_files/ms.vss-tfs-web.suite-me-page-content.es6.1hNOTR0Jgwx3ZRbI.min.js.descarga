"use strict";define("TFS/Views/SuiteMePage",["require","exports","react","VSSUI/Pill","VSSUI/PillGroup","VSS/Platform/Layout","VSSUI/Link","VSS/Core/Util/String","VSS/Platform/Location","VSSUI/FocusZone","VSSUI/Image","VSSUI/TooltipEx","VSSUI/Util","VSS/Core/Observable","VSS/Platform/Context","VSSUI/Button","VSSUI/Card","VSSUI/FocusGroup","VSSUI/FocusWithin","VSSUI/TextFilterBarItem","VSSUI/Utilities/Filter","VSSUI/VssPersona","VSSUI/Utilities/ScreenSize","VSS/Features/PlatformUI/ContributedMenu","VSS/Features/PlatformUI/ContributedTab","VSSUI/Header","VSSUI/Observer","VSSUI/Page","VSSUI/Surface","VSSUI/Tabs"],function(e,t,r,s,o,a,n,c,i,l,u,m,d,p,h,P,g,v,S,f,j,C,w,b,x,I,V,E,N,y){var U,R;U=t.Resources={},t.Resources.SuiteMeGreeting="Welcome back, {0}",t.Resources.SuiteMeSecondaryGreeting="Plan, Code, Build, Test, repeat in that order (or in any order). Choose where to start.",t.Resources.MyAccounts="My organizations",t.Resources.Collections="Collections",t.Resources.RelatedPages="Related pages",t.Resources.WhatsNew="What's new",t.Resources.WhatsNewInDevOps="What's new in DevOps",t.Resources.ProjectDocumentation="Documentation",t.Resources.AccessLevels="Access levels",t.Resources.GetHelp="Get help",t.Resources.FilterProjects="Filter projects",t.Resources.FilterTextItemClearLabel="Clear the filter input",t.Resources.NoSearchResults="No match found.",t.Resources.ResetSearch="Reset filter",t.Resources.Projects="Projects",t.Resources.AdminSettings="Admin settings",t.Resources.OrgSettings="Organization settings",t.Resources.CreateProject="Create project",t.Resources.NewOrg="New organization",t.Resources.NewProject="New project",t.Resources.ZeroProjectsHeader="Create a project to get started",t.Resources.InstalledProductAriaLabel="Navigate to {0} for {1}",function(e){t.SuiteMePageViewAnnouncement={};const c="ms.vss-tfs-web.announcements";class i extends a.VssComponent{constructor(e,t){super(e,t),this.announcementClicked=(e=>{this.context.pageContext.getService("IVssTelemetryService").publishEvent(c,"AnnouncementClicked",{href:e})});const r=t.pageContext.getService("IVssContributionService").getData("ms.vss-tfs-web.announcements-data-provider"),s=r&&r.announcements?r.announcements[0]:void 0;this.state={announcement:s}}render(){const{announcement:e}=this.state;return e?r.createElement("div",{className:"global-announcement flex-column flex-grow fontSizeM "},r.createElement(n.Link,{href:e.href,className:"announcement-link",target:"_blank",onClick:t=>this.announcementClicked(e.href),rel:"noopener noreferrer"},r.createElement(o.PillGroup,null,r.createElement(s.Pill,{className:"header-label colored dark",excludeFocusZone:!0,excludeTabStop:!0,size:0},e.pillText||U.WhatsNew)),r.createElement("div",{className:"header body-m"},e.header),r.createElement("div",{className:"body-s"},e.message))):null}}t.SuiteMePageViewAnnouncement.GlobalAnnouncementComponent=i,i.componentType="globalAnnouncement",a.VssComponent.register(i.componentType,i)}(),function(e){R=t.SuiteMePageViewInstalledProducts={};t.SuiteMePageViewInstalledProducts.InstalledProductsComponent=class extends a.VssComponent{render(){return r.createElement(l.FocusZoneContext.Consumer,null,e=>r.createElement("div",{className:"flex-row installed-product flex-end"},this.getProductComponents(e)))}getProductComponents(e){const t=[];if(this.props.products&&this.props.products.length){let r=0;this.props.products.sort((e,t)=>e.order-t.order),this.props.products.forEach(s=>{r+=30,t.push(this.onRenderProduct(s,r,e))})}return t}onRenderProduct(e,t,s){const o=e&&e._links&&e._links.icon,a=o&&(0,i.getAssetLocation)(this.context.pageContext,o.href);let n=void 0;const l=e.featureProperties&&e.featureProperties.defaultRoute;if(l)try{n=(0,i.routeUrl)(this.context.pageContext,l,{project:this.props.projectName})}catch(e){}let p=r.createElement(r.Fragment,null,r.createElement("div",{className:"placeholder"}),r.createElement("div",{className:(0,d.css)("product-image-container","animation-delay-"+t)},r.createElement("div",{className:"flex-row link-icon"},r.createElement(u.Image,{alt:"",className:"product-image",src:a}))));return p=n?r.createElement("a",{className:"product",href:n,tabIndex:-1,"data-focuszone":s.focuszoneId,"aria-label":(0,c.format)(U.InstalledProductAriaLabel,e.name,this.props.projectName)},p):r.createElement("div",{className:"product"},p),r.createElement(m.Tooltip,{key:e.id},p)}}}(),function(e){t.SuiteMePageViewProjectsPivotService={};h.Services.add("IProjectsPivotViewSerivce",{serviceFactory:class extends h.VssService{getProjectsPivotView(){if(!this.view){const e=this.pageContext.getService("IVssHistoryService").getState(),t=this.pageContext.getService("IVssContributionService");let r,s;const o=new p.ObservableValue(void 0);let a=void 0;const n=!!e.product||!!e.acquisition,c=t.getData("ms.vss-tfs-web.collection-first-run-data-provider");if(c&&c.preCreatedProjectId)r=new p.ObservableArray,s=new p.ReadyableObservableArray,o.value=!1,a=c.preCreatedProjectId;else{const e=this.pageContext.getService("ITfsProjectService");r=e.getMruProjects(),s=e.getAllProjects(),r.length?o.value=!0:s.ready.value?o.value=s.value.length>0:s.ready.subscribe(()=>{o.value=this.view.allProjects.value.length>0})}this.view={mruProjects:r,allProjects:s,hasProjects:o,preCreatedProjectId:a,useSimpleProjectCreate:n,projectCreateUrlParameters:e}}return this.view}}})}(),function(e){t.SuiteMePageViewProjectsPivot={};h.Services.add("suite-home-projects-pivot-provider-service",{serviceFactory:class extends h.VssService{getTabs(e){const t=new j.Filter,o=new p.ObservableCollection;return this.pageContext.getService("IVssSecurityService").hasPermission("3E65F728-F8BC-4ecd-8764-7E378B19BFA7","NAMESPACE",4)&&o.push([{id:"create",className:"create-project-button",text:U.NewProject,iconProps:{iconName:"Add"},onActivate:()=>{document.body.dispatchEvent(new CustomEvent("suiteHomeCreateProject",{}))},isPrimary:!0}]),(0,b.addMenuItems)(this.pageContext,o,"ms.vss-tfs-web.suite-home-projects-pivot-commands"),[{id:"projects",name:U.Projects,order:0,routeId:"ms.vss-tfs-web.suite-me-page-route",commandBarItems:o,render:()=>r.createElement(s,{filter:t}),renderFilterBar:e=>e?r.createElement(f.InlineKeywordFilterBarItem,{filter:t,filterItemKey:"keyword",maxTextLength:50,placeholder:U.FilterProjects}):void 0}]}}});class s extends a.VssComponent{constructor(e,t){super(e,t),this._ttiMarked=!1,this._onCreateProjectClick=(()=>{this.setState({showCreateProjectView:!0})}),this._onFilterChanged=(e=>{const t=e.keyword;t&&this._performSearch(t.value)}),this._performSearch=(e=>{let t;if(e){const r=e.toLowerCase();t=this.state.allProjects.filter(e=>-1!==e.name.toLowerCase().indexOf(r)),this.setState({searchInProgress:!0,searchResults:t})}else this._onClear()}),this._onClear=(()=>{this.setState({searchInProgress:!1,searchResults:void 0}),this.props.filter.reset()}),this.onResize=(e=>{const t=this.getNumberOfCardsToDisplay(this.state.allMruProjects.length);if(this.state.mruProjects.length!==t){const e=this.state.allMruProjects.slice(0,t);this.setState({mruProjects:e})}}),this.onCancelCreateProject=(()=>{this.setState({showCreateProjectView:!1})});const r=t.pageContext.getService("IProjectsPivotViewSerivce").getProjectsPivotView();r.mruProjects.subscribe(()=>{this.setState({allMruProjects:r.mruProjects.value,mruProjects:r.mruProjects.value.slice(0,this.getNumberOfCardsToDisplay(r.mruProjects.value.length))})}),r.allProjects.subscribe(()=>{this.setState({allProjects:r.allProjects.value})}),this._initialUrlState=r.projectCreateUrlParameters;const o=this._initialUrlState[s.actionParameterKey]||this._initialUrlState[s.actionParameterKeyAlt],a=!!o&&((0,c.equals)(s.newProjectAction,o,!0)||(0,c.equals)("new",o,!0));this.state={searchInProgress:!1,allProjects:r.allProjects.value,mruProjects:r.mruProjects.value.slice(0,this.getNumberOfCardsToDisplay(r.mruProjects.value.length)),allMruProjects:r.mruProjects.value,searchResults:void 0,showCreateProjectView:a}}componentDidMount(){super.componentDidMount(),this.props.filter.subscribe(this._onFilterChanged),this.addEventListener(document.body,"suiteHomeCreateProject",this._onCreateProjectClick),this.addEventListener(window,"resize",this.onResize),this.state.mruProjects&&this.state.mruProjects.length&&this.ensureScenarioRecorded()}componentWillUnmount(){super.componentWillUnmount(),this.props.filter.unsubscribe(this._onFilterChanged)}render(){const{allProjects:e,mruProjects:t,searchInProgress:s,searchResults:n,showCreateProjectView:c}=this.state,i=[],u=this.state.allProjects.length>this.state.mruProjects.length;return t.forEach(e=>{i.push(r.createElement(o,{project:e,key:e.id}))}),r.createElement(r.Fragment,null,c&&r.createElement(a.WrappedComponent,{dependencies:["ms.vss-tfs-web.create-project-panel"],className:"page-content page-content-top",wrappedType:"createProjectPanel",showPanel:!0,invokingSource:this._initialUrlState.source||"SuiteMePage",processTemplate:this._initialUrlState.processTemplate,versionControlType:this._initialUrlState.versionControl,acquisitionId:this._initialUrlState.acquisitionId,defaultFeatureIds:this._initialUrlState.featureId?[this._initialUrlState.featureId]:void 0,projectVisibility:this._initialUrlState.projectVisibility,onPanelDismiss:this.onCancelCreateProject}),r.createElement("div",{className:"page-content flex-column flex-grow flex-noshrink"},r.createElement("div",{className:(0,a.css)("mru-projects",n&&"hidden")},r.createElement(w.ScreenSizeObserver,null,e=>r.createElement(l.FocusZone,{circularNavigation:!0,direction:1,focusGroupProps:{defaultElementId:t.length>0?t[0].id:void 0}},r.createElement("ul",{className:(0,a.css)("suite-project-list justify-start",e.screenSize>0?"flex-row":"flex-column")},i)))),!s||s&&n&&n.length?r.createElement(g.Card,{className:"no-padding",contentProps:{contentPadding:!1}},r.createElement(a.WrappedComponent,{dependencies:["ms.vss-tfs-web.suite-me-page-project-list-content"],wrappedType:"tfs-suite-project-list",projects:n||(u?e:[])})):r.createElement("div",{className:"flex-column flex-grow flex-center justify-center"},r.createElement("div",{className:"font-size-ll font-weight-semibold"},U.NoSearchResults),r.createElement(P.Button,{className:"reset-search",onClick:this._onClear},U.ResetSearch))))}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.ensureScenarioRecorded()}ensureScenarioRecorded(){if(!this._ttiMarked){this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive("tfs","WebPlatform.Collection.Home"),this._ttiMarked=!0}}getNumberOfCardsToDisplay(e){const t=window.innerWidth,r=t-108-64-260,s=t>1820?4:3;let o=Math.min(Math.max(2,e),s),a=r/o;for(;a<=300&&o>2;)a=r/--o;return t<600&&(o=3),o}}s.newProjectAction="newProject",s.actionParameterKey="_a",s.actionParameterKeyAlt="action";class o extends r.Component{constructor(){super(...arguments),this.onFocus=(()=>{this.focusGroupContext&&this.focusGroupContext.onFocus(this.props.project.id)})}render(){const{project:e}=this.props;return r.createElement(S.FocusWithin,{onFocus:this.onFocus},t=>r.createElement("li",{className:(0,a.css)("project-card flex-row flex-grow",t.hasFocus&&"focused"),onFocus:t.onFocus,onBlur:t.onBlur},r.createElement(g.Card,{className:"flex-grow no-padding",contentProps:{contentPadding:!1}},r.createElement(v.FocusGroupContext.Consumer,null,t=>(this.focusGroupContext=t,r.createElement(l.FocusZoneContext.Consumer,null,s=>r.createElement("a",{className:"project-link flex-column flex-grow","data-focuszone":s.focuszoneId,href:e.url,id:e.id,tabIndex:t.focusedElementId===e.id?0:-1},r.createElement("div",{className:"top-row flex-row flex-noshrink flex-grow"},r.createElement(C.VssPersona,{ariaLabel:null,className:"project-persona",identityDetailsProvider:{getDisplayName:()=>e.name,getIdentityImageUrl:()=>e.imageUrl},size:"large"}),r.createElement("div",{className:"flex-column project-details"},r.createElement("div",{className:"project-name font-size-l font-weight-semibold"},e.name),r.createElement("div",{className:"project-description"},e.description))))))),r.createElement("div",{className:"installed-products-row flex-row flex-grow flex-noshrink justify-end"},r.createElement(w.ScreenSizeConditional,{condition:e=>e>0},r.createElement(R.InstalledProductsComponent,{products:e.products,projectName:e.name}))))))}}}(),function(e){t.SuiteMePageViewSuiteMePageView={};a.Components.add("suiteMePageView",class extends a.VssComponent{constructor(e,t){let r,s;super(e,t),this.onSelectedTabChanged=(e=>{this.state.selectedTab.value=e});const o=t.pageContext.getService("IVssNavigationService").getCurrentRoute().routeValues,a=new p.ObservableValue(o.view||o.contributionId||"projects");"projects"===a.value&&(s=(r=t.pageContext.getService("IProjectsPivotViewSerivce").getProjectsPivotView()).hasProjects),this.state={hasProjects:s,hostName:t.pageContext.getService("IVssPageService").getData().hostName,projectsView:r,selectedTab:a,tabs:(0,x.getTabs)(t.pageContext,"ms.vss-tfs-web.suite-home-pivots",{defaultRouteId:"ms.vss-tfs-web.suite-me-page-ext-route",fpsRequired:!0,updateUrlOnPivotChange:!0})}}render(){const{hasProjects:e,hostName:t,projectsView:s,selectedTab:o,tabs:n}=this.state;return r.createElement("div",{className:"suite-me-page-view flex flex-grow flex-stretch v-scroll-auto absolute-fill"},r.createElement("div",{className:"suite-me-page-view-container flex flex-column flex-grow v-scroll-auto"},r.createElement(N.Surface,{background:1},r.createElement(E.Page,{className:"flex-grow custom-scrollbar scroll-auto-hide",selectedTabId:o,tabProviders:n},r.createElement(V.Observer,{hasProjects:e},e=>!1!==e.hasProjects?r.createElement(r.Fragment,null,r.createElement(I.Header,{title:t,titleSize:1,className:"hostname-header flex-noshrink"}),r.createElement(y.TabBar,{className:"suite-me-page-tabbar flex-wrap",onSelectedTabChanged:this.onSelectedTabChanged}),r.createElement(y.TabContent,null)):s?r.createElement("div",{className:"flex flex-grow justify-center"},r.createElement("img",{className:"inline-create-project-image",src:(0,i.getAssetLocation)(this.context.pageContext,"ms.vss-tfs-web/suite-me-page-content/images/zero-data-first-project.png"),alt:U.ZeroProjectsHeader}),r.createElement("div",{className:"flex-column inline-create-project-form"},r.createElement("div",{className:"inline-create-project-header title-l"},U.ZeroProjectsHeader),r.createElement(a.WrappedComponent,{dependencies:["ms.vss-tfs-web.create-project-panel"],wrappedType:"createProjectComponent",className:"flex-grow",invokingSource:s.projectCreateUrlParameters.source||"SuiteMePage",isLightWeightView:s.useSimpleProjectCreate,preCreatedProjectId:s.preCreatedProjectId,processTemplate:s.projectCreateUrlParameters.processTemplate,versionControlType:s.projectCreateUrlParameters.versionControl,acquisitionId:s.projectCreateUrlParameters.acquisitionId,product:s.projectCreateUrlParameters.product,defaultFeatureIds:s.projectCreateUrlParameters.featureId?[s.projectCreateUrlParameters.featureId]:void 0,projectVisibility:s.projectCreateUrlParameters.projectVisibility}))):r.createElement("div",null))))))}})}()},["Resources","SuiteMePageView/Announcement","SuiteMePageView/InstalledProducts","SuiteMePageView/ProjectsPivotService","SuiteMePageView/ProjectsPivot","SuiteMePageView/SuiteMePageView"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-tfs-web.suite-me-page-content"}}));