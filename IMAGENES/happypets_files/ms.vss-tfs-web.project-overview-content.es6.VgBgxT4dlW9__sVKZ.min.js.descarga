"use strict";define("TFS/Views/ProjectOverviewPage",["require","exports","VSS/Reflux/Action","VSS/Reflux/Store","react","VSS/Features/PlatformUI/FPSLink","VSS/Platform/Layout","VSSUI/Card","VSSUI/Image","VSSUI/Util","VSS/Platform/FPS","VSS/Platform/Location","VSSUI/Button","VSS/Core/Util/Object","VSSUI/Dropdown","VSSUI/Utilities/DropdownSelection","OfficeFabric/FocusZone","VSS/Core/Util/String","VSSUI/MessageBar","VSSUI/Spinner","VSS/Legacy/Legacy","VSS/Platform/Context","VSS/Platform/RestClientBase","VSS/Core/Util/Promise","VSSUI/RadioButton","VSS/Core/Util/Accessibility","VSSUI/Page","VSSUI/Surface","OfficeFabric/Styling","VSSUI/VssPersona","VSS/Features/PlatformUI/ContributedMenu","VSSUI/HeaderCommandBar","VSSUI/Observer","VSSUI/Utilities/ScreenSize","OfficeFabric/Fabric","OfficeFabric/Overlay","VSS/Features/Frame/ContributedPivotBarItemProvider","VSSUI/Hub","VSSUI/HubHeader","VSSUI/Navigation/VssHubViewState"],function(e,t,o,r,s,i,a,n,c,d,p,l,u,g,h,v,S,m,P,j,b,C,_,I,f,T,w,U,A,y,L,D,O,E,x,M,R,N,F,k){var B,H,V,W,Z,G,z,q,Y,J,K,$,Q,X,ee,te,oe,re,se,ie,ae,ne,ce,de,pe,le,ue,ge,he,ve,Se,me,Pe,je,be,Ce,_e,Ie,fe,Te;B=t.Resources={},t.Resources.ProjectInformationRegion_Label="Project Information",t.Resources.VisibilityTag_VisibilityValueInvalid="{0} is not a valid visibility value.",t.Resources.VisibilityTag_PrivateProject_Tooltip_Text="Shared with members of the project",t.Resources.VisibilityTag_OrgVisibleProject_Tooltip_Text="Shared with people in your enterprise",t.Resources.VisibilityTag_PublicProject_Tooltip_Text="Anyone on the internet can view",t.Resources.InviteButtonText="Invite",t.Resources.Loading_Label="Loading...",t.Resources.ZeroDayCardAriaLabel="Get Started",t.Resources.ProjectNameEditButtonAriaLabel="Edit project name",t.Resources.FavoritesButton_UnFavorited="Favorite",t.Resources.FavoritesButton_Favorited="Favorited",t.Resources.LikeButton_Unliked="Like",t.Resources.LikeButton_Liked="Liked",t.Resources.Link="Link",t.Resources.ProjectOverviewContentAriaLabel="Project overview content",t.Resources.AboutProjectTitle="About this project",t.Resources.AboutProjectCardReadMoreLinkText="Read more",t.Resources.AboutProjectDescriptionLengthExceededMessage="The length of the description should be less than {0}, actual is {1}.",t.Resources.AboutProjectPanelTagsHeading="Tags",t.Resources.AboutProjectPanelAboutSectionHeading="About",t.Resources.AboutProjectUpsellHeading="Help others to get on board!",t.Resources.AboutProjectUpsellMessage="Describe your project and make it easier for other people to understand it.",t.Resources.AboutProjectUpsellHeading_NoPermission="This project has no description yet",t.Resources.AboutProjectUpsellMessage_NoPermission="Describing the project makes it easier for other people to understand it.",t.Resources.AboutProjectUpsellButtonText="Add Project Description",t.Resources.ProjectMembers_ErrorLoadingMembers="Failed to load project members. Refresh to try again.",t.Resources.ProjectMembers_Title="Members",t.Resources.ProjectMembers_ImageOf="Image of {0}",t.Resources.ProjectStats="Project stats",t.Resources.AboutProjectChangesSavedMessage="Changes have been saved successfully.",t.Resources.Tag_ItemNameAriaLabel="{0} Tag",t.Resources.Tag_DeleteButtonAriaLabel="Delete {0} Tag",t.Resources.ProjectTags_AriaLabel="Project Tags",t.Resources.ProjectTags_MaxCountExceeded="Tags count exceeded allowed limit, only {0} tags are allowed.",t.Resources.ProjectTags_MaxCountReached="Tags count reached allowed limit, only {0} tags are allowed.",t.Resources.ProjectTags_TagCharacterLimitExceeded="Tag cannot be greater than {0} characters long.",t.Resources.LastOneDay="Last 1 day",t.Resources.LastSevenDays="Last 7 days",t.Resources.LastThirtyDays="Last 30 days",t.Resources.StatsDropdownAriaLabel="Day range picker",t.Resources.StatsUpsellMessage="No stats are available at this moment",t.Resources.StatsUpsellHelpText="Setup a service to see project activity.",t.Resources.ProjectOverviewDayZero_Title="Welcome to the project!",t.Resources.ProjectOverviewDayZero_SubTitle_TwoOrMoreServices="What service would you like to start with?",t.Resources.ProjectOverviewDayZero_SubTitle_OneService="Get started with your service",t.Resources.ProjectOverviewDayZero_OrManageYourServiceText="or manage your services",t.Resources.ProjectOverviewDayZero_ManageYourServiceText="Manage your services",t.Resources.AboutProjectEditButtonAriaLabel="Edit project information",H=t.ProjectOverviewTabModels={},(Ce=t.ProjectOverviewTabModels.SourceRepositoryTypes||(t.ProjectOverviewTabModels.SourceRepositoryTypes={}))[Ce.Git=0]="Git",Ce[Ce.Tfvc=1]="Tfvc",Ce[Ce.Wiki=2]="Wiki",function(e){V=t.ProjectOverviewTabActionsActionsHub={};t.ProjectOverviewTabActionsActionsHub.ActionsHub=class{constructor(){this.aboutProjectDataLoaded=new o.Action,this.aboutProjectDataLoadFailed=new o.Action,this.allProjectTagsInCollectionLoaded=new o.Action,this.projectTagsUpdated=new o.Action,this.projectTagsUpdateFailed=new o.Action,this.projectTagsUpdateStarted=new o.Action,this.projectTagsNotUpdating=new o.Action,this.projectDescriptionUpdated=new o.Action,this.projectDescriptionUpdateFailed=new o.Action,this.projectDescriptionUpdateStarted=new o.Action,this.projectDescriptionNotUpdating=new o.Action,this.readmeSettingUpdated=new o.Action,this.readmeSettingUpdateFailed=new o.Action,this.readmeSettingUpdateStarted=new o.Action,this.readmeSettingNotUpdating=new o.Action,this.permissionsLoaded=new o.Action}}}(),t.Constants={},W=t[Ie="ProjectOverviewTabConstants"]={},t[Ie].MaxDescriptionLength=15999,t[Ie].TfvcPrefix="$/",t[Ie].WikiHomePage="WikiHomePage",t[Ie].ProjectScopeName="project",(_e=t[Ie].ProjectTagsConstants||(t[Ie].ProjectTagsConstants={})).CharacterLimit=40,_e.MaxCount=15,_e.Separators=[",",";"],_e.PropertyPrefix="Microsoft.TeamFoundation.Project.Tag.",function(e){Z=t.ProjectOverviewTabSourcesPermissionsSource={};t.ProjectOverviewTabSourcesPermissionsSource.PermissionsSource=class{constructor(e){this._pageContext=e}getViewActivityPanePermission(){return this._pageContext.getService("IVssSecurityService").hasPermission("dc02bf3d-cd48-46c3-8a41-345094ecc94b","/UserIsValid",1)}}}(),function(e){G=t[e]={};t[e].ProjectOverviewTabActionCreator=class{constructor(e,t,o){this._pageContext=e,this._actionsHub=t,this._permissionsSource=o,this.loadPermissions=(()=>{const e=this.permissionsSource.getViewActivityPanePermission();this._actionsHub.permissionsLoaded.invoke({hasViewActivityPanePermission:e})})}get permissionsSource(){return this._permissionsSource||(this._permissionsSource=new Z.PermissionsSource(this._pageContext)),this._permissionsSource}}}("ProjectOverviewTabActionsProjectOverviewTabActionCreator"),function(e){z=t.ProjectOverviewTabUtils={},t.ProjectOverviewTabUtils.getImageLocation=function(e,t){return e.getService("IVssLocationService").getAssetLocation(t)},t.ProjectOverviewTabUtils.getFeatureFlagState=function(e,t){const o=e.getService("IVssFeatureService");try{return o.isFeatureFlagEnabled(t)}catch(e){return!1}}}(),q=t.SharedContracts={},(Te=t.SharedContracts.StoreLoadingState||(t.SharedContracts.StoreLoadingState={}))[Te.Loading=0]="Loading",Te[Te.Loaded=1]="Loaded",Te[Te.LoadFailed=2]="LoadFailed",(fe=t.SharedContracts.UpdatingState||(t.SharedContracts.UpdatingState={}))[fe.InProgress=0]="InProgress",fe[fe.Succeeded=1]="Succeeded",fe[fe.Failed=2]="Failed",fe[fe.NotUpdating=3]="NotUpdating",t.SharedModels={},function(e){Y=t.SharedCurrentUserInfoStore={};t.SharedCurrentUserInfoStore.CurrentUserInfoStore=class extends r.Store{constructor(){super(...arguments),this._state={loadingState:q.StoreLoadingState.Loading,currentUserPermission:{isStakeHolder:!1,hasManageProjectPropertiesPermission:!1,hasProjectLevelEditPermission:!1,isAdmin:!1,isLoggedIn:!1}},this.loadCurrentUserInfo=(e=>{this._state.loadingState=q.StoreLoadingState.Loaded,this._state.currentUserPermission=e,this.emitChanged()}),this.loadCurrentUserInfoFailed=(()=>{this._state.loadingState=q.StoreLoadingState.LoadFailed,this.emitChanged()})}getState(){return this._state}}}(),function(e){J=t[e]={};t[e].ProjectOverviewDayZeroComponent=class extends a.VssComponent{constructor(e,t){super(e,t),this._onCurrentUserInfoStoreChange=(()=>{const{currentUserPermission:e,loadingState:t}=this.props.currentUserInfoStore.getState();this.setState({manageServiceLink:this._getManageServiceLink(e)})}),this._markTimeToInteractiveIfNeeded=(()=>{this._ttiMarked||this.props.currentUserInfoStore.getState().loadingState===q.StoreLoadingState.Loading||(this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive("ProjectOverviewPage","ProjectOverviewPage.Loaded",void 0,{source:"day-zero-component"}),this._ttiMarked=!0)});const o=this.context.pageContext.getService("IVssLayoutManager").getComponentsForRegion("projectOverviewDayZeroNavRegion").length,r=t.pageContext.getService("ITfsPageService").getData();r&&r.project&&(this._projectName=r.project.name);const s=this.props.currentUserInfoStore.getState(),i=this._getManageServiceLink(s.currentUserPermission);this.state={servicesCount:o,manageServiceLink:i}}componentDidMount(){super.componentDidMount(),this.props.currentUserInfoStore.addChangedListener(this._onCurrentUserInfoStoreChange),this._markTimeToInteractiveIfNeeded()}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this._markTimeToInteractiveIfNeeded()}componentWillUnmount(){this.props.currentUserInfoStore.removeChangedListener(this._onCurrentUserInfoStoreChange),super.componentWillUnmount()}render(){const{servicesCount:e,manageServiceLink:t}=this.state;return s.createElement(n.Card,{className:(0,d.css)("project-overview-day-zero flex-center",this.props.className),"aria-label":B.ZeroDayCardAriaLabel},s.createElement("div",{className:"flex-column"},s.createElement(c.Image,{containImage:!0,className:"po-day-zero-image",src:(0,z.getImageLocation)(this.context.pageContext,"ms.vss-tfs-web/project-overview-content/ProjectOverviewTab/Images/project_overview_day_zero.png"),alt:""}),s.createElement("div",{className:"po-day-zero-text-container flex-column flex-center justify-center"},s.createElement("h1",{className:"title-l po-day-zero-title"},B.ProjectOverviewDayZero_Title),e>0&&s.createElement(s.Fragment,null,s.createElement("div",{className:"sub-title font-size-m"},1===e?B.ProjectOverviewDayZero_SubTitle_OneService:B.ProjectOverviewDayZero_SubTitle_TwoOrMoreServices),s.createElement(a.RegionComponent,{className:"navigation-container flex-row justify-center",componentRegion:"projectOverviewDayZeroNavRegion",childComponentProperties:{className:"service-link-container font-size-m font-weight-semibold"}})),t&&s.createElement(i.FPSLink,{className:"manage-services-link link-text font-size-m",href:t,telemetrySource:"ProejctOverview_DayZero_ManageServiceLink"},e>0?B.ProjectOverviewDayZero_OrManageYourServiceText:B.ProjectOverviewDayZero_ManageYourServiceText))))}_getManageServiceLink(e){if(e&&e.isAdmin&&this._projectName)return this.context.pageContext.getService("IVssLocationService").routeUrl("ms.vss-admin-web.project-admin-hub-route",{project:this._projectName})}}}("ProjectOverviewTabComponentsProjectOverviewDayZeroComponent"),function(e){t.ProjectOverviewTabComponentsServiceLink={};a.VssComponent.register("TFS.ServiceNavigationLink",class extends a.VssComponent{constructor(e,t){super(e,t),this._onClick=(e=>{this.state.url&&(0,p.onClickFPS)(this.context.pageContext,this.state.url,!0,e,{telemetrySource:"ProjectOverview_DayZero_ServiceNavigationLink"})});const o=t.pageContext.getService("IVssContributionService").getContribution(e.serviceNavigationInfoId);let r=void 0,s=void 0;if(o){const e=o.defaultRoute,i=t.pageContext.getService("ITfsPageService").getData();let a=void 0;i&&i.project&&(a=i.project.name),r=a&&e?(0,l.routeUrl)(t.pageContext,e,{project:a||""}):void 0,s=o.name}this.state={url:r,name:s}}render(){const{name:e,url:t}=this.state;return t&&e?s.createElement(u.Button,{className:(0,d.css)("service-link",this.props.className),href:t,onClick:this._onClick,ariaRoleDescription:B.Link},e):null}})}(),function(e){K=t.ProjectOverviewTabComponentsStatsSection={};const o=7;t.ProjectOverviewTabComponentsStatsSection.StatsSection=class extends a.VssComponent{constructor(e,t){super(e,t),this.dropdownOptions=[{id:"1",text:B.LastOneDay},{id:"7",text:B.LastSevenDays},{id:"30",text:B.LastThirtyDays}],this.numberOfDaysSelection=new v.DropdownSelection,this._numberOfDaysChanged=((e,t)=>{this.context.pageContext.getService("IVssTelemetryService").publishEvent("ProjectOverviewPage_OverviewTab","ProjectStats_NumberOfDaysDropDown",{NumberOfDaysSelected:t.id}),this.setState({numberOfDaysSelected:Number(t.id)})}),this._getDayZeroComponent=(()=>s.createElement("div",{className:"stats-upsell flex-column flex-center"},s.createElement(c.Image,{containImage:!0,className:"image",src:(0,z.getImageLocation)(this.context.pageContext,"ms.vss-tfs-web/project-overview-content/ProjectOverviewTab/Images/project_stats_upsell.png"),alt:""}),s.createElement("div",{className:"message title-xs"},B.StatsUpsellMessage),s.createElement("div",{className:"help-text font-size-m"},B.StatsUpsellHelpText))),this._statsTitleId=(0,g.getId)("statsTitleId"),this.numberOfDaysSelection.select(1),this.state={numberOfDaysSelected:o}}render(){const e=this.context.pageContext.getService("IVssLayoutManager").getComponentsForRegion("statsSection");return s.createElement(n.Card,{className:"project-overview-card"},s.createElement("div",{className:"stats-container-card project-overview-card-container",role:"region","aria-labelledby":this._statsTitleId},s.createElement("div",{className:"title-and-dropdown flex"},s.createElement("div",{className:"title-m",role:"heading","aria-level":3,id:this._statsTitleId},B.ProjectStats),e.length>0&&s.createElement("div",{className:"days-dropdown"},s.createElement(h.Dropdown,{items:this.dropdownOptions,ariaLabel:B.StatsDropdownAriaLabel,onSelect:this._numberOfDaysChanged,selection:this.numberOfDaysSelection}))),s.createElement(a.RegionComponent,{componentRegion:"statsSection",childComponentProperties:{numOfDays:this.state.numberOfDaysSelected,className:"metric-tile"},fallbackComponent:this._getDayZeroComponent})))}}}(),function(e){$=t.ActionsActionsHub={};t.ActionsActionsHub.ActionsHub=class{constructor(){this.projectOverviewPageLoaded=new o.Action,this.projectOverviewPageLoadFailed=new o.Action,this.projectMembersFetched=new o.Action,this.projectMembersFetchFailed=new o.Action}}}(),function(e){Q=t.SharedProjectMembersSource={};class o{constructor(e){this._pageContext=e}getProjectMembers(e){const t=this._pageContext.getService("IVssPerformanceService");return t.startScenario("ProjectMembersSource.GetProjectMembers",!1),this._pageContext.getService("IVssContributionService").getDataAsync(o.PROVIDER_ID,e?{forceRefresh:!0}:void 0,e).then(e=>(t.endScenario("ProjectOverviewPage","ProjectMembersSource.GetProjectMembers",!1),e),e=>{throw t.endScenario("ProjectOverviewPage","ProjectMembersSource.GetProjectMembers",!1,void 0,{status:"failed"}),e})}}t.SharedProjectMembersSource.ProjectMembersSource=o,o.PROVIDER_ID="ms.vss-tfs-web.project-members-data-provider-verticals"}(),function(e){X=t.SharedProjectMembersActionCreator={};t.SharedProjectMembersActionCreator.ProjectMembersActionCreator=class{constructor(e,t,o){this._pageContext=e,this._actions=t,this._projectMembersSource=o}fetchProjectMembers(e){this.projectMembersSource.getProjectMembers(e).then(e=>{e?this._actions.projectMembersFetched.invoke(e):this._invokeProjectMembersFetchFailed()},e=>{this._invokeProjectMembersFetchFailed(e)})}_invokeProjectMembersFetchFailed(e){const t=e?e.toString():B.ProjectMembers_ErrorLoadingMembers;this._actions.projectMembersFetchFailed.invoke(t)}get projectMembersSource(){return this._projectMembersSource||(this._projectMembersSource=new Q.ProjectMembersSource(this._pageContext)),this._projectMembersSource}}}(),function(e){ee=t.SharedProjectMembersStore={};t.SharedProjectMembersStore.ProjectMembersStore=class extends r.Store{constructor(){super(...arguments),this._state={loadingState:q.StoreLoadingState.Loading,membersToDisplay:[],errorMessage:"",membersCount:0,hasMore:!1},this.getState=(()=>this._state),this.loadMembersInfo=(e=>{this._state.membersToDisplay=e.members,this._state.membersCount=e.count,this._state.hasMore=e.hasMore,this._state.loadingState=q.StoreLoadingState.Loaded,this.emitChanged()}),this.loadMembersInfoFailed=(e=>{this._state.errorMessage=e,this._state.loadingState=q.StoreLoadingState.LoadFailed,this.emitChanged()})}}}(),function(e){te=t.ProjectOverviewTabMembersRegionProjectMembers={};t.ProjectOverviewTabMembersRegionProjectMembers.ProjectMembers=class extends a.VssComponent{constructor(e,t){super(e,t),this._onStoreChange=(()=>{this.setState({projectMembers:this.props.store.getState()})}),this._membersSectionTitleId=(0,g.getId)("membersSectionTitleId"),this.state={projectMembers:this.props.store.getState()}}render(){const{hasMore:e,membersCount:t}=this.state.projectMembers,{headingLevel:r,className:i}=this.props;let a="";return t>0&&(a=(0,m.format)("{0}{1}",t,e?"+":"")),s.createElement(n.Card,{className:"project-overview-card"},s.createElement("div",{className:(0,d.css)("project-members",i),role:"region","aria-labelledby":this._membersSectionTitleId},s.createElement(o,{title:B.ProjectMembers_Title,subTitle:a,headingLevel:r,id:this._membersSectionTitleId}),this._getProjectMembersContent()))}componentDidMount(){super.componentDidMount(),this.props.store.addChangedListener(this._onStoreChange),this.props.actionCreator.fetchProjectMembers(!0)}componentWillUnmount(){this.props.store.removeChangedListener(this._onStoreChange),super.componentWillUnmount()}_getProjectMembersContent(){const{errorMessage:e,membersToDisplay:t,loadingState:o}=this.state.projectMembers;switch(o){case q.StoreLoadingState.Loading:return s.createElement(j.Spinner,null);case q.StoreLoadingState.LoadFailed:return s.createElement(P.MessageBar,{severity:"Error"},e);case q.StoreLoadingState.Loaded:return s.createElement("div",{className:"project-members-list-container"},s.createElement(r,{pageContext:this.context.pageContext,membersToDisplay:t}));default:return null}}};const o=e=>{const{headingLevel:t,title:o,subTitle:r,id:i}=e;return s.createElement("div",{className:"project-members-title"},s.createElement("div",{className:"title title-m",role:"heading","aria-level":t,id:i},o),s.createElement("div",{className:"sub-title font-size-ms"},r))},r=e=>s.createElement(S.FocusZone,{className:"project-members-list"},e.membersToDisplay.map(e=>s.createElement(b.LegacyComponent,{wrappedType:"TFS.ProjectOverview.ProjectMember",modules:["ProjectOverview/Scripts/Components/ProjectMember"],key:e.id,member:e})))}(),function(e){oe=t.ProjectOverviewTabStoresPermissionsStore={};t.ProjectOverviewTabStoresPermissionsStore.PermissionsStore=class extends r.Store{constructor(){super(...arguments),this._state={loadingState:q.StoreLoadingState.Loading,permissions:{hasViewActivityPanePermission:!1}},this.loadPermissions=(e=>{this._state.permissions=e,this._state.loadingState=q.StoreLoadingState.Loaded,this.emitChanged()})}getState(){return this._state}}}(),function(e){re=t.SharedProjectOverviewPageDataProviderSource={};class o{constructor(e){this._pageContext=e}getProjectOverviewPageData(){const e=this._pageContext.getService("IVssPerformanceService");return e.startScenario("ProjectOverviewPageDataProviderSource.GetProjectOverviewPageData",!1),this._pageContext.getService("IVssContributionService").getDataAsync(o.PROVIDER_ID).then(t=>(e.endScenario("ProjectOverviewPage","ProjectOverviewPageDataProviderSource.GetProjectOverviewPageData",!1),t?t.projectOverviewPageData:void 0),t=>{throw e.endScenario("ProjectOverviewPage","ProjectOverviewPageDataProviderSource.GetProjectOverviewPageData",!1,void 0,{status:"failed"}),t})}}t.SharedProjectOverviewPageDataProviderSource.ProjectOverviewPageDataProviderSource=o,o.PROVIDER_ID="ms.vss-tfs-web.project-overview-page-data-provider-verticals"}(),function(e){se=t.ActionsProjectOverviewPageActionCreator={};t.ActionsProjectOverviewPageActionCreator.ProjectOverviewPageActionCreator=class{constructor(e,t,o){this._pageContext=e,this._actionsHub=t,this._projectOverviewPageSource=o,this.loadProjectOverviewData=(()=>{this.projectOverviewPageSource.getProjectOverviewPageData().then(e=>{e?this._actionsHub.projectOverviewPageLoaded.invoke(e):this._invokeProjectOverviewPageLoadFailed()},e=>{this._invokeProjectOverviewPageLoadFailed()})})}get projectOverviewPageSource(){return this._projectOverviewPageSource||(this._projectOverviewPageSource=new re.ProjectOverviewPageDataProviderSource(this._pageContext)),this._projectOverviewPageSource}_invokeProjectOverviewPageLoadFailed(){this._actionsHub.projectOverviewPageLoadFailed.invoke(void 0)}}}(),function(e){t[e]={};t[e].OperationsClientName="OperationsForProjectOverview.IOperationsRestClient",t[e].getOperationsClient=function(o,r){return o.getRestClient(t[e].OperationsClientName,r)},C.RestClients.add(t[e].OperationsClientName,{factory:class extends _.RestClientBase{constructor(e){super(e)}async getOperation(e,t){const o={pluginId:t};return this.beginRequest({apiVersion:"4.1-preview.1",routeTemplate:"_apis/operations/{operationId}",routeValues:{operationId:e},queryParams:o})}}})}("RestClientOperations"),function(e){ie=t.ProjectOverviewTabSourcesAboutProjectSource={};class o{constructor(e){this._pageContext=e,this._pollOperationResult=(async e=>{if(e){let t=!1;try{const o=await this._pageContext.getRestClient("OperationsForProjectOverview.IOperationsRestClient").getOperation(e);switch(o.status){case 4:return t=!0,Promise.resolve();case 3:case 5:return t=!0,Promise.reject(o.resultMessage)}}catch(e){return Promise.reject("operation failed")}if(!t)return(0,I.wait)(200).then(()=>this._pollOperationResult(e))}}),this._performanceService=this._pageContext.getService("IVssPerformanceService")}getAboutProjectDataAsync(){return this._performanceService.startScenario("AboutProjectSource.GetAboutProjectData",!1),this._pageContext.getService("IVssContributionService").getDataAsync(o.PROVIDER_ID).then(e=>(this._performanceService.endScenario("ProjectOverviewPage","AboutProjectSource.GetAboutProjectData",!1),e&&e.aboutProjectData?e.aboutProjectData:void 0),e=>{throw this._performanceService.endScenario("ProjectOverviewPage","AboutProjectSource.GetAboutProjectData",!1,void 0,{status:"failed"}),e})}getAllProjectTagsInCollectionDataAsync(){return this._performanceService.startScenario("AboutProjectSource.GetAllProjectTagsInCollection",!1),this._pageContext.getService("IVssContributionService").getDataAsync(o.ALL_PROJECT_TAGS_IN_COLLECTION_PROVIDER_ID).then(e=>(this._performanceService.endScenario("ProjectOverviewPage","AboutProjectSource.GetAllProjectTagsInCollection",!1),e&&e.allProjectTagsInCollection?e.allProjectTagsInCollection:[]),e=>{throw this._performanceService.endScenario("ProjectOverviewPage","AboutProjectSource.GetAllProjectTagsInCollection",!1,void 0,{status:"failed"}),e})}saveProjectDescription(e,t){return this._performanceService.startScenario("AboutProjectSource.SaveDescription",!1),this._pageContext.getRestClient("ICoreRestClient").updateProject({description:e},t).then(e=>this._pollOperationResult(e.id),e=>{throw this._performanceService.endScenario("ProjectOverviewPage","AboutProjectSource.SaveDescription",!1,void 0,{status:"failed"}),e}).then(()=>{this._performanceService.endScenario("ProjectOverviewPage","AboutProjectSource.SaveDescription",!1)},e=>{throw this._performanceService.endScenario("ProjectOverviewPage","AboutProjectSource.SaveDescription",!1,void 0,{status:"failed"}),e})}saveReadmeSetting(e,t){return this._performanceService.startScenario("AboutProjectSource.SaveReadMeSettings",!1),this._pageContext.getService("ISettingsService").setEntries({"VersionControl/ProjectOverview/DefaultRepository":e},1,W.ProjectScopeName,t).then(()=>{this._performanceService.endScenario("ProjectOverviewPage","AboutProjectSource.SaveReadMeSettings",!1)},e=>{throw this._performanceService.endScenario("ProjectOverviewPage","AboutProjectSource.SaveReadMeSettings",!1,void 0,{status:"failed"}),e})}saveProjectTag(e,t,o){return this._performanceService.startScenario("AboutProjectSource.SaveProjectTags",!1),this._pageContext.getRestClient("ICoreRestClient").setProjectProperties(o,(()=>{const o=[];return e.forEach(function(e){o.push({from:"",op:0,path:"/"+W.ProjectTagsConstants.PropertyPrefix+e,value:"true"})}),t.forEach(function(e){o.push({from:"",op:1,path:"/"+W.ProjectTagsConstants.PropertyPrefix+e,value:null})}),o})()).then(()=>{this._performanceService.endScenario("ProjectOverviewPage","AboutProjectSource.SaveProjectTags",!1)},e=>{throw this._performanceService.endScenario("ProjectOverviewPage","AboutProjectSource.SaveProjectTags",!1,void 0,{status:"failed"}),e})}}t.ProjectOverviewTabSourcesAboutProjectSource.AboutProjectSource=o,o.PROVIDER_ID="ms.vss-tfs-web.about-project-data-provider-verticals",o.ALL_PROJECT_TAGS_IN_COLLECTION_PROVIDER_ID="ms.vss-tfs-web.collection-all-project-tags-data-provider-verticals"}(),function(e){var o;ae=t[e]={},function(e){e.UpdateEvent="UpdateEvent"}(o=t[e].AboutProjectStoreEvents||(t[e].AboutProjectStoreEvents={}));t[e].AboutProjectStore=class extends r.Store{constructor(){super(...arguments),this._state={loadingState:q.StoreLoadingState.Loading,aboutProjectData:void 0,readmeSettingUpdateState:q.UpdatingState.NotUpdating,projectTagsUpdateState:q.UpdatingState.NotUpdating,allProjectTagsInCollectionData:{tags:[],tagsFetched:!1}},this.loadAboutProject=(e=>{this._state.loadingState=q.StoreLoadingState.Loaded,this._state.aboutProjectData=e,this.emitChanged()}),this.loadAboutProjectFailed=(()=>{this._state.loadingState=q.StoreLoadingState.LoadFailed,this.emitChanged()}),this.readmeSettingUpdated=(e=>{const t=this._state.aboutProjectData;!t||t.repositoryId===e.repositoryId&&t.sourceRepositoryType===e.repositoryType||(this._state.aboutProjectData=Object.assign(Object.assign({},t),{repositoryId:e.repositoryId,sourceRepositoryType:e.repositoryType}),this._updateReadmeSettingState(q.UpdatingState.Succeeded))}),this.readmeSettingUpdateFailed=(()=>{this._updateReadmeSettingState(q.UpdatingState.Failed)}),this.readmeSettingUpdateStarted=(()=>{this._updateReadmeSettingState(q.UpdatingState.InProgress)}),this.readmeSettingNotUpdating=(()=>{this._updateReadmeSettingState(q.UpdatingState.NotUpdating)}),this.projectTagsUpdated=(e=>{const t=this._state.aboutProjectData;t&&(this._state.aboutProjectData=Object.assign(Object.assign({},t),{tagsData:{tags:e}}),this._updateProjectTagsState(q.UpdatingState.Succeeded))}),this.projectTagsUpdateFailed=(()=>{this._updateProjectTagsState(q.UpdatingState.Failed)}),this.projectTagsUpdateStarted=(()=>{this._updateProjectTagsState(q.UpdatingState.InProgress)}),this.projectTagsNotUpdating=(()=>{this._updateProjectTagsState(q.UpdatingState.NotUpdating)}),this.loadAllProjectTagsInCollection=(e=>{this._state.allProjectTagsInCollectionData={tagsFetched:!0,tags:e},this.emitChanged()})}getState(){return this._state}_updateReadmeSettingState(e){this._state.readmeSettingUpdateState=e,this.emit(o.UpdateEvent,this)}_updateProjectTagsState(e){this._state.projectTagsUpdateState=e,this.emit(o.UpdateEvent,this)}}}("ProjectOverviewTabStoresAboutProjectStore"),function(e){var o;ne=t.SharedProjectBasicInfoStore={},function(e){e.DescriptionUpdateEvent="DescriptionUpdateEvent"}(o=t.SharedProjectBasicInfoStore.ProjectBasicInfoStoreEvents||(t.SharedProjectBasicInfoStore.ProjectBasicInfoStoreEvents={}));t.SharedProjectBasicInfoStore.ProjectBasicInfoStore=class extends r.Store{constructor(){super(...arguments),this._state={loadingState:q.StoreLoadingState.Loading,projectBasicInfo:void 0,descriptionUpdateState:q.UpdatingState.NotUpdating,descriptionError:void 0},this.loadProjectInfo=(e=>{this._state.projectBasicInfo=e,this._state.loadingState=q.StoreLoadingState.Loaded,this.emitChanged()}),this.loadProjectInfoFailed=(()=>{this._state.loadingState=q.StoreLoadingState.LoadFailed,this.emitChanged()}),this.projectDescriptionUpdated=(e=>{this._state.projectBasicInfo&&this._state.projectBasicInfo.description!=e&&(this._state.projectBasicInfo.description=e,this._state.descriptionUpdateState=q.UpdatingState.Succeeded,this.emit(o.DescriptionUpdateEvent,this))}),this.projectDescriptionUpdateFailed=(e=>{this._state.descriptionUpdateState=q.UpdatingState.Failed,this._state.descriptionError=e,this.emit(o.DescriptionUpdateEvent,this)}),this.projectDescriptionUpdateStarted=(()=>{this._state.descriptionUpdateState=q.UpdatingState.InProgress,this.emit(o.DescriptionUpdateEvent,this)}),this.projectDescriptionNotUpdating=(()=>{this._state.descriptionError=void 0,this._state.descriptionUpdateState=q.UpdatingState.NotUpdating,this.emit(o.DescriptionUpdateEvent,this)})}getState(){return this._state}}}(),function(e){ce=t.ProjectOverviewTabStoresStoresHub={};t.ProjectOverviewTabStoresStoresHub.StoresHub=class{constructor(e,t,o){this.projectBasicInfoStore=t,this.currentUserInfoStore=o,this.aboutProjectStore=new ae.AboutProjectStore("aboutProjectStoreChangedEvent"),e.aboutProjectDataLoaded.addListener(this.aboutProjectStore.loadAboutProject),e.aboutProjectDataLoadFailed.addListener(this.aboutProjectStore.loadAboutProjectFailed),e.projectTagsUpdated.addListener(this.aboutProjectStore.projectTagsUpdated),e.projectTagsUpdateStarted.addListener(this.aboutProjectStore.projectTagsUpdateStarted),e.projectTagsUpdateFailed.addListener(this.aboutProjectStore.projectTagsUpdateFailed),e.projectTagsNotUpdating.addListener(this.aboutProjectStore.projectTagsNotUpdating),e.allProjectTagsInCollectionLoaded.addListener(this.aboutProjectStore.loadAllProjectTagsInCollection),e.readmeSettingUpdated.addListener(this.aboutProjectStore.readmeSettingUpdated),e.readmeSettingUpdateFailed.addListener(this.aboutProjectStore.readmeSettingUpdateFailed),e.readmeSettingUpdateStarted.addListener(this.aboutProjectStore.readmeSettingUpdateStarted),e.readmeSettingNotUpdating.addListener(this.aboutProjectStore.readmeSettingNotUpdating),e.projectDescriptionUpdated.addListener(this.projectBasicInfoStore.projectDescriptionUpdated),e.projectDescriptionUpdateFailed.addListener(this.projectBasicInfoStore.projectDescriptionUpdateFailed),e.projectDescriptionUpdateStarted.addListener(this.projectBasicInfoStore.projectDescriptionUpdateStarted),e.projectDescriptionNotUpdating.addListener(this.projectBasicInfoStore.projectDescriptionNotUpdating),this.permissionsStore=new oe.PermissionsStore("permissionsStoreChangedEvent"),e.permissionsLoaded.addListener(this.permissionsStore.loadPermissions)}}}(),function(e){de=t.ProjectOverviewTabActionsAboutProjectActionCreator={};t.ProjectOverviewTabActionsAboutProjectActionCreator.AboutProjectActionCreator=class{constructor(e,t,o,r){this._pageContext=e,this._actionsHub=t,this._storeHub=o,this._aboutProjectSource=r,this.loadInitialData=(()=>{this.loadAboutProjectData()}),this.loadAboutProjectData=(()=>{this.aboutProjectSource.getAboutProjectDataAsync().then(e=>{e?this._actionsHub.aboutProjectDataLoaded.invoke(e):this._actionsHub.aboutProjectDataLoadFailed.invoke(void 0)},e=>{this._actionsHub.aboutProjectDataLoadFailed.invoke(void 0)})}),this.loadAllProjectTagsInCollection=(()=>{const e=this._storeHub.aboutProjectStore.getState().allProjectTagsInCollectionData.tagsFetched,{projectBasicInfo:t}=this._storeHub.projectBasicInfoStore.getState();e||this.aboutProjectSource.getAllProjectTagsInCollectionDataAsync().then(e=>{this._logTelemetry("ProjectTags_FetchAllProjectTags",t,"Succeeded"),this._actionsHub.allProjectTagsInCollectionLoaded.invoke(e)},()=>{this._logTelemetry("ProjectTags_FetchAllProjectTags",t,"Failed"),this._actionsHub.allProjectTagsInCollectionLoaded.invoke([])})}),this.onSaveChanges=((e,t,o)=>{e||this._actionsHub.projectDescriptionNotUpdating.invoke(void 0),t||this._actionsHub.readmeSettingNotUpdating.invoke(void 0),o||this._actionsHub.projectTagsNotUpdating.invoke(void 0)}),this.saveProjectDescription=(e=>{this._actionsHub.projectDescriptionUpdateStarted.invoke(void 0);const{projectBasicInfo:t}=this._storeHub.projectBasicInfoStore.getState();this.aboutProjectSource.saveProjectDescription(e,t.id).then(()=>{this._logTelemetry("ProjectDescription_Update",t,"Succeeded"),this._actionsHub.projectDescriptionUpdated.invoke(e)},e=>{let o;e&&e.serverError&&"ArgumentException"===e.serverError.typeKey&&(o=e.message),this._logTelemetry("ProjectDescription_Update",t,"Failed"),this._actionsHub.projectDescriptionUpdateFailed.invoke(o)})}),this.saveReadmeSetting=(e=>{this._actionsHub.readmeSettingUpdateStarted.invoke(void 0);const{projectBasicInfo:t}=this._storeHub.projectBasicInfoStore.getState(),o=e?e.split(":"):[];let r,s,i,a;2===o.length?(r=o[0],s=o[1]):1===o.length&&(s=o[0]),s&&s.startsWith(W.TfvcPrefix)?i=H.SourceRepositoryTypes.Tfvc:(i=r&&r===W.WikiHomePage?H.SourceRepositoryTypes.Wiki:H.SourceRepositoryTypes.Git,a=s),this.aboutProjectSource.saveReadmeSetting(e,t.id).then(()=>{this._logTelemetryForReadMeSettingUpdate(t,"Succeeded",a,i),this._actionsHub.readmeSettingUpdated.invoke({repositoryId:a,repositoryType:i})},()=>{this._logTelemetryForReadMeSettingUpdate(t,"Failed",a,i),this._actionsHub.readmeSettingUpdateFailed.invoke(void 0)})}),this.saveProjectTags=(e=>{const t=this._storeHub.aboutProjectStore.getState().aboutProjectData.tagsData.tags,o=e.filter(e=>t.indexOf(e)<0),r=t.filter(t=>e.indexOf(t)<0),s=o.length,i=r.length;if(s>0||i>0){this._actionsHub.projectTagsUpdateStarted.invoke(void 0);const{projectBasicInfo:t}=this._storeHub.projectBasicInfoStore.getState(),a=t.id;this.aboutProjectSource.saveProjectTag(o,r,a).then(()=>{this._logTelemetryForTagsUpdate(t,"Succeeded",s,i),this._actionsHub.projectTagsUpdated.invoke(e)},()=>{this._logTelemetryForTagsUpdate(t,"Failed",s,i),this._actionsHub.projectTagsUpdateFailed.invoke(void 0)})}})}get aboutProjectSource(){return this._aboutProjectSource||(this._aboutProjectSource=new ie.AboutProjectSource(this._pageContext)),this._aboutProjectSource}_logTelemetryForTagsUpdate(e,t,o,r){this._logTelemetry("ProjectTags_Update",e,t,{AddedTagsCount:o,RemovedTagsCount:r})}_logTelemetryForReadMeSettingUpdate(e,t,o,r){this._logTelemetry("ProjectReadMeSettings_Update",e,t,{RepositoryId:o,RepoType:H.SourceRepositoryTypes[r]})}_logTelemetry(e,t,o,r){(r=r||{}).ProjectId=t?t.id:void 0,r.Status=o,this._pageContext.getService("IVssTelemetryService").publishEvent("ProjectOverviewPage_OverviewTab",e,r)}}}(),t.ProjectOverviewTabComponentsAboutProjectPanelAboutRegionInterfaces={},function(e){var o;pe=t[e]={},function(e){e.wikiProviderId="ms.vss-wiki-web.wiki-project-about-provider",e.codeProviderId="ms.vss-code-web.vc-project-about-provider"}(o||(o={}));function r(e,t,o){return t===H.SourceRepositoryTypes.Tfvc?W.TfvcPrefix+o:e}function i(e,t){const r=t===H.SourceRepositoryTypes.Wiki?o.wikiProviderId:o.codeProviderId;return e&&e.find(e=>e===r)}function n(e,t){return e&&e.startsWith(W.TfvcPrefix)?H.SourceRepositoryTypes.Tfvc:t===o.wikiProviderId?H.SourceRepositoryTypes.Wiki:H.SourceRepositoryTypes.Git}t[e].ContributedAboutRegion=class extends a.VssComponent{constructor(e,t){super(e,t),this._onMarkTimeToInteractive=(e=>{this.props.onMarkTTI&&this.props.onMarkTTI(e)}),this._onRadioButtonSelect=(e=>{if(e!==i(this._aboutRegionProviderIds,this.props.selectedRepoType)){this._aboutSettingsMap[e]||(this._aboutSettingsMap[e]={repositoryId:void 0,repositoryType:n(void 0,e)});const t=this._aboutSettingsMap[e];this.props.onAboutSourceChanged&&this.props.onAboutSourceChanged(t.repositoryType,t.repositoryId)}}),this._onRepoIdChanged=(e=>{const t=i(this._aboutRegionProviderIds,this.props.selectedRepoType),o=n(e,t);this._aboutSettingsMap[t]={repositoryId:e,repositoryType:o},this.props.onAboutSourceChanged&&this.props.onAboutSourceChanged(o,e)}),this._contributionService=this.context.pageContext.getService("IVssContributionService"),this._aboutSettingsMap={},this._aboutRegionProviderIds=this._contributionService.getContributionChildren("ms.vss-tfs-web.project-overview-about-region","ms.vss-web.service");const o=i(this._aboutRegionProviderIds,e.selectedRepoType);if(o){const t=r(e.selectedRepoId,e.selectedRepoType,e.projectName);this._aboutSettingsMap[o]={repositoryId:t,repositoryType:e.selectedRepoType}}this._performanceService=this.context.pageContext.getService("IVssPerformanceService"),this.state={aboutContentProviders:{},loadingProviders:!0}}componentDidMount(){super.componentDidMount(),this._performanceService.addSplitTiming("ContributedAboutRegion.FetchContentProviders.Started"),this._fetchAboutContentProviders()}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this._fetchAboutContentProviders()}render(){return s.createElement("div",{className:"about-section"},this.props.readMode?this._renderContent():this._renderEditModeAboutRegion())}_renderContent(){const e=i(this._aboutRegionProviderIds,this.props.selectedRepoType);return e?this.state.aboutContentProviders[e]?this.state.aboutContentProviders[e].getAboutRegion(this.props.readMode,r(this.props.selectedRepoId,this.props.selectedRepoType,this.props.projectName),this._onRepoIdChanged,this._onMarkTimeToInteractive,this.props.showError):s.createElement(j.Spinner,null):(this._onMarkTimeToInteractive("ServiceDisabled"),null)}_renderEditModeAboutRegion(){return this.state.loadingProviders?s.createElement(j.Spinner,null):s.createElement(s.Fragment,null,s.createElement(f.RadioButtonGroup,{text:B.AboutProjectPanelAboutSectionHeading,selectedButtonId:i(this._aboutRegionProviderIds,this.props.selectedRepoType),className:"about-choice-group",onSelect:this._onRadioButtonSelect,direction:1},this._getChangeReadmeRadioButtons()),s.createElement("div",{className:"separator"}),s.createElement("div",{className:"about-region-content"},this._renderContent()))}_fetchAboutContentProviders(){if(this._aboutRegionProviderIds)if(this.props.readMode){const e=i(this._aboutRegionProviderIds,this.props.selectedRepoType);e&&!this.state.aboutContentProviders[e]&&this._fetchAboutContentProvider(e).then(()=>{this._performanceService.addSplitTiming("ContributedAboutRegion.FetchContentProviders.End")})}else if(this.state.loadingProviders){const e=this._aboutRegionProviderIds.map(e=>this._fetchAboutContentProvider(e));Promise.all(e).then(()=>{this.setState({loadingProviders:!1})})}}_fetchAboutContentProvider(e){return this.state.aboutContentProviders[e]?Promise.resolve():this.trackPromise(this._contributionService.getService(e)).promise.then(t=>{if(t){const o=this.state.aboutContentProviders;return o[e]=t,this.setState({aboutContentProviders:o}),Promise.resolve()}},()=>{})}_getChangeReadmeRadioButtons(){const e=[];if(this._aboutRegionProviderIds)for(const t of this._aboutRegionProviderIds){const o=this.state.aboutContentProviders[t];o&&e.push(s.createElement(f.RadioButton,{className:o.getChoiceName(),id:t,text:o.getChoiceName(),disabled:this.props.disableEditing}))}return e}}}("ProjectOverviewTabComponentsAboutProjectPanelAboutRegionContributedAboutRegion"),function(e){le=t[e]={};t[e].AboutProjectCard=(e=>{const t=(e.tags||[]).map(e=>({text:e,tagItemAriaLabel:(0,m.format)(B.Tag_ItemNameAriaLabel,e),deleteButtonAriaLabel:(0,m.format)(B.Tag_DeleteButtonAriaLabel,e),isFocusable:!1})),{description:o,onEditProject:r,onMarkTTI:i,projectId:c,projectName:d,repoId:p,repoType:l,showEditOption:g,showLikes:h,aboutProjectTitleId:v}=e;return s.createElement(n.Card,{className:"project-overview-card"},s.createElement("div",{className:"about-project-card project-overview-card-container",role:"region","aria-labelledby":v},s.createElement("div",{className:"title-section flex"},s.createElement("div",{className:"title-m",role:"heading","aria-level":3,id:v},B.AboutProjectTitle),s.createElement("div",{className:"title-right-content flex"},h&&s.createElement("div",{className:"like-component"},s.createElement(a.WrappedComponent,{dependencies:["ms.vss-social.vss-social-likes"],wrappedType:"statefulLikeHeart",wrappedProps:{className:"project-like-component",ariaLabelLiked:B.LikeButton_Liked,ariaLabelUnliked:B.LikeButton_Unliked,likeArtifactInfo:{artifactId:c,artifactType:"Project",artifactScopeType:"Project",artifactScopeId:c}}})),g&&s.createElement(u.Button,{subtle:!0,className:"project-description-edit-button",tooltipProps:{text:B.AboutProjectEditButtonAriaLabel},iconProps:{iconName:"Edit"},onClick:r}))),o&&s.createElement("div",{className:"description about-project-description font-size-m"},o),s.createElement("div",{className:"tags-component"},s.createElement(a.RegionComponent,{className:"languages-section",componentRegion:"projectOverviewLanguagesRegion",childComponentProperties:{showHeader:!0}}),t.length>0&&s.createElement("div",{className:"tags-section"},s.createElement("div",{className:"title title-xs"},B.AboutProjectPanelTagsHeading),s.createElement(b.LegacyComponent,{wrappedType:"TFS.ProjectOverview.TagListControl",modules:["ProjectOverview/Scripts/Shared/Components/TagListControl"],tags:t,editMode:!1,listAriaLabel:B.ProjectTags_AriaLabel}))),s.createElement("div",{className:"about-section"},s.createElement(pe.ContributedAboutRegion,{projectName:d,readMode:!0,showError:g,selectedRepoId:p,selectedRepoType:l,onMarkTTI:i}))))})}("ProjectOverviewTabComponentsAboutProjectAboutProjectCard"),function(e){ue=t[e]={};t[e].AddDescriptionUpsell=(e=>s.createElement(n.Card,{className:"project-overview-card"},s.createElement("div",{className:"project-overview-card-container add-description-upsell",role:"region","aria-labelledby":e.aboutProjectTitleId},s.createElement("div",{className:"upsell-title title-m",role:"heading","aria-level":3,id:e.aboutProjectTitleId},B.AboutProjectTitle),s.createElement("div",{className:"upsell-content flex"},s.createElement("div",{className:"upsell-left-content flex flex-column"},s.createElement("div",{className:"upsell-heading title-xs"},e.showEditOption?B.AboutProjectUpsellHeading:B.AboutProjectUpsellHeading_NoPermission),s.createElement("div",{className:"upsell-message font-size-m"},e.showEditOption?B.AboutProjectUpsellMessage:B.AboutProjectUpsellMessage_NoPermission),e.showEditOption&&s.createElement(u.Button,{className:"upsell-add-button",onClick:e.onAddDescriptionClick,iconProps:{iconName:"Add"},text:B.AboutProjectUpsellButtonText})),s.createElement("div",{className:"upsell-right-image"},s.createElement(c.Image,{src:e.imageLocation,alt:""}))))))}("ProjectOverviewTabComponentsAboutProjectAddDescriptionUpsell"),function(e){var o;ge=t[e]={},function(e){e[e.hide=0]="hide",e[e.showInReadMode=1]="showInReadMode",e[e.showInEditMode=2]="showInEditMode",e[e.showSaving=3]="showSaving",e[e.showError=4]="showError"}(o=t[e].PanelDisplayMode||(t[e].PanelDisplayMode={}));t[e].AboutProject=class extends a.VssComponent{constructor(e,t){super(e,t),this._markTTI=(e=>{this._ttiMarked||(this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive("ProjectOverviewPage","ProjectOverviewPage.Loaded",void 0,{source:e}),this._ttiMarked=!0)}),this._onUpdated=(()=>{const e=this.props.storesHub.projectBasicInfoStore.getState(),t=this.props.storesHub.aboutProjectStore.getState();if(t.readmeSettingUpdateState===q.UpdatingState.Failed||e.descriptionUpdateState===q.UpdatingState.Failed||t.projectTagsUpdateState===q.UpdatingState.Failed){const r=Object.assign({},this.state.panelState),{aboutProjectData:s}=t,{projectBasicInfo:i}=e;if(s&&i){if(t.readmeSettingUpdateState===q.UpdatingState.Succeeded){const{repositoryId:e,sourceRepositoryType:t}=s;r.repoId=e,r.repoType=t}t.projectTagsUpdateState===q.UpdatingState.Succeeded&&(r.tags=s.tagsData.tags),e.descriptionUpdateState===q.UpdatingState.Succeeded&&(r.description=i.description)}r.panelError=Object.assign(Object.assign({},r.panelError),{descriptionError:e.descriptionError}),r.displayMode=o.showError,this.setState({panelState:r,projectBasicData:e.projectBasicInfo,aboutProjectData:t.aboutProjectData})}else t.readmeSettingUpdateState!==q.UpdatingState.InProgress&&e.descriptionUpdateState!==q.UpdatingState.InProgress&&t.projectTagsUpdateState!==q.UpdatingState.InProgress&&((0,T.announce)(B.AboutProjectChangesSavedMessage,!0),this.setState({projectBasicData:e.projectBasicInfo,panelState:this._getPanelStateFromStores(),aboutProjectData:t.aboutProjectData}))}),this._onAboutProjectChange=(()=>{const{aboutProjectData:e,allProjectTagsInCollectionData:t}=this.props.storesHub.aboutProjectStore.getState();let o;o=e?Object.assign(Object.assign({},this.state.panelState),{tags:e.tagsData.tags,repoId:e.repositoryId,repoType:e.sourceRepositoryType}):this.state.panelState,this.setState({loadingState:this._getLoadingState(),aboutProjectData:e,allProjectTagsInCollection:t.tags,panelState:o})}),this._onCurrentUserInfoChange=(()=>{const e=this.props.storesHub.currentUserInfoStore.getState();this.setState({loadingState:this._getLoadingState(),currentUserPermission:e.currentUserPermission})}),this._onProjectBasicInfoChange=(()=>{const{projectBasicInfo:e}=this.props.storesHub.projectBasicInfoStore.getState();this.setState({loadingState:this._getLoadingState(),projectBasicData:e,panelState:e?Object.assign(Object.assign({},this.state.panelState),{description:e.description}):this.state.panelState})}),this._getLoadingState=(()=>{const e=this.props.storesHub.aboutProjectStore.getState(),t=this.props.storesHub.projectBasicInfoStore.getState(),o=this.props.storesHub.currentUserInfoStore.getState();return e.loadingState===q.StoreLoadingState.LoadFailed||t.loadingState===q.StoreLoadingState.LoadFailed||o.loadingState===q.StoreLoadingState.LoadFailed?q.StoreLoadingState.LoadFailed:e.loadingState===q.StoreLoadingState.Loading||t.loadingState===q.StoreLoadingState.Loading||o.loadingState===q.StoreLoadingState.Loading?q.StoreLoadingState.Loading:q.StoreLoadingState.Loaded}),this._onEditProject=(e=>{this.context.pageContext.getService("IVssTelemetryService").publishEvent("ProjectOverviewPage_OverviewTab","AboutProjectPanel",{Event:"Show_Panel",Source:e}),this.props.actionCreator.loadAllProjectTagsInCollection(),this._updatePanelDisplayMode(o.showInEditMode)}),this._onAboutProjectCardEditButtonClick=(()=>{this._onEditProject("AboutProjectCard_EditButton")}),this._onAboutProjectPanelEditButtonClick=(()=>{this._onEditProject("Panel_EditButton")}),this._onAddDescriptionClick=(()=>{this._onEditProject("AddDescription_Upsell")}),this._onCancelClick=(()=>{this.setState({panelState:this._getPanelStateFromStores()})}),this._onSaveChanges=(()=>{const{description:e,tags:t,repoId:r,repoType:s}=this.state.panelState,{aboutProjectData:i}=this.props.storesHub.aboutProjectStore.getState(),{projectBasicInfo:a}=this.props.storesHub.projectBasicInfoStore.getState();if(i&&a){const{repositoryId:n,sourceRepositoryType:c,tagsData:p}=i,l=a.description!==e,u=n!==r||c!==s,g=!(0,d.arrayEquals)(p.tags,t,(e,t)=>0===(0,m.localeIgnoreCaseComparer)(e,t));this.context.pageContext.getService("IVssTelemetryService").publishEvent("ProjectOverviewPage_OverviewTab","AboutProjectPanel",{ProjectId:a?a.id:void 0,IsDescriptionChanged:l,IsTagListChanged:g,IsReadmeInfoChanged:u,Event:"SaveButtonClick"}),this._updatePanelDisplayMode(o.showSaving),l||g||u?(l&&this.props.actionCreator.saveProjectDescription(e),u&&this.props.actionCreator.saveReadmeSetting(this._getReadmeSetting(s,r)),g&&this.props.actionCreator.saveProjectTags(t),this.props.actionCreator.onSaveChanges(l,u,g)):this._onCancelClick()}}),this._onDescriptionChanged=(e=>{this.setState({panelState:Object.assign(Object.assign({},this.state.panelState),{description:e})})}),this._onAboutSourceChanged=((e,t)=>{this.setState({panelState:Object.assign(Object.assign({},this.state.panelState),{repoId:t,repoType:e})})}),this._onTagListChanged=((e,t,o)=>{const r=this.state.panelState.panelError;this.setState({panelState:Object.assign(Object.assign({},this.state.panelState),{tags:e,invalidTag:o,panelError:Object.assign(Object.assign({},r),{tagErrorMessage:t})})})}),this._onOverlayCtaButtonClick=(()=>{const{tagErrorMessage:e,descriptionError:t}=this.state.panelState.panelError;t||e?this._updatePanelDisplayMode(o.showInEditMode):this._onSaveChanges()}),this._aboutProjectTitleId=(0,g.getId)("aboutProjectTitleId"),this._ttiMarked=!1;const r=this.props.storesHub.aboutProjectStore.getState(),s=this.props.storesHub.projectBasicInfoStore.getState(),i=this.props.storesHub.currentUserInfoStore.getState();this.state={aboutProjectData:r.aboutProjectData,loadingState:this._getLoadingState(),projectBasicData:s.projectBasicInfo,currentUserPermission:i.currentUserPermission,allProjectTagsInCollection:r.allProjectTagsInCollectionData.tags,descriptionError:s.descriptionError,panelState:this._getPanelStateFromStores()}}componentDidMount(){super.componentDidMount(),this.props.storesHub.aboutProjectStore.addChangedListener(this._onAboutProjectChange),this.props.storesHub.currentUserInfoStore.addChangedListener(this._onCurrentUserInfoChange),this.props.storesHub.projectBasicInfoStore.addChangedListener(this._onProjectBasicInfoChange),this.props.storesHub.projectBasicInfoStore.addListener(ne.ProjectBasicInfoStoreEvents.DescriptionUpdateEvent,this._onUpdated),this.props.storesHub.aboutProjectStore.addListener(ae.AboutProjectStoreEvents.UpdateEvent,this._onUpdated),this._markAddDescriptionUpsellTti()}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this._markAddDescriptionUpsellTti()}componentWillUnmount(){this.props.storesHub.aboutProjectStore.removeChangedListener(this._onAboutProjectChange),this.props.storesHub.currentUserInfoStore.removeChangedListener(this._onCurrentUserInfoChange),this.props.storesHub.projectBasicInfoStore.removeChangedListener(this._onProjectBasicInfoChange),this.props.storesHub.projectBasicInfoStore.removeListener(ne.ProjectBasicInfoStoreEvents.DescriptionUpdateEvent,this._onUpdated),this.props.storesHub.aboutProjectStore.removeListener(ae.AboutProjectStoreEvents.UpdateEvent,this._onUpdated),super.componentWillUnmount()}render(){switch(this.state.loadingState){case q.StoreLoadingState.Loading:return s.createElement(j.Spinner,null);case q.StoreLoadingState.LoadFailed:return null;default:const e=this.state.aboutProjectData,t=this.state.projectBasicData;if(e&&t){const r=this._hasEditPermission(),i=(0,z.getFeatureFlagState)(this.context.pageContext,"WebAccess.Project.NewOverviewPage.Likes");return s.createElement(s.Fragment,null,this._shouldShowAddDescriptionUpsell()?s.createElement(ue.AddDescriptionUpsell,{showEditOption:r,imageLocation:this._getUpsellImageLocation(),onAddDescriptionClick:this._onAddDescriptionClick,aboutProjectTitleId:this._aboutProjectTitleId}):s.createElement(le.AboutProjectCard,{description:t.description,onEditProject:this._onAboutProjectCardEditButtonClick,showLikes:i,projectId:t.id,tags:e.tagsData.tags,projectName:t.name,repoId:e.repositoryId,repoType:e.sourceRepositoryType,showEditOption:r,onMarkTTI:this._markTTI,aboutProjectTitleId:this._aboutProjectTitleId}),this.state.panelState.displayMode!==o.hide&&s.createElement(a.WrappedComponent,{dependencies:["ms.vss-tfs-web.about-project-panel"],wrappedType:"TFS.ProjectOverview.AboutProjectPanel",panelState:this.state.panelState,projectName:t.name,showEditOption:r,allProjectTagsInCollection:this.state.allProjectTagsInCollection,onSaveClick:this._onSaveChanges,onEditClick:this._onAboutProjectPanelEditButtonClick,onCancelClick:this._onCancelClick,onOverlayCtaButtonClick:this._onOverlayCtaButtonClick,onDescriptionChanged:this._onDescriptionChanged,onTagListChanged:this._onTagListChanged,onAboutSourceChanged:this._onAboutSourceChanged}))}return null}}_getUpsellImageLocation(){return(0,z.getImageLocation)(this.context.pageContext,"ms.vss-tfs-web/project-overview-content/ProjectOverviewTab/Images/add_description_upsell.svg")}_shouldShowAddDescriptionUpsell(){const e=this.state.aboutProjectData;return!(this.state.projectBasicData&&this.state.projectBasicData.description||!e||0!==e.tagsData.tags.length||e.repositoryId||e.sourceRepositoryType)}_hasEditPermission(){return!!this.state.currentUserPermission&&this.state.currentUserPermission.hasProjectLevelEditPermission&&this.state.currentUserPermission.hasManageProjectPropertiesPermission}_markAddDescriptionUpsellTti(){!this._ttiMarked&&this._shouldShowAddDescriptionUpsell()&&this._getLoadingState()!==q.StoreLoadingState.Loading&&this._markTTI("AddDescriptionUpsell")}_getPanelStateFromStores(){const e=this.props.storesHub.aboutProjectStore.getState().aboutProjectData,{projectBasicInfo:t,descriptionError:r}=this.props.storesHub.projectBasicInfoStore.getState();return{description:t?t.description:"",displayMode:o.hide,invalidTag:void 0,panelError:{tagErrorMessage:void 0,descriptionError:r},repoId:e?e.repositoryId:void 0,repoType:e?e.sourceRepositoryType:void 0,tags:e?e.tagsData.tags:[]}}_getReadmeSetting(e,t){const o=t||"";return e===H.SourceRepositoryTypes.Wiki?W.WikiHomePage+":"+o:o}_updatePanelDisplayMode(e){this.setState({panelState:Object.assign(Object.assign({},this.state.panelState),{displayMode:e})})}}}("ProjectOverviewTabComponentsAboutProjectAboutProject"),function(e){t.ProjectOverviewTabProjectOverviewTab={};a.VssComponent.register("TFS.ProjectOverviewPage.ProjectOverviewTab",class extends a.VssComponent{constructor(e,t){super(e,t),this._onPermissionChange=(()=>{this.setState({permissions:this._storesHub.permissionsStore.getState().permissions})}),this._performance=t.pageContext.getService("IVssPerformanceService"),this._performance.addSplitTiming("ProjectOverviewTab.render.Start");const o=new V.ActionsHub;this._storesHub=new ce.StoresHub(o,e.projectBasicInfoStore,e.currentUserInfoStore),this._aboutProjectActionCreator=new de.AboutProjectActionCreator(t.pageContext,o,this._storesHub),this._projectOverviewTabActionCreator=new G.ProjectOverviewTabActionCreator(t.pageContext,o);const r=(0,z.getFeatureFlagState)(this.context.pageContext,"WebAccess.Project.Verticals.OverviewPage.UseIsAnyServiceInitializedData");let s=!0;const i=t.pageContext.getService("IVssContributionService");if(r){const e=i.getData("ms.vss-tfs-web.about-project-data-provider-verticals");s=!!e&&e.aboutProjectData&&!e.aboutProjectData.isAnyServiceInitialized}else{const e=i.getContributionChildren("ms.vss-tfs-web.project-overview-tab-data","ms.vss-tfs-web.service-status-info");s=!!e&&0===e.length}this.state={permissions:this._storesHub.permissionsStore.getState().permissions,showDayZeroComponent:s}}render(){const{permissions:e,showDayZeroComponent:t}=this.state,{projectMembersActionCreator:o,projectMembersStore:r}=this.props;return s.createElement(U.Surface,{background:1},s.createElement(w.Page,{className:"project-overview-tab flex flex-noshrink absolute-fill"},s.createElement("div",{className:"flex overview-region"},s.createElement("div",{className:"left-region"},t?s.createElement(J.ProjectOverviewDayZeroComponent,{className:"po-day-zero",currentUserInfoStore:this._storesHub.currentUserInfoStore}):s.createElement(ge.AboutProject,{actionCreator:this._aboutProjectActionCreator,storesHub:this._storesHub})),s.createElement("div",{className:"right-region"},s.createElement(a.WrappedComponent,{dependencies:["ms.vss-tfs-web.project-overview-tab-stats-section"],wrappedType:"TFS.ProjectOverviewPage.ProjectOverviewTab.RightSection",wrappedProps:{permissions:e,projectMembersActionCreator:o,projectMembersStore:r}})))))}componentDidMount(){super.componentDidMount(),this._performance.addSplitTiming("ProjectOverviewTab.render.End"),this._storesHub.permissionsStore.addChangedListener(this._onPermissionChange),this._aboutProjectActionCreator.loadInitialData(),this.setTimeout(()=>{this._projectOverviewTabActionCreator.loadPermissions()},0)}componentWillUnmount(){this._storesHub.permissionsStore.removeChangedListener(this._onPermissionChange),super.componentWillUnmount()}});a.VssComponent.register("TFS.ProjectOverviewPage.ProjectOverviewTab.RightSection",class extends a.VssComponent{render(){const{permissions:e,projectMembersActionCreator:t,projectMembersStore:o}=this.props;return s.createElement(s.Fragment,null,s.createElement(K.StatsSection,null),e.hasViewActivityPanePermission?s.createElement(te.ProjectMembers,{className:"project-overview-card",headingLevel:3,actionCreator:t,store:o}):null)}})}(),function(e){he=t.ComponentsWrappedComponentContextProvider={},t.ComponentsWrappedComponentContextProvider.WrappedComponentContextProvider=function(e){return s.createElement(s.Fragment,null,s.createElement(a.WrappedComponent,Object.assign({},e,{onDependenciesResolved:async()=>{e.onDependenciesResolved&&await e.onDependenciesResolved()},loadingComponent:()=>s.createElement(s.Fragment,null,e.children)}),e.children))}}(),function(e){ve=t[e]={},t[e].InviteUsersContext=s.createContext(void 0),t[e].InviteUsersContextProvider=function(o){return(0,a.useComponentContext)(),o.isOnPrem?s.createElement(t[e].InviteUsersContext.Provider,{value:{useLegacyComponent:!0,onFlowStart:()=>void 0}},o.children):s.createElement(he.WrappedComponentContextProvider,Object.assign({context:t[e].InviteUsersContext,modules:["Aex/UserManagement/UserHub/EntryPoints/InviteUserContextProvider"],wrappedType:"inviteUserContextProvider",dependencies:["ms.vss-aex-user-management.aex-user-management-service-context","ms.vss-aex-user-management.aex-user-hub-data-provider","ms.vss-aex-user-management.collection-user-management-shared-data","ms.vss-aex-user-management.user-hub-content"]},o))}}("ComponentsInviteUsersContext"),function(e){Se=t.ComponentsProjectImage={};t.ComponentsProjectImage.ProjectImage=(e=>{const t=A.AnimationClassNames.fadeIn400;return e.isProjectImageSet?s.createElement(y.VssPersona,{imageUrl:e.projectImageUrl,displayName:e.projectName,suppressPersonaCard:!0,size:"large",cssClass:"project-persona"}):void 0===e.isProjectImageSet?s.createElement("div",{className:"placeholder"}):s.createElement(y.VssPersona,{className:(0,d.css)("project-persona",t),displayName:e.projectName,size:"large",suppressPersonaCard:!0})})}(),function(e){var o;me=t.ComponentsProjectVisibilityTag={},function(e){e.EveryoneInTenant="EveryoneInTenant",e.TeamMembers="TeamMembers",e.Everyone="Everyone"}(o||(o={}));t.ComponentsProjectVisibilityTag.ProjectVisibilityTag=(e=>{if(e.visibility){const{tooltipText:t,iconName:r,displayText:i}=function(e){switch(e){case o.TeamMembers:return{displayText:"Private",iconName:"Lock",tooltipText:B.VisibilityTag_PrivateProject_Tooltip_Text};case o.EveryoneInTenant:return{displayText:"Enterprise",iconName:"CityNext",tooltipText:B.VisibilityTag_OrgVisibleProject_Tooltip_Text};case o.Everyone:return{displayText:"Public",iconName:"Globe",tooltipText:B.VisibilityTag_PublicProject_Tooltip_Text};default:throw new Error((0,m.format)(B.VisibilityTag_VisibilityValueInvalid,e))}}(e.visibility);return s.createElement(u.Button,{className:e.className,iconProps:{iconName:r},ariaLabel:t,autoFocus:!1,excludeTabStop:!0,tooltipProps:{text:t}},e.isSmallScreen?"":s.createElement("span",{"aria-hidden":"true",className:"body-m"},i))}return null})}(),function(e){Pe=t.ComponentsProjectOverviewPageHeader={};t.ComponentsProjectOverviewPageHeader.ProjectOverviewPageHeader=class extends a.VssComponent{constructor(e,t){super(e,t),this.state={showAddUserDialogContainer:this.props.showInviteButton&&this.props.addUserDialogProps.showAddUsersDialog,commandBarItems:this.getCommandBarItems()}}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.props.showInviteButton&&this.props.addUserDialogProps.showAddUsersDialog&&!this.state.showAddUserDialogContainer&&this.setState({showAddUserDialogContainer:!0})}render(){const{className:e,projectBasicData:t,addUserDialogProps:o,showInviteButton:r,showFavorites:i,isHosted:n,onEditNameClick:c,userPermissions:p,projectImageUrl:l}=this.props,{showAddUserDialogContainer:g}=this.state;return s.createElement(ve.InviteUsersContextProvider,{projectOrTeamDisplayName:t.name,projectId:t.id,onUsersAdded:o.onAddUsersActionComplete},s.createElement(E.ScreenSizeObserver,null,h=>{const v=0===h.screenSize;return s.createElement("div",{className:(0,d.css)("po-page-header",e)},n&&!v&&s.createElement(ve.InviteUsersContext.Consumer,null,e=>e&&e.useLegacyComponent?s.createElement("div",{className:"add-user-dialog-container",role:"presentation"},s.createElement(b.LegacyComponent,Object.assign({wrappedType:"TFS.ProjectOverview.AddUserDialog",modules:["ProjectOverview/Scripts/Components/AddUserDialogComponent"]},o,{hidden:!g}))):null),s.createElement("div",{className:(0,d.css)("page-title-container flex-row",v&&"flex-center"),role:"region","aria-label":B.ProjectInformationRegion_Label},s.createElement("div",{className:(0,d.css)("left-content flex-row flex-center flex-grow",v&&"scroll-hidden")},s.createElement("div",{className:"project-image-container"},s.createElement(Se.ProjectImage,{isProjectImageSet:t.isProjectImageSet,projectName:t.name,projectImageUrl:l})),s.createElement("h1",{className:(0,d.css)("project-name-container text-ellipsis",v?"title-m":"title-l"),tabIndex:-1},t.name),p.isLoggedIn&&s.createElement(u.Button,{className:"settings-icon",subtle:!0,ariaLabel:B.AboutProjectEditButtonAriaLabel,iconProps:{iconName:"Settings"},onClick:c})),s.createElement("div",{className:"right-content flex flex-noshrink project-actions-container"},s.createElement(me.ProjectVisibilityTag,{visibility:t.visibility,isSmallScreen:v,className:"proj-visibility-container"}),r&&this.renderInviteUserButton(v),s.createElement(O.Observer,{items:this.state.commandBarItems},e=>s.createElement(D.HeaderCommandBar,{items:e.items})),i&&s.createElement("div",{className:"po-favorite-container"},s.createElement(a.WrappedComponent,{dependencies:["ms.vss-favorites.favorites-star"],wrappedType:"favoritesStar",wrappedProps:{className:"po-favorite font-size-ml",favoritedArialabel:B.FavoritesButton_Favorited,unFavoritedArialabel:B.FavoritesButton_UnFavorited,artifact:{artifactId:t.id,artifactType:"Microsoft.TeamFoundation.Classification.TeamProject",artifactName:t.name,artifactScope:{id:t.id,type:"Project",name:t.name}}}})))))}))}getCommandBarItems(){return(0,L.getMenuItems)(this.context.pageContext,"ms.vss-tfs-web.project-overview-contributed-header-buttons")}renderInviteUserButton(e){const{onInviteButtonClick:t}=this.props;return s.createElement(ve.InviteUsersContext.Consumer,null,o=>o?s.createElement(u.Button,{primary:!0,className:"invite-button",ariaLabel:B.InviteButtonText,text:e?"":B.InviteButtonText,tooltipProps:{text:e?B.InviteButtonText:""},iconProps:{iconName:"AddGroup"},onClick:()=>{t(),o.onFlowStart()}}):null)}}}(),function(e){je=t.StoresStoresHub={};t.StoresStoresHub.StoresHub=class{constructor(e){this._loadProjectInfo=(e=>{this.projectBasicInfoStore.loadProjectInfo(e.projectBasicData)}),this._loadCurrentUserInfo=(e=>{this.currentUserInfoStore.loadCurrentUserInfo(e.currentUser)}),this.projectBasicInfoStore=new ne.ProjectBasicInfoStore("projectBasicInfoStoreChangedEvent"),e.projectOverviewPageLoaded.addListener(this._loadProjectInfo),e.projectOverviewPageLoadFailed.addListener(this.projectBasicInfoStore.loadProjectInfoFailed),this.currentUserInfoStore=new Y.CurrentUserInfoStore("currentUserInfoStoreChangedEvent"),e.projectOverviewPageLoaded.addListener(this._loadCurrentUserInfo),e.projectOverviewPageLoadFailed.addListener(this.currentUserInfoStore.loadCurrentUserInfoFailed),this.projectMembersStore=new ee.ProjectMembersStore("projectMembersStoreChangedEvent"),e.projectMembersFetched.addListener(this.projectMembersStore.loadMembersInfo),e.projectMembersFetchFailed.addListener(this.projectMembersStore.loadMembersInfoFailed)}}}(),function(e){be=t.ComponentsProjectOverviewPage={};t.ComponentsProjectOverviewPage.ProjectOverviewPage=class extends a.VssComponent{constructor(e,t){super(e,t),this._onProjectInfoStoreChange=(()=>{const{projectBasicInfoStore:e}=this.props.storesHub,t=e.getState();this.setState({loadingState:this._getLoadingState(),projectBasicInfo:t.projectBasicInfo})}),this._onCurrentUserInfoStoreChange=(()=>{const{currentUserInfoStore:e}=this.props.storesHub,t=e.getState();this.setState({loadingState:this._getLoadingState(),userPermissions:t.currentUserPermission})}),this._getLoadingState=(()=>{const{currentUserInfoStore:e,projectBasicInfoStore:t}=this.props.storesHub,o=e.getState(),r=t.getState();return o.loadingState===q.StoreLoadingState.Loading||r.loadingState===q.StoreLoadingState.Loading?q.StoreLoadingState.Loading:o.loadingState===q.StoreLoadingState.Loaded&&r.loadingState===q.StoreLoadingState.Loaded?q.StoreLoadingState.Loaded:q.StoreLoadingState.LoadFailed}),this._onAddUserDialogLoadStarted=(()=>{this.setState({userDialogLoading:!0})}),this._onAddUserDialogLoadCompleted=(()=>{this.setState({userDialogLoading:!1})}),this._onAddUserDialogDismiss=(()=>{this.setState({showAddUsersDialog:!1})}),this._onAddUsersActionComplete=(()=>{this.props.projectMembersActionCreator.fetchProjectMembers(!0),this.setState({showAddUsersDialog:!1})}),this._onInviteButtonClick=(()=>{if(this.context.pageContext.getService("IVssTelemetryService").publishEvent("ProjectOverviewPage","InviteButtonClick",{ProjectId:this.state.projectBasicInfo?this.state.projectBasicInfo.id:void 0}),this.state.isHosted)this.setState({showAddUsersDialog:!0});else{const e=this.context.pageContext.getService("ILegacyPlatformService");e.getLegacyPageContext(!0).then(t=>{e.requireModules(["Admin/Scripts/TFS.Admin.Registration.HostPlugins","VSS/Events/Action"]).then(([e,o])=>{o.getService().performAction("manage-team-members",{teamName:t.webContext.project.name,teamId:t.webContext.team.id,callback:e=>{e&&this.props.projectMembersActionCreator.fetchProjectMembers(!0)}})})})}}),this._onEditNameClick=(()=>{const e=this.state.projectBasicInfo.name,t=(0,l.routeUrl)(this.context.pageContext,"ms.vss-admin-web.project-admin-hub-route",{project:e});window.location.href=t,this.context.pageContext.getService("IVssTelemetryService").publishEvent("ProjectOverviewPage","EditNameButtonClick",{ProjectId:this.state.projectBasicInfo?this.state.projectBasicInfo.id:void 0})});const{currentUserInfoStore:o,projectBasicInfoStore:r,projectMembersStore:s}=this.props.storesHub,i=r.getState(),a=t.pageContext.getService("ITfsPageService").getData();a&&a.project&&(this._projectImageUrl=a.project.imageUrl),this._hubViewState=new k.VssHubViewState(t.pageContext,{defaultPivot:"overview"}),this._pivotProviders=[new R.ContributedPivotBarItemProvider({pageContext:t.pageContext,tabGroupIds:["ms.vss-tfs-web.project-overview-tabs"],props:{currentUserInfoStore:o,projectBasicInfoStore:r,projectMembersActionCreator:e.projectMembersActionCreator,projectMembersStore:s}})];const n=t.pageContext.getService("IVssPageService").getData(),c=t.pageContext.getService("IFavoritesService");this.state={showAddUsersDialog:!1,userDialogLoading:!1,showFavorites:c.canUseFavorites(),loadingState:this._getLoadingState(),projectBasicInfo:i.projectBasicInfo,userPermissions:o.getState().currentUserPermission,isHosted:!!n&&n.isHosted}}componentDidMount(){super.componentDidMount(),this.props.storesHub.currentUserInfoStore.addChangedListener(this._onCurrentUserInfoStoreChange),this.props.storesHub.projectBasicInfoStore.addChangedListener(this._onProjectInfoStoreChange)}componentWillUnmount(){this.props.storesHub.currentUserInfoStore.removeChangedListener(this._onCurrentUserInfoStoreChange),this.props.storesHub.projectBasicInfoStore.removeChangedListener(this._onProjectInfoStoreChange),super.componentWillUnmount()}render(){if(this.state.loadingState===q.StoreLoadingState.Loading)return s.createElement(j.Spinner,null);if(this.state.loadingState===q.StoreLoadingState.Loaded){const e=this.state.projectBasicInfo,t={onAddUserDialogLoadStarted:this._onAddUserDialogLoadStarted,onAddUserDialogLoadCompleted:this._onAddUserDialogLoadCompleted,onAddUsersActionComplete:this._onAddUsersActionComplete,onAddUserDialogDismiss:this._onAddUserDialogDismiss,showAddUsersDialog:this.state.showAddUsersDialog};return s.createElement(x.Fabric,{className:"project-overview-page"},s.createElement(N.Hub,{pivotBarContentAriaLabel:B.ProjectOverviewContentAriaLabel,className:"po-hub",hubViewState:this._hubViewState,pivotProviders:this._pivotProviders,hideFullScreenToggle:!0},s.createElement(F.HubHeader,null,s.createElement(Pe.ProjectOverviewPageHeader,{className:"po-header flex flex-grow scroll-hidden",projectBasicData:e,showInviteButton:this.state.userPermissions.isAdmin,addUserDialogProps:t,onInviteButtonClick:this._onInviteButtonClick,showFavorites:this.state.showFavorites,isHosted:this.state.isHosted,onEditNameClick:this._onEditNameClick,projectImageUrl:this._projectImageUrl,userPermissions:this.state.userPermissions}))),this.showOverlay&&s.createElement(M.Overlay,{className:"project-overview-overlay flex flex-center justify-center",isDarkThemed:!0},s.createElement(j.Spinner,{size:"large",label:B.Loading_Label,ariaLive:"assertive"})))}}get showOverlay(){return this.state.showAddUsersDialog&&this.state.userDialogLoading}}}(),function(e){t.View={};a.VssComponent.register("TFS.ProjectOverviewPage",class extends a.VssComponent{constructor(e,t){super(e,t),this._performanceService=t.pageContext.getService("IVssPerformanceService"),this._performanceService.addSplitTiming("ProjectOverviewPageView.render.Start");const o=new $.ActionsHub;this._storesHub=new je.StoresHub(o),this._projectOverviewPageActionCreator=new se.ProjectOverviewPageActionCreator(t.pageContext,o),this._projectMembersActionCreator=new X.ProjectMembersActionCreator(t.pageContext,o)}componentDidMount(){super.componentDidMount(),this._projectOverviewPageActionCreator.loadProjectOverviewData(),this._performanceService.addSplitTiming("ProjectOverviewPageView.render.End")}render(){const e={storesHub:this._storesHub,projectOverviewActionCreator:this._projectOverviewPageActionCreator,projectMembersActionCreator:this._projectMembersActionCreator};return s.createElement(be.ProjectOverviewPage,Object.assign({},e))}})}()},["Resources","ProjectOverviewTab/Models","ProjectOverviewTab/Actions/ActionsHub","Constants","ProjectOverviewTab/Constants","ProjectOverviewTab/Sources/PermissionsSource","ProjectOverviewTab/Actions/ProjectOverviewTabActionCreator","ProjectOverviewTab/Utils","Shared/Contracts","Shared/Models","Shared/CurrentUserInfoStore","ProjectOverviewTab/Components/ProjectOverviewDayZeroComponent","ProjectOverviewTab/Components/ServiceLink","ProjectOverviewTab/Components/StatsSection","Actions/ActionsHub","Shared/ProjectMembersSource","Shared/ProjectMembersActionCreator","Shared/ProjectMembersStore","ProjectOverviewTab/MembersRegion/ProjectMembers","ProjectOverviewTab/Stores/PermissionsStore","Shared/ProjectOverviewPageDataProviderSource","Actions/ProjectOverviewPageActionCreator","RestClient/Operations","ProjectOverviewTab/Sources/AboutProjectSource","ProjectOverviewTab/Stores/AboutProjectStore","Shared/ProjectBasicInfoStore","ProjectOverviewTab/Stores/StoresHub","ProjectOverviewTab/Actions/AboutProjectActionCreator","ProjectOverviewTab/Components/AboutProject/PanelAboutRegion/Interfaces","ProjectOverviewTab/Components/AboutProject/PanelAboutRegion/ContributedAboutRegion","ProjectOverviewTab/Components/AboutProject/AboutProjectCard","ProjectOverviewTab/Components/AboutProject/AddDescriptionUpsell","ProjectOverviewTab/Components/AboutProject/AboutProject","ProjectOverviewTab/ProjectOverviewTab","Components/WrappedComponentContextProvider","Components/InviteUsersContext","Components/ProjectImage","Components/ProjectVisibilityTag","Components/ProjectOverviewPageHeader","Stores/StoresHub","Components/ProjectOverviewPage","View"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-tfs-web.project-overview-content"}}));